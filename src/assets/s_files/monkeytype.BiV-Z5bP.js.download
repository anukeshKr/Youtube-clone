const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/vendor.CUQxkLCO.js","js/vendor-firebase.BjJDqVEz.js","js/monkeytype-packages.DtRyCVe8.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill.CHaCowSW.js";import{e as Ht,a as fe,p as Da,c as re,t as vt,b as Vs,s as te,h as V,d as Mo,f as Te,g as tn,r as Wa,i as My,j as _k,k as Ay,m as Ik,n as or,z as qk,o as Fo,q as on,u as Bk,v as Ey,w as _y,x as pi,y as Fk,A as Ka,B as Rk,C as Dk,D as br,E as ps,F as Xt,G as Iy,H as an,I as Wk,J as Pk,K as zk,L as qy,M as Hk,N as ng,O as Ok,P as Nk,Q as rg,R as md,S as Uk,T as Vk,U as pp}from"./misc.DyMvgR8O.js";/* empty css              */import{$ as i}from"./vendor-jquery.CemiuikS.js";import{h as U,y as eo,s as Kk,t as Gu,e as Gk,T as jk,S as By,g as ar,x as wc,f as be,c as vr,a as Fy,d as gd,b as Qk,E as vn,i as Ql,j as tl,M as ol,C as Ry,k as Yl,V as Yk,N as Lt,l as Dy,m as Xk,n as sr,o as uu,p as Wy,q as Zk,r as Jk,z as mp,u as eS,v as ju,w as $l,I as tS,A as oS,B as hd,D as Cc,F as Py,G as aS,H as yd,J as sS,K as iS,L as nS,O as rS,P as lS,Q as cS,R as dS,U as uS,W as fS,Z as pS,X as mS}from"./monkeytype-packages.DtRyCVe8.js";import{d as $t,b as gS,t as hS,U as ba,e as yS,s as bS,c as Qu,f as vS,j as Di,k as wS,m as CS,n as kS,p as SS,q as ae,r as lg,u as xS,v as cg,w as TS,x as LS,z as P,y as dt,H as kc,C as vo,B as $S,A as MS,D as AS,E as ES,L as _S,F as IS,G as qS,P as BS,S as FS,T as RS,I as DS,J as WS,K as PS,M as zS,N as HS,O as dg,Q as zy,R as OS,V as NS,W as lt,X as Hy,Y as Oy,_ as Ny,$ as US,a0 as VS,a1 as Uy,a2 as KS,a3 as GS,a4 as Vy,a5 as jS,a6 as ug,a7 as QS,a8 as YS,a9 as Ky,aa as fg,ab as XS,ac as ZS}from"./vendor.CUQxkLCO.js";import{g as JS,i as e1,a as t1,b as o1,c as a1,o as s1,s as i1,d as n1,e as r1,f as l1,h as c1,j as d1,k as gp,l as u1,F as f1,m as p1,n as m1,G as g1,p as h1,q as y1,u as Gy,t as hp,E as jy,v as b1,w as v1,x as w1,y as C1}from"./vendor-firebase.BjJDqVEz.js";import{f as k1}from"./firebase-config-live.D_aLvxET.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="28a5af92-d545-47de-83d8-19959db2ab2f",e._sentryDebugIdIdentifier="sentry-dbid-28a5af92-d545-47de-83d8-19959db2ab2f")}catch{}{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:monkeytype-frontend":!0})}const S1="https://api.monkeytype.com",x1="2025.08.29_13.31_667748ad2",T1="6Lc-V8McAAAAAJ7s6LGNe7MBZnRiwbsbiWts87aj",wn={backendUrl:S1,clientVersion:x1,recaptchaSiteKey:T1},L1="modulepreload",$1=function(e){return"/"+e},pg={},bd=function(t,o,a){let s=Promise.resolve();if(o&&o.length>0){let l=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=l(o.map(d=>{if(d=$1(d),d in pg)return;pg[d]=!0;const p=d.endsWith(".css"),f=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const g=document.createElement("link");if(g.rel=p?"stylesheet":L1,p||(g.as="script"),g.crossOrigin="",g.href=d,u&&g.setAttribute("nonce",u),document.head.appendChild(g),p)return new Promise((h,y)=>{g.addEventListener("load",h),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&n(c.reason);return t().catch(n)})};let Qy=!0;function fu(e){Qy=e}function Ks(){return Qy}const Yy=[];function M1(e){Yy.push(e)}function mg(){Yy.forEach(e=>{try{e()}catch(t){console.error("Banner event subscriber threw an error"),console.error(t)}})}const Xy=[];function A1(e){Xy.push(e)}function E1(e,t,o){Xy.forEach(a=>{try{a(e,t,o)}catch(s){console.error("Notification event subscriber threw an error"),console.error(s)}})}function Gs(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}function pu(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function gg(e){const t=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion"];let o=0,a=e;for(;a>=1e3;)a/=1e3,o++;const s=t[o]??"unknown";return{rounded:Math.round(a),roundedTo2:U(a),orderOfMagnitude:s}}function Sc(e,t=1){if(e<1e3)return e.toFixed(t);const o=Math.floor(Math.log(e)/Math.log(1e3)),a="kmbtqQsSond".charAt(o-1);return(e/Math.pow(1e3,o)).toFixed(t)+a}function _1(e){let t=0,o=0,a=0,s=0,n=0,l=0,c=0;const u=e.length;if(u===0)return null;for(let h=0;h<u;h++)l=h+1,c=e[h],t+=l,o+=c,s+=l*l,a+=l*c,n++;const d=(n*a-t*o)/(n*s-t*t),p=o/n-d*t/n,f=[1,1*d+p],g=[u,u*d+p];return[f,g]}function hg(e,t=10){return e!=null?parseInt(e,t):void 0}function Yu(){const e=i("#bannerCenter").height();i("#app").css("padding-top",e+Gs(2)+"px"),i("#notificationCenter").css("margin-top",e+"px")}let sn=0,I1=0;class yp{constructor(t,o,a,s,n,l,c,u=()=>{},d){this.type=t,this.message=d?o:Ht(o),this.level=a,this.important=s??!1,t==="banner"||t==="psa"?this.duration=n:n===void 0?a===-1?this.duration=0:this.duration=3e3:this.duration=n*1e3,this.customTitle=l,this.customIcon=c,this.id=I1++,this.closeCallback=u}show(){let t="notice",o='<i class="fas fa-info-circle"></i>',a="Notice";if(this.level===1?(t="good",o='<i class="fas fa-check-circle"></i>',a="Success"):this.level===-1&&(t="bad",o='<i class="fas fa-times-circle"></i>',a="Error"),this.important&&(t+=" important"),this.customTitle!==void 0&&(a=this.customTitle),(this.type==="banner"||this.type==="psa")&&(o='<i class="fas fa-fw fa-bullhorn"></i>'),this.customIcon!==void 0&&(o=`<i class="fas fa-fw fa-${this.customIcon}"></i>`),this.type==="notification"){this.duration===0&&(sn++,xc());const s=i("#notificationCenter .history").height();i("#notificationCenter .history").prepend(`

          <div class="notif ${t}" id=${this.id}>
              <div class="message"><div class="title"><div class="icon">${o}</div>${a}</div>${this.message}</div>
          </div>

          `);const n=i("#notificationCenter .history").height();i(`#notificationCenter .notif[id='${this.id}']`).remove(),i("#notificationCenter .history").css("margin-top",0).animate({marginTop:n-s},fe(125),()=>{i("#notificationCenter .history").css("margin-top",0),i("#notificationCenter .history").prepend(`

                  <div class="notif ${t}" id=${this.id}>
                      <div class="message"><div class="title"><div class="icon">${o}</div>${a}</div>${this.message}</div>
                  </div>

              `),i(`#notificationCenter .notif[id='${this.id}']`).css("opacity",0).animate({opacity:1},fe(125),()=>{i(`#notificationCenter .notif[id='${this.id}']`).css("opacity","")}),i(`#notificationCenter .notif[id='${this.id}']`).on("click",()=>{this.hide(),this.closeCallback(),this.duration===0&&sn--,xc()})}),i(`#notificationCenter .notif[id='${this.id}']`).on("hover",()=>{i(`#notificationCenter .notif[id='${this.id}']`).toggleClass("hover")})}else if(this.type==="banner"||this.type==="psa"){let s=`<div class="icon lefticon">${o}</div>`,n=!1;/images\/.*/.test(this.customIcon)&&(n=!0,s=`<div class="icon lefticon"><i class="fas fa-fw fa-bullhorn"></i></div><div class="image" style="background-image: url(${this.customIcon})"></div>`),i("#bannerCenter").prepend(`
        <div class="${this.type} ${t} content-grid ${n?"withImage":""}" id="${this.id}">
        <div class="container">
          ${s}
          <div class="text">
            ${this.message}
          </div>
          ${this.duration>=0?`
          <div class="closeButton">
            <i class="fas fa-fw fa-times"></i>
          </div>
          `:`<div class="righticon">${o}</div>`}
        </div>
      </div>
      `),Yu(),mg(),this.duration>=0&&i(`#bannerCenter .banner[id='${this.id}'] .closeButton, #bannerCenter .psa[id='${this.id}'] .closeButton`).on("click",()=>{this.hide(),this.closeCallback()}),/please (<a.*>)?refresh/i.test(this.message)&&(i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).addClass("clickable"),i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).on("click",()=>{window.location.reload()}))}this.duration>0&&setTimeout(()=>{this.hide()},this.duration+250)}hide(){this.type==="notification"?i(`#notificationCenter .notif[id='${this.id}']`).css("opacity",1).animate({opacity:0},fe(125),()=>{i(`#notificationCenter .notif[id='${this.id}']`).animate({height:0},fe(125),()=>{i(`#notificationCenter .notif[id='${this.id}']`).remove()})}):(this.type==="banner"||this.type==="psa")&&i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).css("opacity",1).animate({opacity:0},fe(125),()=>{i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).remove(),Yu(),mg()})}}function xc(){sn>1?(i("#notificationCenter .clearAll").removeClass("invisible"),i("#notificationCenter .clearAll").slideDown(125)):sn<1&&(i("#notificationCenter .clearAll").addClass("invisible"),i("#notificationCenter .clearAll").slideUp(125))}function m(e,t=0,o={}){E1(e,t,o.customTitle),new yp("notification",e,t,o.important,o.duration,o.customTitle,o.customIcon,o.closeCallback,o.allowHTML).show()}function q1(e,t=-1,o="bullhorn",a=!1,s,n){const l=new yp("banner",e,t,!1,a?-1:0,void 0,o,s,n);return l.show(),l.id}function Ws(e,t=-1,o="bullhorn",a=!1,s,n){const l=new yp("psa",e,t,!1,a?-1:0,void 0,o,s,n);return l.show(),l.id}function B1(){i("#notificationCenter .notif").remove(),sn=0,xc()}const F1=$t(100,Yu);i(window).on("resize",()=>{F1()});i("#notificationCenter .clearAll").on("click",()=>{i("#notificationCenter .notif.bad").each((e,t)=>{var o;(o=i(t)[0])==null||o.click()}),sn=0,xc()});const Zy=[];function R1(e){Zy.push(e)}function D1(e,t){Zy.forEach(o=>{try{o(e,t)}catch(a){console.error("Google Sign Up event subscriber threw an error"),console.error(a)}})}let Xl,qe,Vi=!1,Zl;const{promise:W1,resolve:P1}=Da();async function z1(e){try{Zl=e,Xl=o1().length===0?e1(k1):t1(),qe=a1(Xl);const t=window.localStorage.getItem("firebasePersistence")==="LOCAL";await bp(t,!1),s1(qe,async o=>{Vi||await e(!0,o)}),P1()}catch(t){Xl=void 0,qe=void 0,console.error("Authentication failed to initialize",t),await e(!1,null)}}function F(){return(qe==null?void 0:qe.currentUser)!==void 0&&(qe==null?void 0:qe.currentUser)!==null}function Po(){return(qe==null?void 0:qe.currentUser)??null}function H1(){return JS(Xl)}function Ro(){return qe!==void 0}async function O1(){console.log("auth signout"),await(qe==null?void 0:qe.signOut())}async function N1(e,t,o){if(qe===void 0)throw new Error("Authentication uninitialized");await bp(o,!0);const{data:a,error:s}=await eo(c1(qe,e,t));if(s!==null)throw console.error(s),Jy(s,"Failed to sign in with email and password");return a}async function U1(e,t){if(qe===void 0)throw new Error("Authentication uninitialized");await bp(t,!0),Vi=!0;const{data:o,error:a}=await eo(d1(qe,e));if(a!==null)throw Vi=!1,console.log(a),Jy(a,"Failed to sign in with popup");const s=gp(o);s!=null&&s.isNewUser?D1(o,!0):(Vi=!1,await(Zl==null?void 0:Zl(!0,o.user)))}async function V1(e,t){if(qe===void 0)throw new Error("Authentication uninitialized");return Vi=!0,await u1(qe,e,t)}async function K1(){const e=Po();return e===null?null:l1(e)}async function bp(e,t=!1){if(qe===void 0)throw new Error("Authentication uninitialized");const o=e?n1:r1;t&&window.localStorage.setItem("firebasePersistence",e?"LOCAL":"SESSION"),await i1(qe,o)}function Jy(e,t){let o=re(e,t);return e instanceof f1&&(e.code==="auth/wrong-password"?o="Incorrect password":e.code==="auth/user-not-found"?o="User not found":e.code==="auth/invalid-email"?o="Invalid email format (make sure you are using your email to login - not your username)":e.code==="auth/invalid-credential"?o="Email/password is incorrect or your account does not have password authentication enabled.":e.code==="auth/popup-closed-by-user"?o="":e.code==="auth/popup-blocked"?o="Sign in popup was blocked by the browser. Check the address bar for a blocked popup icon, or update your browser settings to allow popups.":e.code==="auth/user-cancelled"?o="":e.code==="auth/account-exists-with-different-credential"&&(o="Account already exists, but its using a different authentication method. Try signing in with a different method")),new Error(o,{cause:e})}function eb(){Vi=!1}let yg=!1,tb;function G1(e){const t=new AbortController;return setTimeout(()=>t.abort(new Error("request timed out")),e),t.signal}function j1(e){return async t=>{try{const o=await K1();o!==null&&(t.headers.Authorization=`Bearer ${o}`);const a=(AbortSignal==null?void 0:AbortSignal.timeout)===void 0;t.fetchOptions={...t.fetchOptions,signal:a?G1(e):AbortSignal.timeout(e)};const s=await hS(t);s.status>=400&&console.error(`${t.method} ${t.path} failed`,{status:s.status,...s.body});const n=s.headers.get(Kk);if(n!==null&&(tb=parseInt(n)),n!==null&&!yg){const l=parseInt(n);if(l!==Gu){const c=l>Gu?'Looks like the client and server versions are mismatched (backend is newer). Please <a onClick="location.reload(true)">refresh</a> the page.':"Looks like our monkeys didn't deploy the new server version correctly. If this message persists contact support.";Ws(c,1,void 0,!1,void 0,!0),yg=!0}}return s}catch(o){let a="Unknown error";return o instanceof Error&&(o.message.includes("timed out")?a="request took too long to complete":a=o.message),{status:500,body:{message:a},headers:new Headers}}}}function ob(e,t,o=1e4){return gS(e,{baseUrl:t,jsonQuery:!0,api:j1(o),baseHeaders:{Accept:"application/json","X-Client-Version":wn.clientVersion}})}const ab=wn.backendUrl,Q1=ob(Gk,ab,1e4),Y1=ob(jk,ab,24e4),E={...Q1,dev:Y1},sb=[];function X1(e){sb.push(e)}window.addEventListener("load",()=>{window.addEventListener("online",()=>{bg(!0)}),window.addEventListener("offline",()=>{bg(!1)})});function bg(e){sb.forEach(t=>{try{t(e)}catch(o){console.error("Connection event subscriber threw an error"),console.error(o)}})}let Ao=!1,js=!1,Ae=!1,zt=null,al=!0,Ms=!1,Xu=1,Z=0,ib=!0,ut=0,vd=0;function nb(e){Ao=e}function Z1(e){js=e}function vp(e){Ae=e}function rb(e){zt=e}function vg(e){al=e}function wp(e){Ms=e}function Cp(e){Xu=e}function J1(e){Z=e}function wg(){Z++}function ex(){Z--}function lb(e){ib=e}function cb(e){ut=e}function Zu(e=1){ut+=e}function mu(e){vd=e}let wr=navigator.onLine;function it(){return wr}let ir,Ju=!1;function wd(){Ju||ir===void 0&&(ir=Ws("No internet connection",0,"exclamation-triangle",!1,()=>{Ju=!0,ir=void 0}))}const tx=$t(5e3,()=>{wr?(ir!==void 0&&(m("You're back online",1,{customTitle:"Connection"}),i(`#bannerCenter .psa.notice[id="${ir}"] .closeButton`).trigger("click")),Ju=!1):Ae||wd()});X1(e=>{wr=e,tx()});window.addEventListener("load",()=>{wr=navigator.onLine,wr||wd()});function Cg(e,t){if(Array.isArray(e))return t.length===e.length?void 0:e.filter((o,a)=>!t.includes(a));{const o=Object.entries(e);return t.length===o.length?void 0:Object.fromEntries(o.filter(([a])=>!t.includes(a)))}}function ox(e,t){return t.slice(0,-1).reduce((o,a)=>o[a],e)}function kp(e,t){let a,s=structuredClone(t);for(let l=0;l<=2;l++){if(a=e.safeParse(s),a.success)return a.data;if(l===2)break;const c=a.error.errors.reduce((u,{path:d})=>{const p=d.slice(0,-1).join("."),f=d.at(-1);return f!==void 0&&u.set(p,[...u.get(p)??[],f]),u},new Map);for(const[u,d]of c.entries())if(u==="")s=Cg(s,d)??(Array.isArray(s)?[]:{});else{const p=u.split("."),f=ox(s,p),g=p.at(-1),h=Cg(f[g],d);h===void 0?delete f[g]:f[g]=h}}const n=a==null?void 0:a.error.errors.map(l=>`${l.path.join(".")}: ${l.message}`).join(", ");throw new Error("unable to sanitize: "+n)}const ax={theme:"serika_dark",themeLight:"serika",themeDark:"serika_dark",autoSwitchTheme:!1,customTheme:!1,customThemeColors:["#323437","#e2b714","#e2b714","#646669","#2c2e31","#d1d0c5","#ca4754","#7e2a33","#ca4754","#7e2a33"],favThemes:[],showKeyTips:!0,smoothCaret:"medium",codeUnindentOnBackspace:!1,quickRestart:"off",punctuation:!1,numbers:!1,words:50,time:30,mode:"time",quoteLength:[1],language:"english",fontSize:2,freedomMode:!1,difficulty:"normal",blindMode:!1,quickEnd:!1,caretStyle:"default",paceCaretStyle:"default",flipTestColors:!1,layout:"default",funbox:[],confidenceMode:"off",indicateTypos:"off",timerStyle:"mini",liveSpeedStyle:"off",liveAccStyle:"off",liveBurstStyle:"off",colorfulMode:!1,randomTheme:"off",timerColor:"main",timerOpacity:"1",stopOnError:"off",showAllLines:!1,keymapMode:"off",keymapStyle:"staggered",keymapLegendStyle:"lowercase",keymapLayout:"overrideSync",keymapShowTopRow:"layout",keymapSize:1,fontFamily:"Roboto_Mono",smoothLineScroll:!1,alwaysShowDecimalPlaces:!1,alwaysShowWordsHistory:!1,singleListCommandLine:"on",capsLockWarning:!0,playSoundOnError:"off",playSoundOnClick:"off",soundVolume:.5,startGraphsAtZero:!0,showOutOfFocusWarning:!0,paceCaret:"off",paceCaretCustomSpeed:100,repeatedPace:!0,accountChart:["on","on","on","on"],minWpm:"off",minWpmCustomSpeed:100,highlightMode:"letter",typingSpeedUnit:"wpm",ads:"result",hideExtraLetters:!1,strictSpace:!1,minAcc:"off",minAccCustom:90,monkey:!1,repeatQuotes:"off",oppositeShiftMode:"off",customBackground:"",customBackgroundSize:"cover",customBackgroundFilter:[0,1,1,1],customLayoutfluid:["qwerty","dvorak","colemak"],customPolyglot:["english","spanish","french","german"],monkeyPowerLevel:"off",minBurst:"off",minBurstCustomSpeed:100,burstHeatmap:!1,britishEnglish:!1,lazyMode:!1,showAverage:"off",tapeMode:"off",tapeMargin:50,maxLineWidth:0,playTimeWarning:"off"};function Jo(){return structuredClone(ax)}function Cd(e){return sx(ix(nx(e)))}function sx(e){const t=Jo(),o={};for(const a of vt(t)){const s=e[a]??t[a];o[a]=s}return o}function ix(e){return kp(By.strip(),e)}function nx(e){if(e.quickTab===!0&&e.quickRestart===void 0&&(e.quickRestart="tab"),typeof e.smoothCaret=="boolean"&&(e.smoothCaret=e.smoothCaret?"medium":"off"),e.swapEscAndTab===!0&&e.quickRestart===void 0&&(e.quickRestart="esc"),e.alwaysShowCPM===!0&&e.typingSpeedUnit===void 0&&(e.typingSpeedUnit="cpm"),e.showAverage==="wpm"&&(e.showAverage="speed"),typeof e.playSoundOnError=="boolean"&&(e.playSoundOnError=e.playSoundOnError?"1":"off"),e.showTimerProgress===!1&&e.timerStyle===void 0&&(e.timerStyle="off"),e.showLiveWpm===!0&&e.liveSpeedStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveSpeedStyle=t}if(e.showLiveBurst===!0&&e.liveBurstStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveBurstStyle=t}if(e.showLiveAcc===!0&&e.liveAccStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveAccStyle=t}if(typeof e.soundVolume=="string"&&(e.soundVolume=parseFloat(e.soundVolume)),typeof e.funbox=="string"&&(e.funbox==="none"?e.funbox=[]:e.funbox=e.funbox.split("#")),typeof e.customLayoutfluid=="string"&&(e.customLayoutfluid=e.customLayoutfluid.split("#")),typeof e.indicateTypos=="boolean"&&(e.indicateTypos=e.indicateTypos===!1?"off":"replace"),typeof e.fontSize=="string"){const t=e.fontSize;let o=parseInt(t);t==="125"?o=1.25:t==="15"&&(o=1.5),e.fontSize=o}else e.fontSize!==void 0&&e.fontSize<0&&(e.fontSize=1);if(Array.isArray(e.accountChart)&&e.accountChart.length!==4&&(e.accountChart=["on","on","on","on"]),typeof e.minAccCustom=="number"&&e.minAccCustom>100&&(e.minAccCustom=100),Array.isArray(e.customThemeColors)&&e.customThemeColors.length===9){const t=e.customThemeColors;t.splice(4,0,"#000000"),e.customThemeColors=t}if(Array.isArray(e.customBackgroundFilter)&&e.customBackgroundFilter.length===5){const t=e.customBackgroundFilter;e.customBackgroundFilter=[t[0],t[1],t[2],t[3]]}return typeof e.quoteLength=="number"&&(e.quoteLength===-1?e.quoteLength=[0,1,2,3]:e.quoteLength=[e.quoteLength]),e.tapeMargin!==void 0&&(e.tapeMargin<10?e.tapeMargin=10:e.tapeMargin>90&&(e.tapeMargin=90)),e.maxLineWidth!==void 0&&(e.maxLineWidth<20&&e.maxLineWidth!==0?e.maxLineWidth=20:e.maxLineWidth>1e3&&(e.maxLineWidth=1e3)),e}class nr{constructor(t,o,a,s=!1){this.firstDayOfWeek=a;const n=new ba(o),l=this.getInterval(n,s);this.startDay=l.start,this.endDay=l.end,this.data=this.buildData(t,n),this.isFullYear=s}getInterval(t,o=!1){const a=o?yS(t):new Date;let s=bS(t);return o||(s=Qu(vS(a),1),this.isFirstDayOfWeek(s)||(s=this.previousFirstDayOfWeek(s))),{start:s,end:a}}buildData(t,o){const a=new Array(Math.max(0,386-t.length)).fill(void 0);a.push(...t);const s=Di(this.endDay,this.startDay)+1,n=a.length-s+Di(this.endDay,o);return a.slice(n)}getMonths(){const t=wS({start:this.startDay,end:this.endDay}),o=[];for(let a=0;a<t.length;a++){const s=t[a];let n=a===0?this.startDay:CS(s),l=a===t.length-1?this.endDay:kS(n);this.isFirstDayOfWeek(n)||(n=a===0?this.previousFirstDayOfWeek(n):this.nextFirstDayOfWeek(n)),this.isLastDayOfWeek(l)||(l=this.nextLastDayOfWeek(l));const c=SS(l,n,{roundingMethod:"ceil"});c>2?o.push({text:ae(s,"MMM").toLowerCase(),weeks:c}):a===0&&o.push({text:"",weeks:c})}return o}getDays(){const t=[],o=this.getBuckets(),a=l=>{if(l===void 0||l===null||l===0)return"0";for(let c=0;c<4;c++)if(l<=(o[c]??0))return(1+c).toString();return"4"};for(let l=0;l<this.startDay.getDay()-this.firstDayOfWeek;l++)t.push({level:"filler"});const s=Di(this.endDay,this.startDay);let n=this.startDay;for(let l=0;l<=s;l++){const c=this.data[l],u=ae(n,"EEEE dd MMM yyyy");t.push({level:a(c),label:c!=null?`${c} ${c===1?"test":"tests"} on ${u}`:`no activity on ${u}`}),n=Qu(n,1)}for(let l=this.endDay.getDay()-this.firstDayOfWeek;l<6;l++)t.push({level:"filler"});return t}getTotalTests(){const t=Di(this.endDay,this.startDay);return this.data.slice(0,t+1).reduce((o,a)=>(o??0)+(a??0),0)??0}getBuckets(){const o=this.data.filter(l=>l!=null).sort((l,c)=>l-c),a=o.slice(Math.round(o.length*.1),o.length-Math.round(o.length*.1)),n=a.reduce((l,c)=>l+c,0)/a.length;return[Math.floor(n/2),Math.round(n),Math.round(n*1.5)]}isFirstDayOfWeek(t){return lg(t).getDay()===this.firstDayOfWeek}previousFirstDayOfWeek(t){return xS(t,this.firstDayOfWeek)}nextFirstDayOfWeek(t){return cg(t,this.firstDayOfWeek)}isLastDayOfWeek(t){return lg(t).getDay()===(this.firstDayOfWeek+6)%7}nextLastDayOfWeek(t){return cg(t,(this.firstDayOfWeek+6)%7)}}class rx extends nr{constructor(t,o,a){super(t,o,a),this.lastDay=new ba(o)}increment(t){const o=new ba(t),a=new ba(this.lastDay);if(TS(o,a)){const s=this.data.length-1;this.data[s]=(ar(this.data[s])??0)+1}else{if(LS(o,a))throw new Error("cannot alter data in the past.");{const s=Di(o,a)-1;for(let l=0;l<s;l++)this.data.push(void 0);this.data.push(1);const n=this.getInterval(o);this.startDay=n.start,this.endDay=n.end,this.lastDay=o}}this.data=this.buildData(this.data,this.lastDay)}getFullYearCalendar(){const t=new Date;return this.lastDay.getFullYear()!==new ba(t).getFullYear()?new nr([],t,this.firstDayOfWeek,!0):new nr(this.data,this.lastDay,this.firstDayOfWeek,!0)}}const lx={results:void 0,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}},name:"",email:"",uid:"",isPremium:!1,config:Jo(),customThemes:[],presets:[],tags:[],banned:void 0,verified:void 0,lbMemory:{time:{15:{english:0},60:{english:0}}},typingStats:{timeTyping:0,startedTests:0,completedTests:0},quoteRatings:void 0,quoteMod:!1,favoriteQuotes:{},addedAt:0,filterPresets:[],xp:0,inboxUnreadSize:0,streak:0,maxStreak:0,streakHourOffset:void 0,allTimeLbs:{time:{15:{english:{count:0,rank:0}},60:{english:{count:0,rank:0}}}}};function kg(){return structuredClone(lx)}function ft(e,t=!1,o=!1,a=":",s=!0,n=!1){e=Math.abs(e);let l=0,c;n?(l=Math.floor(e/86400),c=Math.floor(e%86400/3600)):c=Math.floor(e/3600);const u=Math.floor(e%3600/60),d=U(e%3600%60);let p,f,g,h;n&&(l<10&&a!=="text"?p="0"+l:p=l),c<10&&a!=="text"?f="0"+c:f=c,u<10&&a!=="text"?g="0"+u:g=u,d<10&&(u>0||c>0||t)&&a!=="text"?h="0"+d:h=d;let y="";return l>0&&n&&(y+=p,a==="text"?l===1?y+=" day ":y+=" days ":y+=a),(c>0||o)&&(y+=f,a==="text"?c===1?y+=" hour ":y+=" hours ":y+=a),(u>0||c>0||t)&&(y+=g,a==="text"?u===1?y+=" minute ":y+=" minutes ":s&&(y+=a)),s&&(y+=h,a==="text"&&(d===1?y+=" second":y+=" seconds")),c===0&&u===0&&!s&&a==="text"&&(y="less than 1 minute"),y.trim()}const Sg={af:0,ar:6,arDZ:0,arEG:0,arMA:1,arSA:0,arTN:1,az:1,be:1,beTarask:1,bg:1,bn:0,bs:1,ca:1,ckb:0,cs:1,cy:0,da:1,de:1,deAT:1,el:1,enAU:1,enCA:0,enGB:1,enIE:1,enIN:1,enNZ:1,enUS:0,enZA:0,eo:1,es:1,et:1,eu:1,faIR:6,fi:1,fr:1,frCA:0,frCH:1,fy:1,gd:0,gl:1,gu:1,he:0,hi:0,hr:1,ht:1,hu:1,hy:1,id:1,is:1,it:1,itCH:1,ja:0,jaHira:0,ka:1,kk:1,km:0,kn:1,ko:0,lb:1,lt:1,lv:1,mk:1,mn:1,ms:1,mt:1,nb:1,nl:1,nlBE:1,nn:1,oc:1,pl:1,pt:1,ptBR:0,ro:1,ru:1,se:1,sk:1,sl:1,sq:1,sr:1,srLatn:1,sv:1,ta:1,te:0,th:0,tr:1,ug:0,uk:1,uz:1,uzCyrl:1,vi:1,zhCN:1,zhHK:0,zhTW:1};function db(){if(navigator.language===void 0||navigator.language===null)return 0;const e=new Intl.Locale(navigator.language);if(e==null)return 0;if("weekInfo"in e)return e.weekInfo.firstDay%7;if("getWeekInfo"in e)return e.getWeekInfo().firstDay%7;let t=Sg[navigator.language.replaceAll("-","")];return t!==void 0||(t=Sg[navigator.language.split("-")[0]],t!==void 0)?t:0}const ub=[];function sa(e){ub.push(e)}function kd(e){ub.forEach(t=>{try{t(e)}catch(o){console.error("Auth event subscriber threw an error"),console.error(o)}})}let R;const fb=db();class On extends Error{constructor(t,o){super(t),this.responseCode=o,this.name="SnapshotInitError",this.responseCode=o}}function x(){return R}function st(e){const t=R==null?void 0:R.banned,o=R==null?void 0:R.verified,a=R==null?void 0:R.lbOptOut;try{e==null||delete e.banned}catch{}try{e==null||delete e.verified}catch{}try{e==null||delete e.lbOptOut}catch{}R=e,R&&(R.banned=t,R.verified=o,R.lbOptOut=a),kd({type:"snapshotUpdated",data:{isInitial:!1}})}async function cx(){var t,o,a,s,n,l,c;const e=kg();try{if(!F())return!1;const[u,d,p]=await Promise.all([E.users.get(),E.configs.get(),E.presets.get()]);if(u.status!==200)throw new On(`${u.body.message} (user)`,u.status);if(d.status!==200)throw new On(`${d.body.message} (config)`,d.status);if(p.status!==200)throw new On(`${p.body.message} (presets)`,p.status);const f=u.body.data,g=d.body.data,h=p.body.data;if(f===null)throw new On("Request was successful but user data is null",200);if(g!==null&&"config"in g)throw new Error("Config data is not in the correct format. Please refresh the page or contact support.");e.name=f.name,e.personalBests=f.personalBests,e.personalBests??(e.personalBests={time:{},words:{},quote:{},zen:{},custom:{}});for(const v of["time","words","quote","zen","custom"])(t=e.personalBests)[v]??(t[v]={});e.banned=f.banned,e.lbOptOut=f.lbOptOut,e.verified=f.verified,e.discordId=f.discordId,e.discordAvatar=f.discordAvatar,e.needsToChangeName=f.needsToChangeName,e.typingStats={timeTyping:f.timeTyping??0,startedTests:f.startedTests??0,completedTests:f.completedTests??0},e.quoteMod=f.quoteMod,e.favoriteQuotes=f.favoriteQuotes??{},e.quoteRatings=f.quoteRatings,e.details=f.profileDetails,e.addedAt=f.addedAt,e.inventory=f.inventory,e.xp=f.xp??0,e.inboxUnreadSize=f.inboxUnreadSize??0,e.streak=((o=f==null?void 0:f.streak)==null?void 0:o.length)??0,e.maxStreak=((a=f==null?void 0:f.streak)==null?void 0:a.maxLength)??0,e.filterPresets=f.resultFilterPresets??[],e.isPremium=(f==null?void 0:f.isPremium)??!1,e.allTimeLbs=f.allTimeLbs,f.testActivity!==void 0&&(e.testActivity=new rx(f.testActivity.testsByDays,new Date(f.testActivity.lastDay),fb));const y=(s=f==null?void 0:f.streak)==null?void 0:s.hourOffset;if(e.streakHourOffset=y??void 0,f.lbMemory!==void 0&&(e.lbMemory=f.lbMemory),g==null?e.config={...Jo()}:e.config=Cd(g),e.customThemes=f.customThemes??[],e.tags=((n=f.tags)==null?void 0:n.map(v=>({...v,display:v.name.replaceAll("_"," ")})))??[],e.tags=(l=e.tags)==null?void 0:l.sort((v,w)=>v.name>w.name?1:v.name<w.name?-1:0),h!=null){const v=h.map(w=>({...w,display:w.name.replace(/_/gi," ")}));e.presets=v,e.presets=(c=e.presets)==null?void 0:c.sort((w,$)=>w.name>$.name?1:w.name<$.name?-1:0)}return R=e,R}catch(u){throw R=kg(),u}}async function Sp(e){var a;if(!F()||!R||R.results!==void 0&&(e===void 0||R.results.length>e)||!it())return!1;const t=await E.results.get({query:{offset:e}});if(t.status!==200)return m("Error getting results: "+t.body.message,-1),!1;if(!F())return!1;const o=t.body.data.map(s=>(s.bailedOut===void 0&&(s.bailedOut=!1),s.blindMode===void 0&&(s.blindMode=!1),s.lazyMode===void 0&&(s.lazyMode=!1),s.difficulty===void 0&&(s.difficulty="normal"),s.funbox===void 0&&(s.funbox=[]),(s.language===void 0||s.language===null)&&(s.language="english"),s.numbers===void 0&&(s.numbers=!1),s.punctuation===void 0&&(s.punctuation=!1),s.numbers===void 0&&(s.numbers=!1),s.quoteLength===void 0&&(s.quoteLength=-1),s.restartCount===void 0&&(s.restartCount=0),s.incompleteTestSeconds===void 0&&(s.incompleteTestSeconds=0),s.afkDuration===void 0&&(s.afkDuration=0),s.tags===void 0&&(s.tags=[]),s));if(o==null||o.sort((s,n)=>n.timestamp-s.timestamp),R.results!==void 0&&R.results.length>0){const s=(a=Vs(R.results))==null?void 0:a.timestamp,n=o.filter(l=>l.timestamp<s);R.results.push(...n)}else R.results=o;return!0}async function dx(e){if(!R)return!1;if(R.customThemes===void 0&&(R.customThemes=[]),R.customThemes.length>=20)return m("Too many custom themes!",0),!1;const t=await E.users.addCustomTheme({body:{...e}});if(t.status!==200)return m("Error adding custom theme: "+t.body.message,-1),!1;if(t.body.data===null)return m("Error adding custom theme: No data returned",-1),!1;const o={...e,_id:t.body.data._id};return R.customThemes.push(o),!0}async function ux(e,t){var n;if(!F()||!R)return!1;R.customThemes===void 0&&(R.customThemes=[]);const o=(n=R.customThemes)==null?void 0:n.find(l=>l._id===e);if(!o)return m("Editing failed: Custom theme with id: "+e+" does not exist",-1),!1;const a=await E.users.editCustomTheme({body:{themeId:e,theme:t}});if(a.status!==200)return m("Error editing custom theme: "+a.body.message,-1),!1;const s={...t,_id:e};return R.customThemes[R.customThemes.indexOf(o)]=s,!0}async function fx(e){var a,s;if(!F()||!R||!((a=R.customThemes)==null?void 0:a.find(n=>n._id===e)))return!1;const o=await E.users.deleteCustomTheme({body:{themeId:e}});return o.status!==200?(m("Error deleting custom theme: "+o.body.message,-1),!1):(R.customThemes=(s=R.customThemes)==null?void 0:s.filter(n=>n._id!==e),!0)}async function pb(e,t,o,a,s,n,l){const c=x();if(!c)return[0,0];function u(){var $;const p=[];($=c==null?void 0:c.tags)==null||$.forEach(S=>{S.active===!0&&p.push(S._id)});let f=0,g=0,h=0,y=0,v=0,w=0;if((c==null?void 0:c.results)!==void 0){for(const S of c.results)if(S.mode===e&&(S.punctuation??!1)===o&&(S.numbers??!1)===a&&S.language===s&&S.difficulty===n&&(S.lazyMode===l||S.lazyMode===void 0&&!l)&&(p.length===0||p.some(T=>{var q;return(q=S.tags)==null?void 0:q.includes(T)}))){if(`${S.mode2}`!=`${t}`&&e!=="quote")continue;if(w<10&&(h+=S.wpm,y+=S.acc,w++),`${S.mode2}`==`${t}`&&(f+=S.wpm,g+=S.acc,v++,v>=10))break}}return v===0&&e==="quote"?[h/w,y/w]:[f/v,g/v]}return c===null||await Sp()===null?[0,0]:u()}async function px(e,t,o,a,s,n,l){const c=x();if(!c)return 0;function u(){var g;const p=[];(g=c==null?void 0:c.tags)==null||g.forEach(h=>{h.active===!0&&p.push(h._id)});let f=0;if((c==null?void 0:c.results)!==void 0){for(const h of c.results)if(h.mode===e&&(h.punctuation??!1)===o&&(h.numbers??!1)===a&&h.language===s&&h.difficulty===n&&(h.lazyMode===l||h.lazyMode===void 0&&!l)&&(p.length===0||p.some(y=>{var v;return(v=h.tags)==null?void 0:v.includes(y)}))){if(h.timestamp<Date.now()-864e5||`${h.mode2}`!=`${t}`&&e!=="quote")continue;h.wpm>f&&(f=h.wpm)}}return f}return c===null||await Sp()===null?0:u()}async function mx(e,t,o,a,s,n,l){const c=x();if(!c)return 0;let u=0;for(const d of c.tags){if(!d.active)continue;const p=await mb(d._id,e,t,o,a,s,n,l);p>u&&(u=p)}return u}async function Cr(e,t,o,a,s,n,l,c){var d,p;if(!c.every(f=>f.canGetPb))return;const u=(p=(d=R==null?void 0:R.personalBests)==null?void 0:d[e])==null?void 0:p[t];return u==null?void 0:u.find(f=>(f.punctuation??!1)===o&&(f.numbers??!1)===a&&f.difficulty===n&&f.language===s&&(f.lazyMode??!1)===l)}async function gx(e,t,o,a,s,n,l,c,u,d,p){if(e==="quote"||!R)return;function f(){var h,y;if(!R)return;let g=!1;R.personalBests??(R.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(h=R.personalBests)[e]??(h[e]={[t]:[]}),(y=R.personalBests[e])[t]??(y[t]=[]),R.personalBests[e][t].forEach(v=>{(v.punctuation??!1)===o&&(v.numbers??!1)===a&&v.difficulty===n&&v.language===s&&(v.lazyMode??!1)===l&&(g=!0,v.wpm=c,v.acc=u,v.raw=d,v.timestamp=Date.now(),v.consistency=p,v.lazyMode=l)}),g||R.personalBests[e][t].push({language:s,difficulty:n,lazyMode:l,punctuation:o,numbers:a,wpm:c,acc:u,raw:d,timestamp:Date.now(),consistency:p})}R!==null&&f()}async function mb(e,t,o,a,s,n,l,c){var f,g,h,y;if(R===null)return 0;let u=0;const d=(((f=x())==null?void 0:f.tags)??[]).find(v=>v._id===e);return d===void 0||(d.personalBests??(d.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(g=d.personalBests)[t]??(g[t]={[o]:[]}),(h=d.personalBests[t])[o]??(h[o]=[]),u=((y=(d.personalBests[t][o]??[]).find(v=>(v.punctuation??!1)===a&&(v.numbers??!1)===s&&v.difficulty===l&&v.language===n&&(v.lazyMode===c||v.lazyMode===void 0&&!c)))==null?void 0:y.wpm)??0),u}async function hx(e,t,o,a,s,n,l,c,u,d,p,f){if(!R||t==="quote")return;function g(){var y,v,w;const h=(y=R==null?void 0:R.tags)==null?void 0:y.find($=>$._id===e);h.personalBests??(h.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(v=h.personalBests)[t]??(v[t]={[o]:[]}),(w=h.personalBests[t])[o]??(w[o]=[]);try{let $=!1;h.personalBests[t][o].forEach(S=>{(S.punctuation??!1)===a&&(S.numbers??!1)===s&&S.difficulty===l&&S.language===n&&(S.lazyMode===c||S.lazyMode===void 0&&!c)&&($=!0,S.wpm=u,S.acc=d,S.raw=p,S.timestamp=Date.now(),S.consistency=f,S.lazyMode=c)}),$||h.personalBests[t][o].push({language:n,difficulty:l,lazyMode:c,punctuation:a,numbers:s,wpm:u,acc:d,raw:p,timestamp:Date.now(),consistency:f})}catch{h.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},h.personalBests[t][o]=[{language:n,difficulty:l,lazyMode:c,punctuation:a,numbers:s,wpm:u,acc:d,raw:p,timestamp:Date.now(),consistency:f}]}}R!==null&&g()}async function yx(e,t,o,a,s=!1){var n,l,c;{const u=e,d=t,p=x();if(!p)return;p.lbMemory===void 0&&(p.lbMemory={time:{15:{english:0},60:{english:0}}}),p.lbMemory[u]===void 0&&(p.lbMemory[u]={15:{english:0},60:{english:0}}),p.lbMemory[u][d]===void 0&&(p.lbMemory[u][d]={});const f=(c=(l=(n=p.lbMemory)==null?void 0:n[u])==null?void 0:l[d])==null?void 0:c[o],g=p.lbMemory[u][d];g[o]=a,s&&f!==a&&await E.users.updateLeaderboardMemory({body:{mode:e,mode2:t,language:o,rank:a}}),st(p)}}async function gb(e){if(F()){const t=await E.configs.save({body:e});t.status!==200&&m("Failed to save config: "+t.body.message,-1)}}async function bx(){if(F()){const e=await E.configs.delete();e.status!==200&&m("Failed to reset config: "+e.body.message,-1)}}function hb(e){const t=x();t&&((t==null?void 0:t.results)!==void 0&&(t.results.unshift(e),st(t)),t.testActivity!==void 0&&(t.testActivity.increment(new Date(e.timestamp)),st(t)))}function yb(e,t){const o=x();o&&(o.typingStats===void 0&&(o.typingStats={timeTyping:0,startedTests:0,completedTests:0}),o.typingStats.timeTyping+=t,o.typingStats.startedTests+=e,o.typingStats.completedTests+=1,st(o))}function bb(e){const t=x();t&&(t.xp===void 0&&(t.xp=0),t.xp+=e,st(t))}function vx(e){const t=x();t&&(t.inboxUnreadSize=e,st(t))}function wx(e){const t=x();t&&(t.inventory===void 0&&(t.inventory={badges:[]}),t.inventory.badges.push(e),st(t))}function Cx(e){const t=x();t&&(t.streak=e,t.streak>t.maxStreak&&(t.maxStreak=t.streak),st(t))}async function kx(e){var o;if(!F()||R===void 0)return;if(e==="current")return R.testActivity;const t=new Date().getFullYear().toString();if(e===t)return(o=R.testActivity)==null?void 0:o.getFullYearCalendar();if(R.testActivityByYear===void 0){if(!it())return;te();const a=await E.users.getTestActivity();if(a.status!==200){m("Error getting test activities: "+a.body.message,-1),V();return}R.testActivityByYear={};for(const s in a.body.data){if(s===t)continue;const n=a.body.data[s]??[],l=Qu(new Date(parseInt(s),0,1),n.length);R.testActivityByYear[s]=new nr(n,l,fb,!0)}V()}return R.testActivityByYear[e]}async function Sd(){return await bd(()=>import("./vendor-sentry.BnicSrXf.js"),[])}let Jl=!1,kr=!1;async function Sx(){if(kr){console.warn("Sentry already activated");return}kr=!0,console.log("Activating Sentry");const e=await Sd();e.init({release:wn.clientVersion,dsn:"https://f50c25dc9dd75304a63776063896a39b@o4509236448133120.ingest.us.sentry.io/4509237217394688",sendDefaultPii:!0,environment:"production",integrations:[e.browserTracingIntegration(),e.replayIntegration({unmask:["#notificationCenter"],block:["#commandLine .modal .suggestions"]}),e.thirdPartyErrorFilterIntegration({filterKeys:["monkeytype-frontend"],behaviour:"drop-error-if-contains-third-party-frames"})],tracesSampleRate:.25,tracePropagationTargets:["localhost",/^https:\/\/api\.monkeytype\.com/],replaysSessionSampleRate:0,replaysOnErrorSampleRate:.5,ignoreErrors:["TypeError: can't access dead object","NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.","NotFoundError: Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.","Error: There is no clipping info for given tab","Non-Error promise rejection captured","Object captured as promise rejection"],beforeSend(t){return Jl&&console.debug("Sentry beforeSend",t),t},beforeBreadcrumb(t,o){return t.category==="console"&&t.level==="debug"?null:t}})}async function xx(e,t){if(!kr)return;(await Sd()).setUser({id:e,username:t})}async function Tx(){if(!kr)return;(await Sd()).setUser(null)}async function xp(e){if(!kr)return;(await Sd()).captureException(e)}function Lx(){Jl=!Jl,console.debug("Sentry debug mode:",Jl)}function $x(e,t,o){let a=`Invalid value for ${e} (${t}). Please try to change this setting again.`;m(a,-1),console.error(a),xp(new Error(a))}function vb(e,t,o){const a=o.safeParse(t).success;return a||$x(e,t),a}const wb=[];function ge(e){wb.push(e)}function Ps(e,t,o,a,s){wb.forEach(n=>{try{n(e,t,o,a,s)}catch(l){console.error("Config event subscriber threw an error"),console.error(l)}})}const Mx=[{name:"Prime Ape",description:"Paying for a monthly subscription",icon:"fa-dollar-sign",test:e=>e.isPremium===!0},{name:"Banned",description:"This account is banned",icon:"fa-gavel",color:"var(--error-color)",test:e=>e.banned===!0},{name:"LbOptOut",description:"This account has opted out of leaderboards",icon:"fa-crown",color:"var(--error-color)",test:e=>e.lbOptOut===!0}],Ax={iconsOnly:!1};function Ex(e){return Mx.filter(o=>o.test(e))}function _x(e,t){const o=`<i class="fas ${e.icon}"></i>`;if(t.iconsOnly)return o;const a=[];return e.background!==void 0&&a.push(`background: ${e.background};`),(e==null?void 0:e.color)!==void 0&&a.push(`color: ${e.color};`),(e==null?void 0:e.customStyle)!==void 0&&a.push(e.customStyle),`<div class="flag" ${`aria-label="${e.description}" data-balloon-pos="right"`} style="${a.join("")}">${o}</div>`}function sl(e,t){const o={...Ax,...t};return Ex(e).map(a=>_x(a,o)).join("")}function Tc(e){return Math.floor((Math.sqrt(392*e+22801)-53)/98)}function Ix(e){return 49*(e-1)+100}function qx(e){return(49*Math.pow(e,2)+53*e-102)/2}function Sr(e){const t=Tc(e);return{level:t,levelCurrentXp:e-qx(t),levelMaxXp:Ix(t)}}let Et={bg:"#323437",main:"#e2b714",caret:"#e2b714",sub:"#646669",subAlt:"#2c2e31",text:"#d1d0c5",error:"#ca4754",errorExtra:"#7e2a33",colorfulError:"#ca4754",colorfulErrorExtra:"#7e2a33"};async function Yt(e){return Et[e]||il(),Et[e]}async function ms(){return Et.bg||il(),Et}function Bx(){Et={bg:"",main:"",caret:"",sub:"",subAlt:"",text:"",error:"",errorExtra:"",colorfulError:"",colorfulErrorExtra:""}}function il(){const e=getComputedStyle(document.body);Et.bg=e.getPropertyValue("--bg-color").replace(" ",""),Et.main=e.getPropertyValue("--main-color").replace(" ",""),Et.caret=e.getPropertyValue("--caret-color").replace(" ",""),Et.sub=e.getPropertyValue("--sub-color").replace(" ",""),Et.subAlt=e.getPropertyValue("--sub-alt-color").replace(" ",""),Et.text=e.getPropertyValue("--text-color").replace(" ",""),Et.error=e.getPropertyValue("--error-color").replace(" ",""),Et.errorExtra=e.getPropertyValue("--error-extra-color").replace(" ",""),Et.colorfulError=e.getPropertyValue("--colorful-error-color").replace(" ",""),Et.colorfulErrorExtra=e.getPropertyValue("--colorful-error-extra-color").replace(" ","")}let Lc=!1;function Fx(){Lc||(Lc=!0,console.error("Slow timer, disabling animations"))}function xr(){Lc=!1}function Pe(){return Lc}let $c=!1,Ge=!1,Cb=!1,Ts={currentXp:0,addedXp:0};const va=i("nav .xpBar .xpBreakdown .total"),Eo=i("nav .xpBar .xpBreakdown .list"),ga=i("nav .level"),Oo=i("nav .xpBar .bar"),ec=i("nav .xpBar");async function Rx(){if(Ge=!0,!$c)return;Cb?va.text(`+${Ts.addedXp}`):ro(Ts.addedXp,!0),Eo.stop(!0,!0).empty().addClass("hidden"),ga.text(Tc(Ts.currentXp+Ts.addedXp));const e=Sr(Ts.currentXp+Ts.addedXp),t=e.level+e.levelCurrentXp/e.levelMaxXp;Oo.css("width",`${t%1*100}%`),await Te(2e3),$c=!1,ec.stop(!0,!0).css("opacity",1).animate({opacity:0},Pe()?0:fe(250))}function xg(e){const t=Sr(e),o=t.levelCurrentXp/t.levelMaxXp;ga.text(t.level),Oo.css({width:o*100+"%"})}async function kb(e,t,o){Ge=!1,$c=!0,Ts={currentXp:e,addedXp:t,breakdown:o},ga.text(Tc(e));const a=Sr(e),s=Sr(e+t),n=a.level+a.levelCurrentXp/a.levelMaxXp,l=s.level+s.levelCurrentXp/s.levelMaxXp,c=Eo;Eo.stop(!0,!0).css("opacity",0).empty(),ec.stop(!0,!0).css("opacity",0),va.text("");const u=Mo(ec,{opacity:"1"},Pe()?0:fe(125),"linear"),d=Mo(Eo,{opacity:"1"},Pe()?0:fe(125),"linear");if(o!==void 0?(c.removeClass("hidden"),Promise.all([u,d])):c.addClass("hidden"),Ge)return;const p=Wx(n,l),f=Dx(t,o);await Promise.all([p,f]),!Ge&&(await Te(5e3),!Ge&&($c=!1,ga.text(Tc(e+t)),ec.stop(!0,!0).css("opacity",1).animate({opacity:0},Pe()?0:fe(250))))}async function ro(e,t=!1){if(!t&&Ge)return;va.text(`+${e}`);const o=(Math.random()*2-1)/4,a=(Math.random()+1)/2;va.stop(!0,!0).css({transition:"initial",borderSpacing:100}).animate({borderSpacing:0},{step(s){va.css("transform",`scale(${1+s/200*a}) rotate(${s/10*o}deg)`)},duration:fe(2e3),easing:"easeOutCubic",complete:()=>{va.css({backgroundColor:"",transition:""})}})}async function no(e,t,o){if(Ge)return;if(t===void 0)Eo.append(`<div class="line" data-string='${e}'><div>${e}</div><div></div></div>`);else if(typeof t=="string")Eo.append(`
      <div class="line" data-string='${e}'>
      <div class="${o==null?void 0:o.extraClass}">${e}</div>
      <div class="${o==null?void 0:o.extraClass}">${t}</div>
      </div>`);else{const s=t===void 0?void 0:t>=0;Eo.append(`
      <div class="line" data-string='${e}'>

        <div class="${o==null?void 0:o.extraClass}">${e}</div>
        <div class="${s?"positive":"negative"} ${o==null?void 0:o.extraClass}">${s?"+":"-"}${Math.abs(t)}</div>
      </div>`)}if(o!=null&&o.noAnimation)return;const a=Eo.find(`.line[data-string='${e}']`);a.css("opacity",0),await Mo(a,{opacity:"1"},fe(250),"swing")}async function Dx(e,t){if(Ge)return;if(Eo.css("opacity",1),!t){va.text(`+${e}`);return}const o=fe(250);let a=0;Eo.empty(),Eo.removeClass("hidden"),va.text("+0"),a+=t.base??0,va.text(`+${a}`),await no("time typing",t.base,{noAnimation:!0}),await Te(o),be(t.fullAccuracy)?(await Te(o),a+=t.fullAccuracy,ro(a),await no("perfect",t.fullAccuracy)):be(t.corrected)&&(await Te(o),a+=t.corrected,ro(a),await no("clean",t.corrected)),!Ge&&(be(t.quote)?(await Te(o),a+=t.quote,ro(a),await no("quote",t.quote)):(be(t.punctuation)&&(await Te(o),a+=t.punctuation,ro(a),await no("punctuation",t.punctuation)),be(t.numbers)&&(await Te(o),a+=t.numbers,ro(a),await no("numbers",t.numbers))),!Ge&&(be(t.funbox)&&(await Te(o),a+=t.funbox,ro(a),await no("funbox",t.funbox)),!Ge&&(be(t.streak)&&(await Te(o),a+=t.streak,ro(a),await no("streak",t.streak)),!Ge&&(be(t.accPenalty)&&t.accPenalty>0&&(await Te(o),a-=t.accPenalty,ro(a),await no("accuracy penalty",t.accPenalty*-1)),!Ge&&(be(t.incomplete)&&t.incomplete>0&&(await Te(o),a+=t.incomplete,ro(a),await no("incomplete tests",t.incomplete)),!Ge&&(be(t.configMultiplier)&&(await Te(o),a*=t.configMultiplier,ro(a),await no("global multiplier",`x${t.configMultiplier}`)),!Ge&&(be(t.daily)&&(await Te(o),a+=t.daily,ro(a),await no("daily bonus",t.daily)),Cb=!0,!Ge&&await Te(o))))))))}async function Wx(e,t){if(Ge)return;const o=t-e;if(Oo.css("width",`${e%1*100}%`),t%1===0){if(await Mo(Oo,{width:"100%"},Pe()?0:fe(1e3),"easeOutExpo"),Ge)return;gu(),Oo.css("width","0%")}else if(Math.floor(e)===Math.floor(t))await Mo(Oo,{width:`${t%1*100}%`},Pe()?0:fe(1e3),"easeOutExpo");else{const a=Math.min(1e3/o,200);let s=o,n=!1,l=a,c="linear",u=1-e%1;do{if(Ge)return;s-1<1&&(l=wc(s-1,0,.5,1e3,200),c="easeOutQuad"),n&&(gu(),Oo.css("width","0%"),u=1),await Mo(Oo,{width:"100%"},Pe()?0:fe(l),c),s-=u,n=!0}while(s>1);if(Ge||(gu(),Oo.css("width","0%"),Ge))return;await Mo(Oo,{width:`${s%1*100}%`},Pe()?0:fe(1e3),"easeOutExpo")}}async function gu(){const e=await ms();ga.text(parseInt(ga.text())+1);const t=Math.random()*2-1,o=Math.random()+1;ga.stop(!0,!0).css({backgroundColor:e.main,borderSpacing:100,transition:"initial"}).animate({backgroundColor:e.sub,borderSpacing:0},{step(a){ga.css("transform",`scale(${1+a/200*o}) rotate(${a/10*t}deg)`)},duration:fe(2e3),easing:"easeOutCubic",complete:()=>{ga.css({backgroundColor:"",transition:""})}})}const Tg=new Map;function Ml(e,t){const o=document.createElement("div");return o.classList.add("avatar"),e===null?t!=null&&t.loading?o.innerHTML='<div class="loading"><i class="fas fa-circle-notch fa-spin"><i></div>':o.innerHTML=`<div class="userIcon"><i class="${(t==null?void 0:t.userIcon)??"fas fa-user-circle"}"><i></div>`:o.innerHTML=`<div class="discordImage" style="background-image:url(${e}?size=${(t==null?void 0:t.size)??32})"></div>`,o}function xd({discordId:e,discordAvatar:t},o){if(e===void 0||e===""||t===void 0||t==="")return Ml(null,o);const a=Tg.get(t);if(a!==void 0)return Ml(a,o);{const s=Ml(null,{loading:!0});return Px({discordId:e,discordAvatar:t}).then(n=>{Tg.set(t,n),s.replaceWith(Ml(n,o))}),s}}async function Px({discordId:e,discordAvatar:t}){try{const o=`https://cdn.discordapp.com/avatars/${e}/${t}.png`;return(await fetch(o,{method:"HEAD"})).ok?o:null}catch{}return null}function zx(){i("nav .accountButtonAndMenu").addClass("hidden"),i("nav .textButton.view-login").addClass("hidden")}function Yo(e){i("nav .accountButtonAndMenu .spinner").css({opacity:e?"1":"0"}),i("nav .accountButtonAndMenu .avatar").css({opacity:e?"0":"1"})}function Lg(e){i("header nav .view-account > .text").text(e)}function $g(e){i("nav .textButton.view-account > .text").append(sl(e,{iconsOnly:!0}))}function ef(e){const t=xd(e??{},{userIcon:"fas fa-fw fa-user"});i("header nav .view-account .avatar").replaceWith(t)}function Hx(){if(F()){const e=x();if(e===void 0)return;const{xp:t,name:o}=e;Yo(!1),Lg(o),$g(e??{}),xg(t),ef(e),i("nav .accountButtonAndMenu .menu .items .goToProfile").attr("href",`/profile/${o}`),tn(i("nav .textButton.view-login"),i("nav .accountButtonAndMenu"),250)}else tn(i("nav .accountButtonAndMenu"),i("nav .textButton.view-login"),250,async()=>{Lg(""),$g({}),xg(0),ef()})}var ty;const Ox=(ty=window.matchMedia("(pointer:coarse)"))==null?void 0:ty.matches;Ox&&i("nav .accountButtonAndMenu .textButton.view-account").attr("href","");sa(e=>{(e.type==="authStateChanged"&&!e.data.isUserSignedIn||e.type==="snapshotUpdated")&&Hx()});function Nx(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Sb(e){return e.replace(/([A-Z])/g," $1").trim().toLowerCase()}function xb(e){try{return e.charAt(e.length-1)}catch{return""}}function Mg(e,t,o){return t>e.length-1?e:e.substring(0,t)+o+e.substring(t+1)}function mi(e){return e.split(/ +/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function Ft(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Ux(e,t){const o=[];let a=[];const s=new Set(t);for(const n of e)s.has(n)?(a.length>0&&o.push(a.join("")),o.push(n),a=[]):a.push(n);return a.length>0&&o.push(a.join("")),o}function ea(e,t=!1){let o="";return t?o=No(e):o=e,o.replace(/_/g," ")}function No(e){return e.replace(/_\d*k$/g,"")}function Tb(e){const t={"“":'"',"”":'"',"„":'"',"’":"'","‘":"'",",":",","—":"-","…":"...","«":"<<","»":">>","–":"-"," ":" "," ":" "," ":" ","᾽":"'"};return e.replace(/[“”’‘—,…«»–\u2007\u202F\u00A0]/g,o=>t[o]||"")}function Xo(e){const t=[];for(const o of e)t.push(o);return t}function Vx(e){return e=e.replace(new RegExp("(?<!\\\\)\\\\t","g"),"	"),e=e.replace(/\\n/g,` 
`),e=e.replace(/([^\\]|^)\\n/gm,`$1
`),e=e.replace(/\\\\t/gm,"\\t"),e=e.replace(/\\\\n/gm,"\\n"),e}function tf(e,t,o){var a;if(o.length===0)return{result:!0};if(e==="words"||e==="time")return t===0?o.filter(n=>{var l;return(l=n.properties)==null?void 0:l.includes("noInfiniteDuration")}).length>0?{result:!1,forcedConfigs:[e==="words"?10:15]}:{result:!0}:{result:!0};{const s={};for(const n of o)if(n.frontendForcedConfig)for(const l in n.frontendForcedConfig)s[l]===void 0?s[l]=n.frontendForcedConfig[l]:s[l]=Fy(s[l],n.frontendForcedConfig[l],!0);if(s[e]===void 0)return{result:!0};if(((a=s[e])==null?void 0:a.length)===0)throw new Error("No intersection of forced configs");return{result:(s[e]??[]).includes(t),forcedConfigs:s[e]}}}function Lb(e,t,o=[],a=!1){let s=0;const n=vr(o);if(e==="mode"){let l=vr(o).filter(c=>{var u;return((u=c.frontendForcedConfig)==null?void 0:u.mode)!==void 0&&!c.frontendForcedConfig.mode.includes(t)});t==="zen"&&(l=l.concat(n.filter(c=>{const u=c.frontendFunctions??[],d=c.properties??[];return u.includes("getWord")||u.includes("pullSection")||u.includes("alterText")||u.includes("withWords")||d.includes("changesCapitalisation")||d.includes("nospace")||d.some(p=>p.startsWith("toPush:"))||d.includes("changesWordsVisibility")||d.includes("speaks")||d.includes("changesLayout")||d.includes("changesWordsFrequency")}))),(t==="quote"||t==="custom")&&(l=l.concat(n.filter(c=>{const u=c.frontendFunctions??[],d=c.properties??[];return u.includes("getWord")||u.includes("pullSection")||u.includes("withWords")||d.includes("changesWordsFrequency")}))),l.length>0&&(s+=1)}if(e==="words"||e==="time"){if(!tf(e,t,n).result)if(a)s+=1;else return m("Active funboxes do not support infinite tests",0),!1}else tf(e,t,n).result||(s+=1);return s>0?(a||m(`You can't set ${Sb(e)} to ${t.toString()} with currently active funboxes.`,0,{duration:5}),!1):!0}function $b(e,t){console.log("cansetfunboxwithconfig",e,t.mode);let o=[...t.funbox,e];const a=[];for(const[s,n]of Object.entries(t))Lb(s,n,o,!0)||a.push({key:s,value:n});if(a.length>0){const s=[];for(const n of a)s.push(`${Ft(Sb(n.key))} cannot be set to ${n.value.toString()}.`);return m(`You can't enable ${e.replace(/_/g," ")}:<br>${s.join("<br>")}`,0,{duration:5,allowHTML:!0}),!1}else return!0}class Gt{constructor(t){this.key=t.key,this.schema=t.schema,this.fallback=t.fallback,this.migrate=t.migrate}get(){if(this.cache!==void 0)return console.debug(`LS ${this.key} Got cached value:`,this.cache),this.cache;console.debug(`LS ${this.key} Getting value from localStorage`);const t=window.localStorage.getItem(this.key);if(t===null)return console.debug(`LS ${this.key} No value found, returning fallback`),this.cache=this.fallback,this.cache;let o=!1;const{data:a,error:s}=gd(()=>vn(t,this.schema,{fallback:this.fallback,migrate:(n,l)=>(console.debug(`LS ${this.key} Schema validation failed`),o=!0,this.migrate?(console.debug(`LS ${this.key} Migrating from old format to new format`),this.cache=this.migrate(n,l),this.cache):(console.debug(`LS ${this.key} No migration function provided, returning fallback`),this.cache=this.fallback,this.cache))}));return s?(console.error(`LS ${this.key} Failed to parse from localStorage: ${s.message}`),window.localStorage.setItem(this.key,JSON.stringify(this.fallback)),this.cache=this.fallback,this.cache):((o||a===this.fallback)&&(console.debug(`LS ${this.key} Setting in localStorage`),window.localStorage.setItem(this.key,JSON.stringify(a))),console.debug(`LS ${this.key} Got value:`,a),this.cache=a,this.cache)}set(t){try{console.debug(`LS ${this.key} Parsing to set in localStorage`);const o=this.schema.parse(t);return console.debug(`LS ${this.key} Setting in localStorage`),window.localStorage.setItem(this.key,JSON.stringify(o)),this.cache=o,!0}catch(o){let a="Unknown error occurred";Qk(o)?(console.error(o),a="Schema validation failed"):o.message.includes("exceeded the quota")&&(a="Local storage is full. Please clear some space and try again.");const s=`Failed to set ${this.key} in localStorage: ${a}`;return console.error(s),m(s,-1),!1}}}const Mb={punctuation:{icon:"fa-at",changeRequiresRestart:!0,overrideValue:({value:e,currentConfig:t})=>t.mode==="quote"?!1:e},numbers:{icon:"fa-hashtag",changeRequiresRestart:!0,overrideValue:({value:e,currentConfig:t})=>t.mode==="quote"?!1:e},words:{icon:"fa-font",displayString:"word count",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.mode!=="words"?{mode:"words"}:{}},time:{icon:"fa-clock",changeRequiresRestart:!0,displayString:"time",overrideConfig:({currentConfig:e})=>e.mode!=="time"?{mode:"time"}:{}},mode:{icon:"fa-bars",changeRequiresRestart:!0,overrideConfig:({value:e})=>e==="custom"||e==="quote"||e==="zen"?{numbers:!1,punctuation:!1}:{},afterSet:({currentConfig:e})=>{e.mode==="zen"&&e.paceCaret!=="off"&&m("Pace caret will not work with zen mode.",0)}},quoteLength:{icon:"fa-quote-right",displayString:"quote length",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.mode!=="quote"?{mode:"quote"}:{}},language:{icon:"fa-language",displayString:"language",changeRequiresRestart:!0},burstHeatmap:{icon:"fa-fire",displayString:"burst heatmap",changeRequiresRestart:!1},difficulty:{icon:"fa-star",changeRequiresRestart:!0},quickRestart:{icon:"fa-redo-alt",displayString:"quick restart",changeRequiresRestart:!1},repeatQuotes:{icon:"fa-sync-alt",displayString:"repeat quotes",changeRequiresRestart:!1},blindMode:{icon:"fa-eye-slash",displayString:"blind mode",changeRequiresRestart:!1},alwaysShowWordsHistory:{icon:"fa-align-left",displayString:"always show words history",changeRequiresRestart:!1},singleListCommandLine:{icon:"fa-list",displayString:"single list command line",changeRequiresRestart:!1},minWpm:{icon:"fa-bomb",displayString:"min speed",changeRequiresRestart:!0},minWpmCustomSpeed:{icon:"fa-bomb",displayString:"min speed custom",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.minWpm!=="custom"?{minWpm:"custom"}:{}},minAcc:{icon:"fa-bomb",displayString:"min accuracy",changeRequiresRestart:!0},minAccCustom:{icon:"fa-bomb",displayString:"min accuracy custom",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.minAcc!=="custom"?{minAcc:"custom"}:{}},minBurst:{icon:"fa-bomb",displayString:"min burst",changeRequiresRestart:!0},minBurstCustomSpeed:{icon:"fa-bomb",displayString:"min burst custom speed",changeRequiresRestart:!0},britishEnglish:{icon:"fa-language",displayString:"british english",changeRequiresRestart:!0},funbox:{icon:"fa-gamepad",changeRequiresRestart:!0,isBlocked:({value:e,currentConfig:t})=>{if(!tl(e))return m(`${Ft(e.join(", "))} is an invalid combination of funboxes`,0),!0;for(const o of e)if(!$b(o,t))return m(`${e}" cannot be enabled with the current config`,0),!0;return!1}},customLayoutfluid:{icon:"fa-tint",displayString:"custom layoutfluid",changeRequiresRestart:!0,overrideValue:({value:e})=>Array.from(new Set(e))},customPolyglot:{icon:"fa-language",displayString:"custom polyglot",changeRequiresRestart:!1,overrideValue:({value:e})=>Array.from(new Set(e))},freedomMode:{icon:"fa-feather-alt",changeRequiresRestart:!1,displayString:"freedom mode",overrideConfig:({value:e})=>e?{confidenceMode:"off"}:{}},strictSpace:{icon:"fa-minus",displayString:"strict space",changeRequiresRestart:!0},oppositeShiftMode:{icon:"fa-exchange-alt",displayString:"opposite shift mode",changeRequiresRestart:!1},stopOnError:{icon:"fa-hand-paper",displayString:"stop on error",changeRequiresRestart:!0,overrideConfig:({value:e})=>e!=="off"?{confidenceMode:"off"}:{}},confidenceMode:{icon:"fa-backspace",displayString:"confidence mode",changeRequiresRestart:!1,overrideConfig:({value:e})=>e!=="off"?{freedomMode:!1,stopOnError:"off"}:{}},quickEnd:{icon:"fa-step-forward",displayString:"quick end",changeRequiresRestart:!1},indicateTypos:{icon:"fa-exclamation",displayString:"indicate typos",changeRequiresRestart:!1},hideExtraLetters:{icon:"fa-eye-slash",displayString:"hide extra letters",changeRequiresRestart:!1},lazyMode:{icon:"fa-couch",displayString:"lazy mode",changeRequiresRestart:!0},layout:{icon:"fa-keyboard",displayString:"layout",changeRequiresRestart:!0},codeUnindentOnBackspace:{icon:"fa-code",displayString:"code unindent on backspace",changeRequiresRestart:!0},soundVolume:{icon:"fa-volume-down",displayString:"sound volume",changeRequiresRestart:!1},playSoundOnClick:{icon:"fa-volume-up",displayString:"play sound on click",changeRequiresRestart:!1},playSoundOnError:{icon:"fa-volume-mute",displayString:"play sound on error",changeRequiresRestart:!1},playTimeWarning:{icon:"fa-exclamation-triangle",displayString:"play time warning",changeRequiresRestart:!1},smoothCaret:{icon:"fa-i-cursor",displayString:"smooth caret",changeRequiresRestart:!1},caretStyle:{icon:"fa-i-cursor",displayString:"caret style",changeRequiresRestart:!1},paceCaret:{icon:"fa-i-cursor",displayString:"pace caret",changeRequiresRestart:!1,isBlocked:({value:e})=>document.readyState==="complete"&&(e==="pb"||e==="tagPb")&&!F()?(m('Pace caret "pb" and "tag pb" are unavailable without an account',0),!0):!1},paceCaretCustomSpeed:{icon:"fa-i-cursor",displayString:"pace caret custom speed",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.paceCaret!=="custom"?{paceCaret:"custom"}:{}},paceCaretStyle:{icon:"fa-i-cursor",displayString:"pace caret style",changeRequiresRestart:!1},repeatedPace:{icon:"fa-i-cursor",displayString:"repeated pace",changeRequiresRestart:!1},timerStyle:{icon:"fa-chart-pie",displayString:"timer style",changeRequiresRestart:!1},liveSpeedStyle:{icon:"fa-tachometer-alt",displayString:"live speed style",changeRequiresRestart:!1},liveAccStyle:{icon:"fa-tachometer-alt",displayString:"live accuracy style",changeRequiresRestart:!1},liveBurstStyle:{icon:"fa-tachometer-alt",displayString:"live burst style",changeRequiresRestart:!1},timerColor:{icon:"fa-chart-pie",displayString:"timer color",changeRequiresRestart:!1},timerOpacity:{icon:"fa-chart-pie",displayString:"timer opacity",changeRequiresRestart:!1},highlightMode:{icon:"fa-highlighter",displayString:"highlight mode",changeRequiresRestart:!1},tapeMode:{icon:"fa-tape",triggerResize:!0,changeRequiresRestart:!1,displayString:"tape mode",overrideConfig:({value:e})=>e!=="off"?{showAllLines:!1}:{}},tapeMargin:{icon:"fa-tape",displayString:"tape margin",triggerResize:!0,changeRequiresRestart:!1},smoothLineScroll:{icon:"fa-align-left",displayString:"smooth line scroll",changeRequiresRestart:!1},showAllLines:{icon:"fa-align-left",changeRequiresRestart:!1,displayString:"show all lines",isBlocked:({value:e,currentConfig:t})=>e&&t.tapeMode!=="off"?(m("Show all lines doesn't support tape mode.",0),!0):!1},alwaysShowDecimalPlaces:{icon:"00",displayString:"always show decimal places",changeRequiresRestart:!1},typingSpeedUnit:{icon:"fa-tachometer-alt",displayString:"typing speed unit",changeRequiresRestart:!1},startGraphsAtZero:{icon:"fa-chart-line",displayString:"start graphs at zero",changeRequiresRestart:!1},maxLineWidth:{icon:"fa-text-width",changeRequiresRestart:!1,triggerResize:!0,displayString:"max line width"},fontSize:{icon:"fa-font",changeRequiresRestart:!1,triggerResize:!0,displayString:"font size"},fontFamily:{icon:"fa-font",displayString:"font family",changeRequiresRestart:!1},keymapMode:{icon:"fa-keyboard",displayString:"keymap mode",changeRequiresRestart:!1},keymapLayout:{icon:"fa-keyboard",displayString:"keymap layout",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapStyle:{icon:"fa-keyboard",displayString:"keymap style",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapLegendStyle:{icon:"fa-keyboard",displayString:"keymap legend style",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapShowTopRow:{icon:"fa-keyboard",displayString:"keymap show top row",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapSize:{icon:"fa-keyboard",triggerResize:!0,changeRequiresRestart:!1,displayString:"keymap size",overrideValue:({value:e})=>(e<.5&&(e=.5),e>3.5&&(e=3.5),Ql(e)),overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},flipTestColors:{icon:"fa-adjust",displayString:"flip test colors",changeRequiresRestart:!1},colorfulMode:{icon:"fa-fill-drip",displayString:"colorful mode",changeRequiresRestart:!1},customBackground:{icon:"fa-link",displayString:"URL background",changeRequiresRestart:!1,overrideValue:({value:e})=>e.trim()},customBackgroundSize:{icon:"fa-image",displayString:"custom background size",changeRequiresRestart:!1},customBackgroundFilter:{icon:"fa-image",displayString:"custom background filter",changeRequiresRestart:!1},autoSwitchTheme:{icon:"fa-palette",displayString:"auto switch theme",changeRequiresRestart:!1},themeLight:{icon:"fa-palette",displayString:"theme light",changeRequiresRestart:!1},themeDark:{icon:"fa-palette",displayString:"theme dark",changeRequiresRestart:!1},randomTheme:{icon:"fa-palette",changeRequiresRestart:!1,displayString:"random theme",isBlocked:({value:e})=>{var t;if(e==="custom"){const o=x();if(!F())return m("Random theme 'custom' is unavailable without an account",0),!0;if(!o)return m("Random theme 'custom' requires a snapshot to be set",0),!0;if(((t=o==null?void 0:o.customThemes)==null?void 0:t.length)===0)return m("Random theme 'custom' requires at least one custom theme to be saved",0),!0}return!1}},favThemes:{icon:"fa-palette",displayString:"favorite themes",changeRequiresRestart:!1},theme:{icon:"fa-palette",changeRequiresRestart:!1,overrideConfig:()=>({customTheme:!1})},customTheme:{icon:"fa-palette",displayString:"custom theme",changeRequiresRestart:!1},customThemeColors:{icon:"fa-palette",displayString:"custom theme colors",changeRequiresRestart:!1},showKeyTips:{icon:"fa-question",displayString:"show key tips",changeRequiresRestart:!1},showOutOfFocusWarning:{icon:"fa-exclamation",displayString:"show out of focus warning",changeRequiresRestart:!1},capsLockWarning:{icon:"fa-exclamation-triangle",displayString:"caps lock warning",changeRequiresRestart:!1},showAverage:{icon:"fa-chart-bar",displayString:"show average",changeRequiresRestart:!1},accountChart:{icon:"fa-chart-line",displayString:"account chart",changeRequiresRestart:!1,overrideValue:({value:e,currentValue:t})=>{if(e[0]==="off"&&e[1]==="off"){const o=e[0]===t[0]?0:1;e[o]="on"}return e}},monkey:{icon:"fa-egg",displayString:"monkey",changeRequiresRestart:!1},monkeyPowerLevel:{icon:"fa-egg",displayString:"monkey power level",changeRequiresRestart:!1},ads:{icon:"fa-ad",changeRequiresRestart:!1,overrideValue:({value:e})=>e,isBlocked:({value:e})=>!1,afterSet:({nosave:e})=>{e||(Wa(3),m("Ad settings changed. Refreshing...",0))}}},Tp=new Gt({key:"config",schema:ol,fallback:Jo(),migrate:(e,t)=>My(e)?Cd(e):Jo()});let r={...Jo()},tc={};const Kx=$t(1e3,()=>{Object.keys(tc).length>0&&(Yo(!0),gb(tc).then(()=>{Yo(!1)})),tc={}});function Lp(e,t=!1,o=!1){if(t)return;Tp.set(r),o||(tc[e]=r[e],Kx());const a=JSON.stringify(r);Ps("saveToLocalStorage",a)}function Cn(e=!1){console.log("saving full config to localStorage"),Tp.set(r),e||(Yo(!0),gb(r),Yo(!1));const t=JSON.stringify(r);Ps("saveToLocalStorage",t)}function Gx(){return Ae&&r.funbox.includes("no_quit")?(m("No quit funbox is active. Please finish the test.",0,{important:!0}),!0):!1}function M(e,t,o=!1){var l,c;const a=Mb[e];if(a===void 0)throw new Error(`Config metadata for key "${e}" is not defined.`);a.overrideValue&&(t=a.overrideValue({value:t,currentValue:r[e],currentConfig:r}));const s=r[e];if(a.changeRequiresRestart&&Ae&&r.funbox.includes("no_quit"))return m("No quit funbox is active. Please finish the test.",0,{important:!0}),console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - no quit funbox active.`),!1;if((l=a.isBlocked)!=null&&l.call(a,{value:t,currentConfig:r}))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - blocked.`),!1;const n=ol.shape[e];if(!vb(a.displayString??e,t,n))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - invalid value.`),!1;if(!Lb(e,t,r.funbox))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - funbox conflict.`),!1;if(a.overrideConfig){const u=a.overrideConfig({value:t,currentConfig:r});for(const d of vt(u)){const p=u[d];if(r[d]===p)continue;if(!M(d,p,o))throw new Error(`Failed to set config key "${d}" with value "${p}" for ${a.displayString} config override.`)}}return r[e]=t,o||Lp(e,o),Ps(e,t,o,s),a.triggerResize&&!o&&_k(),(c=a.afterSet)==null||c.call(a,{nosave:o||!1,currentConfig:r}),!0}function ka(e,t){return M("numbers",e,t)}function ls(e,t){return M("punctuation",e,t)}function gt(e,t){return M("mode",e,t)}function jx(e,t){return M("playSoundOnError",e,t)}function Qx(e,t){return M("playSoundOnClick",e,t)}function Yx(e,t){return M("soundVolume",e,t)}function Xx(e,t){return M("playTimeWarning",e,t)}function ca(e,t){return M("difficulty",e,t)}function Mc(e,t){return M("favThemes",e,t)}function Xa(e,t){return M("funbox",e,t)}function Ki(e,t){if(Gx()||!$b(e,r))return!1;let o=r.funbox;return o.includes(e)?o=o.filter(a=>a!==e):(o.push(e),o.sort()),vb("funbox",o,Ry)?(r.funbox=o,Lp("funbox",t),Ps("funbox",r.funbox),!0):!1}function Zx(e,t){return M("blindMode",e,t)}function Td(e,t){return M("accountChart",e,t)}function Ab(e,t){return M("stopOnError",e,t)}function Jx(e,t){return M("alwaysShowDecimalPlaces",e,t)}function eT(e,t){return M("typingSpeedUnit",e,t)}function tT(e,t){return M("showOutOfFocusWarning",e,t)}function oT(e,t){return M("paceCaret",e,t)}function aT(e,t){return M("repeatedPace",e,t)}function sT(e,t){return M("minWpm",e,t)}function iT(e,t){return M("minAcc",e,t)}function oc(e,t){return M("minBurst",e,t)}function Ag(e,t){return M("minBurstCustomSpeed",e,t)}function nT(e,t){return M("alwaysShowWordsHistory",e,t)}function rT(e,t){return M("singleListCommandLine",e,t)}function lT(e,t){return M("capsLockWarning",e,t)}function of(e,t){return M("showAllLines",e,t)}function cT(e,t){return M("quickEnd",e,t)}function dT(e,t){return M("ads",e,t)}function uT(e,t){return M("repeatQuotes",e,t)}function fT(e,t){return M("flipTestColors",e,t)}function pT(e,t){return M("colorfulMode",e,t)}function mT(e,t){return M("strictSpace",e,t)}function gT(e,t){return M("oppositeShiftMode",e,t)}function hT(e,t){return M("caretStyle",e,t)}function yT(e,t){return M("paceCaretStyle",e,t)}function bT(e,t){return M("showAverage",e,t)}function As(e,t){return M("highlightMode",e,t)}function vT(e,t){return M("tapeMode",e,t)}function wT(e,t){return M("tapeMargin",e,t)}function CT(e,t){return M("hideExtraLetters",e,t)}function kT(e,t){return M("timerStyle",e,t)}function ST(e,t){return M("liveSpeedStyle",e,t)}function xT(e,t){return M("liveAccStyle",e,t)}function TT(e,t){return M("liveBurstStyle",e,t)}function LT(e,t){return M("timerColor",e,t)}function $T(e,t){return M("timerOpacity",e,t)}function MT(e,t){return M("showKeyTips",e,t)}function wa(e,t){return M("time",e,t)}function Ld(e,t){return M("quoteLength",e,t)}function Gi(e){return M("quoteLength",[0,1,2,3],e)}function Qs(e,t){return M("words",e,t)}function AT(e,t){return M("smoothCaret",e,t)}function ET(e,t){return M("codeUnindentOnBackspace",e,t)}function _T(e,t){return M("startGraphsAtZero",e,t)}function IT(e,t){return M("smoothLineScroll",e,t)}function qT(e,t){return M("quickRestart",e,t)}function Eb(e,t){return M("fontFamily",e,t)}function BT(e,t){return M("freedomMode",e,t)}function FT(e,t){return M("confidenceMode",e,t)}function RT(e,t){return M("indicateTypos",e,t)}function _b(e,t){return M("autoSwitchTheme",e,t)}function Sa(e,t){return M("customTheme",e,t)}function $p(e,t){return M("theme",e,t)}function DT(e,t){return M("themeLight",e,t)}function WT(e,t){return M("themeDark",e,t)}function PT(e,t){return M("randomTheme",e,t)}function zT(e,t){return M("britishEnglish",e,t)}function Ac(e,t){return M("lazyMode",e,t)}function nn(e,t){return M("customThemeColors",e,t)}function rn(e,t){return M("language",e,t)}function xo(e,t){return M("keymapMode",e,t)}function HT(e,t){return M("keymapLegendStyle",e,t)}function OT(e,t){return M("keymapStyle",e,t)}function Is(e,t){return M("keymapLayout",e,t)}function NT(e,t){return M("keymapShowTopRow",e,t)}function $d(e,t){return M("keymapSize",e,t)}function Qa(e,t){return M("layout",e,t)}function UT(e,t){return M("fontSize",e,t)}function VT(e,t){return M("maxLineWidth",e,t)}function KT(e,t){return M("customBackground",e,t)}function GT(e,t){return M("customLayoutfluid",e,t)}function jT(e,t){return M("customPolyglot",e,t)}function Ib(e,t){return M("customBackgroundSize",e,t)}function Wi(e,t){return M("customBackgroundFilter",e,t)}function QT(e,t){return M("burstHeatmap",e,t)}const Eg=new Set(["keymapMode","minWpm","minAcc","minBurst","paceCaret","quoteLength","words","time","mode","numbers","punctuation","funbox"]);async function ln(e){if(e==null)return;const t=Cd(e);Ps("fullConfigChange");const o=Jo();for(const n of vt(t))r[n]=o[n];const a=[],s=vt(t).filter(n=>!Eg.has(n));for(const n of[...s,...Eg]){const l=t[n];M(n,l,!0)||a.push(n)}for(const n of a)Lp(n);Ps("configApplied",void 0,void 0,void 0,r),Ps("fullConfigChangeFinished")}async function Mp(){await ln(Jo()),await bx(),Cn(!0)}async function YT(){console.log("loading localStorage config");const e=Tp.get();e===void 0?await Mp():(await ln(e),Cn(!0)),XT()}function _g(){const e={};return vt(r).filter(t=>r[t]!==Jo()[t]).forEach(t=>{e[t]=r[t]}),e}async function qb(e){try{const t=vn(e,By.strip(),{migrate:o=>{if(Array.isArray(o))throw new Error("Invalid config");return Cd(o)}});await ln(t),Cn(),m("Done",1)}catch(t){const o=re(t,"Failed to import settings");console.error(o),m(o,-1)}}const{promise:Bb,resolve:XT}=Da();class ZT{constructor(){this.list=[],this.sectionIndexList=[],this.length=0}get(t,o=!1){var a,s;return t===void 0?this.list:o?(s=(a=this.list[t])==null?void 0:a.replace(/[.?!":\-,]/g,""))==null?void 0:s.toLowerCase():this.list[t]}getCurrent(){return this.list[Z]??""}getLast(){return this.list[this.list.length-1]}push(t,o){this.list.push(t),this.sectionIndexList.push(o),this.length=this.list.length}reset(){this.list=[],this.sectionIndexList=[],this.length=this.list.length}clean(){for(const t of this.list)if(/ +/.test(t)){const o=this.list.indexOf(t),a=t.split(" ");this.list.splice(o,1);for(let s=0;s<a.length;s++)this.list.splice(o+s,0,a[s])}}}const I=new ZT;let Tr=!1,Lr=!1,Ap=!1,J=null;function af(e){J=e}function JT(e){Tr=e}function eL(e){Lr=e}function tL(e){Ap=e}const oL=window.fetch;async function aL(e){var t;try{if(!e)throw new Error("No URL");const o=await oL(e);if(o.ok){if(!((t=o.headers.get("content-type"))!=null&&t.startsWith("application/json")))throw new Error("Content is not JSON");return await o.json()}else throw new Error(`${o.status} ${o.statusText}`)}catch(o){throw console.error("Error fetching JSON: "+e,o),o}}function sL(e,t){const o=new Map;return async(...a)=>{const s=a[0];if(o.has(s)){const l=await o.get(s);if(l!==void 0)return l}const n=e.apply(null,a);return o.set(s,n),n}}const gs=sL(aL);async function zs(e){return await gs(`/layouts/${e}.json`)}let Al;async function kn(e){return(Al===void 0||Al.name!==e)&&(Al=await gs(`/languages/${e}.json`)),Al}async function iL(e){const t=await kn(e);return t.orderedByFrequency===!0?"yes":t.orderedByFrequency===!1?"no":"unknown"}async function hs(e){return await kn(e)}class Fb{constructor(t,o,a){this.title=t,this.author=o,this.words=a}}async function Rb(){return await gs("/challenges/_list.json")}async function nL(){return await gs("/about/supporters.json")}async function rL(){return await gs("/about/contributors.json")}async function lL(){const e=await gs("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=1");if(e[0]===void 0||e[0].name===void 0)throw new Error("No release found");return e[0].name}async function cL(){return gs("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=5")}const Db=new Set(["NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space","Enter","Tab","NoCode"]);class dL{constructor(){this.current="",this.history=[],this.koreanStatus=!1}reset(){this.current="",this.history=[]}resetHistory(){this.history=[]}setKoreanStatus(t){this.koreanStatus=t}getKoreanStatus(){return this.koreanStatus}pushHistory(){this.history.push(this.current),this.current=""}popHistory(){return this.history.pop()??""}getHistory(t){return t===void 0?this.history:this.history[t]}getHistoryLast(){return Vs(this.history)}}class uL{constructor(){this.current="",this.history=[]}reset(){this.history=[],this.current=""}getHistory(t){return this.history[t]}popHistory(){return this.history.pop()??""}pushHistory(){this.history.push(this.current),this.current=""}}let xa={};const k=new dL,tt=new uL;let Ys=[],Ec=0,Md=0,Ta={},mo={correct:0,incorrect:0},ve={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},da={total:0,lastStartTime:-1},La=[],Ad=[],Do=[],nl=[],$r={count:0,words:[]},rl=[],_c=!0;function sf(){Ec++}function Wb(){_c=!1}function Pb(){$r.count++}function nf(e){$r.words.push(e)}function fL(e){Md=e}function Ed(){Ys.push(Ec),Ec=0}function _d(){rl.push(_c),_c=!0}function Id(){nl.push($r),$r={count:0,words:[]}}function zb(e){e?mo.correct++:mo.incorrect++}function pL(e){var n,l;const t=U(Yl(ve.duration.array)),o=Object.entries(xa);o.sort((c,u)=>c[1].timestamp-u[1].timestamp);for(const c of o)Hb(e,c[0]);const a=(n=Vs(o))==null?void 0:n[0],s=(l=xa[a])==null?void 0:l.index;a!==void 0&&s!==void 0&&(ve.duration.array[s]=t)}let Mr=0;function Hb(e,t){if(!Db.has(t))return;t==="NoCode"&&(Mr--,t="NoCode"+Mr);const o=xa[t];if(o===void 0)return;const a=Math.abs(o.timestamp-e);ve.duration.array[o.index]=a,console.debug("Keyup recorded",t,a),delete xa[t],Ob(e)}function mL(e,t){var o;if(!Db.has(t)){console.debug("Key not tracked",t);return}if(t==="NoCode"&&(t="NoCode"+Mr,Mr++),xa[t]!==void 0){console.debug("Key already down",t);return}if(xa[t]={timestamp:e,index:ve.duration.array.length},ve.duration.array.push(0),Ob((o=xa[t])==null?void 0:o.timestamp),ve.spacing.last!==-1){const a=Math.abs(e-ve.spacing.last);ve.spacing.array.push(U(a)),console.debug("Keydown recorded",t,a)}ve.spacing.last=e,ve.spacing.first===-1&&(ve.spacing.first=e,console.debug("First keydown recorded",t,e))}function Ob(e){Object.keys(xa).length>1?da.lastStartTime===-1&&(da.lastStartTime=e):da.lastStartTime!==-1&&(da.total+=e-da.lastStartTime,da.lastStartTime=-1)}function gL(){ve={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},da={total:0,lastStartTime:-1},xa={},Mr=0,console.debug("Keypress timings reset")}function Nb(e){Object.keys(Ta).includes(e)?Ta[e]++:Ta[e]=1}function Ub(e){La.push(e)}function Vb(e){Ad.push(e)}function Kb(e){Do[Z]===void 0?Do.push(e):Do[Z]=e}function hL(){La=[],Ad=[],Do=[],Ys=[],Ec=0,rl=[],_c=!0,nl=[],$r={count:0,words:[]},Md=0,Ta={},mo={correct:0,incorrect:0},ve={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}}}let Ic=!0;const Jt=document.querySelector("#caret");function Gb(){Ic&&(Jt.style.animationName="none",Jt.style.opacity="1",Ic=!1)}function jb(){Ic||(r.smoothCaret!=="off"&&!Pe()?Jt.style.animationName="caretFlashSmooth":Jt.style.animationName="caretFlashHard",Ic=!0)}function ll(){Jt.classList.add("hidden")}function yL(e){if(!e){const o=document.querySelector("#words .word");if(o)e=o;else return 0}const t=window.getComputedStyle(e);return parseInt(t.marginRight)+parseInt(t.marginLeft)}function bL(e,t,o,a,s,n,l){const c=r.blindMode||r.hideExtraLetters;let u=0;if(r.tapeMode==="off"){let d=0;const p=a[l],f=a[n-1],g=a[l-1];t?l<=n&&p?d=p.offsetLeft+(e?0:s):c?d=((f==null?void 0:f.offsetLeft)??0)-(e?s:0):d=((g==null?void 0:g.offsetLeft)??0)-(e?s:0):l<n&&p?d=p.offsetLeft:c?d=((f==null?void 0:f.offsetLeft)??0)+((f==null?void 0:f.offsetWidth)??0):d=((g==null?void 0:g.offsetLeft)??0)+((g==null?void 0:g.offsetWidth)??0),u=o.offsetLeft+d}else if(u=(i(document.querySelector("#wordsWrapper")).width()??0)*(t?1-r.tapeMargin/100:r.tapeMargin/100)-(e&&t?s:0),r.tapeMode==="word"&&l>0){let f=0,g=0;for(let h=0;h<l&&!(c&&h>=n);h++){const y=i(a[h]).outerWidth(!0)??0;f+=y,y>0&&(g=y)}i(a[l]).outerWidth(!0)===0&&(f-=g),t&&(f*=-1),u+=f}return u}function vL(e,t,o,a,s){var l;let n=e==null?void 0:e.offsetWidth;if(n===void 0||o===0)n=yL(t);else if(n===0)for(let c=a;c>=0&&(n=(l=s[c])==null?void 0:l.offsetWidth,!n);c--);return n??0}async function Ea(e=!1){const t=window.getComputedStyle(Jt),o=parseInt(t.width)||0,a=parseInt(t.height)||0,s=["block","outline","underline"].includes(r.caretStyle);let n=Xo(I.getCurrent()).length;const l=Xo(k.current).length;r.mode==="zen"&&(n=l);const c=document.querySelectorAll("#words .word")[Z-ut];if(!c)return;const u=c.querySelectorAll("letter");if(!(u!=null&&u.length))return;const d=u[l],p=u[l-1],f=u[n-1],h=(await hs(r.language)).rightToLeft??!1,y=(ar(d==null?void 0:d.offsetHeight)??0)||(ar(p==null?void 0:p.offsetHeight)??0)||(ar(f==null?void 0:f.offsetHeight)??0)||r.fontSize*Gs(1),v=(d==null?void 0:d.offsetTop)??(p==null?void 0:p.offsetTop)??(f==null?void 0:f.offsetTop)??0,w=y-a;let $=c.offsetTop+v+w/2;r.caretStyle==="underline"&&($=c.offsetTop+v-a/2);const S=vL(d,c,n,l,u),q=bL(s,h,c,u,S,n,l)-(s?0:o/2),_=i(Jt);_.css("display","block");const N={top:$-vd,left:q};s&&(N.width=`${S}px`);const Y=r.smoothCaret==="off"?0:r.smoothCaret==="slow"?150:r.smoothCaret==="medium"?100:r.smoothCaret==="fast"?85:0;if(_.stop(!0,!1).animate(N,Pe()||e?0:Y),r.showAllLines){const G=window.innerHeight,xe=G/2-_.outerHeight()/2,He=document.body.scrollHeight;if($>=xe&&He>G&&Ae){const Fe=$-xe/2;window.scrollTo({left:0,top:Fe,behavior:Ay()?"instant":"smooth"})}}}function wL(){Jt.style.width="",Jt.classList.remove("off","default","underline","outline","block","carrot","banana"),Jt.classList.add(r.caretStyle)}ge(e=>{e==="caretStyle"&&(wL(),Ea(!0)),e==="smoothCaret"&&(r.smoothCaret==="off"?Jt.style.animationName="caretFlashHard":Jt.style.animationName="caretFlashSmooth")});function Qb(e=!1){Jt.classList.remove("hidden"),Ea(e),jb()}class Fn{constructor(t,o,a,s,n){this.unit=t,this.convertFactor=o,this.fullUnitString=a,this.histogramDataBucketSize=s,this.historyStepSize=n}fromWpm(t){return t*this.convertFactor}toWpm(t){return t/this.convertFactor}}const CL={wpm:new Fn("wpm",1,"Words per Minute",10,10),cpm:new Fn("cpm",5,"Characters per Minute",50,100),wps:new Fn("wps",1/60,"Words per Second",.5,2),cps:new Fn("cps",5/60,"Characters per Second",5,5),wph:new Fn("wph",60,"Words per Hour",250,1e3)};function bt(e){return CL[e]}const hu={suffix:"",fallback:"-",showDecimalPlaces:void 0,rounding:Math.round};class kL{constructor(t){this.config=t}typingSpeed(t,o={}){const a={...hu,...o};if(t==null)return a.fallback??"";const s=bt(this.config.typingSpeedUnit).fromWpm(t);return this.number(s,a)}percentage(t,o={}){const a={...hu,...o};return a.suffix="%"+(a.suffix??""),this.number(t,a)}accuracy(t,o={}){return this.percentage(t,{rounding:Math.floor,...o})}decimals(t,o={}){const a={...hu,...o};return this.number(t,a)}number(t,o){if(t==null)return o.fallback??"";const a=o.suffix??"";return(o.showDecimalPlaces!==void 0?o.showDecimalPlaces:this.config.alwaysShowDecimalPlaces)?U(t).toFixed(2)+a:(o.rounding??Math.round)(t).toString()+a}rank(t,o={}){const a={fallback:"-",...o};if(t==null)return a.fallback??"";let s="th";const n=t%10,l=t%100;return n===1&&l!==11&&(s="st"),n===2&&l!==12&&(s="nd"),n===3&&l!==13&&(s="rd"),t+s}}const z=new kL(r),Ar=document.querySelector("#liveStatsTextBottom .liveSpeed"),Er=document.querySelector("#liveStatsMini .speed");function SL(){Ar.innerHTML="0",Er.innerHTML="0"}function xL(e,t){let o=e;r.blindMode&&(o=t);const a=z.typingSpeed(o,{showDecimalPlaces:!1});Ar.innerHTML=a,Er.innerHTML=a}let qc=!1;function Ep(){r.liveSpeedStyle!=="off"&&Ae&&(qc||(r.liveSpeedStyle==="mini"?i(Er).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):i(Ar).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),qc=!0))}function qd(){qc&&(i(Ar).stop(!0,!1).animate({opacity:0},125,()=>{Ar.classList.add("hidden")}),i(Er).stop(!0,!1).animate({opacity:0},125,()=>{Er.classList.add("hidden")}),qc=!1)}ge((e,t)=>{e==="liveSpeedStyle"&&(t==="off"?qd():Ep())});const _r=document.querySelector("#liveStatsTextBottom .liveBurst"),Ir=document.querySelector("#liveStatsMini .burst");function TL(){_r.innerHTML="0",Ir.innerHTML="0"}async function LL(e){const t=z.typingSpeed(e,{showDecimalPlaces:!1});Ir.innerHTML=t,_r.innerHTML=t}let Bc=!1;function _p(){r.liveBurstStyle!=="off"&&Ae&&(Bc||(r.liveBurstStyle==="mini"?i(Ir).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):i(_r).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),Bc=!0))}function Bd(){Bc&&(i(_r).stop(!0,!1).animate({opacity:0},125,()=>{i(_r).addClass("hidden")}),i(Ir).stop(!0,!1).animate({opacity:0},125,()=>{i(Ir).addClass("hidden")}),Bc=!1)}ge((e,t)=>{e==="liveBurstStyle"&&(t==="off"?Bd():_p())});const qr=document.querySelector("#liveStatsTextBottom .liveAcc"),Br=document.querySelector("#liveStatsMini .acc");function $L(e){let t=Math.floor(e);r.blindMode&&(t=100),Br.innerHTML=t+"%",qr.innerHTML=t+"%"}function ML(){Br.innerHTML="100%",qr.innerHTML="100%"}let Fc=!1;function Ip(){r.liveAccStyle!=="off"&&Ae&&(Fc||(r.liveAccStyle==="mini"?i(Br).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):i(qr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),Fc=!0))}function Fd(){Fc&&(i(qr).stop(!0,!1).animate({opacity:0},125,()=>{i(qr).addClass("hidden")}),i(Br).stop(!0,!1).animate({opacity:0},125,()=>{i(Br).addClass("hidden")}),Fc=!1)}ge((e,t)=>{e==="liveAccStyle"&&(t==="off"?Fd():Ip())});const AL=P.record(P.string(),P.string()),EL=P.record(P.string(),P.object({text:P.string(),progress:P.number()})),Yb=new Gt({key:"customText",schema:AL,fallback:{}}),Xb=new Gt({key:"customTextLong",schema:EL,fallback:{}}),Zb=Yk.omit({textLen:!0}).extend({text:P.array(P.string()).min(1)}),Ig={text:["The","quick","brown","fox","jumps","over","the","lazy","dog"],mode:"repeat",limit:{value:9,mode:"word"},pipeDelimiter:!1},wt=new Gt({key:"customTextSettings",schema:Zb,fallback:Ig,migrate:(e,t)=>{const o=structuredClone(Ig);if(typeof e!="object"||e===null)return o;const a=o;return"text"in e&&P.array(P.string()).safeParse(a.text).success&&(a.text=e.text),a}});function cl(){return wt.get().text}function _a(e){const t=wt.get();wt.set({...t,text:e,limit:{value:e.length,mode:t.limit.mode}})}function ac(){return wt.get().mode}function cn(e){const t=wt.get();wt.set({...t,mode:e,limit:{value:t.text.length,mode:t.limit.mode}})}function qg(){return wt.get().limit}function ke(){return wt.get().limit.value}function Se(){return wt.get().limit.mode}function Ko(e){const t=wt.get();wt.set({...t,limit:{value:e,mode:t.limit.mode}})}function _o(e){const t=wt.get();wt.set({...t,limit:{value:t.limit.value,mode:e}})}function dl(){return wt.get().pipeDelimiter}function Xs(e){const t=wt.get();wt.set({...t,pipeDelimiter:e})}function Ia(){return wt.get()}function Rc(e,t=!1){if(t){const a=Sn()[e];if(a===void 0)throw new Error(`Custom text ${e} not found`);return a.text.split(/ +/)}else{const o=Rd()[e];if(o===void 0)throw new Error(`Custom text ${e} not found`);return o.split(/ +/)}}function _L(e,t,o=!1){if(o){const a=Sn();a[e]={text:"",progress:0};const s=a[e];if(s===void 0)throw new Error("Custom text not found");return typeof t=="string"?s.text=t:s.text=t.join(" "),Bp(a)}else{const a=Rd();return typeof t=="string"?a[e]=t:a[e]=t.join(" "),ev(a)}}function Jb(e,t){const o=t?Sn():Rd();delete o[e],t?Bp(o):ev(o)}function qp(e){const t=Sn()[e];if(t===void 0)throw new Error("Custom text not found");return t.progress??0}function rf(e,t){const o=Sn(),a=o[e];if(a===void 0)throw new Error("Custom text not found");a.progress=t,Bp(o)}function Rd(){return Yb.get()}function Sn(){return Xb.get()}function ev(e){return Yb.set(e)}function Bp(e){return Xb.set(e)}function lf(e=!1){return Object.keys(e?Sn():Rd())}let Fp=0;function ul(){return Fp}function IL(e){Fp=e}function qL(){Fp++}const cf=i("#barTimerProgress .bar"),tv=i("#barTimerProgress .opacityWrapper"),Dd=i("#liveStatsTextTop .timerProgress"),Fr=i("#liveStatsMini .time");function Rp(){r.mode!=="zen"&&r.timerStyle==="bar"?tv.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125):r.timerStyle==="text"?Dd.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125):(r.mode==="zen"||r.timerStyle==="mini")&&Fr.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125)}function BL(){let e="0vw";(r.mode==="time"||r.mode==="custom"&&Se()==="time")&&(e="100vw"),cf.stop(!0,!0).animate({width:e},0),Fr.text("0"),Dd.text("0")}function Wd(){tv.stop(!0,!0).animate({opacity:0},125),Fr.stop(!0,!0).animate({opacity:0},125,()=>{Fr.addClass("hidden")}),Dd.stop(!0,!0).animate({opacity:0},125)}const Na=Dd[0],Ua=Fr[0];function Bg(){return r.mode==="custom"&&Se()==="section"?I.sectionIndexList[Z]-1:k.getHistory().length}function fl(){const e=ul();if(r.mode==="time"||r.mode==="custom"&&Se()==="time"){let t=r.time;if(r.mode==="custom"&&Se()==="time"&&(t=ke()),r.timerStyle==="bar"){const o=100-(e+1)/t*100;cf.stop(!0,!0).animate({width:o+"vw"},Pe()?0:1e3,"linear")}else if(r.timerStyle==="text"){let o=ft(t-e);t===0&&(o=ft(e)),Na!==null&&(Na.innerHTML="<div>"+o+"</div>")}else if(r.timerStyle==="mini"){let o=ft(t-e);t===0&&(o=ft(e)),Ua!==null&&(Ua.innerHTML=o)}}else if(r.mode==="words"||r.mode==="custom"||r.mode==="quote"){let t=I.length;if(r.mode==="words"&&(t=r.words),r.mode==="custom"&&(t=ke()),r.mode==="quote"&&(t=(J==null?void 0:J.textSplit.length)??1),r.timerStyle==="bar"){const o=Math.floor((Z+1)/t*100);cf.stop(!0,!0).animate({width:o+"vw"},Pe()?0:250)}else r.timerStyle==="text"?t===0?Na!==null&&(Na.innerHTML=`<div>${k.getHistory().length}</div>`):Na!==null&&(Na.innerHTML=`<div>${Bg()}/${t}</div>`):r.timerStyle==="mini"&&(t===0?Ua!==null&&(Ua.innerHTML=`${k.getHistory().length}`):Ua!==null&&(Ua.innerHTML=`${Bg()}/${t}`))}else r.mode==="zen"&&(r.timerStyle==="text"?Na!==null&&(Na.innerHTML=`<div>${k.getHistory().length}</div>`):Ua!==null&&(Ua.innerHTML=`${k.getHistory().length}`))}function FL(){Ae&&(Wd(),fl(),r.timerStyle!=="off"&&setTimeout(()=>{Rp()},125))}ge((e,t)=>{e==="timerStyle"&&FL()});const Fg=3;let Nn=!1;function zo(e,t=!1){e&&!Nn?(Nn=!0,Gb(),i("header").addClass("focus"),i("footer").addClass("focus"),t||(i("body").css("cursor","none"),i("button").css("cursor","none"),i("a").css("cursor","none")),i("main").addClass("focus"),i("#bannerCenter").addClass("focus"),i("#notificationCenter").addClass("focus"),i("#capsWarning").addClass("focus"),i("#ad-vertical-right-wrapper").addClass("focus"),i("#ad-vertical-left-wrapper").addClass("focus"),i("#ad-footer-wrapper").addClass("focus"),i("#ad-footer-small-wrapper").addClass("focus"),Ep(),_p(),Ip(),Rp()):!e&&Nn&&(Nn=!1,jb(),i("header").removeClass("focus"),i("footer").removeClass("focus"),i("body").css("cursor",""),i("button").css("cursor",""),i("a").css("cursor",""),i("main").removeClass("focus"),i("#bannerCenter").removeClass("focus"),i("#notificationCenter").removeClass("focus"),i("#capsWarning").removeClass("focus"),i("#app").removeClass("focus"),i("#ad-vertical-right-wrapper").removeClass("focus"),i("#ad-vertical-left-wrapper").removeClass("focus"),i("#ad-footer-wrapper").removeClass("focus"),i("#ad-footer-small-wrapper").removeClass("focus"),qd(),Bd(),Fd(),Wd())}i(document).on("mousemove",function(e){Ks()||Nn&&e.originalEvent&&(e.originalEvent.movementX>Fg||e.originalEvent.movementY>Fg)&&zo(!1)});const RL={title:"Minimum burst...",configKey:"minBurst",list:[{id:"setMinBurstOff",display:"off",configValue:"off",exec:()=>{oc("off")}},{id:"setMinBurstFixed",display:"fixed...",configValue:"fixed",input:!0,exec:({input:e})=>{if(e===void 0||e==="")return;oc("fixed");const t=bt(r.typingSpeedUnit).toWpm(parseInt(e));Ag(t)}},{id:"setMinBurstFlex",display:"flex...",configValue:"flex",input:!0,exec:({input:e})=>{if(e===void 0||e==="")return;oc("flex");const t=bt(r.typingSpeedUnit).toWpm(parseInt(e));Ag(t)}}]},ov=[{id:"changeMinBurst",display:"Minimum burst...",alias:"minimum",icon:"fa-bomb",subgroup:RL}],av=[];function xn(){i("#words, #koInputVisualContainer").css("transition","none").removeClass("blurred"),i(".outOfFocusWarning").addClass("hidden"),Ik(av)}function sv(){av.push(setTimeout(()=>{i("#words, #koInputVisualContainer").css("transition","0.25s").addClass("blurred"),i(".outOfFocusWarning").removeClass("hidden")},1e3))}function Uo(e,t,o){const a=Rg(e),s=Rg(t);if(a&&s){const n=a.a??1,l=s.a??1,c=Math.round(a.r*(1-o)+s.r*o),u=Math.round(a.g*(1-o)+s.g*o),d=Math.round(a.b*(1-o)+s.b*o),p=n*(1-o)+l*o;return a.a!==void 0||s.a!==void 0||p!==1?Dg(c,u,d,p):Dg(c,u,d)}else return"#ff00ffff"}function Rg(e){if(e.length!==4&&e.length!==5&&e.length!==7&&e.length!==9||!e.startsWith("#"))return;let t,o,a,s;if(e.length===4)t=+("0x"+e[1]+e[1]),o=+("0x"+e[2]+e[2]),a=+("0x"+e[3]+e[3]);else if(e.length===5)t=+("0x"+e[1]+e[1]),o=+("0x"+e[2]+e[2]),a=+("0x"+e[3]+e[3]),s=+("0x"+e[4]+e[4])/255;else if(e.length===7)t=+("0x"+e[1]+e[2]),o=+("0x"+e[3]+e[4]),a=+("0x"+e[5]+e[6]);else if(e.length===9)t=+("0x"+e[1]+e[2]),o=+("0x"+e[3]+e[4]),a=+("0x"+e[5]+e[6]),s=+("0x"+e[7]+e[8])/255;else return;const n={r:t,g:o,b:a};return s!==void 0&&(n.a=s),n}function Dg(e,t,o,a){const s=Math.round(e).toString(16).padStart(2,"0"),n=Math.round(t).toString(16).padStart(2,"0"),l=Math.round(o).toString(16).padStart(2,"0");if(a!==void 0){const c=Math.round(a*255).toString(16).padStart(2,"0");return`#${s}${n}${l}${c}`}return`#${s}${n}${l}`}function Dc(e){let t,o,a,s;e.length===4?(t="0x"+e[1]+e[1],o="0x"+e[2]+e[2],a="0x"+e[3]+e[3]):e.length===5?(t="0x"+e[1]+e[1],o="0x"+e[2]+e[2],a="0x"+e[3]+e[3],s=("0x"+e[4]+e[4])/255):e.length===7?(t="0x"+e[1]+e[2],o="0x"+e[3]+e[4],a="0x"+e[5]+e[6]):e.length===9?(t="0x"+e[1]+e[2],o="0x"+e[3]+e[4],a="0x"+e[5]+e[6],s=("0x"+e[7]+e[8])/255):(t=0,o=0,a=0),t/=255,o/=255,a/=255;const n=Math.min(t,o,a),l=Math.max(t,o,a),c=l-n;let u=0,d=0,p=0;c===0?u=0:l===t?u=(o-a)/c%6:l===o?u=(a-t)/c+2:u=(t-o)/c+4,u=Math.round(u*60),u<0&&(u+=360),p=(l+n)/2,d=c===0?0:c/(1-Math.abs(2*p-1)),d=+(d*100).toFixed(1),p=+(p*100).toFixed(1);const f={hue:u,sat:d,lgt:p,string:s!==void 0?`hsla(${u}, ${d}%, ${p}%, ${s.toFixed(3)})`:`hsl(${u}, ${d}%, ${p}%)`};return s!==void 0&&(f.alpha=s),f}function DL(e){return Dc(e).lgt>=50}function iv(e){return Dc(e).lgt<50}function WL(e){const t=e.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);if(t===null||t.length<3)return;function o(a){return("0"+parseInt(a).toString(16)).slice(-2)}return"#"+o(t[1])+o(t[2])+o(t[3])}const Pd={composing:!1,startPos:-1};function Hs(){return Pd.composing}function PL(){return Pd.startPos}function Dp(e){Pd.composing=e}function zL(e){Pd.startPos=e}const _t=16,nv=12,df=_t/2,HL=nv/2,Wg=250;let Ot=[],pt,dn={},Wc=[],zd=[],rr=[],Wp=[],Pi=[],El,Ci,rv=new Date,Rr=!1,lv=!1,uf=!0,Pc=!0,ff=!1,_l=!1;async function OL(e,t){if(!lv||Pi!==void 0&&e===Pi[0]&&t===Pi[1]||!Rr&&!await UL()||e===void 0||t===void 0||e<0||t<0||t<e)return!1;t=Math.min(t,pt.length-1);const o=VL(e,t,ff);for(let a=0;a<Ot.length;a++){const s=zd[a],n=s.children[0];s.classList.remove("highlight-hidden"),!uf&&!Pc?(s.classList.add("withAnimation"),n.classList.add("withAnimation")):(s.classList.remove("withAnimation"),n.classList.remove("withAnimation"));const l=o[a];l&&(s.style.right=l.highlightRight+"px",n.style.left=l.inputContainerLeft+"px",s.style.left=l.highlightLeft+"px")}return uf=!1,Pc=!1,Pi=[e,t],!0}function NL(){for(const e of zd)e.classList.add("highlight-hidden");Pc=!0,Pi=[]}function Pp(){if(Rr){for(const e of Wc)e.remove();zd=[],Wc=[],dn={},Ot=[],rr=[],Wp=[],Rr=!1,uf=!0,Pc=!0,Pi=[]}}function cv(e){lv=e}async function UL(){if(Rr||_l)return!1;_l=!0;const e=new Date().getTime()-rv.getTime();if(e<Wg&&await new Promise(d=>setTimeout(d,Wg-e)),ff=(await hs(r.language)).rightToLeft??!1,El=i("#resultWordsHistory")[0],Ci=El.getBoundingClientRect(),pt=i(El).find(".words .word[input]"),pt.length===0)return _l=!1,!1;let o=-1,a,s=0;dn[0]=0;for(let d=1;d<pt.length;d++){const p=pt[d],f=pt[d-1];p.offsetTop!==f.offsetTop&&(s++,a=or([pt[o+1],f]),Ot.push({firstWordIndex:o+1,lastWordIndex:d-1,rect:a}),o=d-1),dn[d]=s}a=or([pt[o+1],pt[pt.length-1]]),Ot.push({firstWordIndex:o+1,lastWordIndex:pt.length-1,rect:a});const n=Ci.width,l=Ci.height,c=Ci.top,u=Ci.left;return Ot.forEach(d=>{const p=document.createElement("div");p.classList.add("highlightContainer"),Wc.push(p);const f=d.rect.top-HL,g=d.rect.left-df,h=f-c,y=g-u,v=d.rect.width+_t,w=d.rect.height+nv,$=d.rect.width,S=d.rect.height,T=h/l*100+"%",q=y/n*100+"%",_=v/n*100+"%",N=w/l*100+"%";p.style.width=_,p.style.top=T,p.style.left=q,p.style.height=N;const Y=document.createElement("div"),G=document.createElement("div");G.style.top=d.rect.top-f+"px",G.style.left=d.rect.left-g+"px",G.style.width=$+"px",G.style.height=S+"px",Y.className="highlight highlight-hidden",G.className="inputWordsContainer";for(let xe=d.firstWordIndex;xe<=d.lastWordIndex;xe+=1){const He=pt[xe],Fe=He.getAttribute("input")??"";if(!Fe)continue;const Re=document.createElement("div");let X;ff?X=d.rect.left-Ci.left+_t:X=0,Re.style.left=He.offsetLeft+df-X+"px",Re.innerHTML=Fe.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt").slice(0,He.childElementCount),Re.className="inputWord",G.append(Re),Wp.push(Re)}rr.push(G),zd.push(Y),Y.append(G),p.append(Y),El.append(p)}),Rr=!0,_l=!1,!0}function VL(e,t,o=!1){const a=dn[e],s=new Array(Ot.length).fill(null).map(()=>({highlightLeft:0,highlightRight:0,inputContainerLeft:0,inputContainerRight:0})),n=KL(e,t),l=pt[e],c=Ot[a],u=s[a],d=Wc[a],p=rr[a];if(l===void 0||c===void 0||u===void 0||d===void 0||p===void 0)return s;if(!o)u.highlightLeft=l.offsetLeft,u.highlightRight=c.rect.width-(u.highlightLeft+n)+_t;else{const f=d.offsetLeft;u.highlightRight=c.rect.width-(l.offsetLeft+l.offsetWidth)+f+df,u.highlightLeft=c.rect.width-(u.highlightRight+n)+_t}o?u.inputContainerLeft=-1*(p.getBoundingClientRect().width-n-u.highlightRight):u.inputContainerLeft=-1*u.highlightLeft;for(let f=a-1;f>=0;f--){const g=s[f],h=s[f+1],y=Ot[f],v=rr[f];g===void 0||y===void 0||h===void 0||v===void 0||(o?(g.highlightRight=h.highlightRight+y.rect.width+_t,g.highlightLeft=y.rect.width-(g.highlightRight+n)+_t,g.inputContainerLeft=-1*(v.getBoundingClientRect().width-n-g.highlightRight)):(g.highlightLeft=h.highlightLeft+y.rect.width+_t,g.highlightRight=y.rect.width-(g.highlightLeft+n)+_t,g.inputContainerLeft=-1*g.highlightLeft))}for(let f=a+1;f<Ot.length;f++){const g=s[f],h=Ot[f-1],y=Ot[f],v=s[f-1],w=rr[f];g===void 0||h===void 0||y===void 0||v===void 0||w===void 0||(o?(g.highlightRight=-1*(h.rect.width-v.highlightRight+_t),g.highlightLeft=y.rect.width-(g.highlightRight+n)+_t,g.inputContainerLeft=-1*(w.getBoundingClientRect().width-n-g.highlightRight)):(g.highlightLeft=-1*(h.rect.width-v.highlightLeft+_t),g.highlightRight=y.rect.width-(g.highlightLeft+n)+_t,g.inputContainerLeft=-1*g.highlightLeft))}return s}function KL(e,t){var y,v;const o=dn[e],a=dn[t];if(o===void 0||a===void 0)return 0;const s=pt[e],n=pt[t],l=Wp[t],c=pt[((y=Ot[o])==null?void 0:y.lastWordIndex)??-1],u=pt[((v=Ot[a])==null?void 0:v.firstWordIndex)??-1];if(s===void 0||n===void 0||l===void 0||c===void 0||u===void 0)return 0;if(o===a){const w=or([s,n]),$=n.getBoundingClientRect(),S=l.getBoundingClientRect();let T=w.width+_t;return T-=$.width-S.width,T}const d=or([s,c]),p=or([u,n]);let f=d.width+p.width;for(let w=o+1;w<a;w++)f+=Ot[w].rect.width;f+=2*_t*(a-o);const g=n.getBoundingClientRect(),h=l.getBoundingClientRect();return f-=g.width-h.width,f}function GL(){rv=new Date}let dv="loading";function ee(){return dv}function Pg(e){dv=e}let Rn=null;class zc{constructor(t){this.words=t,this.length=this.words.length,this.shuffledIndexes=[],this.orderedIndex=0}resetIndexes(){this.orderedIndex=0,this.shuffledIndexes=[]}randomWord(t){return t==="zipf"?this.words[qk(this.words.length)]:Fo(this.words)}shuffledWord(){return this.shuffledIndexes.length===0&&this.generateShuffledIndexes(),this.words[this.shuffledIndexes.pop()]}generateShuffledIndexes(){this.shuffledIndexes=[];for(let t=0;t<this.length;t++)this.shuffledIndexes.push(t);on(this.shuffledIndexes)}nextWord(){return this.orderedIndex>=this.length&&(this.orderedIndex=0),this.words[this.orderedIndex++]}}async function jL(e){return(Rn===null||e!==Rn.words)&&(Rn=new zc(e)),Rn.resetIndexes(),Rn}function QL(){return Math.floor(Math.random()*256).toString(2).padStart(8,"0")}function YL(){const e=Lt(1,4);return Array.from({length:e},()=>Math.floor(Math.random()*256).toString(16).padStart(2,"0")).join("")}function XL(e){const t={a:".-",b:"-...",c:"-.-.",d:"-..",e:".",f:"..-.",g:"--.",h:"....",i:"..",j:".---",k:"-.-",l:".-..",m:"--",n:"-.",o:"---",p:".--.",q:"--.-",r:".-.",s:"...",t:"-",u:"..-",v:"...-",w:".--",x:"-..-",y:"-.--",z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",".":".-.-.-",",":"--..--","?":"..--..","'":".----.","/":"-..-.","(":"-.--.",")":"-.--.-","&":".-...",":":"---...",";":"-.-.-.","=":"-...-","+":".-.-.","-":"-....-",_:"..--.-",'"':".-..-.",$:"...-..-","!":"-.-.--","@":".--.-."};let o="";const a=Nx(e);for(let s=0;s<a.length;s++){const n=t[a.toLowerCase()[s]];o+=n!==void 0?n+"/":""}return o}function ZL(){const e=Lt(1,7);let t="";for(let o=0;o<e;o++)t+=String.fromCharCode(97+Lt(0,25));return t}function JL(){const e=Lt(1,10);let t="";for(let o=0;o<e;o++){const a=33+Lt(0,93);t+=String.fromCharCode(a)}return t}const e$=["`","~","!","@","#","$","%","^","&","*","(",")","-","_","=","+","{","}","[","]","'",'"',"/","\\","|","?",";",":",">","<",",","."];function t$(){const e=Lt(1,7);let t="";for(let o=0;o<e;o++)t+=Fo(e$);return t}function uv(e){const t=Lt(1,e);let o="";for(let a=0;a<t;a++){let s;a===0?s=Lt(1,9):s=Lt(0,9),o+=s.toString()}return o}let ji={};function et(e,t,o){ji[e]??(ji[e]={value:t,setFunction:o})}function fv(){Object.keys(ji).forEach(e=>{const t=ji[e];t.setFunction(t.value,!0)}),ji={}}const pv=[];function o$(e){pv.push(e)}async function a$(e){pv.forEach(t=>{try{t(e)}catch(o){console.error("TTS event subscriber threw an error"),console.error(o)}})}let Dn=!1,Il=0,yu=0,zg=0,Hg=3,ki=0,Si=0;function s$(e){yu--;let t=Math.round(Math.random()),o=Math.round(Math.random()*5-.5);return e?(Dn=!!Math.round(Math.random()),Dn?o=3:o=0):(Dn?(zg===t?ki++:ki=0,(ki>1||Si>0&&ki>0)&&(t=1-t,ki=0),zg=t,o=t*(Il+1)):(Hg===t?Si++:Si=0,(Si>1||Si>0&&ki>0)&&(t=1-t,Si=0),Hg=t,o=3-t*(Il+1)),Dn=!Dn,yu<0&&t===0&&(Il=1-Il,yu=Math.floor(Math.random()*3)+3)),o}function i$(e){const t=["←","↓","↑","→"];let o="";for(let a=0;a<4;a++)o+=t[s$(a===0&&e)];return o}function mv(){i("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:1},125)}function lr(){i("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:0},125)}function bu(e,t){i("#typingTest #layoutfluidTimer").text(`${Ft(t)} in: ${e}s`)}function n$(e,t){const o=Ft(t.replace(/_/g," "));let a=`${o} in: ${e} words`;e===1&&(a=`${o} starting next word`),i("#typingTest #layoutfluidTimer").text(a)}const zp=[];function r$(e){zp.push(e)}async function gv(e,t){zp.forEach(o=>{try{o("flash",e,t)}catch(a){console.error("Keymap flash event subscriber threw an error"),console.error(a)}})}async function Za(e){zp.forEach(t=>{try{t("highlight",e)}catch(o){console.error("Keymap highlight event subscriber threw an error"),console.error(o)}})}let Va=null,sc=null;function l$(){i("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:1},125)}function hv(){i("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:0},125)}function un(){sc!==null&&(clearInterval(sc),sc=null),Va=null,hv()}function c$(e){un(),Va=e,Og(Va),l$(),sc=setInterval(()=>{Va!==null&&(Va-=1,Va===0?hv():Og(Va),Va<=0&&(un(),i("#wordsWrapper").addClass("hidden")))},1e3)}function Og(e){i("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${e}s`)}const d$=new Set(["—","_"," "]),u$=100,f$="https://poetrydb.org/random";class p$ extends Fb{constructor(t,o,a){super(t,o,a),this.title=t,this.author=o,this.words=a,this.cleanUpText()}cleanUpText(){let t=0;const o=[];for(const a of this.words){let s="";for(const n of a)d$.has(n)||(s+=n);if(s!==""&&(o.push(s),t++,t===u$))break}this.words=o}}async function m$(){console.log("Getting poem");try{const o=(await(await fetch(f$)).json())[0];if(!o)return!1;const a=[];return o.lines.forEach(s=>{s.split(/ +/).forEach(n=>{a.push(n)})}),new p$(o.title,o.author,a)}catch(e){return console.log(e),!1}}const Hp=Dy._def.values,yv={english:["english","english_1k","english_5k","english_10k","english_25k","english_450k","english_commonly_misspelled","english_contractions","english_doubleletter","english_shakespearean","english_old","english_medical"],spanish:["spanish","spanish_1k","spanish_10k","spanish_650k"],french:["french","french_1k","french_2k","french_10k","french_600k","french_bitoduc"],german:["german","german_1k","german_10k","german_250k"],swiss_german:["swiss_german","swiss_german_1k","swiss_german_2k"],portuguese:["portuguese","portuguese_1k","portuguese_3k","portuguese_5k","portuguese_320k","portuguese_550k","portuguese_acentos_e_cedilha"],arabic:["arabic","arabic_10k"],arabic_egypt:["arabic_egypt","arabic_egypt_1k"],arabic_morocco:["arabic_morocco"],italian:["italian","italian_1k","italian_7k","italian_60k","italian_280k"],friulian:["friulian"],latin:["latin"],afrikaans:["afrikaans","afrikaans_1k","afrikaans_10k"],mongolian:["mongolian","mongolian_10k"],korean:["korean","korean_1k","korean_5k"],khmer:["khmer"],marathi:["marathi"],chinese:["chinese_traditional","chinese_simplified","chinese_simplified_1k","chinese_simplified_5k","chinese_simplified_10k","chinese_simplified_50k"],russian:["russian","russian_1k","russian_5k","russian_10k","russian_25k","russian_50k","russian_375k","russian_contractions","russian_contractions_1k","russian_abbreviations"],polish:["polish","polish_2k","polish_5k","polish_10k","polish_20k","polish_40k","polish_200k"],czech:["czech","czech_1k","czech_10k"],slovak:["slovak","slovak_1k","slovak_10k"],ukrainian:["ukrainian","ukrainian_1k","ukrainian_10k","ukrainian_50k","ukrainian_endings"],ukrainian_latynka:["ukrainian_latynka","ukrainian_latynka_1k","ukrainian_latynka_10k","ukrainian_latynka_50k","ukrainian_latynka_endings"],lithuanian:["lithuanian","lithuanian_1k","lithuanian_3k"],indonesian:["indonesian","indonesian_1k","indonesian_10k"],kurdish_central:["kurdish_central","kurdish_central_2k","kurdish_central_4k"],greek:["greek","greek_1k","greek_5k","greek_10k","greek_25k"],greeklish:["greeklish","greeklish_1k","greeklish_5k","greeklish_10k","greeklish_25k"],turkish:["turkish","turkish_1k","turkish_5k"],irish:["irish"],galician:["galician"],thai:["thai","thai_1k","thai_5k","thai_10k","thai_20k","thai_50k","thai_60k"],tamil:["tamil","tamil_1k","tanglish","tamil_old"],kannada:["kannada"],telugu:["telugu","telugu_1k"],slovenian:["slovenian","slovenian_1k","slovenian_5k"],croatian:["croatian","croatian_1k"],dutch:["dutch","dutch_1k","dutch_10k"],filipino:["filipino","filipino_1k"],danish:["danish","danish_1k","danish_10k"],hungarian:["hungarian","hungarian_2k"],norwegian_bokmal:["norwegian_bokmal","norwegian_bokmal_1k","norwegian_bokmal_5k","norwegian_bokmal_10k","norwegian_bokmal_150k","norwegian_bokmal_600k"],norwegian_nynorsk:["norwegian_nynorsk","norwegian_nynorsk_1k","norwegian_nynorsk_5k","norwegian_nynorsk_10k","norwegian_nynorsk_100k","norwegian_nynorsk_400k"],hebrew:["hebrew","hebrew_1k","hebrew_5k","hebrew_10k"],icelandic:["icelandic","icelandic_1k"],malagasy:["malagasy","malagasy_1k"],malay:["malay","malay_1k"],romanian:["romanian","romanian_1k","romanian_5k","romanian_10k","romanian_25k","romanian_50k","romanian_100k","romanian_200k"],finnish:["finnish","finnish_1k","finnish_10k"],estonian:["estonian","estonian_1k","estonian_5k","estonian_10k"],udmurt:["udmurt"],welsh:["welsh","welsh_1k"],persian:["persian","persian_1k","persian_5k","persian_20k","persian_romanized"],kazakh:["kazakh","kazakh_1k"],vietnamese:["vietnamese","vietnamese_1k","vietnamese_5k"],jyutping:["jyutping"],pinyin:["pinyin","pinyin_1k","pinyin_10k"],hausa:["hausa","hausa_1k"],swedish:["swedish","swedish_1k","swedish_diacritics"],serbian:["serbian","serbian_latin","serbian_10k","serbian_latin_10k"],georgian:["georgian"],yoruba:["yoruba_1k"],swahili:["swahili_1k"],maori:["maori_1k"],catalan:["catalan","catalan_1k"],bulgarian:["bulgarian","bulgarian_latin"],bosnian:["bosnian","bosnian_4k"],esperanto:["esperanto","esperanto_1k","esperanto_10k","esperanto_25k","esperanto_36k","esperanto_x_sistemo","esperanto_x_sistemo_1k","esperanto_x_sistemo_10k","esperanto_x_sistemo_25k","esperanto_x_sistemo_36k","esperanto_h_sistemo","esperanto_h_sistemo_1k","esperanto_h_sistemo_10k","esperanto_h_sistemo_25k","esperanto_h_sistemo_36k"],bangla:["bangla","bangla_letters","bangla_10k"],urdu:["urdu","urdu_1k","urdu_5k","urdish"],albanian:["albanian","albanian_1k"],shona:["shona","shona_1k"],armenian:["armenian","armenian_1k","armenian_western","armenian_western_1k"],myanmar:["myanmar_burmese"],japanese:["japanese_hiragana","japanese_katakana","japanese_romaji","japanese_romaji_1k"],hindi:["hindi","hindi_1k","hinglish"],sanskrit:["sanskrit","sanskrit_roman"],gujarati:["gujarati","gujarati_1k"],nepali:["nepali","nepali_1k","nepali_romanized"],santali:["santali"],macedonian:["macedonian","macedonian_1k","macedonian_10k","macedonian_75k"],uzbek:["uzbek","uzbek_1k","uzbek_70k"],belarusian:["belarusian","belarusian_1k","belarusian_5k","belarusian_10k","belarusian_25k","belarusian_50k","belarusian_100k"],belarusian_lacinka:["belarusian_lacinka","belarusian_lacinka_1k"],tatar:["tatar","tatar_1k","tatar_5k","tatar_9k"],tatar_crimean:["tatar_crimean","tatar_crimean_1k","tatar_crimean_5k","tatar_crimean_10k","tatar_crimean_15k","tatar_crimean_cyrillic","tatar_crimean_cyrillic_1k","tatar_crimean_cyrillic_5k","tatar_crimean_cyrillic_10k","tatar_crimean_cyrillic_15k"],azerbaijani:["azerbaijani","azerbaijani_1k"],malayalam:["malayalam"],sinhala:["sinhala"],latvian:["latvian","latvian_1k"],maltese:["maltese","maltese_1k"],toki_pona:["toki_pona","toki_pona_ku_suli","toki_pona_ku_lili"],xhosa:["xhosa","xhosa_3k"],tibetan:["tibetan","tibetan_1k"],bashkir:["bashkir"],other:["lojban_gismu","lojban_cmavo","pig_latin","twitch_emotes","git","typing_of_the_dead","league_of_legends","docker_file"],amharic:["amharic","amharic_1k","amharic_5k"],oromo:["oromo","oromo_1k","oromo_5k"],wordle:["wordle","wordle_1k"],kyrgyz:["kyrgyz","kyrgyz_1k"],yiddish:["yiddish"],frisian:["frisian","frisian_1k"],pashto:["pashto"],euskera:["euskera"],klingon:["klingon","klingon_1k"],quenya:["quenya"],lorem_ipsum:["lorem_ipsum"],occitan:["occitan","occitan_1k","occitan_2k","occitan_5k","occitan_10k"],kabyle:["kabyle","kabyle_1k","kabyle_2k","kabyle_5k","kabyle_10k"],zulu:["zulu"],hawaiian:["hawaiian","hawaiian_1k"],code:["code_python","code_python_1k","code_python_2k","code_python_5k","code_c","code_css","code_csharp","code_c++","code_dart","code_brainfck","code_fsharp","code_javascript","code_javascript_1k","code_javascript_react","code_jule","code_julia","code_haskell","code_html","code_nim","code_nix","code_pascal","code_java","code_kotlin","code_go","code_rockstar","code_rust","code_ruby","code_r","code_r_2k","code_swift","code_scala","code_bash","code_powershell","code_lua","code_luau","code_latex","code_typst","code_matlab","code_sql","code_perl","code_php","code_vim","code_vimscript","code_opencl","code_visual_basic","code_arduino","code_systemverilog","code_elixir","code_gleam","code_zig","code_gdscript","code_gdscript_2","code_assembly","code_v","code_ook","code_typescript","code_cobol","code_common_lisp","code_odin","code_fortran","code_abap","code_abap_1k","code_yoptascript","code_cuda"],viossa:["viossa","viossa_njutro"]},Op=Array.from(Object.keys(yv));function g$(e){return Op.find(t=>t.includes(e))}async function h$(e){switch(e){case"english":return"en";case"spanish":return"es";case"french":return"fr";case"german":return"de";case"portuguese":return"pt";case"arabic":return"ar";case"italian":return"it";case"latin":return"la";case"afrikaans":return"af";case"korean":return"ko";case"russian":return"ru";case"polish":return"pl";case"czech":return"cs";case"slovak":return"sk";case"ukrainian":return"uk";case"lithuanian":return"lt";case"indonesian":return"id";case"greek":return"el";case"turkish":return"tr";case"thai":return"th";case"tamil":return"ta";case"slovenian":return"sl";case"croatian":return"hr";case"dutch":return"nl";case"danish":return"da";case"hungarian":return"hu";case"norwegian_bokmal":return"no";case"norwegian_nynorsk":return"nn";case"hebrew":return"he";case"malay":return"ms";case"romanian":return"ro";case"finnish":return"fi";case"estonian":return"et";case"welsh":return"cy";case"persian":return"fa";case"kazakh":return"kk";case"vietnamese":return"vi";case"swedish":return"sv";case"serbian":return"sr";case"georgian":return"ka";case"catalan":return"ca";case"bulgarian":return"bg";case"esperanto":return"eo";case"bangla":return"bn";case"urdu":return"ur";case"armenian":return"hy";case"myanmar":return"my";case"hindi":return"hi";case"macedonian":return"mk";case"uzbek":return"uz";case"belarusian":return"be";case"azerbaijani":return"az";case"latvian":return"lv";case"euskera":return"eu";default:return"en"}}const y$=P.object({query:P.object({pages:P.record(P.string(),P.object({extract:P.string()}))})});async function b$(e){te();let t="en";const o=g$(e);o!==void 0&&(t=await h$(o));const a=`https://${t}.wikipedia.org/api/rest_v1/page/random/summary`,s={title:"",author:""},n=await fetch(a);let l=0;if(n.status===200){const c=await n.json();s.title=c.title,s.author=c.author,l=c.pageid}return new Promise((c,u)=>{n.status!==200&&(V(),u(n.status));const d=`https://${t}.wikipedia.org/w/api.php?action=query&format=json&pageids=${l}&prop=extracts&exintro=true&origin=*`,p=new XMLHttpRequest;p.onload=()=>{if(p.readyState===4)if(p.status===200){const g=vn(p.responseText,y$).query.pages[l.toString()];if(!g){V(),u("Page not found");return}let h=g.extract;h=h.replace(/<\/p><p>+/g," "),h=Bk(h),h=h.replace(/\[\d+\]/gi,""),h=h.replace(/[\u200B-\u200D\uFEFF]/g,""),h=Tb(h),t==="en"&&(h=h.replace(/[^\x20-\x7E]+/g,"")),h=h.replace(/\s+/g," "),h=h.trim();const y=h.split(" "),v=new Fb(s.title,s.author,y);V(),c(v)}else V(),u(p.status)},p.open("GET",d),p.send()})}const v$=50,w$=20,C$=5e3,cr={};class k${constructor(){this.average=0,this.count=0}update(t){this.count<v$&&this.count++;const o=1/this.count;this.average=t*o+this.average*(1-o)}}function S$(e,t){var s;const o=ve.spacing.array;if(o.length===0||typeof o=="string")return;let a=o[o.length-1];t||(a+=C$),e in cr||(cr[e]=new k$),(s=cr[e])==null||s.update(a)}function x$(e){let t=0,o=0;for(const a of e)a in cr&&(t+=cr[a].average,o++);return o===0?0:t/o}function T$(e){let t,o="";for(let a=0;a<w$;a++){const s=e.randomWord("normal"),n=x$(s);(a===0||t===void 0||n>t)&&(o=s,t=n)}return o}function bv(e,t,o,a,s){const n=[],l=Math.round(e/t);for(let c=0;c<t;c++){let d=Lt(0,2**l-1).toString(o);if(a){const p=Math.ceil(l/Math.ceil(Math.log2(o)));d="0".repeat(Math.max(0,p-d.length))+d}n.push(d)}return n.join(s)}function Ng(e,t,o,a,s,n){const l=s.split(a).map(d=>parseInt(d,o)),c=Math.round(e/t);let u=n;for(let d=0;d<t;d++)u-=c,u<0&&(-u<=c?l[d]&=2**c-1^2**-u-1:l[d]=0);return l.map(d=>d.toString(o)).join(a)+"/"+n.toString()}function L$(){return bv(32,4,10,!1,".")}function $$(){return bv(128,8,16,!0,":")}function Ug(e){return e.includes(":")?Ng(128,8,16,":",e,Lt(16,32)*4):Ng(32,4,10,".",e,Lt(8,32))}function M$(e){const t=e.split("/");let o=t[0].split(":"),a="";o=o.map(p=>p.replace(/^0+/gm,""));let s=0,n=-1,l=-1,c=0,u=-1,d=-1;for(let p=0;p<o.length;p++)o[p]===""?(u===-1&&(u=p),c++):(d=p-1,s<c&&(s=c,n=u,l=d),c=0,u=-1,d=-1);return s<c&&(s=c,n=u,l=o.length-1),o=o.map((p,f)=>p===""?f>=n&&f<=l&&n!==l?":":"0":p),a=o.join(":"),a=a.replace(/:{3,}/gm,"::"),t.length>1&&(a+="/"+t[1]),a}class ct extends Error{constructor(t){super(t),this.name="WordGenError"}}async function vu(e){const t=(k.current??"").slice(-1),o=I.getCurrent().slice(k.current.length-1,k.current.length),a=t===o;e.key==="Backspace"&&!a&&(k.current!==""||k.getHistory(Z-1)!==I.get(Z-1)||r.freedomMode)?i("#words").addClass("read_ahead_disabled"):e.key===" "&&i("#words").removeClass("read_ahead_disabled")}class A${constructor(){this.chars={},this.count=0}addChar(t){this.count++,t in this.chars?this.chars[t]++:this.chars[t]=1}randomChar(){const t=Lt(0,this.count-1);let o=0;for(const[a,s]of Object.entries(this.chars))if(o+=s,o>t)return a;return Object.keys(this.chars)[0]}}class E$ extends zc{constructor(t){super(t),this.ngrams={},this.length=1/0;for(let o of t){o+=" ";let a="";for(const s of o)a in this.ngrams||(this.ngrams[a]=new A$),this.ngrams[a].addChar(s),a=(a+s).slice(-2)}}randomWord(){let t="";for(;;){const o=t.slice(-2),a=this.ngrams[o];if(!a){t="";continue}const s=a.randomChar();if(s===" ")break;t+=s}return t}}const _$={58008:{getWord(){let e=uv(7);return r.language.startsWith("kurdish")?e=Ey(e):r.language.startsWith("nepali")&&(e=_y(e)),e},punctuateWord(e){if(e.length>3&&(Math.random()<.5&&(e=Mg(e,Lt(1,e.length-2),".")),Math.random()<.75)){const t=Lt(1,e.length-2);if(e[t-1]!=="."&&e[t+1]!=="."&&e[t+1]!=="0"){const o=Fo(["/","*","-","+"]);e=Mg(e,t,o)}}return e},rememberSettings(){et("numbers",r.numbers,ka)},handleChar(e){return e===`
`?" ":e}},simon_says:{applyConfig(){xo("next",!0)},rememberSettings(){et("keymapMode",r.keymapMode,xo)}},tts:{applyConfig(){xo("off",!0)},rememberSettings(){et("keymapMode",r.keymapMode,xo)},toggleScript(e){if(window.speechSynthesis===void 0){m("Failed to load text-to-speech script",-1);return}e[0]!==void 0&&a$(e[0])}},arrows:{getWord(e,t){return i$(t===0)},rememberSettings(){et("highlightMode",r.highlightMode,As)},handleChar(e){return e==="a"||e==="ArrowLeft"||e==="j"?"←":e==="s"||e==="ArrowDown"||e==="k"?"↓":e==="w"||e==="ArrowUp"||e==="i"?"↑":e==="d"||e==="ArrowRight"||e==="l"?"→":e},isCharCorrect(e,t){return(e==="a"||e==="ArrowLeft"||e==="j")&&t==="←"||(e==="s"||e==="ArrowDown"||e==="k")&&t==="↓"||(e==="w"||e==="ArrowUp"||e==="i")&&t==="↑"||(e==="d"||e==="ArrowRight"||e==="l")&&t==="→"},async preventDefaultEvent(e){return["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e.key)},getWordHtml(e,t){let o="";return e==="↑"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-up"></i>',t&&(o+="</letter>")),e==="↓"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-down"></i>',t&&(o+="</letter>")),e==="←"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-left"></i>',t&&(o+="</letter>")),e==="→"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-right"></i>',t&&(o+="</letter>")),o}},rAnDoMcAsE:{alterText(e){let t=e[0];for(let o=1;o<e.length;o++)t[o-1]===t[o-1].toUpperCase()?t+=e[o].toLowerCase():t+=e[o].toUpperCase();return t}},backwards:{alterText(e){return e.split("").reverse().join("")}},capitals:{alterText(e){return mi(e)}},layout_mirror:{applyConfig(){let e=r.layout;r.layout==="default"&&(e="qwerty"),Qa(e,!0),Is("overrideSync",!0)},rememberSettings(){et("keymapMode",r.keymapMode,xo),et("layout",r.layout,Qa)}},layoutfluid:{applyConfig(){const e=r.customLayoutfluid[0]??"qwerty";Qa(e,!0),Is(e,!0)},rememberSettings(){et("keymapMode",r.keymapMode,xo),et("layout",r.layout,Qa),et("keymapLayout",r.keymapLayout,Is)},handleSpace(){if(r.mode!=="time"){const e=r.customLayoutfluid,t=I.length,o=Math.floor(t/e.length),a=Math.floor((k.getHistory().length+1)/o),s=o-(Z+1)%o;e[a]?(s<=3&&e[a+1]?(mv(),n$(s,e[a+1])):lr(),s===o&&(Qa(e[a]),Is(e[a]),s>3&&lr())):lr(),setTimeout(()=>{Za(I.getCurrent().charAt(k.current.length))},1)}},getResultContent(){return r.customLayoutfluid.join(" ")},restart(){this.applyConfig&&this.applyConfig(),setTimeout(()=>{Za(I.getCurrent().substring(k.current.length,k.current.length+1))},1)}},gibberish:{getWord(){return ZL()}},ascii:{getWord(){return JL()}},specials:{getWord(){return t$()}},read_ahead_easy:{rememberSettings(){et("highlightMode",r.highlightMode,As)},async handleKeydown(e){await vu(e)}},read_ahead:{rememberSettings(){et("highlightMode",r.highlightMode,As)},async handleKeydown(e){await vu(e)}},read_ahead_hard:{rememberSettings(){et("highlightMode",r.highlightMode,As)},async handleKeydown(e){await vu(e)}},memory:{applyConfig(){i("#wordsWrapper").addClass("hidden"),of(!0,!0),r.keymapMode==="next"&&xo("react",!0)},rememberSettings(){et("mode",r.mode,gt),et("showAllLines",r.showAllLines,of),r.keymapMode==="next"&&et("keymapMode",r.keymapMode,xo)},start(){un(),i("#words").addClass("hidden")},restart(){c$(Math.round(Math.pow(I.length,1.2))),i("#words").removeClass("hidden"),r.keymapMode==="next"&&xo("react")}},nospace:{rememberSettings(){et("highlightMode",r.highlightMode,As)}},poetry:{async pullSection(){return m$()}},wikipedia:{async pullSection(e){return b$((e??"")||"english")}},weakspot:{getWord(e){return e!==void 0?T$(e):""}},pseudolang:{async withWords(e){return e!==void 0?new E$(e):new zc([])}},IPv4:{getWord(){return L$()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=Ug(e)),t},rememberSettings(){et("numbers",r.numbers,ka)}},IPv6:{getWord(){return $$()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=Ug(e)),t.includes(":")&&(t=M$(t)),t},rememberSettings(){et("numbers",r.numbers,ka)}},binary:{getWord(){return QL()}},hexadecimal:{getWord(){return YL()},punctuateWord(e){return`0x${e}`},rememberSettings(){et("punctuation",r.punctuation,ls)}},zipf:{getWordsFrequencyMode(){return"zipf"}},ddoouubblleedd:{alterText(e){return e.replace(/./gu,"$&$&")}},instant_messaging:{alterText(e){return e.toLowerCase().replace(/[.!?]$/g,`
`).replace(/[().'"]/g,"").replace(/\n+/g,`
`)}},morse:{alterText(e){return XL(e)}},underscore_spaces:{alterText(e,t,o){return t===o-1?e:e+"_"}},crt:{applyGlobalCSS(){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){const t=navigator.userAgent.match(/.*Version\/([0-9]*)\.([0-9]*).*/),o=t!==null?parseInt(t[1]??"0"):0,a=t!==null?parseInt(t[2]??"0"):0;if(o<=16&&a<=5){m("CRT is not available on Safari 16.5 or earlier.",0,{duration:5}),Ki("crt");return}}i("body").append('<div id="scanline" />'),i("body").addClass("crtmode"),i("#globalFunBoxTheme").attr("href","funbox/crt.css")},clearGlobal(){i("#scanline").remove(),i("body").removeClass("crtmode"),i("#globalFunBoxTheme").attr("href","")}},ALL_CAPS:{alterText(e){return e.toUpperCase()}},polyglot:{async withWords(e){const t=r.customPolyglot.map(async s=>kn(s).catch(()=>(m(`Failed to load language: ${s}. It will be ignored.`,0),null))),o=(await Promise.all(t)).filter(s=>s!==null);if(o.length===0)throw Ki("polyglot"),new Error(`No valid languages found. Please check your polyglot languages config (${r.customPolyglot.join(", ")}).`);if(o.length===1){const s=o[0];throw rn(s.name,!0),Ki("polyglot",!0),m(`Disabled polyglot funbox because only one valid language was found. Check your polyglot languages config (${r.customPolyglot.join(", ")}).`,0,{duration:7}),new ct("")}const a=o.flatMap(s=>s.words);return on(a),new zc(a)}}};function I$(){return _$}const q$=Xk(),B$=I$(),pf={};for(const[e,t]of Object.entries(q$))pf[e]={...t,functions:B$[e]};function mf(e){return Array.isArray(e)?e.map(o=>pf[o]):pf[e]}function Pa(){return mf(wo())}function wo(){return r.funbox??[]}function vv(e){return Pa().filter(t=>{var o;return(o=t.properties)==null?void 0:o.includes(e)})}function gi(e){return vv(e).length>0}function wv(e){return wo().includes(e)}function Ct(e){return Pa().filter(t=>{var o;return(o=t.functions)==null?void 0:o[e]})}function Cv(e){return Ct(e).length>0}function za(e){const t=Ct(e);if(t.length!==0){if(t.length===1)return t[0];throw new Error(`Expecting exactly one funbox implementing "${e} but found ${t.length}`)}}const F$=$t(250,async()=>{const e=await iL(r.language);e==="no"&&m(`${Ft(ea(r.language))} does not support Zipf funbox, because the list is not ordered by frequency. Please try another word list.`,0,{duration:7}),e==="unknown"&&m(`${Ft(ea(r.language))} may not support Zipf funbox, because we don't know if it's ordered by frequency or not. If you would like to add this label, please contact us.`,0,{duration:7})}),Hd=Fk(W$,{rejectSkippedCalls:!1});ge((e,t,o)=>{(e==="language"||e==="funbox")&&r.funbox.includes("zipf")&&F$(),e==="fontSize"&&(i("#caret, #paceCaret, #liveStatsMini, #typingTest, #wordsInput").css("fontSize",t+"rem"),o||(xn(),yf())),["fontSize","fontFamily","blindMode","hideExtraLetters"].includes(e)&&Hd(),e==="theme"&&Qi(),t!==void 0&&(e==="highlightMode"&&ee()==="test"&&Od(),["highlightMode","blindMode","indicateTypos","tapeMode","hideExtraLetters"].includes(e)&&yf(),["tapeMode","tapeMargin"].includes(e)&&Z$(),e==="showAllLines"&&(Up(!0),t===!1&&Ev()),typeof t=="boolean"&&(e==="flipTestColors"&&O$(t),e==="colorfulMode"&&N$(t),e==="burstHeatmap"&&Qi()))});let de=!1,Vt=!1,gf=!1,hf=0,Zs=!1;function kv(e){de=e}let{promise:R$,resolve:Vg}=Da();function ic(e){Vt=e,e?{promise:R$,resolve:Vg}=Da():Vg()}function Sv(e){Zs=e}function D$(){hf=0,cb(0)}function fn(){i("#wordsInput").trigger("focus")}function Od(e,t=!1){const o=document.querySelector("#words .active");e||o==null||o.classList.add("typed"),r.mode==="zen"&&e?o==null||o.remove():o!==null&&!t&&o.classList.remove("active");const a=document.querySelectorAll("#words .word")[Z-ut];if(a===void 0)throw new Error("activeWord is undefined - can't update active element");a.classList.add("active"),a.classList.remove("error"),a.classList.remove("typed"),a.offsetTop,!t&&Mv()&&Np(),!t&&r.tapeMode!=="off"&&Nd()}function xv(e,t,o,a=!0){const s=typeof o=="string",n=s?Xo(o):o;let l="",c=0;for(const u of e)for(const d of u){const p=t[d],f=`${d}`,g=s?n[d]:n[c++];l+=`<hint data-chars-index=${f} style="left:${p.offsetLeft+p.offsetWidth/2}px;">${g}</hint>`}return a&&(l=`<div class="hints">${l}</div>`),l}async function Tv(e,t,o){var u,d;const s=(await hs(r.language)).rightToLeft;let n=!1,l=0,c=o.length;for(;l<c-1;){const p=o[l],f=o[l+1],g=((u=p.dataset.charsIndex)==null?void 0:u.split(","))??[],h=((d=f.dataset.charsIndex)==null?void 0:d.split(","))??[],y=parseInt(g[0]??"0"),v=parseInt(h[0]??"0");if(!e.some(G=>G.includes(y)&&G.includes(v))){l++,n=!1;continue}const $=t[y],S=t[v],T=$.offsetTop===S.offsetTop,q=s?f:p,_=s?p:f,N=q.offsetLeft+q.offsetWidth/2,Y=_.offsetLeft-_.offsetWidth/2;if(T&&N>Y){p.dataset.charsIndex=[...g,...h].join(",");const G=$.offsetLeft+(s?$.offsetWidth:0),xe=f.offsetLeft-p.offsetLeft;p.style.left=G+xe+"px",p.insertAdjacentHTML("beforeend",f.innerHTML),f.remove(),c--,n&&l>0&&l--}else l++;n=!0}}async function W$(){var n;if(ee()!=="test"||de||r.indicateTypos!=="below")return;let e,t=[],o=[];const a=document.querySelectorAll(".hints > hint");for(const l of a){const c=l.parentElement;c!==e&&(await s(e,t,o),e=c,t=[],o=[]);const u=(n=l.dataset.charsIndex)==null?void 0:n.split(",").map(d=>parseInt(d));if(!(u===void 0||u.length===0)){for(const d of u){const p=t[t.length-1];p&&p[p.length-1]===d-1?p.push(d):t.push([d])}o.push(...Xo(l.innerHTML))}}await s(e,t,o);async function s(l,c,u){if(!l||c.length===0)return;const d=l.parentElement,p=d.querySelectorAll("letter");l.innerHTML=xv(c,p,u,!1);const f=d.getElementsByTagName("hint");await Tv(c,p,f)}}function Lv(e){let t=!1,o="<div class='word'>";const a=za("getWordHtml"),s=Xo(e);for(const n of s)a?o+=a.functions.getWordHtml(n,!0):n==="	"?o+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:n===`
`?(t=!0,o+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):o+="<letter>"+n+"</letter>";return o+="</div>",t&&(o+="<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),o}function yf(){var t,o,a;r.tapeMode!=="off"?(i("#words").addClass("tape"),i("#wordsWrapper").addClass("tape")):(i("#words").removeClass("tape"),i("#wordsWrapper").removeClass("tape")),r.blindMode?(i("#words").addClass("blind"),i("#wordsWrapper").addClass("blind")):(i("#words").removeClass("blind"),i("#wordsWrapper").removeClass("blind")),r.indicateTypos==="below"?(i("#words").addClass("indicateTyposBelow"),i("#wordsWrapper").addClass("indicateTyposBelow")):(i("#words").removeClass("indicateTyposBelow"),i("#wordsWrapper").removeClass("indicateTyposBelow")),r.hideExtraLetters?(i("#words").addClass("hideExtraLetters"),i("#wordsWrapper").addClass("hideExtraLetters")):(i("#words").removeClass("hideExtraLetters"),i("#wordsWrapper").removeClass("hideExtraLetters"));const e=((a=(o=(t=i("#words"))==null?void 0:t.attr("class"))==null?void 0:o.split(/\s+/))==null?void 0:a.filter(s=>!s.startsWith("highlight-")))??[];r.highlightMode!==null&&e.push("highlight-"+r.highlightMode.replaceAll("_","-")),i("#words").attr("class",e.join(" ")),_v(),Up(!0),H$(Np,[!0])}function P$(){if(i("#words").empty(),r.mode==="zen")$v();else{let e="";for(let t=0;t<I.length;t++)e+=Lv(I.get(t));i("#words").html(e)}Od(void 0,!0),yf(),setTimeout(()=>{Ea()},125)}function $v(){i("#words").append("<div class='word'><letter class='invisible'>_</letter></div>")}const z$=["japanese","chinese","korean"];function Mv(){return z$.some(t=>r.language.startsWith(t))||r.mode!=="time"&&r.showAllLines}async function Np(e=!1){if(ee()!=="test")return;const o=(await hs(r.language)).rightToLeft,a=document.querySelector("#wordsInput");if(!a)return;const s=document.querySelectorAll("#words .word")[Z-ut];if(!s){a.style.top="0px",a.style.left="0px";return}const n=window.getComputedStyle(s),l=parseInt(n.marginTop)+parseInt(n.marginBottom),c=Gs(r.fontSize),u=s.offsetTop+c/2-a.offsetHeight/2+1;r.tapeMode!=="off"?a.style.maxWidth=`${100-r.tapeMargin}%`:a.style.maxWidth="",s.offsetWidth<c?a.style.width=c+"px":a.style.width=s.offsetWidth+"px",e&&!Mv()&&r.tapeMode==="off"?a.style.top=u+c+l+4+"px":a.style.top=u+"px",s.offsetWidth<c&&o?a.style.left=s.offsetLeft-c+"px":a.style.left=Math.max(0,s.offsetLeft)+"px"}let Av=Promise.resolve();async function Ev(){var c;if(r.showAllLines)return;const{resolve:e,promise:t}=Da();Av=t;const o=document.querySelectorAll("#words .word"),a=Z-ut,s=o[a];if(!s){e();return}const n=s.offsetTop;let l=n;for(let u=a-1;u>=0;u--)if(l=((c=o[u])==null?void 0:c.offsetTop)??n,l<n){await Vp(l,!0),e();return}e()}function Up(e=!1){var p;if(ee()!=="test"||de||!e&&r.mode!=="custom")return;const t=document.getElementById("wordsWrapper"),o=document.querySelector(".outOfFocusWarning"),a=t.querySelectorAll("#words .word"),s=a[Z-ut];if(!s)return;t.classList.remove("hidden");const n=window.getComputedStyle(s),l=parseInt(n.marginTop)+parseInt(n.marginBottom),c=s.offsetHeight+l,u=r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&ke()===0;if(r.showAllLines&&!u)t.style.height="";else if(r.mode==="zen")t.style.height=c*2+"px";else if(r.tapeMode==="off"){let f=0,g=0,h=0,y=0;for(;f<3;){const v=a[h];if(!v)break;const w=v.offsetTop;w>g&&(f++,y+=v.offsetHeight+l,g=w),h++}f<3&&(y=y*(3/f)),t.style.height=y+"px"}else if(Lr)t.style.height=c*3+"px";else{const f=((p=document.getElementById("words"))==null?void 0:p.offsetHeight)??c;t.style.height=f+"px"}o.style.maxHeight=c*3+"px"}function H$(e,t){const o=()=>{e(...t),Hd()};if(r.tapeMode!=="off")Nd(!0,o);else{const a=document.getElementById("words"),s=a.querySelectorAll(".afterNewline");if(r.smoothLineScroll){const n=i(a);n.stop("leftMargin",!0,!1).animate({marginLeft:0},{duration:Pe()?0:125,queue:"leftMargin",complete:o}),n.dequeue("leftMargin"),i(s).stop(!0,!1).animate({marginLeft:0},Pe()?0:125)}else{a.style.marginLeft="0";for(const n of s)n.style.marginLeft="0";o()}}}function Kg(e){i("#words").append(Lv(e))}function O$(e){e?i("#words").addClass("flipped"):i("#words").removeClass("flipped")}function N$(e){e?i("#words").addClass("colorfulMode"):i("#words").removeClass("colorfulMode")}async function Io(e){var c,u;const t=e??k.current,o=I.getCurrent();if(!o&&r.mode!=="zen")return;let a="";const s=(c=document.querySelectorAll("#words .word"))==null?void 0:c[Z-ut];if(!s)return;const n=[];let l=!1;if(r.mode==="zen"){for(const d of k.current)d==="	"?a+=`<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:d===`
`?(l=!0,a+=`<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):a+=`<letter class="correct">${d}</letter>`;k.current===""&&(a+="<letter class='invisible'>_</letter>")}else{let d=!1;const p=k.getKoreanStatus();if(p){const y=dt.disassemble(o).join(""),v=dt.disassemble(t).join(""),w=Ka.test(t)?t.search(Ka):v.length;t.search(Ka)<dt.d(y).length&&y.slice(0,w)===v.slice(0,w)&&(d=!0)}else{const y=Ka.test(t)?t.search(Ka):t.length;t.search(Ka)<o.length&&o.slice(0,y)===t.slice(0,y)&&(d=!0)}const f=za("getWordHtml"),g=Xo(t),h=Xo(o);for(let y=0;y<g.length;y++){const v=h[y]===g[y];let w=h[y],$="",S="";if(f){const T=f.functions.getWordHtml(w);T!==""&&(w=T)}else w==="	"?($="tabChar",w='<i class="fas fa-long-arrow-alt-right fa-fw"></i>'):w===`
`&&(S="nlChar",w='<i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i>');if(v)a+=`<letter class="correct ${$}${S}">${w}</letter>`;else if(w!==void 0&&Hs()&&y>=PL()&&!(p&&!d))a+=`<letter class="dead">${r.indicateTypos==="replace"?g[y]===" "?"_":g[y]:w}</letter>`;else if(w===void 0){let T=g[y];(T===" "||T==="	"||T===`
`)&&(T="_"),a+=`<letter class="incorrect extra ${$}${S}">${T}</letter>`}else if(a+=`<letter class="incorrect ${$}${S}">`+(r.indicateTypos==="replace"?g[y]===" "?"_":g[y]:w)+"</letter>",r.indicateTypos==="below"){const T=n[n.length-1];T&&T[T.length-1]===y-1?T.push(y):n.push([y])}}for(let y=g.length;y<h.length;y++){const v=h[y];(u=f==null?void 0:f.functions)!=null&&u.getWordHtml?a+=f.functions.getWordHtml(v,!0):v==="	"?a+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:v===`
`?a+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`:a+="<letter>"+v+"</letter>"}}if(s.innerHTML=a,n!=null&&n.length){const d=s.querySelectorAll("letter"),p=xv(n,d,t);s.insertAdjacentHTML("beforeend",p);const f=s.getElementsByTagName("hint");await Tv(n,d,f)}l&&i("#words").append("<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),r.tapeMode!=="off"&&Nd()}function U$(e,t=!0){let o;if(e?o=e.querySelector("letter.nlChar"):o=document.querySelector("#words > .word > letter.nlChar"),!o||t&&o.classList.contains("incorrect"))return 0;const a=window.getComputedStyle(o),s=parseFloat(a.marginLeft)+parseFloat(a.marginRight);return o.offsetWidth+s}async function Nd(e=!1,t){if(ee()!=="test"||de)return;await Av;const a=(await hs(r.language)).rightToLeft,s=Z-ut,n=document.querySelector("#wordsWrapper").offsetWidth,l=document.getElementById("words"),c=[...l.children],d=l.getElementsByClassName("word")[s];if(!d)return;const p=l.getElementsByClassName("afterNewline");let f=0,g=0,h=0,y=!1,v,w=0;const $=[],S=[],T=[];for(const X of c)if(X.classList.contains("word")){v&&(w+=parseFloat(v.style.marginLeft));break}else X.classList.contains("afterNewline")&&(T.push(X),y=!0,v=X);let q;const _=c.indexOf(d),N=c.slice(0,_).filter(X=>X.classList.contains("afterNewline")).length;let Y=p[N+1];Y?q=c.indexOf(Y):(Y=p[N],Y?q=c.indexOf(Y):q=_-1);const G=parseFloat(window.getComputedStyle(d).marginRight);for(let X=0;X<=q;X++){const we=c[X];if(we.classList.contains("word")){y=!1;const Ve=i(we).outerWidth(!0)??0,Ze=Math.floor(we.offsetLeft),jt=Math.floor(we.offsetWidth);!a&&Ze<0-jt||a&&Ze>n?(T.push(we),w+=Ve,h++):(g+=Ve,X<_&&(f=g))}else if(we.classList.contains("afterNewline")){if(y)continue;const Ve=U$(c[X-3]);g-=Ve+G,X<_&&(f=g);const Ze=3*l.offsetWidth;if(g<Ze)S.push(g),$.push(w);else{S.push(Ze),$.push(w),X<q&&(S.push(Ze),$.push(w));break}}}if(T.length>0&&!e){for(const we of T)we.remove();Zu(h);for(let we=0;we<$.length;we++){const Ve=p[we],Ze=parseFloat(Ve.style.marginLeft)||0;Ve.style.marginLeft=`${Ze-($[we]??0)}px`}a&&(w*=-1);const X=parseFloat(l.style.marginLeft)||0;l.style.marginLeft=`${X+w}px`}let xe=0;const He=k.current.length;if(r.tapeMode==="letter"&&He>0){const X=d.querySelectorAll("letter");let we=0;for(let Ve=0;Ve<He;Ve++){const Ze=X[Ve];if((r.blindMode||r.hideExtraLetters)&&Ze.classList.contains("extra"))continue;const jt=i(Ze).outerWidth(!0)??0;xe+=jt,jt>0&&(we=jt)}i(X[He]).outerWidth(!0)===0&&(xe-=we)}let Fe=n*(r.tapeMargin/100)-f-xe;a&&(Fe=G-Fe);const Re=i(l);if(r.smoothLineScroll){Re.stop("leftMargin",!0,!1).animate({marginLeft:Fe},{duration:Pe()?0:125,queue:"leftMargin",complete:t}),Re.dequeue("leftMargin");for(let X=0;X<S.length;X++){const we=S[X]??0;i(p[X]).stop(!0,!1).animate({marginLeft:we},Pe()?0:125)}}else{l.style.marginLeft=`${Fe}px`;for(let X=0;X<S.length;X++){const we=S[X]??0;p[X].style.marginLeft=`${we}px`}t&&t()}}function V$(){const e=pi(r,J);let t="";r.funbox.length>0&&(t=" "+r.funbox.join(" ")),i(".pageTest #premidTestMode").text(`${r.mode} ${e} ${ea(r.language)}${t}`),i(".pageTest #premidSecondsLeft").text(r.time)}function Gg(e,t){var a;if(!t&&(t=(a=document.getElementById("words"))==null?void 0:a.children,!t))return 0;let o=0;for(let s=0;s<=e;s++){const n=t[s];!n||!n.isConnected||(n.classList.contains("word")&&o++,n.remove())}return o}let wu=0;async function Vp(e,t=!1){const{resolve:o,promise:a}=Da();if(hf>0||t){const s=e,n=Z-ut,l=document.getElementById("words"),c=[...l.children],d=l.querySelectorAll(".word")[n];if(!d){o();return}const p=c.indexOf(d);let f;for(let y=p-1;y>=0;y--){const v=c[y];if(!v.classList.contains("hidden")&&Math.floor(v.offsetTop)<s){if(v.classList.contains("word")){f=y;break}else if(v.classList.contains("beforeNewline")){f=y+1;break}}}const g=i(d).outerHeight(!0),h=document.querySelector("#paceCaret");if(f===void 0)o();else if(r.smoothLineScroll){gf=!0,i(h).stop(!0,!1).animate({top:(h==null?void 0:h.offsetTop)-g},Pe()?0:125);const y=vd+g;mu(y),wu++;const v={marginTop:`-${g*wu}px`},w=i(l);w.stop("topMargin",!0,!1).animate(v,{duration:Pe()?0:125,queue:"topMargin",step:($,S)=>{const T=($-S.start)/(S.end-S.start);mu(y*(1-T))},complete:()=>{var $,S;wu=0,mu(0),(S=($=document.querySelectorAll("#words .word"))==null?void 0:$[n])==null||S.offsetTop,Zu(Gg(f,c)),l.style.marginTop="0",gf=!1,o()}}),w.dequeue("topMargin")}else Zu(Gg(f,c)),h.style.top=`${h.offsetTop-g}px`,o()}return hf++,Up(),a}function K$(e){e?(i("#words").addClass("rightToLeftTest"),i("#resultWordsHistory .words").addClass("rightToLeftTest"),i("#resultReplay .words").addClass("rightToLeftTest")):(i("#words").removeClass("rightToLeftTest"),i("#resultWordsHistory .words").removeClass("rightToLeftTest"),i("#resultReplay .words").removeClass("rightToLeftTest"))}function G$(e){e||r.mode==="custom"||r.mode==="zen"?(i("#words").addClass("withLigatures"),i("#resultWordsHistory .words").addClass("withLigatures"),i("#resultReplay .words").addClass("withLigatures")):(i("#words").removeClass("withLigatures"),i("#resultWordsHistory .words").removeClass("withLigatures"),i("#resultReplay .words").removeClass("withLigatures"))}function j$(e,t,o,a,s,n,l){let c="";for(let u=0;u<e;u++){let d;try{d=l?dt.assemble(o.split(""))[u]:n[u]}catch{d=void 0}let p="";const f=l?dt.assemble(o.split("")):o;u+1===e&&f!==void 0&&f.length>t.length&&(p="extraCorrected"),r.mode==="zen"||s[u]!==void 0?r.mode==="zen"||a[u]===s[u]?d===a[u]||d===void 0?c+=`<letter class="correct ${p}">${a[u]}</letter>`:c+=`<letter class="corrected ${p}">`+a[u]+"</letter>":a[u]===k.current?c+=`<letter class='correct ${p}'>`+s[u]+"</letter>":a[u]===void 0?c+="<letter>"+s[u]+"</letter>":c+=`<letter class="incorrect ${p}">`+s[u]+"</letter>":c+='<letter class="incorrect extra">'+a[u]+"</letter>"}return c}async function Q$(){i("#resultWordsHistory .words").empty();let e="";for(let t=0;t<k.getHistory().length+2;t++){const o=k.getHistory(t),a=tt.getHistory(t),s=I.get(t),n=(o==null?void 0:o.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null||(s==null?void 0:s.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null;let l="";try{if(o===void 0||o==="")throw new Error("empty input word");const c=r.mode==="zen"?"":o!==s?"error":"";if(a!==void 0&&a!==""){const g=n?dt.assemble(a.split("")):a;l=`<div class='word nocursor ${c}' burst="${Do[t]}" input="${g.replace(/"/g,"&quot;").replace(/ /g,"_")}">`}else l=`<div class='word nocursor ${c}' burst="${Do[t]}" input="${o.replace(/"/g,"&quot;").replace(/ /g,"_")}">`;const u=Xo(o),d=Xo(s??""),p=Xo(a??"");let f;if(r.mode==="zen"||o.length>s.length?f=u.length:f=d.length,a===void 0)throw new Error("empty corrected word");l+=j$(f,o,a,u,d,p,n),l+="</div>"}catch{try{l="<div class='word'>";for(const u of s)l+="<letter>"+u+"</letter>";l+="</div>"}catch{l+="</div>"}}e+=l}return i("#resultWordsHistory .words").html(e),i("#showWordHistoryButton").addClass("loaded"),!0}function Kp(e=!1){de&&(GL(),i("#resultWordsHistory").stop(!0,!0).hasClass("hidden")?i("#resultWordsHistory .words .word").length===0?(i("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),Q$().then(()=>{r.burstHeatmap&&Qi(),i("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250,()=>{r.burstHeatmap&&Qi()})})):(r.burstHeatmap&&Qi(),i("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250)):i("#resultWordsHistory").slideUp(250,()=>{i("#resultWordsHistory").addClass("hidden")}))}async function Qi(){if(r.burstHeatmap){i("#resultWordsHistory .heatmapLegend").removeClass("hidden");let e=[...Do];e=e.filter(u=>u!==1/0),e=e.filter(u=>u<500);const t=bt(r.typingSpeedUnit);e.forEach((u,d)=>{e[d]=Math.round(t.fromWpm(u))});const o=await ms();let a=[o.colorfulError,Uo(o.colorfulError,o.text,.5),o.text,Uo(o.main,o.text,.5),o.main],s=o.sub;o.main===o.text&&(a=[o.colorfulError,Uo(o.colorfulError,o.text,.5),o.sub,Uo(o.sub,o.text,.5),o.main],s=o.subAlt);const n=e.sort((u,d)=>u-d),l=e.length,c=[{val:0,colorId:0},{val:n[l*.15|0],colorId:1},{val:n[l*.35|0],colorId:2},{val:n[l*.65|0],colorId:3},{val:n[l*.85|0],colorId:4}];c.forEach((u,d)=>{const p=c[d+1];let f="";d===0&&p?f=`<${Math.round(p.val)}`:d===4?f=`${Math.round(u.val)}+`:p&&(u.val!==p.val?f=`${Math.round(u.val)}-${Math.round(p.val)-1}`:f=`${Math.round(u.val)}-${Math.round(u.val)}`),i("#resultWordsHistory .heatmapLegend .box"+d).html(`<div>${f}</div>`)}),i("#resultWordsHistory .words .word").each((u,d)=>{const p=i(d).attr("burst");if(p===void 0)i(d).css("color",s);else{let f=parseInt(p);f=Math.round(bt(r.typingSpeedUnit).fromWpm(f)),c.forEach(g=>{f>=g.val&&(i(d).addClass("heatmapInherit"),i(d).css("color",a[g.colorId]))})}}),i("#resultWordsHistory .heatmapLegend .boxes .box").each((u,d)=>{i(d).css("background",a[u])})}else i("#resultWordsHistory .heatmapLegend").addClass("hidden"),i("#resultWordsHistory .words .word").removeClass("heatmapInherit"),i("#resultWordsHistory .words .word").css("color",""),i("#resultWordsHistory .heatmapLegend .boxes .box").css("color","")}function Y$(e){i(i("#words .word")[e]).addClass("error")}function X$(e){i(i("#words .word")[e]).find("letter").addClass("correct")}function _v(){let e={};r.tapeMode==="off"?r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":r.maxLineWidth+"ch"}:r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":"100%"};const t=i("#typingTest");t.css(e),r.maxLineWidth===0?t.removeClass("full-width-padding").addClass("content"):t.removeClass("content").addClass("full-width-padding")}function Z$(){r.tapeMode==="off"?i("#liveStatsMini").css({"justify-content":"start","margin-left":"0.25em"}):i("#liveStatsMini").css({"justify-content":"center","margin-left":r.tapeMargin+"%"})}function J$(e){i("#barTimerProgress").css("opacity",parseFloat(e)),i("#liveStatsTextTop").css("opacity",parseFloat(e)),i("#liveStatsTextBottom").css("opacity",parseFloat(e)),i("#liveStatsMini").css("opacity",parseFloat(e))}function eM(e){i("#barTimerProgress").removeClass("timerSub"),i("#barTimerProgress").removeClass("timerText"),i("#barTimerProgress").removeClass("timerMain"),i("#liveStatsTextTop").removeClass("timerSub"),i("#liveStatsTextTop").removeClass("timerText"),i("#liveStatsTextTop").removeClass("timerMain"),i("#liveStatsTextBottom").removeClass("timerSub"),i("#liveStatsTextBottom").removeClass("timerText"),i("#liveStatsTextBottom").removeClass("timerMain"),i("#liveStatsMini").removeClass("timerSub"),i("#liveStatsMini").removeClass("timerText"),i("#liveStatsMini").removeClass("timerMain"),e==="main"?(i("#barTimerProgress").addClass("timerMain"),i("#liveStatsTextTop").addClass("timerMain"),i("#liveStatsTextBottom").addClass("timerMain"),i("#liveStatsMini").addClass("timerMain")):e==="sub"?(i("#barTimerProgress").addClass("timerSub"),i("#liveStatsTextTop").addClass("timerSub"),i("#liveStatsTextBottom").addClass("timerSub"),i("#liveStatsMini").addClass("timerSub")):e==="text"&&(i("#barTimerProgress").addClass("timerText"),i("#liveStatsTextTop").addClass("timerText"),i("#liveStatsTextBottom").addClass("timerText"),i("#liveStatsMini").addClass("timerText"))}i(".pageTest #copyWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=k.getHistory().join(" "):e=I.get().slice(0,k.getHistory().length).join(" "),await Iv(e)});i(".pageTest #copyMissedWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=k.getHistory().join(" "):e=Object.keys(Ta??{}).join(" "),await Iv(e)});async function Iv(e){try{await navigator.clipboard.writeText(e),m("Copied to clipboard",0,{duration:2})}catch(t){const o=re(t,"Could not copy to clipboard");m(o,-1)}}i(".pageTest #toggleBurstHeatmap").on("click",async()=>{QT(!r.burstHeatmap),Pp()});i(".pageTest #resultWordsHistory").on("mouseleave",".words .word",()=>{i(".wordInputHighlight").remove()});i(".pageTest #result #wpmChart").on("mouseleave",()=>{cv(!1),NL()});i(".pageTest #result #wpmChart").on("mouseenter",()=>{cv(!0)});i(".pageTest #resultWordsHistory").on("mouseenter",".words .word",e=>{if(de){const t=i(e.currentTarget).attr("input"),o=parseInt(i(e.currentTarget).attr("burst"));t!==void 0&&i(e.currentTarget).append(`<div class="wordInputHighlight withSpeed">
          <div class="text">
          ${t.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt")}
          </div>
          <div class="speed">
          ${z.typingSpeed(o,{showDecimalPlaces:!1})}
          ${r.typingSpeedUnit}
          </div>
          </div>`)}});addEventListener("resize",()=>{Pp()});i("#wordsInput").on("focus",e=>{e.target===document.activeElement&&(!de&&r.showOutOfFocusWarning&&xn(),Qb(!0))});i("#wordsInput").on("focusout",()=>{!de&&r.showOutOfFocusWarning&&sv(),ll()});i(".pageTest").on("click","#showWordHistoryButton",()=>{Kp()});i("#wordsWrapper").on("click",()=>{fn()});ge((e,t)=>{e==="quickRestart"&&(t==="off"?i(".pageTest #restartTestButton").removeClass("hidden"):i(".pageTest #restartTestButton").addClass("hidden")),e==="maxLineWidth"&&_v(),e==="timerOpacity"&&J$(t),e==="timerColor"&&eM(t),e==="showOutOfFocusWarning"&&t===!1&&xn()});let Gp=!1;function oe(){Gp=!0}function Dr(){Gp=!1}function tM(){return Gp}let qv="",Bv=!1;function jp(){return qv}function ta(){return Bv}function cs(e,t){qv=e,Bv=t}let Qp=!1,Js,Tn,bf,vf,Wr,Pr,ei=!1,Fv;function oM(e){Fv=e}function Rv(){const e={lastResult:Fv,start:Js,end:Tn,start3:Wr,end3:Pr,afkHistory:rl,errorHistory:nl,wpmHistory:La,rawHistory:Ad,burstHistory:Do,keypressCountHistory:Ys,currentBurstStart:Md,lastSecondNotRound:ei,missedWords:Ta,accuracy:mo,keypressTimings:ve,keyOverlap:da,wordsHistory:I.list.slice(0,k.getHistory().length),inputHistory:k.getHistory()};try{e.keypressTimings.spacing.average=ve.spacing.array.reduce((t,o)=>o+=t)/ve.spacing.array.length,e.keypressTimings.spacing.sd=sr(ve.spacing.array)}catch{}try{e.keypressTimings.duration.average=ve.duration.array.reduce((t,o)=>o+=t)/ve.duration.array.length,e.keypressTimings.duration.sd=sr(ve.duration.array)}catch{}return e}function aM(){Js=0,Tn=0,Qp=!1,ei=!1}let Yp=0,Hc=0,Xp=[];function Zp(){Yp++}function Jp(e){Hc+=e}function em(e,t){Xp.push({acc:e,seconds:t})}function Dv(){Yp=0,Hc=0,Xp=[]}function ql(){Qp=!0}function pl(e){return e===void 0?(Tn-Js)/1e3:(e-Js)/1e3}function tm(e){const t=pl(Ae?performance.now():Tn),o=Pv(),a=U((o.correctWordChars+o.correctSpaces)*(60/t)/5),s=U((o.allCorrectChars+o.spaces+o.incorrectChars+o.extraChars)*(60/t)/5);return{wpm:e?a:Math.round(a),raw:e?s:Math.round(s)}}function jg(e){Tn=e,vf=Date.now(),Pr=new Date().getTime()}function sM(e){Js=e,bf=Date.now(),Wr=new Date().getTime()}function om(e){let t=0;return e!==void 0&&(r.mode==="time"?t=Math.round(e)-Ys.length:t=Math.ceil(e)-Ys.length,t<0&&(t=0)),rl.filter(a=>a).length+t}function iM(){ei=!0}function Wv(){var s,n;const e=k.getKoreanStatus(),t=(performance.now()-Md)/1e3;let o;if(o=e?kc.disassemble(k.current).length:k.current.length,o===0&&(o=e?((n=kc.disassemble(k.getHistoryLast()))==null?void 0:n.length)??0:((s=k.getHistoryLast())==null?void 0:s.length)??0),o===0)return 0;const a=U(o*(60/t)/5);return Math.round(a)}function ml(){const e=mo.correct/(mo.correct+mo.incorrect)*100;return isNaN(e)?100:e}function nM(){const e=pl();Ys.splice(e),La.splice(e),Do.splice(e),Ad.splice(e)}function rM(){const e=k.getKoreanStatus();let t=[...k.getHistory()];return Ae&&t.push(k.current),e&&(t=t.map(o=>kc.disassemble(o).join(""))),t}function lM(){const e=k.getKoreanStatus();let t=[...r.mode==="zen"?k.getHistory():I.list];return Ae&&t.push(r.mode==="zen"?k.current:I.getCurrent()),e&&(t=t.map(o=>kc.disassemble(o).join(""))),t}function Pv(){let e=0,t=0,o=0,a=0,s=0,n=0,l=0;const c=rM(),u=lM();for(let d=0;d<c.length;d++){const p=c[d],f=u[d];if(p===f)e+=f.length,t+=f.length,d<c.length-1&&xb(p)!==`
`&&l++;else if(p.length>=f.length)for(let g=0;g<p.length;g++)g<f.length?p[g]===f[g]?t++:o++:a++;else{const g={correct:0,incorrect:0,missed:0};for(let h=0;h<f.length;h++)h<p.length?p[h]===f[h]?g.correct++:g.incorrect++:g.missed++;t+=g.correct,o+=g.incorrect,d===c.length-1?g.incorrect===0&&(e+=g.correct):s+=g.missed}d<c.length-1&&n++}return gi("nospace")&&(n=0,l=0),{spaces:n,correctWordChars:e,allCorrectChars:t,incorrectChars:r.mode==="zen"?mo.incorrect:o,extraChars:a,missedChars:s,correctSpaces:l}}function cM(){console.debug("Calculating result stats");let e=pl();console.debug("Test seconds",e," (date based) ",(vf-bf)/1e3," (performance.now based)",(Pr-Wr)/1e3," (new Date based)"),console.debug("Test seconds",Ql(e)," (date based) ",Ql((vf-bf)/1e3)," (performance.now based)",Ql((Pr-Wr)/1e3)," (new Date based)"),r.mode!=="custom"&&(e=U(e),console.debug("Mode is not custom - rounding to 2. New time: ",e));const t=Pv(),{wpm:o,raw:a}=tm(!0),s=U(ml()),n={wpm:isNaN(o)?0:o,wpmRaw:isNaN(a)?0:a,acc:s,correctChars:t.correctWordChars,incorrectChars:t.incorrectChars,missedChars:t.missedChars,extraChars:t.extraChars,allChars:t.allCorrectChars+t.spaces+t.incorrectChars+t.extraChars,time:U(e),spaces:t.spaces,correctSpaces:t.correctSpaces};return console.debug("Result stats",n),n}const Le={mode:null,punctuation:null,numbers:null,customText:null};function wf(e,t){if(r.mode==="zen")return!1;let o;e==="words"&&!t||e==="off"&&t?o=20:o=10;let a=[];e==="words"&&(Object.keys(Ta).forEach(f=>{const g=Ta[f];g!==void 0&&a.push([f,g])}),a.sort((f,g)=>g[1]-f[1]),a=a.slice(0,o));let s=[];if(e==="biwords"){for(let f=0;f<I.length;f++){const g=I.get(f),h=Ta[g];h!==void 0&&(f===0?s.push([g,"",h]):s.push([g,I.get(f-1),h]))}s.sort((f,g)=>g[2]-f[2]),s=s.slice(0,o)}if((e==="words"&&a.length===0||e==="biwords"&&s.length===0)&&!t)return m("You haven't missed any words",0),!1;let n=[];if(t&&(n=I.get().map((f,g)=>[f,Do[g]??0]),n.sort((f,g)=>f[1]-g[1]),n=n.slice(0,Math.min(o,Math.round(I.length*.2))),n.length===0&&m("Test too short to classify slow words.",0)),a.length===0&&s.length===0&&n.length===0)return m("Could not start a new custom test",0),!1;const l=[];a.forEach(f=>{for(let g=0;g<f[1];g++)l.push(f[0])}),s.forEach(f=>{for(let g=0;g<f[2];g++)f[1]!==""?l.push(f[1]+" "+f[0]):l.push(f[0])}),n.forEach((f,g)=>{for(let h=0;h<n.length-g;h++)l.push(f[0])});const c=Le.mode===null?r.mode:Le.mode,u=Le.punctuation===null?r.punctuation:Le.punctuation,d=Le.numbers===null?r.numbers:Le.numbers;let p=null;return r.mode==="custom"&&(p=Ia()),gt("custom",!0),Xs(!0),_a(l),_o("section"),cn("shuffle"),Ko((n.length+a.length+s.length)*5),cs("practise",void 0),Le.mode=c,Le.punctuation=u,Le.numbers=d,Le.customText=p,!0}function zv(){Le.mode=null,Le.punctuation=null,Le.numbers=null,Le.customText=null}ge(e=>{e==="mode"&&zv()});const Qg=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],["Space"]],dM=new Set(["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyA","KeyS","KeyD","KeyF","KeyG","ShiftLeft","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","Space"]),uM=new Set(["Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter","KeyB","KeyN","KeyM","Comma","Period","Slash","ShiftRight","ArrowUp","ArrowLeft","ArrowDown","ArrowRight","NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadEnter","Space"]);function Hv(e,t){var c,u;const o=Object.values(t.keys),a=o.findIndex(d=>d.find(p=>p.includes(e))),s=o[a];if(s===void 0)return;const n=s.findIndex(d=>d.includes(e));if(n===-1)return;let l=(c=Qg[a])==null?void 0:c[n];return t.type==="iso"&&(a===2&&n===11?l="Backslash":a===3&&n===0?l="IntlBackslash":a===3&&(l=(u=Qg[3])==null?void 0:u[n-1])),l}function am(e){const t=dM.has(e),o=uM.has(e);return{leftSide:t,rightSide:o}}function sm(e){const t=[11,10,10,10,10],o={row1:[...[...e.keys.row1.slice(0,t[0])].reverse(),...e.keys.row1.slice(t[0])],row2:[...[...e.keys.row2.slice(0,t[1])].reverse(),...e.keys.row2.slice(t[1])],row3:[...[...e.keys.row3.slice(0,t[2])].reverse(),...e.keys.row3.slice(t[2])],row4:[...[...e.keys.row4.slice(0,t[3])].reverse(),...e.keys.row4.slice(t[3])],row5:[...[...e.keys.row5.slice(0,t[4])].reverse(),...e.keys.row5.slice(t[4])]};return{...e,keys:o}}let ds=!1,us=!1;i(document).on("keydown",e=>{e.code==="ShiftLeft"?(ds=!0,us=!1):e.code==="ShiftRight"&&(ds=!1,us=!0)});i(document).on("keyup",e=>{(e.code==="ShiftLeft"||e.code==="ShiftRight")&&(ds=!1,us=!1)});function fM(){ds=!1,us=!1}function Cf(e){if(!ds&&!us||r.oppositeShiftMode==="off")return!0;const{leftSide:t,rightSide:o}=am(e);return!!(!t&&!o||ds&&o||us&&t)}let Ud=!1,Vd=!1;i(document).on("keydown",e=>{e.code==="AltLeft"?Ud=!0:e.code==="AltRight"&&(Vd=!0)});i(document).on("keyup",e=>{e.code==="AltLeft"?Ud=!1:e.code==="AltRight"&&(Vd=!1)});function pM(){Ud=!1,Vd=!1}function Oc(...e){if(r.funbox.length!==0)for(const t of Ct("toggleScript"))t.functions.toggleScript(e)}function mM(e){if(e.length===0)for(const t of Ct("clearGlobal"))t.functions.clearGlobal();return fv(),Xa(e,!1),!0}function Ov(e){var t,o,a,s;if(!tl(wo(),e)&&!r.funbox.includes(e)){m(`${Ft(e.replace(/_/g," "))} funbox is not compatible with the current funbox selection`,0);return}fv(),Ki(e,!1),wo().includes(e)?(s=(a=mf(e).functions)==null?void 0:a.applyGlobalCSS)==null||s.call(a):(o=(t=mf(e).functions)==null?void 0:t.clearGlobal)==null||o.call(t)}async function zi(){var e,t,o,a;return i("body").attr("class",((a=(o=(t=(e=i("body"))==null?void 0:e.attr("class"))==null?void 0:t.split(/\s+/))==null?void 0:o.filter(s=>!s.startsWith("fb-")))==null?void 0:a.join(" "))??""),i(".funBoxTheme").remove(),i("#wordsWrapper").removeClass("hidden"),un(),oe(),!0}async function Nv(e){if(e==null?e=r.funbox:r.funbox!==e&&(r.funbox=e),!tl(wo()))return m(re(void 0,`Failed to activate funbox: funboxes ${r.funbox.map(s=>s.replace(/_/g," ")).join(", ")} are not compatible`),-1),Xa([],!0),await zi(),!1;un(),await hM(),await yM(),i("#wordsWrapper").removeClass("hidden");const{data:t,error:o}=await eo(hs(r.language));if(o)return m(re(o,"Failed to activate funbox"),-1),Xa([],!0),await zi(),!1;if(t.ligatures&&gi("noLigatures")){m("Current language does not support this funbox mode",0),Xa([],!0),await zi();return}let a=!0;for(const[s,n]of Object.entries(r)){const l=tf(s,n,Pa());if(!l.result&&!l.result)if(l.forcedConfigs&&l.forcedConfigs.length>0)s==="mode"&&gt(l.forcedConfigs[0]),s==="words"&&Qs(l.forcedConfigs[0]),s==="time"&&wa(l.forcedConfigs[0]),s==="punctuation"&&ls(l.forcedConfigs[0]),s==="numbers"&&ka(l.forcedConfigs[0]),s==="highlightMode"&&As(l.forcedConfigs[0]);else{a=!1;break}}if(!a){r.funbox.length>1?m(`Failed to activate funboxes ${r.funbox}: no intersecting forced configs. Disabling funbox`,-1):m(`Failed to activate funbox ${r.funbox}: no forced configs. Disabling funbox`,-1),Xa([],!0),await zi();return}oe();for(const s of Ct("applyConfig"))s.functions.applyConfig();return!0}async function gM(){for(const e of Ct("rememberSettings"))e.functions.rememberSettings()}async function hM(){var a;const e=i("body"),t=wo().map(s=>"fb-"+s.replaceAll("_","-")),o=((a=e==null?void 0:e.attr("class"))==null?void 0:a.split(/\s+/).filter(s=>!s.startsWith("fb-")))??[];return gi("ignoreReducedMotion")&&o.push("ignore-reduced-motion"),e.attr("class",[...new Set([...o,...t]).keys()].join(" ")),!0}async function yM(){i(".funBoxTheme").remove();for(const e of vv("hasCssFile")){const t=document.createElement("link");t.classList.add("funBoxTheme"),t.rel="stylesheet",t.href="funbox/"+e.name+".css",document.head.appendChild(t)}return!0}const Yi=document.querySelector("#capsWarning");let pn=!1,Nc=!1;function bM(){Nc||(Yi==null||Yi.classList.remove("hidden"),Nc=!0)}function vM(){Nc&&(Yi==null||Yi.classList.add("hidden"),Nc=!1)}function Uv(e){var o,a;const t=(a=(o=e==null?void 0:e.originalEvent)==null?void 0:o.getModifierState)==null?void 0:a.call(o,"CapsLock");t!==void 0&&(pn=t);try{r.capsLockWarning&&pn?bM():vM()}catch{}}i(document).on("keyup",Uv);i(document).on("keydown",e=>{Rk()&&Uv(e)});const Vv="~~",wM={keymapShowTopRow:!0,type:"matrix",keys:{row1:[],row2:[["s","S"],["t","T"],["p","P"],["h","H"],["*","*"],["f","F"],["p","P"],["l","L"],["t","T"],["d","D"]],row3:[["s","S"],["k","K"],["w","W"],["r","R"],["*","*"],["r","R"],["b","B"],["g","G"],["s","S"],["z","Z"]],row4:[["a","A"],["o","O"],["e","E"],["u","U"]],row5:[]}};function CM(e){if(r.mode!=="zen"){e===""&&(e=" ");try{i(".activeKey").removeClass("activeKey");let t;r.language.startsWith("korean")&&(e=dt.disassemble(e)[0]??e),e===" "?t="#keymap .keySpace":e==='"'?t=`#keymap .keymapKey[data-key*='${e}']`:t=`#keymap .keymapKey[data-key*="${e}"]`,i(t).addClass("activeKey")}catch(t){t instanceof Error&&console.log("could not update highlighted keymap key: "+t.message)}}}async function kM(e,t){if(e===void 0)return;e===" "?e="#keymap .keySpace":e==='"'?e=`#keymap .keymapKey[data-key*='${e}']`:e=`#keymap .keymapKey[data-key*="${e}"]`;const o=await ms();try{let a={color:o.bg,backgroundColor:o.sub,borderColor:o.sub};t||r.blindMode?a={color:o.bg,backgroundColor:o.main,borderColor:o.main}:a={color:o.bg,backgroundColor:o.error,borderColor:o.error},i(e).stop(!0,!0).css(a).animate({color:o.sub,backgroundColor:o.subAlt,borderColor:o.sub},Pe()?0:500,"easeOutExpo")}catch{}}function SM(){i("#keymap").addClass("hidden")}function xM(){i("#keymap").removeClass("hidden")}function TM(e){const{layoutData:t,rowId:o,isMatrix:a,showTopRow:s,isSteno:n,isISO:l,layoutNameDisplayString:c,isAlice:u}=e;let{rowKeys:d}=e,p=!1,f="",g="",h="";if(o==="row1"&&(a||r.keymapStyle==="staggered")&&(d=d.slice(1)),o==="row1"&&(!s||n))return"";if((o==="row2"||o==="row3"||o==="row4")&&!a&&!n&&(h+="<div></div>"),o==="row4"&&!l&&!a&&!n&&(h+="<div></div>"),a&&(o!=="row5"&&t.matrixShowRightColumn?h+='<div class="keymapKey"></div>':h+="<div></div>"),o==="row5"){if(n)return"";let y=c.replace(/_/g," "),v="";r.keymapLegendStyle==="blank"&&(v='style="display: none;"');const w=S=>br(S??[],[" "]);d.length===1&&w(d[0])&&(d[1]=d[0]??[]),d.length===1&&!w(d[0])&&(d[1]=[" "],d.reverse()),d.length>1&&!w(d[0])&&br(d[0],d[1])&&(d[0]=[" "]);const $=S=>S.some(T=>T!==" ");p=d.some($),h+="<div></div>";for(let S=0;S<d.length;S++){const T=d[S];let q=T[0];r.keymapLegendStyle==="uppercase"&&(q=q.toUpperCase());const _=T.map(Y=>Y.replace('"',"&quot;"));let N=S<1?"left":"right";p&&!u&&(N=""),S===1&&(h+='<div class="keymapSplitSpacer"></div>',f+="-"),w(_)?(h+=`<div class="keymapKey keySpace layoutIndicator ${N}">
              <div class="letter" ${v}>${y}</div>
            </div>`,f+="3",y=""):(h+=`<div class="keymapKey ${N}">
              <div class="letter">${q}</div>
            </div>`,f+="1")}}else for(let y=0;y<d.length;y++){if(o==="row2"&&y===12||o==="row4"&&a&&l&&y===0)continue;let v=10;if(t.matrixShowRightColumn&&(v=11),o==="row4"&&a&&l&&(v+=1),(r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix")&&y>=v)continue;const w=d[y],$=o==="row3"&&(y===3||y===6);let S=w[0],T="";r.keymapLegendStyle==="blank"?T='style="display: none;"':r.keymapLegendStyle==="uppercase"&&(S=S.toUpperCase());let q="";o==="row1"&&y===0&&!a&&r.keymapStyle!=="staggered"&&(q=" invisible");const _=`<div class="keymapKey${q}" data-key="${w.map(Y=>Y.replace('"',"&quot;")).join(Vv)}"><span class="letter" ${T}>${S}</span>${$?"<div class='bump'></div>":""}</div>`;let N="";(r.keymapStyle==="split"||r.keymapStyle==="split_matrix"||r.keymapStyle==="alice"||n)&&(o==="row4"&&n&&(y===0||y===2||y===4)?N+='<div class="keymapSplitSpacer"></div>':o==="row4"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")&&l?y===6&&(N+='<div class="keymapSplitSpacer"></div>'):o==="row1"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")?y===7&&(N+='<div class="keymapSplitSpacer"></div>'):o==="row4"&&a&&l?y===6&&(N+='<div class="keymapSplitSpacer"></div>'):y===5&&(N+='<div class="keymapSplitSpacer"></div>')),r.keymapStyle==="alice"&&o==="row4"&&(l&&y===6||!l&&y===5)&&(N+='<div class="extraKey"><span class="letter"></span></div>'),h+=N+_}if(o==="row5")g+=`<div
          class="row r5"
          data-row5-grid="${f}"
          data-row5-has-alpha="${p}"
        >${h}</div>`;else{const y=parseInt(o.replace("row",""));g+=`<div class="row r${y}">${h}</div>`}return g}async function Uc(){const e=r.keymapLayout==="overrideSync"?r.keymapLayout:r.layout;if(r.keymapMode!=="off"&&ee()==="test"&&e)try{let t=e,o;try{r.keymapLayout==="overrideSync"?r.layout==="default"?(o=await zs("qwerty"),t="default"):(o=await zs(r.layout),t=r.layout):(o=await zs(r.keymapLayout),t=r.keymapLayout)}catch(p){m(re(p,`Failed to load keymap ${e}`),-1);return}const a=Ap&&r.keymapMode==="next"||r.keymapShowTopRow==="always"||o.keymapShowTopRow&&r.keymapShowTopRow!=="never",s=r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix",n=r.keymapStyle==="steno"||r.keymapStyle==="steno_matrix",l=r.keymapStyle==="alice";n&&(o=wM),wo().includes("layout_mirror")&&(o=sm(o));const u=o.type==="iso";let d="";for(const[p,f]of Object.entries(o.keys))d+=TM({layoutData:o,rowId:p,rowKeys:f,isMatrix:s,showTopRow:a,isSteno:n,isISO:u,layoutNameDisplayString:t,isAlice:l});i("#keymap").html(d),i("#keymap").removeClass("staggered"),i("#keymap").removeClass("matrix"),i("#keymap").removeClass("split"),i("#keymap").removeClass("split_matrix"),i("#keymap").removeClass("alice"),i("#keymap").removeClass("steno"),i("#keymap").removeClass("steno_matrix"),i("#keymap").addClass(r.keymapStyle)}catch(t){t instanceof Error&&console.log("something went wrong when changing layout, resettings: "+t.message)}}const LM=Dk(),$M=/^[^\p{L}\p{N}]{1}$/u;let Cu=[0,0];function MM(){const e=ds||us,t=Ud||Vd,a=((LM?e||pn:e!==pn)?1:0)+(t?2:0),s=(e?1:0)+(t?2:0),[n,l]=Cu;if(!(n===a&&l===s))return Cu=[a,s],Cu}async function Kv(){const e=MM();if(e===void 0)return;const t=[...document.getElementsByClassName("keymapKey")].filter(u=>{const d=u.classList.contains("keymapKey"),p=!u.classList.contains("keySpace");return d&&p}),o=t.map(u=>{var d;return(d=u.dataset.key)==null?void 0:d.split(Vv)});if(o.includes(void 0))return;const a=t.map(u=>u.childNodes[0]),[s,n]=e,l=r.keymapLayout==="overrideSync"?r.layout==="default"?"qwerty":r.layout:r.keymapLayout,c=await zs(l).catch(()=>{});if(c===void 0){m("Failed to load keymap layout",-1);return}for(let u=0;u<o.length;u++){const d=o[u],p=a[u],f=d[0],g=d[1];if(p===void 0||d===void 0||f===void 0||g===void 0)continue;const h=[f,g].some(T=>$M.test(T??"")),y=Hv(f,c);if(y===void 0)return;const $=Cf(y)?h?n:s:0,S=d[$]??d[$-2];p.textContent=S??""}}let ku=!1;ge(e=>{const t=()=>{i(".activeKey").removeClass("activeKey"),i(".keymapKey").attr("style",""),r.keymapMode==="off"?SM():xM()},o=()=>{i("#keymap").css("zoom",r.keymapSize)},a=()=>{let s=r.keymapLegendStyle;["lowercase","uppercase","blank","dynamic"].forEach(l=>{i(".keymapLegendStyle").removeClass(l)}),s=s||"lowercase",i(".keymapKey > .letter").css("display",""),i(".keymapKey > .letter").css("text-transform",""),s==="uppercase"&&i(".keymapKey > .letter").css("text-transform","capitalize"),s==="blank"&&i(".keymapKey > .letter").css("display","none"),i(".keymapLegendStyle").addClass(s)};e==="fullConfigChange"&&(ku=!0),e==="fullConfigChangeFinished"&&(ku=!1,Uc(),t(),o(),a()),!ku&&((e==="layout"&&r.keymapLayout==="overrideSync"||e==="keymapLayout"||e==="keymapStyle"||e==="keymapShowTopRow"||e==="keymapMode")&&Uc(),e==="keymapMode"&&t(),e==="keymapSize"&&o(),e==="keymapLegendStyle"&&a())});r$((e,t,o)=>{e==="highlight"&&CM(t),e==="flash"&&kM(t,o)});i(document).on("keydown",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&Kv()});i(document).on("keyup",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&Kv()});vo.register($S,MS,AS,ES,_S,IS,qS,BS,FS,RS,DS,WS,PS,zS);vo.defaults.animation.duration=0;vo.defaults.elements.line.tension=.3;vo.defaults.elements.line.fill="origin";class Ln extends vo{constructor(t,o){super(t,o)}async updateColors(){await EM(this)}getDataset(t){var o;return(o=this.data.datasets)==null?void 0:o.find(a=>a.yAxisID===t)}getScale(t){return this.options.scales[t]}}let Yg;const Ie=new Ln(document.querySelector("#wpmChart"),{type:"line",data:{labels:[],datasets:[{clip:!1,label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{clip:!1,label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"raw",order:3,pointRadius:1},{clip:!1,label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{axis:"y",display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1,callbacks:{afterLabel:function(e){var t;if(Yg===e)return"";Yg=e;try{const o=Math.round(parseFloat(e.label))-1,a=(t=nl[o])==null?void 0:t.words,s=[...new Set(a)],n=s[0],l=Vs(s);if(n===void 0||l===void 0)return"";OL(n,l)}catch{}return""}}}}}});let Gv;const O=new Ln(document.querySelector(".pageAccount #accountHistoryChart"),{type:"line",data:{datasets:[{yAxisID:"wpm",data:[],fill:!1,borderWidth:0,order:3},{yAxisID:"pb",data:[],fill:!1,stepped:!0,pointRadius:0,pointHoverRadius:0,order:4},{yAxisID:"acc",fill:!1,data:[],pointStyle:"triangle",borderWidth:0,pointRadius:3.5,order:3},{yAxisID:"wpmAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"accAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"wpmAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1},{yAxisID:"accAvgHundred",label:"accAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1}]},options:{maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",type:"linear",reverse:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpm:{axis:"y",type:"linear",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Words per Minute"},position:"right"},pb:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1},acc:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Accuracy"},grid:{display:!1},position:"left"},wpmAvgTen:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgTen:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpmAvgHundred:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgHundred:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},enabled:!0,intersect:!1,external:function(e){e!==void 0&&(e.tooltip.options.displayColors=!1)},filter:function(e){return e.datasetIndex!==1&&e.datasetIndex!==3&&e.datasetIndex!==4&&e.datasetIndex!==5&&e.datasetIndex!==6},callbacks:{title:function(){return""},beforeLabel:function(e){if(e.datasetIndex!==0){const s=e.dataset.data[e.dataIndex];return`error rate: ${U(s.errorRate)}%
acc: ${U(100-s.errorRate)}%`}const t=e.dataset.data[e.dataIndex];let o=`${r.typingSpeedUnit}: ${t.wpm}
raw: ${t.raw}
acc: ${t.acc}

mode: ${t.mode} `;(t.mode==="time"||t.mode==="words")&&(o+=t.mode2);let a=t.difficulty;return a===void 0&&(a="normal"),o+=`
difficulty: ${a}`,o+=`
punctuation: ${t.punctuation}
language: ${t.language}${t.isPb?`

new personal best`:""}

date: ${ae(new Date(t.timestamp),"dd MMM yyyy HH:mm")}`,o},label:function(){return""},afterLabel:function(e){return Gv=e.dataIndex,""}}}}}}),Ja=new Ln(document.querySelector(".pageAccount #accountActivityChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Seconds",data:[],trendlineLinear:{style:"rgba(255,105,180, .8)",lineStyle:"dotted",width:2},order:3},{yAxisID:"avgWpm",label:"Average Wpm",data:[],type:"line",order:2,tension:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},type:"time",time:{unit:"day",displayFormats:{day:"d MMM"}},bounds:"ticks",display:!0,title:{display:!1,text:"Date"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:1},display:!0,title:{display:!0,text:"Time typing (minutes)"}},avgWpm:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,position:"right",title:{display:!0,text:"Average Wpm"},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index",filter:e=>e.datasetIndex===0,callbacks:{title:function(e){const t=e[0],o=t.dataset.data[t.dataIndex];return ae(new Date(o.x),"dd MMM yyyy")},beforeLabel:function(e){const t=e.dataset.data[e.dataIndex],o=bt(r.typingSpeedUnit);return`Time Typing: ${ft(Math.round(t.y*60),!0,!0)}
Tests Completed: ${t.amount}
Restarts per test: ${U((t.restarts??0)/(t.amount??0))}
Highest ${r.typingSpeedUnit.toUpperCase()}: ${U(o.fromWpm(t.maxWpm??0))}
Average ${r.typingSpeedUnit.toUpperCase()}: ${U(o.fromWpm(t.avgWpm??0))}
Average Accuracy: ${U(t.avgAcc??0)}%
Average Consistency: ${U(t.avgCon??0)}%`},label:function(){return""}}}}}}),Xi=new Ln(document.querySelector(".pageAccount #accountHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Tests",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Tests"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),Zi=new Ln(document.querySelector(".pageAbout #publicStatsHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Users",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Users"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),lo=new Ln(document.querySelector("#miniResultChartModal canvas"),{type:"line",data:{labels:[],datasets:[{label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"wpm",order:2,pointRadius:2},{label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"raw",order:3,pointRadius:2},{label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1}}}});function AM(){jv(!1),Qv(!1),Yv(!1),Xv(!1)}function Kd(e,t){e?i(`.pageAccount ${t}`).addClass("active"):i(`.pageAccount ${t}`).removeClass("active")}function jv(e=!0){const t=r.accountChart[0]==="on";Kd(t,".toggleResultsOnChart"),O.getDataset("wpm").hidden=!t,O.getDataset("pb").hidden=!t,O.getDataset("wpmAvgTen").hidden=!t,O.getDataset("wpmAvgHundred").hidden=!t,O.getScale("wpm").display=t,e&&O.updateColors()}function Qv(e=!0){const t=r.accountChart[0]==="on",o=r.accountChart[1]==="on";if(Kd(o,".toggleAccuracyOnChart"),O.getDataset("acc").hidden=!o,O.getDataset("accAvgTen").hidden=!o,O.getDataset("accAvgHundred").hidden=!o,O.getScale("acc").display=o,t)O.getScale("acc").min=0,O.getScale("accAvgTen").min=0,O.getScale("accAvgHundred").min=0;else{const a=Math.floor(Math.min(...O.getDataset("acc").data.map(s=>s.y))/5)*5;O.getScale("acc").min=a,O.getScale("accAvgTen").min=a,O.getScale("accAvgHundred").min=a}e&&O.updateColors()}function Yv(e=!0){const t=r.accountChart[0]==="on",o=r.accountChart[1]==="on",a=r.accountChart[2]==="on";Kd(a,".toggleAverage10OnChart"),o&&(O.getDataset("accAvgTen").hidden=!a),t&&(O.getDataset("wpmAvgTen").hidden=!a),e&&O.updateColors()}function Xv(e=!0){const t=r.accountChart[0]==="on",o=r.accountChart[1]==="on",a=r.accountChart[3]==="on";Kd(a,".toggleAverage100OnChart"),o&&(O.getDataset("accAvgHundred").hidden=!a),t&&(O.getDataset("wpmAvgHundred").hidden=!a),e&&O.updateColors()}async function EM(e){var g,h;const t=await Yt("bg"),o=await Yt("sub"),a=await Yt("subAlt"),s=await Yt("main"),n=await Yt("error"),l=await Yt("text"),c=a;for(const y of vt(e.scales)){const v=e.getScale(y);v.grid.color=c,v.grid.tickColor=c,v.grid.borderColor=c,v.ticks.color=o,v.title.color=o}e.data.datasets[0].borderColor=y=>{var $;return(($=y.raw)==null?void 0:$.isPb)?l:s},e.data.datasets[1]&&(e.data.datasets[1].borderColor=o),e.data.datasets[2]&&(e.data.datasets[2].borderColor=n);const u=e.data.datasets[0];((h=(g=e==null?void 0:e.data)==null?void 0:g.datasets[0])==null?void 0:h.type)===void 0?e.config.type==="line"?u.pointBackgroundColor=y=>{var $;return(($=y.raw)==null?void 0:$.isPb)?l:s}:e.config.type==="bar"&&(u.backgroundColor=s):e.data.datasets[0].type==="bar"?e.data.datasets[0].backgroundColor=s:e.data.datasets[0].type==="line"&&(u.pointBackgroundColor=s);const d=e.data.datasets[1];d!==void 0&&(d.type===void 0?e.config.type==="line"?d.pointBackgroundColor=o:e.config.type==="bar"&&(d.backgroundColor=o):(d==null?void 0:d.type)==="bar"?d.backgroundColor=o:d.type==="line"&&(d.pointBackgroundColor=o)),e.data.datasets.length===2&&(d.borderColor=()=>o);const p=e.data.datasets[2];if(e.data.datasets.length===7){p.borderColor=()=>o;const y=r.accountChart[2]==="on",v=r.accountChart[3]==="on",w=Uo(t,l,.2),$=Uo(t,s,.2),S=Uo(t,s,.4),T=Uo(t,o,.2),q=Uo(t,o,.4),[_,N,Y,G,xe,He,Fe]=e.data.datasets;if(_===void 0||N===void 0||Y===void 0||G===void 0||xe===void 0||He===void 0||Fe===void 0)return;y&&v?(_.pointBackgroundColor=$,N.borderColor=w,Y.pointBackgroundColor=T,G.borderColor=S,xe.borderColor=q,He.borderColor=s,Fe.borderColor=o):y&&!v||!y&&v?(N.borderColor=w,_.pointBackgroundColor=S,Y.pointBackgroundColor=q,G.borderColor=s,He.borderColor=s,xe.borderColor=o,Fe.borderColor=o):(N.borderColor=w,_.pointBackgroundColor=s,Y.pointBackgroundColor=o)}const f=e.options;Object.keys(f.scales).forEach(y=>{const v=f.scales[y];v.ticks.color=o,v.title.color=o,v.grid.color=c,v.grid.tickColor=c,v.grid.borderColor=c});try{u.trendlineLinear.style=o}catch{}e.options.plugins.annotation.annotations.forEach(y=>{y.id!=="funbox-label"&&(y.borderColor=o),y.label.backgroundColor=o,y.label.color=t}),e.update("none")}function _M(e){vo.defaults.font.family=e.replace(/_/g," ")}function Zv(){il(),O.updateColors(),Xi.updateColors(),Zi.updateColors(),Ie.updateColors(),Ja.updateColors(),lo.updateColors()}ge((e,t)=>{e==="accountChart"&&ee()==="account"&&(jv(),Qv(),Yv(),Xv()),e==="fontFamily"&&_M(t)});const Me={blur:{value:0,default:0},brightness:{value:1,default:1},saturate:{value:1,default:1},opacity:{value:1,default:1}};function IM(){let e="";return Object.keys(Me).forEach(t=>{const o=t;Me[o].value!==Me[o].default&&(e+=`${t}(${Me[o].value}${t==="blur"?"rem":""}) `)}),e}function $n(){const t={filter:IM(),width:`calc(100% + ${Me.blur.value*4}rem)`,height:`calc(100% + ${Me.blur.value*4}rem)`,left:`-${Me.blur.value*2}rem`,top:`-${Me.blur.value*2}rem`,position:"absolute"};i(".customBackground img").css(t)}function qM(){i(".section[data-config-name='customBackgroundFilter'] .blur input").val(Me.blur.value),i(".section[data-config-name='customBackgroundFilter'] .brightness input").val(Me.brightness.value),i(".section[data-config-name='customBackgroundFilter'] .saturate input").val(Me.saturate.value),i(".section[data-config-name='customBackgroundFilter'] .opacity input").val(Me.opacity.value)}function gl(){i(".section[data-config-name='customBackgroundFilter'] .blur .value").html(Me.blur.value.toFixed(1)),i(".section[data-config-name='customBackgroundFilter'] .brightness .value").html(Me.brightness.value.toFixed(1)),i(".section[data-config-name='customBackgroundFilter'] .saturate .value").html(Me.saturate.value.toFixed(1)),i(".section[data-config-name='customBackgroundFilter'] .opacity .value").html(Me.opacity.value.toFixed(1))}function Jv(){qM(),gl()}function BM(e){Me.blur.value=e[0],Me.brightness.value=e[1],Me.saturate.value=e[2],Me.opacity.value=e[3],Jv()}i(".section[data-config-name='customBackgroundFilter'] .blur input").on("input",()=>{Me.blur.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .blur input").val()),gl(),$n()});i(".section[data-config-name='customBackgroundFilter'] .brightness input").on("input",()=>{Me.brightness.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .brightness input").val()),gl(),$n()});i(".section[data-config-name='customBackgroundFilter'] .saturate input").on("input",()=>{Me.saturate.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .saturate input").val()),gl(),$n()});i(".section[data-config-name='customBackgroundFilter'] .opacity input").on("input",()=>{Me.opacity.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .opacity input").val()),gl(),$n()});i(".section[data-config-name='customBackgroundFilter'] input").on("input",()=>{FM()});const FM=$t(2e3,async()=>{const e=Object.keys(Me).map(t=>Me[t].value);Wi(e,!1)});ge((e,t)=>{e==="customBackgroundFilter"&&t&&(BM(t),$n())});const Xg={8008:{bgColor:"#333a45",mainColor:"#f44c7f",subColor:"#939eae",textColor:"#e9ecf0"},9009:{bgColor:"#eeebe2",mainColor:"#080909",subColor:"#99947f",textColor:"#080909"},dark_note:{bgColor:"#1f1f1f",mainColor:"#f2c17b",subColor:"#768f95",textColor:"#d2dff4"},viridescent:{bgColor:"#2c3333",mainColor:"#95d5b2",subColor:"#84a98c",textColor:"#e9f5db"},dark:{bgColor:"#111",mainColor:"#eee",subColor:"#444",textColor:"#eee"},phantom:{bgColor:"#1a1b26",mainColor:"#7aa2f7",subColor:"#414868",textColor:"#c0caf5"},muted:{bgColor:"#525252",mainColor:"#c5b4e3",subColor:"#939eae",textColor:"#b1e4e3"},dark_magic_girl:{bgColor:"#091f2c",mainColor:"#f5b1cc",subColor:"#93e8d3",textColor:"#a288d9"},carbon:{bgColor:"#313131",mainColor:"#f66e0d",subColor:"#616161",textColor:"#f5e6c8"},vesper:{bgColor:"#101010",mainColor:"#ffc799",subColor:"#99ffe4",textColor:"#ffffff"},our_theme:{bgColor:"#ce1226",mainColor:"#fcd116",subColor:"#6d0f19",textColor:"#ffffff"},dots:{bgColor:"#121520",mainColor:"#fff",subColor:"#676e8a",textColor:"#fff"},nautilus:{bgColor:"#132237",mainColor:"#ebb723",subColor:"#0b4c6c",textColor:"#1cbaac"},serika:{bgColor:"#e1e1e3",mainColor:"#e2b714",subColor:"#aaaeb3",textColor:"#323437"},serika_dark:{bgColor:"#323437",mainColor:"#e2b714",subColor:"#646669",textColor:"#d1d0c5"},bushido:{bgColor:"#242933",mainColor:"#ec4c56",subColor:"#596172",textColor:"#f6f0e9"},red_samurai:{bgColor:"#84202c",mainColor:"#c79e6e",subColor:"#55131b",textColor:"#e2dad0"},rgb:{bgColor:"#111",mainColor:"#eee",subColor:"#444",textColor:"#eee"},oblivion:{bgColor:"#313231",mainColor:"#a5a096",subColor:"#5d6263",textColor:"#f7f5f1"},magic_girl:{bgColor:"#ffffff",mainColor:"#f5b1cc",subColor:"#93e8d3",textColor:"#00ac8c"},metropolis:{bgColor:"#0f1f2c",mainColor:"#56c3b7",subColor:"#326984",textColor:"#e4edf1"},mountain:{bgColor:"#0f0f0f",mainColor:"#e7e7e7",subColor:"#4c4c4c",textColor:"#e7e7e7"},laser:{bgColor:"#221b44",mainColor:"#009eaf",subColor:"#b82356",textColor:"#dbe7e8"},retro:{bgColor:"#dad3c1",mainColor:"#1d1b17",subColor:"#918b7d",textColor:"#1d1b17"},dracula:{bgColor:"#282a36",mainColor:"#bd93f9",subColor:"#6272a4",textColor:"#f8f8f2"},nord:{bgColor:"#242933",mainColor:"#88C0D0",subColor:"#2E3440",textColor:"#88C0D0"},mr_sleeves:{bgColor:"#d1d7da",mainColor:"#daa99b",subColor:"#9a9fa1",textColor:"#1d1d1d"},olivia:{bgColor:"#1c1b1d",mainColor:"#deaf9d",subColor:"#4e3e3e",textColor:"#f2efed"},bliss:{bgColor:"#262727",mainColor:"#f0d3c9",subColor:"#665957",textColor:"#fff"},mizu:{bgColor:"#afcbdd",mainColor:"#fcfbf6",subColor:"#85a5bb",textColor:"#1a2633"},metaverse:{bgColor:"#232323",mainColor:"#d82934",subColor:"#5e5e5e",textColor:"#e8e8e8"},shadow:{bgColor:"#000",mainColor:"#eee",subColor:"#444",textColor:"#eee"},mint:{bgColor:"#05385b",mainColor:"#5cdb95",subColor:"#20688a",textColor:"#edf5e1"},miami:{bgColor:"#f35588",mainColor:"#05dfd7",subColor:"#94294c",textColor:"#f0e9ec"},miami_nights:{bgColor:"#18181a",mainColor:"#e4609b",subColor:"#47bac0",textColor:"#fff"},modern_dolch:{bgColor:"#2d2e30",mainColor:"#7eddd3",subColor:"#54585c",textColor:"#e3e6eb"},botanical:{bgColor:"#7b9c98",mainColor:"#eaf1f3",subColor:"#495755",textColor:"#eaf1f3"},bingsu:{bgColor:"#b8a7aa",mainColor:"#83616e",subColor:"#48373d",textColor:"#ebe6ea"},terminal:{bgColor:"#191a1b",mainColor:"#79a617",subColor:"#48494b",textColor:"#e7eae0"},lavender:{bgColor:"#ada6c2",mainColor:"#e4e3e9",subColor:"#e4e3e9",textColor:"#2f2a41"},taro:{bgColor:"#b3baff",mainColor:"#130f1a",subColor:"#6f6c91",textColor:"#130f1a"},striker:{bgColor:"#124883",mainColor:"#d7dcda",subColor:"#0f2d4e",textColor:"#d6dbd9"},gruvbox_dark:{bgColor:"#282828",mainColor:"#d79921",subColor:"#665c54",textColor:"#ebdbb2"},gruvbox_light:{bgColor:"#fbf1c7",mainColor:"#689d6a",subColor:"#a89984",textColor:"#3c3836"},monokai:{bgColor:"#272822",mainColor:"#a6e22e",subColor:"#e6db74",textColor:"#e2e2dc"},sonokai:{bgColor:"#2c2e34",mainColor:"#9ed072",subColor:"#e7c664",textColor:"#e2e2e3"},camping:{bgColor:"#faf1e4",mainColor:"#618c56",subColor:"#c2b8aa",textColor:"#3c403b"},voc:{bgColor:"#190618",mainColor:"#e0caac",subColor:"#4c1e48",textColor:"#eeeae4"},vaporwave:{bgColor:"#a4a7ea",mainColor:"#e368da",subColor:"#7c7faf",textColor:"#f1ebf1"},pulse:{bgColor:"#181818",mainColor:"#17b8bd",subColor:"#53565a",textColor:"#e5f4f4"},matrix:{bgColor:"#000000",mainColor:"#15ff00",subColor:"#006500",textColor:"#d1ffcd"},olive:{bgColor:"#e9e5cc",mainColor:"#92946f",subColor:"#b7b39e",textColor:"#373731"},strawberry:{bgColor:"#f37f83",mainColor:"#fcfcf8",subColor:"#e53c58",textColor:"#fcfcf8"},night_runner:{bgColor:"#212121",mainColor:"#feff04",subColor:"#5c4a9c",textColor:"#e8e8e8"},cyberspace:{bgColor:"#181c18",mainColor:"#00ce7c",subColor:"#9578d3",textColor:"#c2fbe1"},joker:{bgColor:"#1a0e25",mainColor:"#99de1e",subColor:"#7554a3",textColor:"#e9e2f5"},dualshot:{bgColor:"#737373",mainColor:"#212222",subColor:"#aaaaaa",textColor:"#212222"},solarized_dark:{bgColor:"#002b36",mainColor:"#859900",subColor:"#2aa198",textColor:"#268bd2"},solarized_light:{bgColor:"#fdf6e3",mainColor:"#859900",subColor:"#2aa198",textColor:"#181819"},solarized_osaka:{bgColor:"#00141a",mainColor:"#859900",subColor:"#2aa198",textColor:"#b58900"},terra:{bgColor:"#0c100e",mainColor:"#89c559",subColor:"#436029",textColor:"#f0edd1"},red_dragon:{bgColor:"#1a0b0c",mainColor:"#ff3a32",subColor:"#e2a528",textColor:"#4a4d4e"},hammerhead:{bgColor:"#030613",mainColor:"#4fcdb9",subColor:"#213c53",textColor:"#e2f1f5"},future_funk:{bgColor:"#2e1a47",mainColor:"#f7f2ea",subColor:"#c18fff",textColor:"#f7f2ea"},milkshake:{bgColor:"#ffffff",mainColor:"#212b43",subColor:"#62cfe6",textColor:"#212b43"},aether:{bgColor:"#101820",mainColor:"#eedaea",subColor:"#cf6bdd",textColor:"#eedaea"},froyo:{bgColor:"#e1dacb",mainColor:"#7b7d7d",subColor:"#b29c5e",textColor:"#7b7d7d"},retrocast:{bgColor:"#07737a",mainColor:"#88dbdf",subColor:"#f3e03b",textColor:"#ffffff"},luna:{bgColor:"#221c35",mainColor:"#f67599",subColor:"#5a3a7e",textColor:"#ffe3eb"},graen:{bgColor:"#303c36",mainColor:"#a59682",subColor:"#181d1a",textColor:"#a59682"},bento:{bgColor:"#2d394d",mainColor:"#ff7a90",subColor:"#4a768d",textColor:"#fffaf8"},watermelon:{bgColor:"#1f4437",mainColor:"#d6686f",subColor:"#3e7a65",textColor:"#cdc6bc"},menthol:{bgColor:"#00c18c",mainColor:"#ffffff",subColor:"#186544",textColor:"#ffffff"},ishtar:{bgColor:"#202020",mainColor:"#91170c",subColor:"#847869",textColor:"#fae1c3"},mashu:{bgColor:"#2b2b2c",mainColor:"#76689a",subColor:"#d8a0a6",textColor:"#f1e2e4"},deku:{bgColor:"#058b8c",mainColor:"#b63530",subColor:"#255458",textColor:"#f7f2ea"},honey:{bgColor:"#f2aa00",mainColor:"#fff546",subColor:"#a66b00",textColor:"#f3eecb"},shoko:{bgColor:"#ced7e0",mainColor:"#81c4dd",subColor:"#7599b1",textColor:"#3b4c58"},norse:{bgColor:"#242425",mainColor:"#2b5f6d",subColor:"#505b5e",textColor:"#ccc2b1"},matcha_moccha:{bgColor:"#523525",mainColor:"#7ec160",subColor:"#9e6749",textColor:"#ecddcc"},cafe:{bgColor:"#ceb18d",mainColor:"#14120f",subColor:"#d4d2d1",textColor:"#14120f"},alpine:{bgColor:"#6c687f",mainColor:"#ffffff",subColor:"#9994b8",textColor:"#ffffff"},superuser:{bgColor:"#262a33",mainColor:"#43ffaf",subColor:"#526777",textColor:"#e5f7ef"},ms_cupcakes:{bgColor:"#ffffff",mainColor:"#5ed5f3",subColor:"#d64090",textColor:"#0a282f"},dollar:{bgColor:"#e4e4d4",mainColor:"#6b886b",subColor:"#8a9b69",textColor:"#555a56"},lime:{bgColor:"#7c878e",mainColor:"#93c247",subColor:"#4b5257",textColor:"#bfcfdc"},sweden:{bgColor:"#0058a3",mainColor:"#ffcc02",subColor:"#57abdb",textColor:"#ffffff"},wavez:{bgColor:"#1c292f",mainColor:"#6bde3b",subColor:"#1f5e6b",textColor:"#e9efe6"},nebula:{bgColor:"#212135",mainColor:"#be3c88",subColor:"#19b3b8",textColor:"#838686"},lil_dragon:{bgColor:"#ebe1ef",mainColor:"#8a5bd6",subColor:"#a28db8",textColor:"#212b43"},pastel:{bgColor:"#e0b2bd",mainColor:"#fbf4b6",subColor:"#b4e9ff",textColor:"#6d5c6f"},alduin:{bgColor:"#1c1c1c",mainColor:"#dfd7af",subColor:"#444444",textColor:"#f5f3ed"},paper:{bgColor:"#eeeeee",mainColor:"#444444",subColor:"#b2b2b2",textColor:"#444444"},fundamentals:{bgColor:"#727474",mainColor:"#7fa482",subColor:"#cac4be",textColor:"#131313"},drowning:{bgColor:"#191826",mainColor:"#4a6fb5",subColor:"#50688c",textColor:"#9393a7"},iceberg_dark:{bgColor:"#161821",mainColor:"#84a0c6",subColor:"#595e76",textColor:"#c6c8d1"},iceberg_light:{bgColor:"#e8e9ec",mainColor:"#2d539e",subColor:"#adb1c4",textColor:"#33374c"},onedark:{bgColor:"#2f343f",mainColor:"#61afef",subColor:"#eceff4",textColor:"#98c379"},darling:{bgColor:"#fec8cd",mainColor:"#ffffff",subColor:"#a30000",textColor:"#ffffff"},repose_dark:{bgColor:"#2f3338",mainColor:"#d6d2bc",subColor:"#8f8e84",textColor:"#d6d2bc"},repose_light:{bgColor:"#efead0",mainColor:"#5f605e",subColor:"#8f8e84",textColor:"#333538"},horizon:{bgColor:"#1c1e26",mainColor:"#c4a88a",subColor:"#db886f",textColor:"#bbbbbb"},rudy:{bgColor:"#1a2b3e",mainColor:"#af8f5c",subColor:"#3a506c",textColor:"#c9c8bf"},stealth:{bgColor:"#010203",mainColor:"#383e42",subColor:"#5e676e",textColor:"#383e42"},"80s_after_dark":{bgColor:"#1b1d36",mainColor:"#fca6d1",subColor:"#99d6ea",textColor:"#e1e7ec"},arch:{bgColor:"#0c0d11",mainColor:"#7ebab5",subColor:"#454864",textColor:"#f6f5f5"},rose_pine:{bgColor:"#1f1d27",mainColor:"#9ccfd8",subColor:"#c4a7e7",textColor:"#e0def4"},rose_pine_moon:{bgColor:"#2a273f",mainColor:"#9ccfd8",subColor:"#c4a7e7",textColor:"#e0def4"},rose_pine_dawn:{bgColor:"#fffaf3",mainColor:"#56949f",subColor:"#c4a7e7",textColor:"#286983"},copper:{bgColor:"#442f29",mainColor:"#b46a55",subColor:"#7ebab5",textColor:"#e7e0de"},grand_prix:{bgColor:"#36475c",mainColor:"#c0d036",subColor:"#5c6c80",textColor:"#c1c7d7"},peaches:{bgColor:"#e0d7c1",mainColor:"#dd7a5f",subColor:"#e7b28e",textColor:"#5f4c41"},bouquet:{bgColor:"#173f35",mainColor:"#eaa09c",subColor:"#408e7b",textColor:"#e9e0d2"},midnight:{bgColor:"#0b0e13",mainColor:"#60759f",subColor:"#394760",textColor:"#9fadc6"},blueberry_light:{bgColor:"#dae0f5",mainColor:"#506477",subColor:"#92a4be",textColor:"#678198"},blueberry_dark:{bgColor:"#212b42",mainColor:"#add7ff",subColor:"#5c7da5",textColor:"#91b4d5"},fledgling:{bgColor:"#3b363f",mainColor:"#fc6e83",subColor:"#8e5568",textColor:"#e6d5d3"},ez_mode:{bgColor:"#0068c6",mainColor:"#fa62d5",subColor:"#138bf7",textColor:"#ffffff"},vscode:{bgColor:"#1e1e1e",mainColor:"#007acc",subColor:"#4d4d4d",textColor:"#d4d4d4"},material:{bgColor:"#263238",mainColor:"#80cbc4",subColor:"#4c6772",textColor:"#e6edf3"},godspeed:{bgColor:"#eae4cf",mainColor:"#9abbcd",subColor:"#ada998",textColor:"#646669"},witch_girl:{bgColor:"#f3dbda",mainColor:"#56786a",subColor:"#ddb4a7",textColor:"#56786a"},terror_below:{bgColor:"#0b1e1a",mainColor:"#66ac92",subColor:"#015c53",textColor:"#dceae5"},sewing_tin:{bgColor:"#241963",mainColor:"#f2ce83",subColor:"#446ad5",textColor:"#ffffff"},soaring_skies:{bgColor:"#fff9f2",mainColor:"#55c6f0",subColor:"#1e107a",textColor:"#1d1e1e"},sewing_tin_light:{bgColor:"#ffffff",mainColor:"#2d2076",subColor:"#385eca",textColor:"#2d2076"},chaos_theory:{bgColor:"#141221",mainColor:"#fd77d7",subColor:"#676e8a",textColor:"#dde5ed"},hanok:{bgColor:"#d8d2c3",mainColor:"#513a2a",subColor:"#8b6f5c",textColor:"#393b3b"},comfy:{bgColor:"#4a5b6e",mainColor:"#f8cdc6",subColor:"#9ec1cc",textColor:"#f5efee"},tiramisu:{bgColor:"#cfc6b9",mainColor:"#c0976f",subColor:"#c0976f",textColor:"#7d5448"},diner:{bgColor:"#537997",mainColor:"#c3af5b",subColor:"#445c7f",textColor:"#dfdbc8"},modern_ink:{bgColor:"#ffffff",mainColor:"#ff360d",subColor:"#b7b7b7",textColor:"#000000"},dev:{bgColor:"#1b2028",mainColor:"#23a9d5",subColor:"#4b5975",textColor:"#ccccb5"},moonlight:{bgColor:"#191f28",mainColor:"#c69f68",subColor:"#4b5975",textColor:"#ccccb5"},pink_lemonade:{bgColor:"#f6d992",mainColor:"#f6a192",subColor:"#f6b092",textColor:"#fcfcf8"},creamsicle:{bgColor:"#ff9869",mainColor:"#fcfcf8",subColor:"#ff661f",textColor:"#fcfcf8"},beach:{bgColor:"#ffeead",mainColor:"#96ceb4",subColor:"#ffcc5c",textColor:"#5b7869"},desert_oasis:{bgColor:"#fff2d5",mainColor:"#d19d01",subColor:"#0061fe",textColor:"#332800"},frozen_llama:{bgColor:"#9bf2ea",mainColor:"#6d44a6",subColor:"#b690fd",textColor:"#ffffff"},ryujinscales:{bgColor:"#081426",mainColor:"#f17754",subColor:"#ffbc90",textColor:"#ffe4bc"},trackday:{bgColor:"#464d66",mainColor:"#e0513e",subColor:"#5c7eb9",textColor:"#cfcfcf"},fruit_chew:{bgColor:"#d6d3d6",mainColor:"#5c1e5f",subColor:"#b49cb5",textColor:"#282528"},evil_eye:{bgColor:"#0084c2",mainColor:"#f7f2ea",subColor:"#01589f",textColor:"#171718"},trance:{bgColor:"#00021b",mainColor:"#e51376",subColor:"#3c4c79",textColor:"#fff"},fire:{bgColor:"#0f0000",mainColor:"#b31313",subColor:"#683434",textColor:"#ffffff"},aurora:{bgColor:"#011926",mainColor:"#00e980",subColor:"#245c69",textColor:"#fff"},leather:{bgColor:"#a86948",mainColor:"#ffe4bc",subColor:"#81482b",textColor:"#ffe4bc"},fleuriste:{bgColor:"#c6b294",mainColor:"#405a52",subColor:"#64374d",textColor:"#091914"},dmg:{bgColor:"#dadbdc",mainColor:"#ae185e",subColor:"#3846b1",textColor:"#414141"},catppuccin:{bgColor:"#1e1e2e",mainColor:"#cba6f7",subColor:"#7f849c",textColor:"#cdd6f4"},snes:{bgColor:"#bfbec2",mainColor:"#553d94",subColor:"#9f8ad4",textColor:"#2e2e2e"},passion_fruit:{bgColor:"#7c2142",mainColor:"#f4a3b4",subColor:"#9994b8",textColor:"#ffffff"},blue_dolphin:{bgColor:"#003950",mainColor:"#ffcefb",subColor:"#00e4ff",textColor:"#82eaff"},mexican:{bgColor:"#f8ad34",mainColor:"#b12189",subColor:"#333",textColor:"#eee"},husqy:{bgColor:"#000000",mainColor:"#c58aff",subColor:"#972fff",textColor:"#ebd7ff"},peach_blossom:{bgColor:"#292929",mainColor:"#99b898",subColor:"#616161",textColor:"#fecea8"},dino:{bgColor:"#ffffff",mainColor:"#40d672",subColor:"#d5d5d5",textColor:"#1d221f"},tron_orange:{bgColor:"#0d1c1c",mainColor:"#f0e800",subColor:"#ff6600",textColor:"#ffffff"},hedge:{bgColor:"#415e31",mainColor:"#6a994e",subColor:"#ede5b4",textColor:"#f7f1d6"},modern_dolch_light:{bgColor:"#dbdbdb",mainColor:"#8fd1c3",subColor:"#acacac",textColor:"#454545"},iv_spade:{bgColor:"#0c0c0c",mainColor:"#b7976a",subColor:"#404040",textColor:"#d3c2c3"},iv_clover:{bgColor:"#a0a0a0",mainColor:"#573e40",subColor:"#353535",textColor:"#3b2d3b"},cheesecake:{bgColor:"#fdf0d5",mainColor:"#8e2949",subColor:"#d91c81",textColor:"#3a3335"},earthsong:{bgColor:"#292521",mainColor:"#509452",subColor:"#f5ae2d",textColor:"#e6c7a8"},purpleish:{bgColor:"#1e1e32",mainColor:"#7a52cc",subColor:"#3d3d66",textColor:"#7a52cc"},nord_light:{bgColor:"#eceff4",mainColor:"#8fbcbb",subColor:"#6a7791",textColor:"#8fbcbb"},slambook:{bgColor:"#FFFDDE",mainColor:"#13005A",subColor:"#1c82adc4",textColor:"#125d98"},breeze:{bgColor:"#e8d5c4",mainColor:"#7d67a9",subColor:"#3a98b9",textColor:"#1b4c5e"},cherry_blossom:{bgColor:"#323437",mainColor:"#d65ccc",subColor:"#787d82",textColor:"#d1d0c5"},everblush:{bgColor:"#141b1e",mainColor:"#8ccf7e",subColor:"#838887",textColor:"#dadada"},grape:{bgColor:"#2c003e",mainColor:"#ff8f00",subColor:"#651e56",textColor:"#fff"},rainbow_trail:{bgColor:"#f5f5f5",mainColor:"#363636",subColor:"#4f4f4f",textColor:"#1f1f1f"},tangerine:{bgColor:"#ffede0",mainColor:"#fe5503",subColor:"#ff9562",textColor:"#3d1705"},macroblank:{bgColor:"#b2d2c8",mainColor:"#c13117",subColor:"#717977",textColor:"#490909"},anti_hero:{bgColor:"#00002e",mainColor:"#ffadad",subColor:"#ff3d8b",textColor:"#f1deef"},incognito:{bgColor:"#0e0e0e",mainColor:"#ff9900",subColor:"#2f2f2f",textColor:"#c6c6c6"},discord:{bgColor:"#313338",mainColor:"#5a65ea",subColor:"#565861",textColor:"#dcdee3"},cy_red:{bgColor:"#6e2626",mainColor:"#e55050",subColor:"#ff6060",textColor:"#ffaaaa"},floret:{bgColor:"#00272c",mainColor:" #ffdd6d",subColor:"#779097",textColor:"#E5E5E5"},lilac_mist:{bgColor:"#fffbfe",mainColor:"#b94189",subColor:"#e094c2",textColor:"#5c2954"},terrazzo:{bgColor:"#f1e5da",mainColor:"#e0794e",subColor:"#688e8f",textColor:"#023e3b"},suisei:{bgColor:"#3b4a62",mainColor:"#bef0ff",subColor:"#fe9841",textColor:"#dbdeeb"},github:{bgColor:"#212830",mainColor:"#41ce5c",subColor:"#788386",textColor:"#ccdae6"},sunset:{bgColor:"#211e24",mainColor:"#f79777",subColor:"#5b578e",textColor:"#f4e0c9"}},hl=Object.keys(Xg).sort().map(e=>({...Xg[e],name:e})),RM=[...hl.sort((e,t)=>{const o=Dc(e.bgColor);return Dc(t.bgColor).lgt-o.lgt})];class DM{constructor(t="file-storage-db"){this.dbPromise=HS(t,1,{upgrade(o){o.objectStoreNames.contains("files")||o.createObjectStore("files")}})}async storeFile(t,o){await(await this.dbPromise).put("files",o,t)}async getFile(t){return(await this.dbPromise).get("files",t)}async deleteFile(t){await(await this.dbPromise).delete("files",t)}async listFilenames(){return(await this.dbPromise).getAllKeys("files")}async hasFile(t){return await this.getFile(t)!==void 0}}const at=new DM;let je=null,kf=!1,qi=0;const qa=["--bg-color","--main-color","--caret-color","--sub-color","--sub-alt-color","--text-color","--error-color","--error-extra-color","--colorful-error-color","--colorful-error-extra-color"];async function WM(){setTimeout(async()=>{let e,t;t=await Yt("bg"),e=await Yt("main"),t===e&&(t="#111",e="#eee");const o=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <style>
    #bg{fill:${t};}
    path{fill:${e};}
  </style>
  <g>
    <path id="bg" d="M0 16Q0 0 16 0h32q16 0 16 16v32q0 16-16 16H16Q0 64 0 48"/>
    <path d="M9.09 24.1v21.2h5.12V33.1q.256-4.61 4.48-4.61 3.46.384 3.46 3.84v12.9h5.12v-11.5q-.128-5.25 4.48-5.25 3.46.384 3.46 3.84v12.9h5.12v-12.2q0-9.47-7.04-9.47-4.22 0-7.04 3.46-2.18-3.46-6.02-3.46-3.46 0-6.02 2.43v-2.05M47 18.9v5.12h-4.61v5.12H47v16.1h5.12v-16.1h4.61v-5.12h-4.61V18.9"/>
  </g>
</svg>`;i("#favicon").attr("href","data:image/svg+xml;base64,"+btoa(o))},125)}function PM(){console.debug("Theme controller clearing custom theme");for(const e of qa)document.documentElement.style.setProperty(e,"")}let Wn=[];async function ew(e){return new Promise(t=>{function o(){console.debug("Theme controller swapping elements");const n=i("#currentTheme"),l=i("#nextTheme");if(l.length===0){console.debug("Theme controller failed to swap elements, next is missing");return}n.remove(),l.attr("id","currentTheme")}console.debug("Theme controller loading style",e),Wn.push(setTimeout(()=>{te()},100)),i("#nextTheme").remove();const a=document.querySelector("#currentTheme"),s=document.createElement("link");s.type="text/css",s.rel="stylesheet",s.id="nextTheme",s.onload=()=>{console.debug("Theme controller loaded style",e),V(),o(),Wn.map(n=>clearTimeout(n)),Wn=[],i("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},s.onerror=n=>{console.debug("Theme controller failed to load style",e,n),console.error(`Failed to load theme ${e}`,n),V(),m("Failed to load theme",0),o(),Wn.map(l=>clearTimeout(l)),Wn=[],i("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},e==="custom"?s.href="/themes/serika_dark.css":s.href=`/themes/${e}.css`,a===null?(console.debug("Theme controller appending link to the head",s),document.head.appendChild(s)):(console.debug("Theme controller inserting link after current theme",s),a.after(s))})}async function ss(e,t,o=!1){console.debug("Theme controller applying theme",e,t,o),e!=="custom"&&PM();const a=t?"custom":e;if(Bx(),i(".keymapKey").attr("style",""),await ew(a),il(),r.customTheme&&!o||t){const n=t??r.customThemeColors;for(let l=0;l<qa.length;l++){const c=qa[l];document.documentElement.style.setProperty(c,n[l])}}const s=await ms();i(".keymapKey").attr("style",""),Zv(),WM(),i("#metaThemeColor").attr("content",s.bg),tw(o?e:void 0),iv(await Yt("bg"))?i("body").addClass("darkMode"):i("body").removeClass("darkMode")}function tw(e){const t=document.querySelector("footer .right .current-theme"),o=t==null?void 0:t.querySelector(".text"),a=t==null?void 0:t.querySelector(".favIndicator");if(!(t instanceof HTMLElement)||!(o instanceof HTMLElement)||!(a instanceof HTMLElement))return;let s=r.theme;if(je!==null&&(s=je),r.customTheme&&(s="custom"),e!==void 0&&e!==""&&(s=e),s=s.replace(/_/g," "),o.innerText=s,r.customTheme){a.style.display="none";return}a.style.display="";const l=e??je??r.theme;l!==null&&r.favThemes.includes(l)?a.style.display="block":a.style.display="none"}let dr=null;function im(e,t){dr={theme:e,colors:t},zM()}const zM=$t(250,()=>{dr&&(kf=!0,ss(dr.theme,dr.colors,!0))});async function At(e,t=!1){console.debug("Theme controller setting theme",e,t),await ss(e,void 0,t),!t&&r.autoSwitchTheme&&(_b(!1),m("Auto switch theme disabled",0))}async function zr(e=!0){dr=null,kf&&(kf=!1,e&&(je!==null?await ss(je):r.customTheme?await ss("custom"):await ss(r.theme)))}let uo=[];async function ow(){var t,o;const e=hl;r.randomTheme==="fav"&&r.favThemes.length>0?uo=r.favThemes:r.randomTheme==="light"?uo=e.filter(a=>DL(a.bgColor)).map(a=>a.name):r.randomTheme==="dark"?uo=e.filter(a=>iv(a.bgColor)).map(a=>a.name):r.randomTheme==="on"?uo=e.map(a=>a.name):r.randomTheme==="custom"&&x()&&(uo=((o=(t=x())==null?void 0:t.customThemes)==null?void 0:o.map(a=>a._id))??[]),on(uo),qi=0}async function aw(){var t,o,a,s,n;if(uo.length===0&&(await ow(),uo.length===0))return;je=uo[qi],qi++,qi>=uo.length&&(on(uo),qi=0);let e;if(r.randomTheme==="custom"){const l=(o=(t=x())==null?void 0:t.customThemes)==null?void 0:o.find(c=>c._id===je);e=l==null?void 0:l.colors,je="custom"}if(Sa(!1,!0),await ss(je,e),qi>=uo.length){let l=je.replace(/_/g," ");r.randomTheme==="custom"&&(l=(((n=(s=(a=x())==null?void 0:a.customThemes)==null?void 0:s.find(c=>c._id===je))==null?void 0:n.name)??"custom").replace(/_/g," ")),m(l,0)}}async function Su(){je!==null&&(je=null,r.customTheme?await ss("custom"):await ss(r.theme))}function sw(){r.customBackgroundSize==="max"?i(".customBackground img").css({objectFit:""}):i(".customBackground img").css({objectFit:r.customBackgroundSize})}async function mn(){let e=r.customBackground;i(".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']").val(e);const t=await at.getFile("LocalBackgroundFile");if(t!==void 0&&(e=t),i(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden"),e==="")i("#words").removeClass("noErrorBorder"),i("#resultWordsHistory").removeClass("noErrorBorder"),i(".customBackground img").remove();else{i("#words").addClass("noErrorBorder"),i("#resultWordsHistory").addClass("noErrorBorder");const o=document.querySelector(".customBackground"),a=document.createElement("img");a.setAttribute("src",e),a.setAttribute("onError","javascript:this.style.display='none'; window.dispatchEvent(new Event('customBackgroundFailed'))"),a.onload=()=>{i(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden")},o==null||o.replaceChildren(a),$n(),sw()}}async function Hr(){let e=r.fontFamily.replace(/_/g," ");const t=await at.getFile("LocalFontFamilyFile");t===void 0?i(".customFont").empty():(e="LOCALCUSTOM",i(".customFont").html(`
      @font-face{ 
        font-family: LOCALCUSTOM;
        src: url(${t});
        font-weight: 400;
        font-style: normal;
        font-display: block;
      }`)),document.documentElement.style.setProperty("--font",`"${e}", "Roboto Mono", "Vazirmatn", monospace`)}var oy,jl,ay;(ay=(jl=(oy=window.matchMedia)==null?void 0:oy.call(window,"(prefers-color-scheme: dark)"))==null?void 0:jl.addEventListener)==null||ay.call(jl,"change",e=>{!r.autoSwitchTheme||r.customTheme||(e.matches?At(r.themeDark,!0):At(r.themeLight,!0))});let xu=!1;ge(async(e,t,o)=>{var a,s,n;e==="fullConfigChange"&&(xu=!0),e==="fullConfigChangeFinished"&&(xu=!1,await Su(),await zr(!1),r.autoSwitchTheme?(a=window.matchMedia)!=null&&a.call(window,"(prefers-color-scheme: dark)").matches?await At(r.themeDark,!0):await At(r.themeLight,!0):r.customTheme?await At("custom"):await At(r.theme),await mn()),!xu&&(e==="randomTheme"&&ow(),e==="customTheme"&&(t?await At("custom"):await At(r.theme)),e==="customThemeColors"&&(o?im("custom"):await At("custom")),e==="theme"&&(await Su(),await zr(!1),await At(t)),e==="randomTheme"&&t==="off"&&await Su(),e==="customBackground"&&await mn(),e==="customBackgroundSize"&&sw(),e==="autoSwitchTheme"&&(t?(s=window.matchMedia)!=null&&s.call(window,"(prefers-color-scheme: dark)").matches?await At(r.themeDark,!0):await At(r.themeLight,!0):await At(r.theme)),e==="themeLight"&&r.autoSwitchTheme&&!((n=window.matchMedia)!=null&&n.call(window,"(prefers-color-scheme: dark)").matches)&&!o&&await At(r.themeLight,!0),e==="themeDark"&&r.autoSwitchTheme&&window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches&&!o&&await At(r.themeDark,!0),["theme","customTheme","customThemeColors","randomTheme","favThemes"].includes(e)&&tw())});window.addEventListener("customBackgroundFailed",()=>{m("Custom background link is either temporarily unavailable or expired. Please make sure the URL is correct or change it",0,{duration:5})});let H=null,Sf=0;function HM(e){(!js||js&&e>Sf)&&(Sf=e)}async function OM(){var n;if(r.paceCaret==="off"&&!js||(i("#paceCaret").hasClass("hidden")||i("#paceCaret").addClass("hidden"),r.mode==="zen"))return;const e=i("#paceCaret"),t=(n=document==null?void 0:document.querySelector("#words .word"))==null?void 0:n.querySelector("letter"),o=i(t).height();if(t===void 0||o===void 0)return;const s=(await hs(r.language)).rightToLeft;e.stop(!0,!0).animate({top:t.offsetTop-o/4,left:t.offsetLeft+(s?t.offsetWidth:0)},0,"linear")}async function Vc(){var n;i("#paceCaret").addClass("hidden");const e=pi(r,J);let t=0;if(r.paceCaret==="pb"?t=((n=await Cr(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,Pa()))==null?void 0:n.wpm)??0:r.paceCaret==="tagPb"?t=await mx(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode):r.paceCaret==="average"?([t]=await pb(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="daily"?(t=await px(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="custom"?t=r.paceCaretCustomSpeed:(r.paceCaret==="last"||js)&&(t=Sf),t===void 0||t<1||Number.isNaN(t)){H=null;return}const o=t*5,a=o/60,s=60/o;H={wpm:t,cps:a,spc:s,correction:0,currentWordIndex:0,currentLetterIndex:-1,wordsStatus:{},timeout:null},await OM()}async function iw(e){if(!(H===null||!Ae||de)){try{if(H.currentLetterIndex++,H.currentLetterIndex>=I.get(H.currentWordIndex).length&&(H.currentLetterIndex=-1,H.currentWordIndex++),!r.blindMode){if(H.correction<0)for(;H.correction<0;)H.currentLetterIndex--,H.currentLetterIndex<=-2&&(H.currentLetterIndex=I.get(H.currentWordIndex-1).length-1,H.currentWordIndex--),H.correction++;else if(H.correction>0)for(;H.correction>0;)H.currentLetterIndex++,H.currentLetterIndex>=I.get(H.currentWordIndex).length&&(H.currentLetterIndex=-1,H.currentWordIndex++),H.correction--}}catch{H=null,i("#paceCaret").addClass("hidden");return}try{const t=i("#paceCaret");let o,a,s;try{const l=H.currentWordIndex-ut,c=document.querySelectorAll("#words .word")[l];H.currentLetterIndex===-1?o=c.querySelectorAll("letter")[0]:o=c.querySelectorAll("letter")[H.currentLetterIndex];const u=i(o).height(),d=i(o).width(),p=t.width();if(u===void 0||d===void 0||p===void 0)throw new Error("Undefined current letter height, width or caret width.");const g=(await hs(r.language)).rightToLeft;a=c.offsetTop+o.offsetTop-r.fontSize*Gs(1)*.1,H.currentLetterIndex===-1?s=c.offsetLeft+o.offsetLeft-p/2+(g?d:0):s=c.offsetLeft+o.offsetLeft-p/2+(g?0:d),t.removeClass("hidden")}catch{t.addClass("hidden")}const n=e-performance.now();a!==void 0&&(i("#paceCaret").css({top:a-vd}),r.smoothCaret!=="off"?t.stop(!0,!0).animate({left:s},Pe()?0:n,"linear"):t.stop(!0,!0).animate({left:s},0,"linear")),H.timeout=setTimeout(()=>{iw(e+((H==null?void 0:H.spc)??0)*1e3).catch(()=>{H=null})},n)}catch(t){console.error(t),i("#paceCaret").addClass("hidden")}}}function NM(){(H==null?void 0:H.timeout)!==null&&(H==null?void 0:H.timeout)!==void 0&&clearTimeout(H.timeout),H=null}function Zg(e,t){e?H!==null&&H.wordsStatus[Z]===!0&&!r.blindMode&&(H.wordsStatus[Z]=void 0,H.correction-=t.length+1):H!==null&&H.wordsStatus[Z]===void 0&&!r.blindMode&&(H.wordsStatus[Z]=!0,H.correction+=t.length+1)}function UM(){iw(performance.now()+((H==null?void 0:H.spc)??0)*1e3)}function VM(){const e=i("#paceCaret");e.removeClass(["off","default","underline","outline","block","carrot","banana"]),e.addClass(r.paceCaretStyle)}ge(e=>{e==="paceCaret"&&Vc(),e==="paceCaretStyle"&&VM()});ge(e=>{e==="monkey"&&Ae&&(r.monkey?i("#monkey").removeClass("hidden"):i("#monkey").addClass("hidden"))});let fo=!1,po=!1;const mt={left:!1,right:!1,last:"right"},Tu={"00":document.querySelector("#monkey .up"),"01":document.querySelector("#monkey .right"),10:document.querySelector("#monkey .left"),11:document.querySelector("#monkey .both")},Lu={"00":document.querySelector("#monkey .fast .up"),"01":document.querySelector("#monkey .fast .right"),10:document.querySelector("#monkey .fast .left"),11:document.querySelector("#monkey .fast .both")};function Jg(e){return e?"1":"0"}function nw(){var e,t,o;if(r.monkey&&!((e=document.querySelector("#monkey"))!=null&&e.classList.contains("hidden"))){Object.keys(Tu).forEach(s=>{var n;(n=Tu[s])==null||n.classList.add("hidden")}),Object.keys(Lu).forEach(s=>{var n;(n=Lu[s])==null||n.classList.add("hidden")});const a=`${Jg(fo)}${Jg(po)}`;(t=Tu[a])==null||t.classList.remove("hidden"),(o=Lu[a])==null||o.classList.remove("hidden")}}function KM(e){if(!r.monkey)return;const t=wc(e,130,180,0,1);i("#monkey .fast").animate({opacity:t},1e3);let o=wc(e,130,180,.25,.01);o===.25&&(o=0),i("#monkey").css({animationDuration:o+"s"})}function GM(e){if(!r.monkey)return;const{leftSide:t,rightSide:o}=am(e.code);t&&o?mt.last==="left"?po?fo||(fo=!0,mt.last="left",mt.left=!0):(po=!0,mt.last="right",mt.right=!0):fo?po||(po=!0,mt.last="right",mt.right=!0):(fo=!0,mt.last="left",mt.left=!0):(fo=fo||t,po=po||o),nw()}function jM(e){if(!r.monkey)return;const{leftSide:t,rightSide:o}=am(e.code);t&&o?mt.left&&mt.last==="left"?(fo=!1,mt.left=!1):mt.right&&mt.last==="right"?(po=!1,mt.right=!1):(fo=fo&&!mt.left,po=po&&!mt.right):(fo=fo&&!t,po=po&&!o),nw()}function QM(){r.monkey&&i("#monkey").css("opacity",0).removeClass("hidden").animate({opacity:1},125)}function rw(){i("#monkey").css("opacity",1).animate({opacity:1},125,()=>{i("#monkey").addClass("hidden"),i("#monkey .fast").stop(!0,!0).css("opacity",0),i("#monkey").stop(!0,!0).css({animationDuration:"0s"})})}const lw=[];function YM(e){lw.push(e)}function Or(e,t,o){lw.forEach(a=>{try{a(e,t,o)}catch(s){console.error("Timer event subscriber threw an error"),console.error(s)}})}async function nm(){return await bd(()=>import("./vendor.CUQxkLCO.js").then(e=>e.h),__vite__mapDeps([0,1,2]))}let co=null,ti=null,Kc=null;async function XM(){const e=(await nm()).Howl;Kc===null&&(Kc=new e({src:"../sound/timeWarning.wav"}))}async function cw(){const e=(await nm()).Howl;co===null&&(co={1:[{sounds:[new e({src:"../sound/error1/error1_1.wav"}),new e({src:"../sound/error1/error1_1.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/error2/error2_1.wav"}),new e({src:"../sound/error2/error2_1.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/error3/error3_1.wav"}),new e({src:"../sound/error3/error3_1.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/error4/error4_1.wav"}),new e({src:"../sound/error4/error4_1.wav"})],counter:0},{sounds:[new e({src:"../sound/error4/error4_2.wav"}),new e({src:"../sound/error4/error4_2.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function Gd(){const e=(await nm()).Howl;ti===null&&(ti={1:[{sounds:[new e({src:"../sound/click1/click1_1.wav"}),new e({src:"../sound/click1/click1_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_2.wav"}),new e({src:"../sound/click1/click1_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_3.wav"}),new e({src:"../sound/click1/click1_3.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/click2/click2_1.wav"}),new e({src:"../sound/click2/click2_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_2.wav"}),new e({src:"../sound/click2/click2_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_3.wav"}),new e({src:"../sound/click2/click2_3.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/click3/click3_1.wav"}),new e({src:"../sound/click3/click3_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_2.wav"}),new e({src:"../sound/click3/click3_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_3.wav"}),new e({src:"../sound/click3/click3_3.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/click4/click4_1.wav"}),new e({src:"../sound/click4/click4_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_2.wav"}),new e({src:"../sound/click4/click4_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_3.wav"}),new e({src:"../sound/click4/click4_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_4.wav"}),new e({src:"../sound/click4/click4_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_5.wav"}),new e({src:"../sound/click4/click4_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_6.wav"}),new e({src:"../sound/click4/click4_66.wav"})],counter:0}],5:[{sounds:[new e({src:"../sound/click5/click5_1.wav"}),new e({src:"../sound/click5/click5_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_2.wav"}),new e({src:"../sound/click5/click5_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_3.wav"}),new e({src:"../sound/click5/click5_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_4.wav"}),new e({src:"../sound/click5/click5_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_5.wav"}),new e({src:"../sound/click5/click5_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_6.wav"}),new e({src:"../sound/click5/click5_66.wav"})],counter:0}],6:[{sounds:[new e({src:"../sound/click6/click6_1.wav"}),new e({src:"../sound/click6/click6_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_2.wav"}),new e({src:"../sound/click6/click6_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_3.wav"}),new e({src:"../sound/click6/click6_33.wav"})],counter:0}],7:[{sounds:[new e({src:"../sound/click7/click7_1.wav"}),new e({src:"../sound/click7/click7_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_2.wav"}),new e({src:"../sound/click7/click7_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_3.wav"}),new e({src:"../sound/click7/click7_33.wav"})],counter:0}],14:[{sounds:[new e({src:"../sound/click14/click14_1.wav"}),new e({src:"../sound/click14/click14_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_2.wav"}),new e({src:"../sound/click14/click14_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_3.wav"}),new e({src:"../sound/click14/click14_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_4.wav"}),new e({src:"../sound/click14/click14_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_5.wav"}),new e({src:"../sound/click14/click14_5.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_6.wav"}),new e({src:"../sound/click14/click14_6.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_7.wav"}),new e({src:"../sound/click14/click14_7.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_8.wav"}),new e({src:"../sound/click14/click14_8.wav"})],counter:0}],15:[{sounds:[new e({src:"../sound/click15/click15_1.wav"}),new e({src:"../sound/click15/click15_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_2.wav"}),new e({src:"../sound/click15/click15_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_3.wav"}),new e({src:"../sound/click15/click15_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_4.wav"}),new e({src:"../sound/click15/click15_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_5.wav"}),new e({src:"../sound/click15/click15_5.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function ZM(e){var a,s,n,l,c,u;if(["8","9","10","11"].includes(e)){fw("KeyQ",rm[e]);return}if(["12","13"].includes(e)){xf[e].preview();return}ti===null&&await Gd();const t=ti;Object.keys(t).includes(e)&&((n=(s=(a=t==null?void 0:t[e])==null?void 0:a[0])==null?void 0:s.sounds[0])==null||n.seek(0),(u=(c=(l=t==null?void 0:t[e])==null?void 0:l[0])==null?void 0:c.sounds[0])==null||u.play())}async function JM(e){var a,s,n,l,c,u;co===null&&await cw(),Object.keys(co).includes(e)&&((n=(s=(a=co==null?void 0:co[e])==null?void 0:a[0])==null?void 0:s.sounds[0])==null||n.seek(0),(u=(c=(l=co==null?void 0:co[e])==null?void 0:l[0])==null?void 0:c.sounds[0])==null||u.play())}let Un="KeyA";i(document).on("keydown",e=>{Un=e.code||"KeyA"});const se={C:[16.35,32.7,65.41,130.81,261.63,523.25,1046.5,2093,4186.01],Db:[17.32,34.65,69.3,138.59,277.18,554.37,1108.73,2217.46,4434.92],D:[18.35,36.71,73.42,146.83,293.66,587.33,1174.66,2349.32,4698.64],Eb:[19.45,38.89,77.78,155.56,311.13,622.25,1244.51,2489.02,4978.03],E:[20.6,41.2,82.41,164.81,329.63,659.26,1318.51,2637.02],F:[21.83,43.65,87.31,174.61,349.23,698.46,1396.91,2793.83],Gb:[23.12,46.25,92.5,185,369.99,739.99,1479.98,2959.96],G:[24.5,49,98,196,392,783.99,1567.98,3135.96],Ab:[25.96,51.91,103.83,207.65,415.3,830.61,1661.22,3322.44],A:[27.5,55,110,220,440,880,1760,3520],Bb:[29.14,58.27,116.54,233.08,466.16,932.33,1864.66,3729.31],B:[30.87,61.74,123.47,246.94,493.88,987.77,1975.53,3951.07]};function ne(e,t=0){return o=>e[o+t]??0}const Bl={KeyZ:ne(se.C),KeyS:ne(se.Db),KeyX:ne(se.D),KeyD:ne(se.Eb),KeyC:ne(se.E),KeyV:ne(se.F),KeyG:ne(se.Gb),KeyB:ne(se.G),KeyH:ne(se.Ab),KeyN:ne(se.A),KeyJ:ne(se.Bb),KeyM:ne(se.B),Comma:ne(se.C,1),KeyL:ne(se.Db,1),Period:ne(se.D,1),Semicolon:ne(se.Eb,1),Slash:ne(se.E,1),KeyQ:ne(se.C,1),Digit2:ne(se.Db,1),KeyW:ne(se.D,1),Digit3:ne(se.Eb,1),KeyE:ne(se.E,1),KeyR:ne(se.F,1),Digit5:ne(se.Gb,1),KeyT:ne(se.G,1),Digit6:ne(se.Ab,1),KeyY:ne(se.A,1),Digit7:ne(se.Bb,1),KeyU:ne(se.B,1),KeyI:ne(se.C,2),Digit9:ne(se.Db,2),KeyO:ne(se.D,2),Digit0:ne(se.Eb,2),KeyP:ne(se.E,2),BracketLeft:ne(se.F,2),Equal:ne(se.Gb,2),BracketRight:ne(se.G,2)},rm={8:"sine",9:"sawtooth",10:"square",11:"triangle"};let ot;function dw(){if(ot!==null)try{ot=new AudioContext}catch(e){ot=null,console.error(e),m(re(e,"Error initializing audio context")+". Notes will not play.",-1)}}const eh={pentatonic:["C","D","E","G","A"],wholetone:["C","D","E","Gb","Ab","Bb"]};function th(e){const t={octave:4,direction:1};return async()=>{ti===null&&await Gd(),uw(e,t)}}const oh={position:0,octave:4,direction:1},xf={12:{name:"pentatonic",preview:th("pentatonic"),meta:oh},13:{name:"wholetone",preview:th("wholetone"),meta:oh}};function uw(e,t){if(ot===void 0&&dw(),!ot)return;const o=Lt(0,eh[e].length-1);Math.random()<.5&&(t.octave+=t.direction),t.octave>=6&&(t.direction=-1),t.octave<=4&&(t.direction=1);const a=eh[e][o],s=se[a][t.octave],n=ot.createOscillator(),l=ot.createGain();n.type="sine",l.gain.value=r.soundVolume/10,n.connect(l),l.connect(ot.destination),n.frequency.value=s,n.start(ot.currentTime),l.gain.setTargetAtTime(0,ot.currentTime,.3),n.stop(ot.currentTime+2)}async function Gc(){Kc===null&&await XM();const e=Kc;e.stop(),e.seek(0),e.play()}function fw(e,t){var c;if(ot===void 0&&dw(),!ot||(Un=e??Un,!(Un in Bl)))return;const a=3+(ds||us||pn?1:0),s=(c=Bl[Un])==null?void 0:c.call(Bl,a),n=ot.createOscillator(),l=ot.createGain();n.type=t??rm[r.playSoundOnClick],l.gain.value=r.soundVolume/10,n.connect(l),l.connect(ot.destination),n.frequency.value=s,n.start(ot.currentTime),l.gain.setTargetAtTime(0,ot.currentTime,.15),n.stop(ot.currentTime+.5)}async function Ho(e){if(r.playSoundOnClick==="off")return;if(r.playSoundOnClick in xf){const{name:s,meta:n}=xf[r.playSoundOnClick];uw(s,n);return}if(r.playSoundOnClick in rm){fw(e??void 0);return}ti===null&&await Gd();const t=ti[r.playSoundOnClick];if(t===void 0)throw new Error("Invalid click sound ID");const o=Fo(t),a=o.sounds[o.counter];o.counter++,o.counter===2&&(o.counter=0),a.seek(0),a.play()}async function yl(){if(r.playSoundOnError==="off")return;co===null&&await cw();const e=co[r.playSoundOnError];if(e===void 0)throw new Error("Invalid error sound ID");const t=Fo(e),o=t.sounds[t.counter];t.counter++,t.counter===2&&(t.counter=0),o.seek(0),o.play()}function eA(e){try{Howler.volume(e)}catch{}}ge((e,t)=>{e==="playSoundOnClick"&&t!=="off"&&Gd(),e==="soundVolume"&&eA(parseFloat(t))});let qs=0,qo=null;const Fl=1e3;let Rl=0,_e=!1;function tA(){_e=!0}function lm(){IL(0),qo!==null&&clearTimeout(qo)}function oA(){_e&&console.time("premid");const e=document.querySelector("#premidSecondsLeft");e!==null&&(e.innerHTML=(r.time-ul()).toString()),_e&&console.timeEnd("premid")}function aA(){_e&&console.time("timer progress update"),(r.mode==="time"||r.mode==="custom"&&Se()==="time")&&fl(),_e&&console.timeEnd("timer progress update")}function sA(){_e&&console.time("calculate wpm and raw");const e=tm();return _e&&console.timeEnd("calculate wpm and raw"),_e&&console.time("update live wpm"),xL(e.wpm,e.raw),_e&&console.timeEnd("update live wpm"),_e&&console.time("push to history"),Ub(e.wpm),Vb(e.raw),_e&&console.timeEnd("push to history"),e}function iA(e){_e&&console.time("update monkey");const t=r.blindMode?e.raw:e.wpm;KM(t),_e&&console.timeEnd("update monkey")}function nA(){_e&&console.time("calculate acc");const e=U(ml());return _e&&console.timeEnd("calculate acc"),e}function rA(){if(_e&&console.time("layoutfluid"),r.funbox.includes("layoutfluid")&&r.mode==="time"){const e=r.customLayoutfluid,t=r.time/e.length,o=ul(),a=Math.floor(o/t),s=e[a],n=[];for(let l=1;l<e.length;l++)n.push(Math.floor(t*l));n.includes(o+3)?(mv(),bu(3,e[a+1])):n.includes(o+2)?bu(2,e[a+1]):n.includes(o+1)&&bu(1,e[a+1]),r.layout!==s&&s!==void 0&&(lr(),Qa(s,!0),Is(s,!0))}_e&&console.timeEnd("layoutfluid")}function lA(e,t){return _e&&console.time("fail conditions"),Ed(),Id(),_d(),r.minWpm==="custom"&&e.wpm<r.minWpmCustomSpeed&&Z>3?(qo!==null&&clearTimeout(qo),xr(),qs=0,Or("fail","min speed"),!0):r.minAcc==="custom"&&t<r.minAccCustom?(qo!==null&&clearTimeout(qo),xr(),qs=0,Or("fail","min accuracy"),!0):(_e&&console.timeEnd("fail conditions"),!1)}function cA(){_e&&console.time("times up check");let e;if(r.mode==="time"?e=r.time:r.mode==="custom"&&Se()==="time"&&(e=ke()),e!==void 0&&e!==0&&ul()>=e){qo!==null&&clearTimeout(qo),ll(),k.pushHistory(),tt.pushHistory(),xr(),qs=0,Or("finish");return}_e&&console.timeEnd("times up check")}function dA(){_e&&console.time("play timer warning");let e;r.mode==="time"?e=r.time:r.mode==="custom"&&Se()==="time"&&(e=ke()),e!==void 0&&ul()===e-parseInt(r.playTimeWarning,10)&&Gc(),_e&&console.timeEnd("play timer warning")}let Tf=[];function uA(){return Tf}async function fA(){_e&&console.time("timer step -----------------------------"),qL(),oA(),aA(),r.playTimeWarning!=="off"&&dA();const e=sA(),t=nA();iA(e),rA(),lA(e,t)||cA(),_e&&console.timeEnd("timer step -----------------------------")}async function pA(){xr(),qs=0,Tf=[],Rl=Js+Fl,function e(){const t=Rl-performance.now();Tf.push({dateNow:Date.now(),now:performance.now(),expected:Rl,nextDelay:t}),(r.mode==="time"&&r.time<130&&r.time>0||r.mode==="words"&&r.words<250&&r.words>0)&&(t<Fl/2&&Fx(),t<Fl/10&&(qs++,qs>5&&(m('This could be caused by "efficiency mode" on Microsoft Edge.'),m("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.",-1),Or("fail","slow timer")))),qo=setTimeout(function(){if(!Ae){qo!==null&&clearTimeout(qo),xr(),qs=0;return}fA(),Rl+=Fl,e()},t)}()}let cm=[],Go=[],pw=0,dm=!0,Vo=0,xt=0,oi=0,bl=0,jc=[],Lf=[];var sy;const ht=(sy=document.getElementById("playpauseReplayButton"))==null?void 0:sy.children[0];function $f(e){cm=e}function um(){const e=document.getElementById("replayWords");if(e===null)return;e.innerHTML="";let t=0;Go.forEach(o=>{o.action==="backWord"?t--:(o.action==="submitCorrectWord"||o.action==="submitErrorWord")&&t++}),cm.forEach((o,a)=>{if(a>t)return;const s=document.createElement("div");s.className="word";for(const n of o){const l=document.createElement("letter");l.innerHTML=n,s.appendChild(l)}e.appendChild(s)})}function vl(){var e;jc.forEach(t=>{clearTimeout(t)}),jc=[],Lf.forEach(t=>{clearTimeout(t)}),Lf=[],bl=xt,oi=Vo,ht!==void 0&&(ht.className="fas fa-play",(e=ht.parentNode)==null||e.setAttribute("aria-label","Resume replay"))}function xi(e=!1){e&&r.playSoundOnError!=="off"?yl():Ho()}function mw(e,t=!1){var a,s,n,l;let o=(a=document.getElementById("replayWords"))==null?void 0:a.children[Vo];if(o!==void 0){if(e.action==="correctLetter")t||xi(),(s=o.children[xt])==null||s.classList.add("correct"),xt++;else if(e.action==="incorrectLetter"){t||xi(!0);let c;xt>=o.children.length&&(c=document.createElement("letter"),c==null||c.classList.add("extra"),c.innerHTML=((n=e.value)==null?void 0:n.toString())??"",o.appendChild(c)),c=o.children[xt],c==null||c.classList.add("incorrect"),xt++}else if(e.action==="setLetterIndex"&&typeof e.value=="number"){t||xi(),xt=e.value;for(const c of[...o.children].slice(xt))c!=null&&c.classList.contains("extra")?c.remove():c.className=""}else if(e.action==="submitCorrectWord")t||xi(),Vo++,xt=0;else if(e.action==="submitErrorWord")t||xi(!0),o==null||o.classList.add("error"),Vo++,xt=0;else if(e.action==="backWord"){t||xi(),Vo--;const c=document.getElementById("replayWords");for(c!==null&&(o=c.children[Vo]),xt=o.children.length;((l=o.children[xt-1])==null?void 0:l.className)==="";)xt--;o==null||o.classList.remove("error")}}}function fm(){var a;let e=0;xt=0,Vo=0,Go.forEach((s,n)=>{(Vo<oi||Vo===oi&&xt<bl)&&(mw(s,!0),e=n+1)});const t=(a=Go[e])==null?void 0:a.time;if(t===void 0)throw new Error("Failed to load old replay: datatime is undefined");const o=Math.floor(t/1e3);return hw(o),e}function gw(){var e;i("#resultReplay").stop(!0,!0).hasClass("hidden")?(um(),fm(),i("#watchReplayButton").hasClass("loaded")?i("#resultReplay").removeClass("hidden").css("display","none").slideDown(250):(i("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),i("#resultReplay").removeClass("hidden").css("display","none").slideDown(250))):(((e=ht==null?void 0:ht.parentNode)==null?void 0:e.getAttribute("aria-label"))!=="Start replay"&&vl(),i("#resultReplay").slideUp(250,()=>{i("#resultReplay").addClass("hidden")}))}function mA(){i("#resultReplay").stop(!0,!0).hasClass("hidden")||gw(),i("#replayStats").text(""),Go=[],pw=performance.now(),dm=!0,bl=0,oi=0}function pm(){dm=!1}function Os(e,t){if(!dm)return;const o=performance.now()-pw;Go.push({action:e,value:t,time:o})}function hw(e){const o=`${La[e-1]??0}wpm	${e}s`;i("#replayStats").text(o)}function gA(){var s,n;if(xt=0,Vo=0,ht===void 0)return;ht.className="fas fa-pause",(s=ht.parentNode)==null||s.setAttribute("aria-label","Pause replay"),um();const e=fm(),t=(n=Go[e])==null?void 0:n.time;if(t===void 0)throw new Error("Failed to play replay: lastTime is undefined");let o=Math.round(t/1e3);const a=Math.round(Vs(Go).time/1e3);for(;o<=a;){const l=o;Lf.push(setTimeout(()=>{hw(l)},l*1e3-t)),o++}Go.forEach((l,c)=>{c<e||jc.push(setTimeout(()=>{mw(l)},l.time-t))}),jc.push(setTimeout(()=>{bl=0,oi=0,ht.className="fas fa-play",ht.parentNode.setAttribute("aria-label","Start replay")},Vs(Go).time-t))}function hA(){return JSON.stringify({replayData:Go,wordsList:cm})}i(".pageTest #playpauseReplayButton").on("click",()=>{(ht==null?void 0:ht.className)==="fas fa-play"?gA():(ht==null?void 0:ht.className)==="fas fa-pause"&&vl()});i("#replayWords").on("click","letter",e=>{vl();const t=document.querySelector("#replayWords"),o=[...(t==null?void 0:t.children)??[]];oi=o.indexOf(e.target.parentNode),bl=[...o[oi].children].indexOf(e.target),um(),fm()});i(".pageTest").on("click","#watchReplayButton",()=>{gw()});let Nr=0,mm=!1,yw;function yA(e){if(mm&&new Date().getDate()>yw){Nr=e;return}Nr+=e}function bA(){return ft(Math.round(Nr),!0,!0)+(mm?" today":" session")}function vA(){const e=new Date;e.setSeconds(0),e.setMinutes(0),e.setHours(0),e.setMilliseconds(0),yw=e.getDate();const t=e.getTime();Nr=0;const o=x();if(!o)return;const a=o.results;a==null||a.forEach(s=>{const n=new Date(s.timestamp);n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setMilliseconds(0),n.getTime()>=t&&(Nr+=s.testDuration+s.incompleteTestSeconds-s.afkDuration)}),mm=!0}let Mf=!1;function bw(){zt&&!Mf&&!Vt&&(m("Challenge cleared",0),rb(null))}function wA(e,t,o){var l;let a=!0,s=[];const n=e.afkDuration/e.testDuration*100;if(t[o]===void 0)throw new Error("Requirement value is undefined");if(o==="wpm"&&t.wpm){const c=t.wpm;"exact"in c?Math.round(e.wpm)!==c.exact&&(a=!1,s.push(`WPM not ${c.exact}`)):"min"in c&&e.wpm<c.min&&(a=!1,s.push(`WPM below ${c.min}`))}else if(o==="acc"&&t.acc){const c=t.acc;"exact"in c?e.acc!==c.exact&&(a=!1,s.push(`Accuracy not ${c.exact}`)):"min"in c&&e.acc<c.min&&(a=!1,s.push(`Accuracy below ${c.min}`))}else if(o==="afk"&&t.afk){const c=t.afk;c.max&&Math.round(n)>c.max&&(a=!1,s.push(`AFK percentage above ${c.max}`))}else if(o==="time"&&t.time){const c=t.time;c.min&&Math.round(e.testDuration)<c.min&&(a=!1,s.push(`Test time below ${c.min}`))}else if(o==="funbox"&&t.funbox){const c=t.funbox.exact;if(c===void 0)throw new Error("Funbox mode is undefined");if(!ps(c,e.funbox)){a=!1;for(const u of c)(l=e.funbox)!=null&&l.includes(u)||s.push(`${u} funbox not active`);if(e.funbox!==void 0&&e.funbox.length>0)for(const u of e.funbox)c.includes(u)||s.push(`${u} funbox active`)}}else if(o==="raw"&&t.raw){const c=t.raw;c.exact&&Math.round(e.rawWpm)!==c.exact&&(a=!1,s.push(`Raw WPM not ${c.exact}`))}else if(o==="con"&&t.con){const c=t.con;c.exact&&Math.round(e.consistency)!==c.exact&&(a=!1,s.push(`Consistency not ${c.exact}`))}else if(o==="config"&&t.config){const c=t.config;for(const u of vt(c)){const d=c[u];r[u]!==d&&(a=!1,s.push(`${u} not set to ${d}`))}}return[a,s]}function CA(e){if(!zt)return null;try{if(e.afkDuration/e.testDuration*100>10)return m("Challenge failed: AFK time is greater than 10%",0),null;if(zt.requirements===void 0)return m(`${zt.display} challenge passed!`,1),zt.name;{let o=!0;const a=[];for(const s of vt(zt.requirements)){const[n,l]=wA(e,zt.requirements,s);n||(o=!1),a.push(...l)}return o?(zt.autoRole&&m("You will receive a role shortly. Please don't post a screenshot in challenge submissions.",1,{duration:5}),m(`${zt.display} challenge passed!`,1),zt.name):(m(`${zt.display} challenge failed: ${a.join(", ")}`,0),null)}}catch(t){return console.error(t),m(`Something went wrong when verifying challenge: ${t.message}`,0),null}}async function vw(e){Mf=!0,Xa([]);const{data:t,error:o}=await eo(Rb());if(o){const n=re(o,"Failed to setup challenge");return m(n,-1),oe(),setTimeout(()=>{i("header .config").removeClass("hidden"),i(".page.pageTest").removeClass("hidden")},250),!1}const a=t.find(n=>n.name.toLowerCase()===e.toLowerCase());let s;try{if(a===void 0)return m("Challenge not found",0),oe(),setTimeout(()=>{i("header .config").removeClass("hidden"),i(".page.pageTest").removeClass("hidden")},250),!1;if(a.type==="customTime")wa(a.parameters[0],!0),gt("time",!0),ca("normal",!0),a.name==="englishMaster"&&(rn("english_10k",!0),ka(!0,!0),ls(!0,!0));else if(a.type==="customWords")Qs(a.parameters[0],!0),gt("words",!0),ca("normal",!0);else if(a.type==="customText")_a(a.parameters[0].split(" ")),cn(a.parameters[1]),Ko(a.parameters[2]),_o(a.parameters[3]),Xs(a.parameters[4]),gt("custom",!0),ca("normal",!0);else if(a.type==="script"){te();const n=await fetch("/challenges/"+a.parameters[0]);if(V(),n.status!==200)throw new Error(`${n.status} ${n.statusText}`);let c=(await n.text()).trim();c=c.replace(/[\n\r\t ]/gm," "),c=c.replace(/ +/gm," "),_a(c.split(" ")),cn("repeat"),_o("word"),Xs(!1),gt("custom",!0),ca("normal",!0),a.parameters[1]!==null&&$p(a.parameters[1]),a.parameters[2]!==null&&Nv(a.parameters[2])}else a.type==="accuracy"?(wa(0,!0),gt("time",!0),ca("master",!0)):a.type==="funbox"?(Xa(a.parameters[0],!0),ca("normal",!0),a.parameters[1]==="words"?Qs(a.parameters[2],!0):a.parameters[1]==="time"&&wa(a.parameters[2],!0),gt(a.parameters[1],!0),a.parameters[3]!==void 0&&ca(a.parameters[3],!0)):a.type==="special"&&a.name==="semimak"&&(gt("time",!0),wa(120,!0),rn("english_10k",!0),ls(!0,!0),Ab("word",!0),Qa("semimak",!0),Is("overrideSync",!0),xo("static",!0));return oe(),s=a.message,i("header .config").removeClass("hidden"),i(".page.pageTest").removeClass("hidden"),m(s===void 0?`Challenge '${a.display}' loaded.`:"Challenge loaded. "+s,0),rb(a),Mf=!1,!0}catch(n){return m(re(n,"Failed to load challenge"),-1),!1}}ge(e=>{["difficulty","numbers","punctuation","mode","funbox","paceCaret","showAllLines","showLiveWpm","highlightMode","time","words","keymapMode","keymapLayout","layout"].includes(e)&&bw()});const jd=new Map;function oo(e,t=!0){const o=document.getElementById(e)??void 0;if(o===void 0)throw new Error(`Element with id ${e} not found`);jd.set(e,o),t&&Bt(e)}function Bt(e){const t=jd.get(e);t?t.remove():oo(e,!0)}const kA={popups:document.getElementById("popups"),main:document.querySelector("main")};function to(e,t){const o=jd.get(e);kA[t].append(o)}function SA(e){return jd.has(e)}const Dl=125,Wl=.75;class le{constructor(t){var s,n;this.open=!1,this.setupRan=!1,t.dialogId.startsWith("#")&&(t.dialogId=t.dialogId.slice(1)),this.skeletonAppendParent=t.appendTo??"popups",SA(t.dialogId)&&to(t.dialogId,this.skeletonAppendParent);const o=document.getElementById(t.dialogId),a=document.querySelector(`#${t.dialogId} > .modal`);if(o===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(!(o instanceof HTMLDialogElement))throw new Error("Animated dialog must be an HTMLDialogElement");if(o===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(a===null)throw new Error(`Div element inside #${t.dialogId} with class 'modal' not found`);this.dialogId=t.dialogId,this.wrapperEl=o,this.modalEl=a,this.customShowAnimations=(s=t.customAnimations)==null?void 0:s.show,this.customHideAnimations=(n=t.customAnimations)==null?void 0:n.hide,this.previousModalInChain=void 0,this.showOptionsWhenInChain=t.showOptionsWhenInChain,this.customEscapeHandler=t==null?void 0:t.customEscapeHandler,this.customWrapperClickHandler=t==null?void 0:t.customWrapperClickHandler,this.setup=t==null?void 0:t.setup,this.cleanup=t==null?void 0:t.cleanup,oo(this.dialogId)}getPreviousModalInChain(){return this.previousModalInChain}async runSetup(){this.wrapperEl.addEventListener("keydown",async t=>{var o;t.key==="Escape"&&Xt(this.dialogId)&&(t.preventDefault(),t.stopPropagation(),this.customEscapeHandler!==void 0?(this.customEscapeHandler(t),(o=this.cleanup)==null||o.call(this)):await this.hide())}),this.wrapperEl.addEventListener("mousedown",async t=>{var o;t.target===this.wrapperEl&&(this.customWrapperClickHandler!==void 0?(this.customWrapperClickHandler(t),(o=this.cleanup)==null||o.call(this)):await this.hide())}),this.setup!==void 0&&await this.setup(this.modalEl)}getDialogId(){return this.dialogId}getWrapper(){return this.wrapperEl}getModal(){return this.modalEl}isOpen(){return this.open}focusFirstInput(t){const a=[...this.modalEl.querySelectorAll("input")].find(s=>!s.classList.contains("hidden"));a!=null?t===!0?a.focus():t==="focusAndSelect"?(a.focus(),a.select()):this.wrapperEl.focus():this.wrapperEl.focus()}async show(t){return new Promise(async o=>{var u,d,p,f,g,h,y,v,w,$,S,T,q;if(this.open){o();return}if(to(this.dialogId,this.skeletonAppendParent),this.setupRan||(await this.runSetup(),this.setupRan=!0),Xt(this.dialogId)){o();return}const a=fe((((d=(u=t==null?void 0:t.customAnimation)==null?void 0:u.modal)==null?void 0:d.durationMs)??(t==null?void 0:t.animationDurationMs)??((f=(p=this.customShowAnimations)==null?void 0:p.modal)==null?void 0:f.durationMs)??Dl)*((t==null?void 0:t.modalChain)!==void 0?Wl:1));(t==null?void 0:t.modalChain)!==void 0&&(this.previousModalInChain=t.modalChain,await this.previousModalInChain.hide({animationMode:"modalOnly",animationDurationMs:a,dontShowPreviousModalInchain:t.modalChain.previousModalInChain!==void 0})),this.open=!0,(t==null?void 0:t.mode)==="dialog"?this.wrapperEl.show():((t==null?void 0:t.mode)==="modal"||(t==null?void 0:t.mode)===void 0)&&this.wrapperEl.showModal(),await((g=t==null?void 0:t.beforeAnimation)==null?void 0:g.call(t,this.modalEl,t==null?void 0:t.modalChainData)),setTimeout(async()=>{this.focusFirstInput(t==null?void 0:t.focusFirstInput)},1);const s=((h=t==null?void 0:t.customAnimation)==null?void 0:h.modal)??((y=this.customShowAnimations)==null?void 0:y.modal),n=((v=t==null?void 0:t.customAnimation)==null?void 0:v.wrapper)??((w=this.customShowAnimations)==null?void 0:w.wrapper)??{from:{opacity:"0"},to:{opacity:"1"},easing:"swing"},l=fe(((S=($=t==null?void 0:t.customAnimation)==null?void 0:$.wrapper)==null?void 0:S.durationMs)??((q=(T=this.customShowAnimations)==null?void 0:T.wrapper)==null?void 0:q.durationMs)??Dl),c=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";i(this.modalEl).stop(!0,!1),i(this.wrapperEl).stop(!0,!1),c==="both"||c==="none"?(s!=null&&s.from?(i(this.modalEl).css(s.from),i(this.modalEl).animate(s.to,c==="none"?0:a,s.easing??"swing")):i(this.modalEl).css("opacity","1"),i(this.wrapperEl).css(n.from),i(this.wrapperEl).removeClass("hidden").css("opacity","0").animate(n.to??{opacity:1},c==="none"?0:l,n.easing??"swing",async()=>{var _;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await((_=t==null?void 0:t.afterAnimation)==null?void 0:_.call(t,this.modalEl,t==null?void 0:t.modalChainData)),o()})):c==="modalOnly"&&(i(this.wrapperEl).removeClass("hidden").css("opacity","1"),s!=null&&s.from?i(this.modalEl).css(s.from):i(this.modalEl).css("opacity","0"),i(this.modalEl).animate((s==null?void 0:s.to)??{opacity:1},a,(s==null?void 0:s.easing)??"swing",async()=>{var _;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await((_=t==null?void 0:t.afterAnimation)==null?void 0:_.call(t,this.modalEl,t==null?void 0:t.modalChainData)),o()}))})}async hide(t){return new Promise(async o=>{var u,d,p,f,g,h,y,v,w,$,S,T,q;if(!Xt(this.dialogId)){o();return}t!=null&&t.clearModalChain&&(this.previousModalInChain=void 0),await((u=t==null?void 0:t.beforeAnimation)==null?void 0:u.call(t,this.modalEl));const a=((d=t==null?void 0:t.customAnimation)==null?void 0:d.modal)??((p=this.customHideAnimations)==null?void 0:p.modal),s=fe((((g=(f=t==null?void 0:t.customAnimation)==null?void 0:f.modal)==null?void 0:g.durationMs)??(t==null?void 0:t.animationDurationMs)??((y=(h=this.customHideAnimations)==null?void 0:h.modal)==null?void 0:y.durationMs)??Dl)*(this.previousModalInChain!==void 0?Wl:1)),n=((v=t==null?void 0:t.customAnimation)==null?void 0:v.wrapper)??((w=this.customHideAnimations)==null?void 0:w.wrapper)??{from:{opacity:"1"},to:{opacity:"0"},easing:"swing"},l=fe(((S=($=t==null?void 0:t.customAnimation)==null?void 0:$.wrapper)==null?void 0:S.durationMs)??((q=(T=this.customHideAnimations)==null?void 0:T.wrapper)==null?void 0:q.durationMs)??Dl),c=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";i(this.modalEl).stop(!0,!1),i(this.wrapperEl).stop(!0,!1),c==="both"||c==="none"?(a!=null&&a.from?(i(this.modalEl).css(a.from),i(this.modalEl).animate(a.to,c==="none"?0:s,a.easing??"swing")):i(this.modalEl).css("opacity","1"),i(this.wrapperEl).css(n.from),i(this.wrapperEl).css("opacity","1").animate((n==null?void 0:n.to)??{opacity:0},c==="none"?0:l,(n==null?void 0:n.easing)??"swing",async()=>{var _,N;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),Bt(this.dialogId),this.open=!1,await((_=t==null?void 0:t.afterAnimation)==null?void 0:_.call(t,this.modalEl)),(N=this.cleanup)==null||N.call(this),this.previousModalInChain!==void 0&&!(t!=null&&t.dontShowPreviousModalInchain)&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t==null?void 0:t.modalChainData,animationDurationMs:s*Wl,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),o()})):c==="modalOnly"&&(i(this.wrapperEl).removeClass("hidden").css("opacity","1"),a!=null&&a.from?i(this.modalEl).css(a.from):i(this.modalEl).css("opacity","1"),i(this.modalEl).animate((a==null?void 0:a.to)??{opacity:0},s,(a==null?void 0:a.easing)??"swing",async()=>{var _,N;this.wrapperEl.close(),i(this.wrapperEl).addClass("hidden").css("opacity","0"),Bt(this.dialogId),this.open=!1,await((_=t==null?void 0:t.afterAnimation)==null?void 0:_.call(t,this.modalEl)),(N=this.cleanup)==null||N.call(this),this.previousModalInChain!==void 0&&!(t!=null&&t.dontShowPreviousModalInchain)&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t==null?void 0:t.modalChainData,animationDurationMs:s*Wl,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),o()}))})}destroy(){var t;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),(t=this.cleanup)==null||t.call(this),Bt(this.dialogId),this.open=!1}}let To=0,ce=null,Ce=null;function xA(){ce=null}function TA(){i("#quoteRateModal .quote .text").text("-"),i("#quoteRateModal .quote .source .val").text("-"),i("#quoteRateModal .quote .id .val").text("-"),i("#quoteRateModal .quote .length .val").text("-"),i("#quoteRateModal .ratingCount .val").text("-"),i("#quoteRateModal .ratingAverage .val").text("-")}function ww(e){return be(e.ratings)&&be(e.totalRating)&&e.ratings>0&&e.totalRating>0?Math.round(e.totalRating/e.ratings*10)/10:0}async function Cw(e){if(!e)return;Ce=e;const t=await E.quotes.getRating({query:{quoteId:Ce.id,language:Ce.language}});if(V(),t.status!==200){m("Failed to get quote ratings: "+t.body.message,-1);return}return t.body.data===null?{}:(ce=t.body.data,ce!==void 0&&ce.average===void 0&&(ce.average=ww(ce)),ce)}function nc(e){const t=e??To;i("#quoteRateModal .star").removeClass("active");for(let o=1;o<=t;o++)i(`#quoteRateModal .star[data-rating=${o}]`).addClass("active")}async function LA(){var e;ce||await Cw(),i("#quoteRateModal .ratingCount .val").text((ce==null?void 0:ce.ratings)??"0"),i("#quoteRateModal .ratingAverage .val").text(((e=ce==null?void 0:ce.average)==null?void 0:e.toFixed(1))??"-")}function $A(){if(!Ce)return;let e;Ce.group===0?e="short":Ce.group===1?e="medium":Ce.group===2?e="long":Ce.group===3&&(e="thicc"),i("#quoteRateModal .quote .text").text(Ce.text),i("#quoteRateModal .quote .source .val").text(Ce.source),i("#quoteRateModal .quote .id .val").text(Ce.id),i("#quoteRateModal .quote .length .val").text(e),LA()}function MA(e,t){kw.show({...t,beforeAnimation:async()=>{var s,n;TA(),Ce=e,To=0;const o=x(),a=(n=(s=o==null?void 0:o.quoteRatings)==null?void 0:s[Ce.language])==null?void 0:n[Ce.id];be(a)&&(To=a),nc(),$A()}})}function AA(e=!1){kw.hide({clearModalChain:e})}async function EA(){var s,n;if(To===0){m("Please select a rating");return}if(!Ce)return;AA(!0);const e=await E.quotes.addRating({body:{quoteId:Ce.id,language:Ce.language,rating:To}});if(V(),e.status!==200){m("Failed to submit quote rating: "+e.body.message,-1);return}const t=x();if(!t)return;const o=t.quoteRatings??{},a=(o==null?void 0:o[Ce.language])??{};if(be(a==null?void 0:a[Ce.id])){const l=(s=o[Ce.language])==null?void 0:s[Ce.id],c=To-l;a[Ce.id]=To,ce={ratings:ce==null?void 0:ce.ratings,totalRating:isNaN(ce==null?void 0:ce.totalRating)?0:(ce==null?void 0:ce.totalRating)+c,quoteId:Ce.id,language:Ce.language},m("Rating updated",1)}else a[Ce.id]=To,be(ce==null?void 0:ce.ratings)&&be(ce.totalRating)?(ce.ratings++,ce.totalRating+=To):ce={ratings:1,totalRating:To,quoteId:Ce.id,language:Ce.language},m("Rating submitted",1);t.quoteRatings=o,st(t),ce.average=ww(ce),i(".pageTest #result #rateQuoteButton .rating").text((n=ce.average)==null?void 0:n.toFixed(1)),i(".pageTest #result #rateQuoteButton .icon").removeClass("far"),i(".pageTest #result #rateQuoteButton .icon").addClass("fas")}async function _A(e){var o;(o=e.querySelector(".submitButton"))==null||o.addEventListener("click",()=>{EA()});const t=e.querySelectorAll(".stars button.star");for(const a of t)a.addEventListener("click",s=>{To=parseInt(s.currentTarget.getAttribute("data-rating")),nc()}),a.addEventListener("mouseenter",s=>{const n=parseInt(s.currentTarget.getAttribute("data-rating"));nc(n)}),a.addEventListener("mouseleave",()=>{nc()})}const kw=new le({dialogId:"quoteRateModal",setup:_A}),IA=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"}],qA=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"}],BA=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"},{type:"leaderboard_btf",selectorId:"ad-footer-wrapper"},{type:"med_rect_btf",selectorId:"ad-footer-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-3-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-3-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-2-small-wrapper"}];let Qd=!1;function FA(){const e="1024888",t="74058";window.ramp={que:[],passiveMode:!0,forcePath:"320x50-test",onReady:()=>{Qd=!0,Yd()}};const o=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("async",!0),a.src=`//cdn.intergient.com/${e}/${t}/ramp.js`,o.appendChild(a),window._pwGA4PageviewId="".concat(Date.now()),window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-KETCPNHRJF",{send_page_view:!1}),gtag("event","ramp_js",{send_to:"G-KETCPNHRJF",pageview_id:window._pwGA4PageviewId})}function Sw(){let e;r.ads==="result"?e=IA:r.ads==="on"?e=qA:r.ads==="sellout"&&(e=BA);const t=[];for(const o of e){const a=document.querySelector(`#${o.selectorId}`);a&&window.getComputedStyle(a).display!=="none"&&a.offsetParent!==null&&t.push(o)}return t}async function Yd(){if(Qd){if(ee()==="test"&&!de){ramp.destroyUnits("all");return}await ramp.destroyUnits("all"),await ramp.addUnits(Sw()),await ramp.displayUnits()}}async function RA(){}function DA(){Qd&&ramp.destroyUnits("all")}async function WA(){if(!Qd)return;const e=Sw();await ramp.addUnits(e),await ramp.displayUnits()}const PA=900;let Pl=!0;const zA=1330;let zl=!0,wl=!1,Xd,Ur;function xw(){FA(),setInterval(()=>{Ae||RA()},6e4),wl=!0}function HA(){Af(),Tw(),OA()}function Af(){i("#ad-footer-wrapper").remove(),i("#ad-footer-small-wrapper").remove(),i("#ad-about-1-wrapper").remove(),i("#ad-about-1-small-wrapper").remove(),i("#ad-about-2-wrapper").remove(),i("#ad-about-2-small-wrapper").remove(),i("#ad-settings-1-wrapper").remove(),i("#ad-settings-1-small-wrapper").remove(),i("#ad-settings-2-wrapper").remove(),i("#ad-settings-2-small-wrapper").remove(),i("#ad-settings-3-wrapper").remove(),i("#ad-settings-3-small-wrapper").remove(),i("#ad-account-1-wrapper").remove(),i("#ad-account-1-small-wrapper").remove(),i("#ad-account-2-wrapper").remove(),i("#ad-account-2-small-wrapper").remove()}function Tw(){i("#ad-vertical-right-wrapper").remove(),i("#ad-vertical-left-wrapper").remove()}function OA(){i("#ad-result-wrapper").remove(),i("#ad-result-small-wrapper").remove()}function NA(){}function Lw(e=!1){const t=Pl;window.innerWidth>PA?Pl=!0:Pl=!1,!e&&(r.ads==="off"||!wl||t!==Pl&&Yd())}function $w(e=!1){const t=zl;window.innerWidth>zA?zl=!0:zl=!1,!e&&(r.ads==="off"||!wl||t!==zl&&Yd())}async function gm(){return new Promise(e=>{window.ramp===void 0&&(Xd=!0),e()})}async function hm(){return new Promise(e=>{if(Ur===void 0){Ur=!1,e();return}e()})}async function UA(){return r.ads==="off"?!1:wl?(await gm(),await hm(),Xd||Ur?!1:Yd()):(xw(),!0)}async function VA(){if(r.ads!=="off"){if(wl||xw(),await gm(),await hm(),Xd){i("#ad-result-wrapper .iconAndText .text").html(`
    Using an ad blocker? No worries
    <div class="smalltext">
      We understand ads can be annoying
      <br />
      You can
      <i>disable all ads</i>
      in the settings
    </div>
    `);return}if(Ur){i("#ad-result-wrapper .iconAndText .text").html(`
    Ads not working? Ooops
    <div class="smalltext">
      You may have a cookie popup blocker enabled - ads will not show without your consent
      <br />
      You can also 
      <i>disable all ads</i>
      in the settings if you wish
    </div>
    `);return}WA()}}function Qc(e){e?(i("#ad-vertical-left-wrapper").removeClass("testPage"),i("#ad-vertical-right-wrapper").removeClass("testPage"),i("#ad-footer-wrapper").removeClass("testPage"),i("#ad-footer-small-wrapper").removeClass("testPage")):(i("#ad-vertical-left-wrapper").addClass("testPage"),i("#ad-vertical-right-wrapper").addClass("testPage"),i("#ad-footer-wrapper").addClass("testPage"),i("#ad-footer-small-wrapper").addClass("testPage"))}function KA(){ramp.showCmpModal()}function GA(){DA()}const jA=$t(500,NA),QA=$t(500,Lw),YA=$t(500,$w);i(window).on("resize",()=>{jA(),QA(),YA()});ge((e,t)=>{e==="ads"&&(t==="off"?HA():t==="result"?(Af(),Tw()):t==="on"&&Af())});M1(()=>{});i(()=>{Lw(!0),$w()});window.onerror=function(e){};const $u={quotes:[],length:0,language:null,groups:[]};class XA{constructor(){this.quoteCollection=$u,this.quoteQueue=[],this.queueIndex=0}async getQuotes(t,o){var s,n;const a=No(t);if(this.quoteCollection.language!==a){const{data:l,error:c}=await eo(gs(`quotes/${a}.json`));if(c){if(c instanceof Error&&((s=c==null?void 0:c.message)!=null&&s.includes("404")||(n=c==null?void 0:c.message)!=null&&n.includes("Content is not JSON")))return $u;throw c}if(l.quotes===void 0||l.quotes.length===0)return $u;this.quoteCollection={quotes:[],length:l.quotes.length,groups:[],language:l.language},l.quotes.forEach(u=>{const d={text:u.text,britishText:u.britishText,source:u.source,length:u.length,id:u.id,language:l.language,group:0};this.quoteCollection.quotes.push(d)}),l.groups.forEach((u,d)=>{const p=u[0],f=u[1];this.quoteCollection.groups[d]=this.quoteCollection.quotes.filter(g=>g.length>=p&&g.length<=f?(g.group=d,!0):!1)}),o!==void 0&&this.updateQuoteQueue(o)}return this.quoteCollection}getQuoteById(t){return this.quoteCollection.quotes.find(a=>a.id===t)}updateQuoteQueue(t){this.quoteQueue=[],t.forEach(o=>{var a;o<0||(a=this.quoteCollection.groups[o])==null||a.forEach(s=>{this.quoteQueue.push(s)})}),on(this.quoteQueue),this.queueIndex=0}getRandomQuote(){if(this.quoteQueue.length===0)return null;this.queueIndex>=this.quoteQueue.length&&(this.queueIndex=0,on(this.quoteQueue));const t=this.quoteQueue[this.queueIndex];return this.queueIndex+=1,t}getRandomFavoriteQuote(t){const o=x();if(!o)return null;const a=No(t),s=[],{favoriteQuotes:n}=o;if(n===void 0||(Object.keys(n).forEach(u=>{No(u)===a&&s.push(...n[u]??[])}),s.length===0))return null;const l=Fo(s);return this.getQuoteById(parseInt(l,10))??null}isQuoteFavorite({language:t,id:o}){const a=x();if(!a)return!1;const{favoriteQuotes:s}=a;if(s===void 0)return!1;const n=No(t);return Object.keys(s).find(c=>n!==No(c)?!1:(s[c]??[]).includes(o.toString()))!==void 0}async setQuoteFavorite(t,o){var s,n,l,c,u;const a=x();if(!a)throw new Error("Snapshot is not available");if(o){const d=await E.users.addQuoteToFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(d.status===200)a.favoriteQuotes===void 0&&(a.favoriteQuotes={}),a.favoriteQuotes[t.language]||(a.favoriteQuotes[t.language]=[]),(u=a.favoriteQuotes[t.language])==null||u.push(`${t.id}`);else throw new Error(d.body.message)}else{const d=await E.users.removeQuoteFromFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(d.status===200){const p=(n=(s=a.favoriteQuotes)==null?void 0:s[t.language])==null?void 0:n.indexOf(`${t.id}`);(c=(l=a.favoriteQuotes)==null?void 0:l[t.language])==null||c.splice(p,1)}else throw new Error(d.body.message)}}}const yt=new XA;ge((e,t)=>{e==="quoteLength"&&yt.updateQuoteQueue(t)});let Mw=!1;function ah(){return Mw}function ZA(){Mw=!0,console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)"),console.log("To disable Glarses Mode refresh the page.")}function JA(){Ef=!1,i("#result .stats .wpm .crown").css("opacity",0).addClass("hidden")}let Ef=!1,Aw="normal";function e2(){return Aw}function Ew(){if(Ef)return;Ef=!0,i("#result .stats .wpm .crown").removeClass("hidden").css("opacity","0").animate({opacity:1},fe(250),"easeOutCubic")}function _w(e){Aw=e;const t=i("#result .stats .wpm .crown");t.removeClass("ineligible"),t.removeClass("pending"),t.removeClass("error"),t.removeClass("warning"),t.addClass(e)}function t2(){i("#testConfig").removeClass("invisible"),i("#mobileTestConfigButton").removeClass("invisible")}function o2(){i("#testConfig").addClass("invisible"),i("#mobileTestConfigButton").addClass("invisible")}async function Iw(){i("#testConfig .mode .textButton").removeClass("active"),i("#testConfig .mode .textButton[mode='"+r.mode+"']").addClass("active"),i("#testConfig .puncAndNum").addClass("hidden"),i("#testConfig .spacer").css("transition","none").addClass("scrolled"),i("#testConfig .time").addClass("hidden"),i("#testConfig .wordCount").addClass("hidden"),i("#testConfig .customText").addClass("hidden"),i("#testConfig .quoteLength").addClass("hidden"),i("#testConfig .zen").addClass("hidden"),r.mode==="time"?(i("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),i("#testConfig .leftSpacer").removeClass("scrolled"),i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .time").removeClass("hidden"),Ga("time",r.time)):r.mode==="words"?(i("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),i("#testConfig .leftSpacer").removeClass("scrolled"),i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .wordCount").removeClass("hidden"),Ga("words",r.words)):r.mode==="quote"?(i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .quoteLength").removeClass("hidden"),Ga("quoteLength",r.quoteLength)):r.mode==="custom"&&(i("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),i("#testConfig .leftSpacer").removeClass("scrolled"),i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .customText").removeClass("hidden")),Ga("quoteLength",r.quoteLength),Ga("numbers",r.numbers),Ga("punctuation",r.punctuation),setTimeout(()=>{i("#testConfig .spacer").css("transition","")},125)}async function a2(e,t){var y,v,w;if(e===t)return;s2(t);let o;r.mode==="time"?o=r.time:r.mode==="words"?o=r.words:r.mode==="quote"&&(o=r.quoteLength),o!==void 0&&Ga(r.mode,o);const a={time:"time",words:"wordCount",custom:"customText",quote:"quoteLength",zen:"zen"},s=fe(250),n={both:"easeInOutSine",in:"easeInSine",out:"easeOutSine"},l={time:!0,words:!0,custom:!0,quote:!1,zen:!1},c=i("#testConfig .puncAndNum");if(l[t]!==l[e]){l[t]?i("#testConfig .leftSpacer").removeClass("scrolled"):i("#testConfig .leftSpacer").addClass("scrolled"),c.css({width:"unset",opacity:1}).removeClass("hidden");const $=Math.round(((y=c[0])==null?void 0:y.getBoundingClientRect().width)??0);c.stop(!0,!1).css({width:l[e]?$:0,opacity:l[e]?1:0}).animate({width:l[t]?$:0,opacity:l[t]?1:0},s,n.both,()=>{l[t]?c.css("width","unset"):c.addClass("hidden")})}t==="zen"?i("#testConfig .rightSpacer").addClass("scrolled"):i("#testConfig .rightSpacer").removeClass("scrolled");const u=i(`#testConfig .${a[t]}`),d=i(`#testConfig .${a[e]}`),p=Math.round(((v=d[0])==null?void 0:v.getBoundingClientRect().width)??0);d.addClass("hidden"),u.removeClass("hidden");const f=Math.round(((w=u[0])==null?void 0:w.getBoundingClientRect().width)??0);d.removeClass("hidden"),u.addClass("hidden");const h=(f-p)/2;d.stop(!0,!1).css({opacity:1,width:p}).animate({width:p+h,opacity:0},s/2,n.in,()=>{d.css({opacity:1,width:"unset"}).addClass("hidden"),u.css({opacity:0,width:p+h}).removeClass("hidden").stop(!0,!1).animate({opacity:1,width:f},s/2,n.out,()=>{u.css("width","unset")})})}function s2(e){i("#testConfig .mode .textButton").removeClass("active"),i("#testConfig .mode .textButton[mode='"+e+"']").addClass("active")}function Ga(e,t){if(e==="time"){i("#testConfig .time .textButton").removeClass("active");const o=[15,30,60,120].includes(t)?t:"custom";i("#testConfig .time .textButton[timeConfig='"+o+"']").addClass("active")}else if(e==="words"){i("#testConfig .wordCount .textButton").removeClass("active");const o=[10,25,50,100,200].includes(t)?t:"custom";i("#testConfig .wordCount .textButton[wordCount='"+o+"']").addClass("active")}else e==="quoteLength"?(i("#testConfig .quoteLength .textButton").removeClass("active"),ps(t,[0,1,2,3])?i("#testConfig .quoteLength .textButton[quotelength='all']").addClass("active"):t.forEach(o=>{i("#testConfig .quoteLength .textButton[quoteLength='"+o+"']").addClass("active")})):e==="numbers"?t===!1?i("#testConfig .numbersMode.textButton").removeClass("active"):i("#testConfig .numbersMode.textButton").addClass("active"):e==="punctuation"&&(t===!1?i("#testConfig .punctuationMode.textButton").removeClass("active"):i("#testConfig .punctuationMode.textButton").addClass("active"))}function i2(){i("#testConfig .quoteLength .favorite").removeClass("hidden")}function n2(){i("#testConfig .quoteLength .favorite").addClass("hidden")}let Mu=!1;ge((e,t,o,a)=>{e==="fullConfigChange"&&(Mu=!0),e==="fullConfigChangeFinished"&&(Mu=!1,Iw()),!Mu&&ee()==="test"&&(e==="mode"?a2(a,t):["time","quoteLength","words","numbers","punctuation"].includes(e)&&t!==void 0&&Ga(e,t))});sa(e=>{e.type==="authStateChanged"&&(e.data.isUserSignedIn?i2():n2())});function Zd(e,t,o,a,s){const n=e==="words"&&(t>=1e3||t===0),l=e==="time"&&(o>=900||o===0),c=e==="custom"&&s,u=e==="custom"&&(a.limit.mode==="word"||a.limit.mode==="section")&&(a.limit.value>=1e3||a.limit.value===0),d=e==="custom"&&a.limit.mode==="time"&&(a.limit.value>=900||a.limit.value===0);return!(n||l||c||u||d)}let A,Ya,rc=!1,la,Bi="";function r2(){rc=!rc,m(rc?"on":"off",1)}let ai=[];async function qw(){var l;const e=bt(r.typingSpeedUnit),t=[];for(let c=1;c<=La.length;c++)ei&&c===La.length?t.push(U(A.testDuration).toString()):t.push(c.toString());Ie.getScale("wpm").title.text=e.fullUnitString;const o=[...La.map(c=>U(e.fromWpm(c)))];if(A.chartData==="toolong")return;const a=[...A.chartData.raw.map(c=>U(e.fromWpm(c)))];r.mode!=="time"&&ei&&A.testDuration%1<.5&&(t.pop(),o.pop(),a.pop());let s=a;if(rc||(s=Iy(s,1),s=s.map(c=>Math.round(c))),Ie.data.labels=t,Ie.getDataset("wpm").data=o,Ie.getDataset("wpm").label=r.typingSpeedUnit,Ie.getDataset("raw").data=s,Ya=Math.max(Math.max(...s),Math.max(...o)),r.startGraphsAtZero)Ie.getScale("wpm").min=0,Ie.getScale("raw").min=0;else{const c=Math.min(Math.min(...s),Math.min(...o));Ie.getScale("wpm").min=c,Ie.getScale("raw").min=c}Ie.getDataset("error").data=A.chartData.err;const n=await Yt("sub");if(r.funbox.length>0){let c="";for(const u of Pa())c+=u.name,(l=u.functions)!=null&&l.getResultContent&&(c+="("+u.functions.getResultContent()+")"),c+=" ";c=c.trimEnd(),ai.push({display:!0,id:"funbox-label",type:"line",scaleID:"wpm",value:Ie.getScale("wpm").min,borderColor:"transparent",borderWidth:1,borderDash:[2,2],label:{backgroundColor:"transparent",font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:vo.defaults.font.weight,lineHeight:vo.defaults.font.lineHeight},color:n,padding:3,borderRadius:3,position:"start",display:!0,content:`${c}`}})}Ie.getScale("wpm").max=Ya,Ie.getScale("raw").max=Ya,Ie.getScale("error").max=Math.max(...A.chartData.err)}async function Bw(){const e=await ms(),t=await Cr(A.mode,A.mode2,A.punctuation??!1,A.numbers??!1,A.language,A.difficulty,A.lazyMode??!1,vr(A.funbox)),o=(t==null?void 0:t.wpm)??0;if(o===0)return;const a=bt(r.typingSpeedUnit),s=U(a.fromWpm(o)).toFixed(2);ai.push({display:!0,type:"line",id:"lpb",scaleID:"wpm",value:s,borderColor:e.sub,borderWidth:1,borderDash:[2,2],label:{backgroundColor:e.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:vo.defaults.font.weight,lineHeight:vo.defaults.font.lineHeight},color:e.bg,padding:3,borderRadius:3,position:"center",content:`PB: ${s}`,display:!0}});const n=a.fromWpm(20);Ya>=parseFloat(s)-n&&Ya<=parseFloat(s)+n&&(Ya=Math.round(parseFloat(s)+n)),Ie.getScale("wpm").max=Ya,Ie.getScale("raw").max=Ya}function Fw(){let e=!1;if(A.wpm>=1e3&&(e=!0),i("#result .stats .wpm .top .text").text(r.typingSpeedUnit),e?i("#result .stats .wpm .bottom").text("Infinite"):i("#result .stats .wpm .bottom").text(z.typingSpeed(A.wpm)),i("#result .stats .raw .bottom").text(z.typingSpeed(A.rawWpm)),i("#result .stats .acc .bottom").text(A.acc===100?"100%":z.accuracy(A.acc)),r.alwaysShowDecimalPlaces){r.typingSpeedUnit!=="wpm"?(i("#result .stats .wpm .bottom").attr("aria-label",A.wpm.toFixed(2)+" wpm"),i("#result .stats .raw .bottom").attr("aria-label",A.rawWpm.toFixed(2)+" wpm")):(i("#result .stats .wpm .bottom").removeAttr("aria-label"),i("#result .stats .raw .bottom").removeAttr("aria-label"));let t=U(A.testDuration).toFixed(2)+"s";A.testDuration>61&&(t=ft(U(A.testDuration))),i("#result .stats .time .bottom .text").text(t),i("#result .stats .acc .bottom").attr("aria-label",`${mo.correct} correct
${mo.incorrect} incorrect`)}else{const t={showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`};let o=z.typingSpeed(A.wpm,t),a=z.typingSpeed(A.rawWpm,t);r.typingSpeedUnit!=="wpm"&&(o+=" ("+A.wpm.toFixed(2)+" wpm)",a+=" ("+A.rawWpm.toFixed(2)+" wpm)"),i("#result .stats .wpm .bottom").attr("aria-label",o),i("#result .stats .raw .bottom").attr("aria-label",a),i("#result .stats .acc .bottom").attr("aria-label",`${A.acc===100?"100%":z.percentage(A.acc,{showDecimalPlaces:!0})}
${mo.correct} correct
${mo.incorrect} incorrect`).attr("data-balloon-break","")}}function l2(){i("#result .stats .consistency .bottom").text(z.percentage(A.consistency)),r.alwaysShowDecimalPlaces?i("#result .stats .consistency .bottom").attr("aria-label",z.percentage(A.keyConsistency,{showDecimalPlaces:!0,suffix:" key"})):i("#result .stats .consistency .bottom").attr("aria-label",`${A.consistency}% (${A.keyConsistency}% key)`)}function c2(){const e=U(A.afkDuration/A.testDuration*100);if(i("#result .stats .time .bottom .afk").text(""),e>0&&i("#result .stats .time .bottom .afk").text(e+"% afk"),i("#result .stats .time .bottom").attr("aria-label",`${A.afkDuration}s afk ${e}%`),r.alwaysShowDecimalPlaces){let t=U(A.testDuration).toFixed(2)+"s";A.testDuration>61&&(t=ft(U(A.testDuration))),i("#result .stats .time .bottom .text").text(t)}else{let t=Math.round(A.testDuration)+"s";A.testDuration>61&&(t=ft(Math.round(A.testDuration))),i("#result .stats .time .bottom .text").text(t),i("#result .stats .time .bottom").attr("aria-label",`${U(A.testDuration)}s (${A.afkDuration}s afk ${e}%)`)}}function d2(){i("#result .stats .time .bottom .timeToday").text(bA())}function u2(){i("#result .stats .key .bottom").text(A.charStats[0]+"/"+A.charStats[1]+"/"+A.charStats[2]+"/"+A.charStats[3])}function lc(e){Ew(),_w(e)}function ur(e,t=!1){i("#result .stats .wpm .crown").attr("aria-label",e),i("#result .stats .wpm .crown").attr("data-balloon-length",t?"medium":"")}async function f2(e){if(r.mode==="quote"||e){_f();return}let t=0;const o=await Rw();if(console.debug("Result can get PB:",o.value,o.reason??""),o.value){const a=await Cr(r.mode,A.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,Pa()),s=(a==null?void 0:a.wpm)??0;t=A.wpm-s,console.debug("Local PB",a,"diff",t),t<=0?(_f(),console.debug("Hiding crown")):(console.debug("Showing pending crown"),lc("pending"),ur("+"+z.typingSpeed(t,{showDecimalPlaces:!0})))}else{const a=await Cr(r.mode,A.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,[]),s=(a==null?void 0:a.wpm)??0;t=A.wpm-s,console.debug("Local PB",a,"diff",t),t<=0?(console.debug("Showing warning crown"),lc("warning"),ur(`This result is not eligible for a new PB (${o.reason})`,!0)):(console.debug("Showing ineligible crown"),lc("ineligible"),ur(`You could've gotten a new PB (+${z.typingSpeed(t,{showDecimalPlaces:!0})}), but your config does not allow it (${o.reason})`,!0))}}function _f(){JA(),ur("")}function p2(){e2()==="pending"&&(Ew(),_w("error"),ur("Local PB data is out of sync with the server - please refresh (pb mismatch)",!0))}async function Rw(){const e=A.funbox,o=vr(A.funbox).every(l=>l==null?void 0:l.canGetPb),a=e.length===0||o,s=r.stopOnError==="letter"&&A.acc<100,n=!A.bailedOut;return a&&!s&&n?{value:!0}:a?s?{value:!1,reason:"stop on letter"}:n?{value:!1,reason:"unknown"}:{value:!1,reason:"bailed out"}:{value:!1,reason:"funbox"}}function Dw(){if(Pe())return;const e=getComputedStyle(document.body),t=[e.getPropertyValue("--main-color"),e.getPropertyValue("--text-color"),e.getPropertyValue("--sub-color")],o=Date.now()+125;(function a(){dg({particleCount:5,angle:60,spread:75,origin:{x:0},colors:t}),dg({particleCount:5,angle:120,spread:75,origin:{x:1},colors:t}),Date.now()<o&&requestAnimationFrame(a)})()}async function m2(e){var n,l,c,u;const t=[],o=((l=(n=x())==null?void 0:n.tags)==null?void 0:l.length)??0;try{(u=(c=x())==null?void 0:c.tags)==null||u.forEach(d=>{d.active===!0&&t.push(d)})}catch{}o===0?i("#result .stats .tags").addClass("hidden"):i("#result .stats .tags").removeClass("hidden"),t.length===0?i("#result .stats .tags .bottom").html("<div class='noTags'>no tags</div>"):i("#result .stats .tags .bottom").text(""),i("#result .stats .tags .editTagsButton").attr("data-result-id",""),i("#result .stats .tags .editTagsButton").attr("data-active-tag-ids",t.map(d=>d._id).join(",")),i("#result .stats .tags .editTagsButton").addClass("invisible");let a="start",s=15;t.forEach(async d=>{const p=await mb(d._id,r.mode,A.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode);i("#result .stats .tags .bottom").append(`
      <div tagid="${d._id}" aria-label="PB: ${p}" data-balloon-pos="up">${d.display}<i class="fas fa-crown hidden"></i></div>
    `);const f=bt(r.typingSpeedUnit);if(r.mode!=="quote"&&!e&&(await Rw()).value)if(p<A.wpm)await hx(d._id,r.mode,A.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,A.wpm,A.acc,A.rawWpm,A.consistency),i(`#result .stats .tags .bottom div[tagid="${d._id}"] .fas`).removeClass("hidden"),i(`#result .stats .tags .bottom div[tagid="${d._id}"]`).attr("aria-label","+"+U(A.wpm-p));else{const g=await ms();ai.push({display:!0,type:"line",id:"tpb",scaleID:"wpm",value:f.fromWpm(p),borderColor:g.sub,borderWidth:1,borderDash:[2,2],label:{backgroundColor:g.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:vo.defaults.font.weight,lineHeight:vo.defaults.font.lineHeight},color:g.bg,padding:3,borderRadius:3,position:a,xAdjust:s,display:!0,content:`${d.display} PB: ${U(f.fromWpm(p)).toFixed(2)}`}}),a==="start"?(a="end",s=-15):(a="start",s=15)}})}function g2(e){let t="";t+=r.mode,r.mode==="time"?t+=" "+r.time:r.mode==="words"?t+=" "+r.words:r.mode==="quote"&&(e==null?void 0:e.group)!==void 0&&(t+=" "+["short","medium","long","thicc"][e.group]);const o=gi("ignoresLanguage");r.mode!=="custom"&&!o&&(t+="<br>"+ea(A.language)),r.punctuation&&(t+="<br>punctuation"),r.numbers&&(t+="<br>numbers"),r.blindMode&&(t+="<br>blind"),r.lazyMode&&(t+="<br>lazy"),r.funbox.length>0&&(t+="<br>"+r.funbox.map(a=>a.replace(/_/g," ")).join(", ")),r.difficulty==="expert"?t+="<br>expert":r.difficulty==="master"&&(t+="<br>master"),r.stopOnError!=="off"&&(t+=`<br>stop on ${r.stopOnError}`),i("#result .stats .testType .bottom").html(t)}function h2(e,t,o,a,s){let n="";if(e&&(n+=`<br>failed (${t})`),o&&(n+="<br>afk detected"),Qp){n+="<br>invalid";const l=[];(A.wpm<0||A.wpm>350&&A.mode!=="words"&&A.mode2!=="10"||A.wpm>420&&A.mode==="words"&&A.mode2==="10")&&l.push("wpm"),(A.rawWpm<0||A.rawWpm>350&&A.mode!=="words"&&A.mode2!=="10"||A.rawWpm>420&&A.mode==="words"&&A.mode2==="10")&&l.push("raw"),(A.acc<75||A.acc>100)&&l.push("accuracy"),l.length>0&&(n+=` (${l.join(",")})`)}a&&(n+="<br>repeated"),A.bailedOut&&(n+="<br>bailed out"),s&&(n+="<br>too short"),n===""?i("#result .stats .info").addClass("hidden"):(i("#result .stats .info").removeClass("hidden"),n=n.substring(4),i("#result .stats .info .bottom").html(n))}function y2(e){var t,o,a;if(r.mode==="quote"){if(e===null){console.error("Failed to update quote rating button: randomQuote is null");return}const s=(a=(o=(t=x())==null?void 0:t.quoteRatings)==null?void 0:o[e.language])==null?void 0:a[e.id];be(s)&&i(".pageTest #result #rateQuoteButton .icon").removeClass("far").addClass("fas"),Cw(e).then(n=>{var l;i(".pageTest #result #rateQuoteButton .rating").text(((l=n==null?void 0:n.average)==null?void 0:l.toFixed(1))??"")}).catch(n=>{i(".pageTest #result #rateQuoteButton .rating").text("?")}),i(".pageTest #result #rateQuoteButton").css({opacity:0}).removeClass("hidden").css({opacity:1})}}function b2(e){const t=i(".pageTest #result #favoriteQuoteButton .icon");if(r.mode!=="quote"||!F()){t.parent().addClass("hidden");return}if(e===null){console.error("Failed to update quote favorite button: randomQuote is null");return}la=r.mode==="quote"?e.language:void 0,Bi=r.mode==="quote"?e.id.toString():"";const o=yt.isQuoteFavorite(e);t.removeClass(o?"far":"fas").addClass(o?"fas":"far"),t.parent().removeClass("hidden")}function v2(e){r.mode==="quote"?(i("#result .stats .source").removeClass("hidden"),i("#result .stats .source .bottom").html((e==null?void 0:e.source)??"Error: Source unknown")):i("#result .stats .source").addClass("hidden")}async function w2(e,t,o,a,s,n,l,c){ai=[],A=structuredClone(e),_f(),i("#resultWordsHistory .words").empty(),i("#result #resultWordsHistory").addClass("hidden"),i("#retrySavingResultButton").addClass("hidden"),i(".pageTest #result #rateQuoteButton .icon").removeClass("fas").addClass("far"),i(".pageTest #result #rateQuoteButton .rating").text(""),i(".pageTest #result #rateQuoteButton").addClass("hidden"),i("#words").removeClass("blurred"),i("#wordsInput").trigger("blur"),i("#result .stats .time .bottom .afk").text(""),F()?i("#result .loginTip").addClass("hidden"):i("#result .loginTip").removeClass("hidden"),r.ads==="off"||r.ads==="result"?i("#result #watchVideoAdButton").addClass("hidden"):i("#result #watchVideoAdButton").removeClass("hidden"),Fw(),l2(),c2(),u2(),g2(l),v2(l),b2(l),await f2(c),await qw(),await Bw(),await m2(c),h2(t,o,a,s,n),Ie.options.plugins.annotation.annotations=ai,Ie.updateColors(),Ie.resize(),i("#result .stats .tags").hasClass("hidden")&&i("#result .stats .info").hasClass("hidden")?i("#result .stats .infoAndTags").addClass("hidden"):i("#result .stats .infoAndTags").removeClass("hidden"),ah()?(i("main #result .noStressMessage").remove(),i("main #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `),i("main #result .stats").addClass("hidden"),i("main #result .chart").addClass("hidden"),i("main #result #resultWordsHistory").addClass("hidden"),i("main #result #resultReplay").addClass("hidden"),i("main #result .loginTip").addClass("hidden"),i("main #result #showWordHistoryButton").addClass("hidden"),i("main #result #watchReplayButton").addClass("hidden"),i("main #result #saveScreenshotButton").addClass("hidden"),console.log(`Test Completed: ${A.wpm} wpm ${A.acc}% acc ${A.rawWpm} raw ${A.consistency}% consistency`)):(i("main #result .stats").removeClass("hidden"),i("main #result .chart").removeClass("hidden"),F()||i("main #result .loginTip").removeClass("hidden"),i("main #result #showWordHistoryButton").removeClass("hidden"),i("main #result #watchReplayButton").removeClass("hidden"),i("main #result #saveScreenshotButton").removeClass("hidden")),o2(),tn(i("#typingTest"),i("#result"),250,async()=>{i("#result").trigger("focus"),VA(),Sv(!1),i("#words").empty(),Ie.resize()},async()=>{zo(!1),i("#resultExtraButtons").removeClass("hidden").css("opacity",0).animate({opacity:1},fe(125));const u=Zd(r.mode,r.words,r.time,Ia(),ta()??!1);r.alwaysShowWordsHistory&&u&&!ah()&&Kp(!0),Qc(!0),zi()})}function C2(e,t){var a,s;const o=[];if(e.length>0)for(const n of e)(s=(a=x())==null?void 0:a.tags)==null||s.forEach(l=>{n===l._id&&o.push(l.display)});if(e.length===0)i(".pageTest #result .tags .bottom").html("<div class='noTags'>no tags</div>");else{i(".pageTest #result .tags .bottom div.noTags").remove();const n=i(".pageTest #result .tags .bottom div[tagid]"),l=[];n.each((u,d)=>{const p=i(d).attr("tagid");e.includes(p)?l.push(p):i(d).remove()});let c="";e.forEach((u,d)=>{l.includes(u)||(t.includes(u)?c+=`<div tagid="${u}" data-balloon-pos="up">${o[d]}<i class="fas fa-crown"></i></div>`:c+=`<div tagid="${u}">${o[d]}</div>`)}),i(".pageTest #result .tags .bottom").append(c),i(".pageTest #result .tags .top .editTagsButton").attr("active-tag-ids",e.join(","))}}i(".pageTest #favoriteQuoteButton").on("click",async()=>{var o,a,s,n,l;if(la===void 0||Bi===""){m("Could not get quote stats!",-1);return}const e=i(".pageTest #favoriteQuoteButton .icon"),t=x();if(t)if(e.hasClass("fas")){te();const c=await E.users.removeQuoteFromFavorites({body:{language:la,quoteId:Bi}});if(V(),m(c.body.message,c.status===200?1:-1),c.status===200){e.removeClass("fas").addClass("far");const u=(a=(o=t.favoriteQuotes)==null?void 0:o[la])==null?void 0:a.indexOf(Bi);(n=(s=t.favoriteQuotes)==null?void 0:s[la])==null||n.splice(u,1)}}else{te();const c=await E.users.addQuoteToFavorites({body:{language:la,quoteId:Bi}});V(),m(c.body.message,c.status===200?1:-1),c.status===200&&(e.removeClass("far").addClass("fas"),t.favoriteQuotes===void 0&&(t.favoriteQuotes={}),t.favoriteQuotes[la]||(t.favoriteQuotes[la]=[]),(l=t.favoriteQuotes[la])==null||l.push(Bi))}});ge(async e=>{["typingSpeedUnit","startGraphsAtZero"].includes(e)&&de&&(ai=[],Fw(),await qw(),await Bw(),Qi(),Ie.options.plugins.annotation.annotations=ai,Ie.updateColors(),Ie.resize())});const K={particles:[],rendering:!1},k2=1e3,S2=.05,x2=4,T2=.6,Hl=1500,sh=.3,ih=[6,3],Ol=10;function L2(){const e=document.createElement("canvas");return e.style.cssText="position:fixed;top:0;left:0;pointer-events:none;z-index:999999",e.height=window.innerHeight,e.width=window.innerWidth,window.addEventListener("resize",()=>{e.height=window.innerHeight,e.width=window.innerWidth}),document.body.appendChild(e),e}function $2(e,t,o){return{x:e,y:t,color:o,alpha:1,prev:{x:e,y:t},vel:{x:Hl-Math.random()*Hl*2,y:Hl-Math.random()*Hl*2}}}function M2(e){!K.canvas||!be(K.deltaTime)||(e.prev.x=e.x,e.prev.y=e.y,e.x+=e.vel.x*K.deltaTime,e.y+=e.vel.y*K.deltaTime,e.x>K.canvas.width?(e.vel.x*=-.3,e.x=K.canvas.width-(e.x-K.canvas.width)*sh):e.x<0&&(e.vel.x*=-.3,e.x*=-.3),e.y>K.canvas.height?(e.vel.y*=-.3,e.y=K.canvas.height-(e.y-K.canvas.height)*sh):e.y<0&&(e.vel.y*=-1,e.y*=-1),e.vel.y+=k2*K.deltaTime,e.vel.x*=1-S2*K.deltaTime,e.alpha*=1-T2*K.deltaTime)}function A2(){K.caret=i("#caret"),K.canvas=L2(),K.context2d=K.canvas.getContext("2d")}function Ww(){if(!be(K.lastFrame)||!K.context2d||!K.canvas)return;K.rendering=!0;const e=Date.now();K.deltaTime=(e-K.lastFrame)/1e3,K.lastFrame=e,K.context2d.clearRect(0,0,K.canvas.width,K.canvas.height);const t=[];for(const o of K.particles)o.alpha<.1||(M2(o),K.context2d.globalAlpha=o.alpha,K.context2d.strokeStyle=o.color,K.context2d.lineWidth=x2,K.context2d.beginPath(),K.context2d.moveTo(Math.round(o.prev.x),Math.round(o.prev.y)),K.context2d.lineTo(Math.round(o.x),Math.round(o.y)),K.context2d.stroke(),t.push(o));K.particles=t,K.particles.length&&!Pe()?requestAnimationFrame(Ww):(K.context2d.clearRect(0,0,K.canvas.width,K.canvas.height),K.rendering=!1)}function Pw(e=!1){if(!be(K.resetTimeOut))return;delete K.resetTimeOut,clearTimeout(K.resetTimeOut);const t=i(document.body);t.css("transition","all .25s, transform 0.8s"),t.css("transform","translate(0,0)"),setTimeout(()=>{t.css("transition","all .25s, transform .05s"),i("html").css("overflow","inherit"),i("html").css("overflow-y","scroll")},e?0:1e3)}function E2(){K.rendering||(K.lastFrame=Date.now(),Ww())}function _2(){const e=Math.floor(Math.random()*256).toString(16),t=Math.floor(Math.random()*256).toString(16),o=Math.floor(Math.random()*256).toString(16);return`#${e}${t}${o}`}async function zw(e=!0,t=!1){var s,n;if(r.monkeyPowerLevel==="off"||Pe())return;if(r.blindMode&&(e=!0),["3","4"].includes(r.monkeyPowerLevel)){i("html").css("overflow","hidden");const l=[Math.round(Ol-Math.random()*Ol),Math.round(Ol-Math.random()*Ol)];i(document.body).css("transform",`translate(${l[0]}px, ${l[1]}px)`),be(K.resetTimeOut)&&clearTimeout(K.resetTimeOut),K.resetTimeOut=setTimeout(Pw,2e3)}const o=(s=K.caret)==null?void 0:s.offset(),a=[(o==null?void 0:o.left)??0,((o==null?void 0:o.top)??0)+(((n=K.caret)==null?void 0:n.height())??0)];for(let l=Math.round((ih[0]+Math.random()*ih[1])*(t?2:1));l>0;l--){const c=["2","4"].includes(r.monkeyPowerLevel)?_2():e?await Yt("caret"):await Yt("error");K.particles.push($2(...a,c))}E2()}const I2={laborers:"labourers",industrialized:"industrialised",acclimatizing:"acclimatising",acclimatized:"acclimatised",behoove:"behove",reorganization:"reorganisation",galvanize:"galvanise",demagogism:"demagoguism",canceled:"cancelled",baptize:"baptise",revitalize:"revitalise",skeptical:"sceptical",piscine:"piscinae",ionization:"ionisation",chili:"chilli",dexterous:"dextrous",likable:"likeable",neutralize:"neutralise",meter:"metre",meters:"metres",centimeter:"centimetre",hurrah:"hooray",multicolor:"multicolour",actualization:"actualisation",fertilizing:"fertilising",enamor:"enamour",skepticism:"scepticism",authorize:"authorise",minimize:"minimise",bandoleer:"bandolier",rigor:"rigour",fledgling:"fledgeling",mesquite:"mesquit",fogy:"fogey",characterize:"characterise",wagonette:"waggonette",plagiarize:"plagiarise",kilometers:"kilometres",molt:"moult",leveler:"leveller",checkered:"chequered",vendor:"vender",candor:"candour",moralize:"moralise",denationalization:"denationalisation",anemia:"anaemia",caiman:"cayman",chitterlings:"chitlins",acclimated:"acclimatised",acclimate:"acclimatise",skillful:"skilful",enamored:"enamoured",watercolor:"watercolour",extemporization:"extemporisation",lackluster:"lacklustre",equalizer:"equaliser",cipher:"cypher",polarization:"polarisation",polymerization:"polymerisation",ionize:"ionise",anesthetic:"anaesthetic",aerie:"eyrie",lachrymal:"lacrimal",decimeter:"decimetre",rajah:"raja",modernize:"modernise",gasoline:"petrol",alphabetized:"alphabetised",saber:"sabre",burglarize:"burglarise",terrorize:"terrorise",enthrall:"enthral",mustachioed:"moustachioed",anesthesia:"anaesthesia",sepulcher:"sepulchre",caftan:"kaftan",organize:"organise",manikin:"mannikin",dexterously:"dextrously",artifact:"artefact",kilometer:"kilometre",mommy:"mummy",brant:"brent",hyena:"hyaena",fuze:"fuse",victimize:"victimise",jihad:"jehad",airplane:"aeroplane",laborer:"labourer",vaporware:"vapourware",worshiped:"worshipped",taboret:"tabouret",rationalize:"rationalise",whimsy:"whimsey",scandalize:"scandalise",categorization:"categorisation",centered:"centred",kerosene:"kerosine",specialize:"specialise",specialized:"specialised",cicatrix:"cicatrice",jailer:"jailor",unfavorable:"unfavourable",guerrilla:"guerilla",emphasize:"emphasise",wacky:"whacky",ionizing:"ionising",czarina:"tzarina",ratline:"ratlin",abolitionize:"abolitionise",subsidize:"subsidise",plowing:"ploughing",untrammeled:"untrammelled",worshiping:"worshipping",memorization:"memorisation",anglicize:"anglicise",finalize:"finalise",gases:"gasses",fertilization:"fertilisation",libeling:"libelling",kinesthetic:"kinaesthetic",immunization:"immunisation",coloration:"colouration",overdraft:"overdraught",lambaste:"lambast",unpasteurized:"unpasteurised",ascendance:"ascendence",jeweler:"jeweller",fervor:"fervour",jeopardize:"jeopardise",abridgment:"abridgement",monopolize:"monopolise",colorless:"colourless",colorlessness:"colourlessness",tumors:"tumours",jinni:"jinn",aluminum:"aluminium",salable:"saleable",bronco:"broncho",lupine:"lupin",linchpin:"lynchpin",mesmerize:"mesmerise",internationalization:"internationalisation",anapestic:"anapaestic",supersede:"supercede",europeanize:"europeanise",optimized:"optimised",botanize:"botanise",organizational:"organisational",heme:"haem",estivation:"aestivation",edema:"oedema",penalize:"penalise",peddler:"pedlar",biased:"biassed",aggrandize:"aggrandise",rationalizing:"rationalising",deputize:"deputise",centers:"centres",unicolor:"unicolour",hypnotized:"hypnotised",anglicized:"anglicised",initialization:"initialisation",topee:"topi",nightie:"nighty",tricolor:"tricolour",reorganize:"reorganise",barbecue:"barbeque",fertilized:"fertilised",synthesize:"synthesise",economize:"economise",colter:"coulter",paleontologist:"palaeontologist",acclimatize:"acclimatise",idealize:"idealise",fossilization:"fossilisation",lionize:"lionise",acclimating:"acclimatising",luster:"lustre",demeanor:"demeanour",unauthorized:"unauthorised",smolder:"smoulder",abettor:"abetter",jewelry:"jewellery",demoralization:"demoralisation",fullness:"fulness",neighbored:"neighboured",neighbor:"neighbour",neighbors:"neighbours",neighboring:"neighbouring",neighborly:"neighbourly",neighborhood:"neighbourhood",neighborhoods:"neighbourhoods",magnetizer:"magnetiser",appetizer:"appetiser",hebraizing:"hebraising",carbonization:"carbonisation",favorably:"favourably",favorite:"favourite",behavioral:"behavioural",cognizant:"cognisant",skeptic:"sceptic",fiber:"fibre",fibers:"fibres",labeled:"labelled",analyze:"analyse",disorganization:"disorganisation",concenter:"concentre",categorize:"categorise",novelization:"novelisation",proselytize:"proselytise",draftsman:"draughtsman",paralyze:"paralyse",ostracize:"ostracise",italicize:"italicise",micrometer:"micrometre",cognizance:"cognisance",saltpeter:"saltpetre",conceptualization:"conceptualisation",containerization:"containerisation",anapest:"anapaest",leukemia:"leukaemia",omelet:"omelette",industrialize:"industrialise",characterization:"characterisation",amortize:"amortise",mazurka:"mazourka",macadamize:"macadamise",stymie:"stymy",analog:"analogue",prizer:"priser",cauterize:"cauterise",dysmenorrhea:"dysmenorrhoea",hippie:"hippy",mechanization:"mechanisation",commercialize:"commercialise",unsavory:"unsavoury",somber:"sombre",esophageal:"oesophageal",iodized:"iodised",tyrannize:"tyrannise",liberalize:"liberalise",computerization:"computerisation",synthesizer:"synthesiser",fertilizes:"fertilises",airdrome:"aerodrome",uncivilized:"uncivilised",mold:"mould",nitrogenized:"nitrogenised",legalize:"legalise",tantalize:"tantalise",eulogize:"eulogise",depolarization:"depolarisation",fecal:"faecal",bastardize:"bastardise",summarize:"summarise",cony:"coney",authorization:"authorisation",colorful:"colourful",temporized:"temporised",adviser:"advisor",tendinitis:"tendonitis",crystallization:"crystallisation",humor:"humour",humorous:"humourous",chanty:"shanty",dyspnea:"dyspnoea",aging:"ageing",mousy:"mousey",succor:"succour",distill:"distil",decentralization:"decentralisation",cauterization:"cauterisation",specter:"spectre",snowplow:"snowplough",pediatrics:"paediatrics",discoloration:"discolouration",tumor:"tumour",empathize:"empathise",pawpaw:"papaya",aggrandizement:"aggrandisement",fontanel:"fontanelle",brunet:"brunette",rumor:"rumour",epaulet:"epaulette",glycerin:"glycerine",fraternize:"fraternise",latinize:"latinise",sniveling:"snivelling",pasteurize:"pasteurise",modernization:"modernisation",patronize:"patronise",totaled:"totalled",normalization:"normalisation",niter:"nitre",shoveler:"shoveller",flier:"flyer",equalization:"equalisation",meagerly:"meagrely",favoritism:"favouritism",libelous:"libellous",popularized:"popularised",armory:"armoury",humanization:"humanisation",minuscule:"miniscule",collectible:"collectable",tepee:"teepee",stabilization:"stabilisation",moldy:"mouldy",colonize:"colonise",idealized:"idealised",meager:"meagre",armorer:"armourer",vitalize:"vitalise",fossilized:"fossilised",antagonize:"antagonise",criticize:"criticise",liter:"litre",stigmatize:"stigmatise",theorize:"theorise",combated:"combatted",desalination:"desalinisation",evangelize:"evangelise",idolization:"idolisation",smoldering:"smouldering",commercialization:"commercialisation",laureled:"laurelled",hematology:"haematology",fulfill:"fulfil",disorganized:"disorganised",accouterments:"accoutrements",busses:"buses",utilize:"utilise",enroll:"enrol",goiter:"goitre",stylized:"stylised",diarrhea:"diarrhoea",hypothesize:"hypothesise",esthetic:"aesthetic",dishonor:"dishonour",victualer:"victualler",paleolithic:"palaeolithic",sanatorium:"sanitarium",feminization:"feminisation",flotation:"floatation",teetotaler:"teetotaller",feudalization:"feudalisation",visualize:"visualise",fertilize:"fertilise",czar:"tzar",nationalization:"nationalisation",septicemia:"septicaemia",organizer:"organiser",recrystallization:"recrystallisation",dolor:"dolour",agonizing:"agonising",romanization:"romanisation",synchronize:"synchronise",amorist:"amourist",agonized:"agonised",belabor:"belabour",caster:"castor",softy:"softie",apothegm:"apophthegm",demobilization:"demobilisation",agonizes:"agonises",misdemeanor:"misdemeanour",recognizable:"recognisable",asshole:"arsehole",brutalization:"brutalisation",chamois:"shammy",clamor:"clamour",fertilizer:"fertiliser",deodorization:"deodorisation",privatization:"privatisation",tidbit:"titbit",molding:"moulding",alleluia:"halleluiah",canonization:"canonisation",customize:"customise",customization:"customisations",customizer:"customiser",customizers:"customisers",customizes:"customises",customizing:"customising",popularize:"popularise",specialty:"speciality",meagerness:"meagreness",esophagus:"oesophagus",millimeter:"millimetre",harmonization:"harmonisation",atomizer:"atomiser",dieresis:"diaeresis",maneuver:"manoeuvre",capitalize:"capitalise",gynecologist:"gynaecologist",acclimation:"acclimatisation",generalize:"generalise",temporize:"temporise",premunire:"praemunire",estival:"aestival",selvage:"selvedge",brier:"briar",hyperesthesia:"hyperaesthesia",maximize:"maximise",draftsmen:"draughtsmen",colonization:"colonisation",capitalization:"capitalisation",tenia:"taenia",paleontology:"palaeontology",libeler:"libeller",arytenoid:"arytaenoid",wainscoting:"wainscotting",globalization:"globalisation",legalization:"legalisation",magnetization:"magnetisation",stabilize:"stabilise",mesmerized:"mesmerised",savory:"savoury",reconnoiter:"reconnoitre",bastardized:"bastardised",rancor:"rancour",checker:"chequer",industrialization:"industrialisation",epitomize:"epitomise",socialize:"socialise",externalization:"externalisation",chivy:"chivvy",optimize:"optimise",romanize:"romanise",vulcanize:"vulcanise",plow:"plough",memorize:"memorise",sterilization:"sterilisation",routing:"routeing",raveling:"ravelling",savor:"savour",harmonize:"harmonise",cannibalize:"cannibalise",vaporize:"vaporise",utilization:"utilisation",hybridization:"hybridisation",mechanize:"mechanise",arbor:"arbour",arbors:"arbours",licorice:"liquorice",counselor:"counsellor",orthopedic:"orthopaedic",lusterless:"lustreless",numskull:"numbskull",paleozoic:"palaeozoic",malodor:"malodour",amenorrhea:"amenorrhoea",criticized:"criticised",gonorrhea:"gonorrhoea",fossilize:"fossilise",revolutionize:"revolutionise",woolen:"woollen",dishabille:"deshabille",organdy:"organdie",asses:"arses",furor:"furore",paycheck:"paycheque",pulverize:"pulverise",dramatization:"dramatisation",yodeler:"yodeller",apologize:"apologise",apologized:"apologised",blond:"blonde",oxidize:"oxidise",extemporize:"extemporise",whiz:"whizz",edile:"aedile",appall:"appal",legitimize:"legitimise",urbanization:"urbanisation",magnetize:"magnetise",womanize:"womanise",orthopedics:"orthopaedics",cognize:"cognise",christianization:"christianisation",vocalize:"vocalise",individualization:"individualisation",hemoglobin:"haemoglobin",racket:"racquet",agonize:"agonise",aggrandizes:"aggrandises",accouter:"accoutre",mollusk:"mollusc",publicize:"publicise",fraternization:"fraternisation",odorless:"odourless",odor:"odour",odorous:"odourous",rationalization:"rationalisation",pretense:"pretence",louver:"louvre",kopeck:"kopek",lissome:"lissom",idealization:"idealisation",nosy:"nosey",stogie:"stogy",althea:"althaea",immobilization:"immobilisation",majolica:"maiolica",savior:"saviour",civilize:"civilise",granddad:"grandad",centralization:"centralisation",localization:"localisation",evangelization:"evangelisation",ruble:"rouble",pajamas:"pyjamas",sterilize:"sterilise",math:"maths",localize:"localise",hospitalization:"hospitalisation",scrutinize:"scrutinise",acclimatization:"acclimatisation",misbehavior:"misbehaviour",behavior:"behaviour",color:"colour",tire:{britishWord:"tyre",exceptPreviousWords:["will"]},gray:"grey",grays:"greys",theater:"theatre",amphitheater:"amphitheatre",center:"centre",realize:"realise",realizing:"realising",realization:"realisation",license:"licence",mom:"mum","mom'l":"mum'll",favor:"favour",favors:"favours",favorites:"favourites",analyzed:"analysed",characterized:"characterised",colored:"coloured",colors:"colours",counseling:"counselling",customized:"customised",defense:"defence",offense:"offence",enrollment:"enrolment",flavor:"flavour",flavors:"flavours",flavoring:"flavouring",harbor:"harbour",harbored:"harboured",honor:"honour",honors:"honours",labor:"labour",licensed:"licenced",licenses:"licences",licensing:"licencing",modeling:"modelling",optimization:"optimisation",organization:"organisation",organizations:"organisations",organized:"organised",organizing:"organising",pediatric:"paediatric",personalized:"personalised",practice:"practise",realized:"realised",recognize:"recognise",recognized:"recognised",specialties:"specialities",specializing:"specialising",theaters:"theatres",travelers:"travellers",traveler:"traveller",traveling:"travelling",authorized:"authorised",behaviors:"behaviours",traveled:"travelled",utilizing:"utilising",utilized:"utilised",honored:"honoured",specializes:"specialises",practicing:"practising",signaling:"signalling",analyzing:"analysing",recognizes:"recognises",organizers:"organisers",visualization:"visualisation",standardized:"standardised",favorable:"favourable",analyzer:"analyser",recognizing:"recognising",uncategorized:"uncategorised",categorized:"categorised",vapor:"vapour",synchronization:"synchronisation",synchronized:"synchronised",rumors:"rumours",coloring:"colouring",honorable:"honourable",generalized:"generalised",generalization:"generalisation",mobilize:"mobilise",armor:"armour",armored:"armoured",labeling:"labelling",endeavor:"endeavour",civilized:"civilised",civilization:"civilisation",parlor:"parlour",tranquilize:"tranquilise",tranquillized:"tranquillised",tranquillization:"tranquillisation",catalog:"catalogue",cataloger:"cataloguer",cataloging:"cataloguing",catalogs:"catalogues",cataloged:"catalogued",uncataloged:"uncatalogued",catalogers:"cataloguers",discolored:"discoloured",discolor:"discolour",encyclopedias:"encyclopaedias",endeavored:"endeavoured",endeavors:"endeavours",endeavoring:"endeavouring",judgments:"judgements",judgment:"judgement",paneling:"panelling",defenses:"defences",criticizing:"criticising",mustache:"moustache",emphasized:"emphasised",emphasizes:"emphasises",emphasizing:"emphasising",fetus:"foetus",programs:"programmes",yogurt:"yoghurt",valor:"valour",moisturize:"moisturise",moisturized:"moisturised",moisturizes:"moisturises",moisturizing:"moisturising",favoring:"favouring",marvelous:"marvellous"};async function Hw(e,t){if(e.includes("-"))return(await Promise.all(e.split("-").map(async o=>Hw(o,t)))).join("-");{const o=e.replace(/^[\W]+|[\W]+$/g,"").toLowerCase(),a=I2[o];if(a===void 0)return e;const[s,n]=typeof a=="string"?[a,[]]:[a.britishWord,a.exceptPreviousWords];return r.mode==="quote"&&n.includes(t)?e:e.replace(RegExp(`^(?:([\\W]*)(${o})([\\W]*))$`,"gi"),(l,c,u,d)=>c+(u.charAt(0)===u.charAt(0).toUpperCase()?u===u.toUpperCase()?s.toUpperCase():mi(s):s)+d)}}const q2=[["áàâäåãąą́āą̄ă","a"],["éèêëẽęę́ēę̄ėě","e"],["íìîïĩįį́īį̄ı","i"],["óòôöøõóōǫǫ́ǭő","o"],["úùûüŭũúūůű","u"],["ńň","n"],["çĉčć","c"],["řŕṛ","r"],["ďđḍ","d"],["ťțṭ","t"],["ṃ","m"],["æ","ae"],["œ","oe"],["ẅŵ","w"],["ĝğg̃","g"],["ĥ","h"],["ĵ","j"],["ńṇṅ","n"],["ŝśšșşṣ","s"],["ß","ss"],["żźž","z"],["ÿỹýÿŷ","y"],["łľĺ","l"],["أإآ","ا"],["َ",""],["ُ",""],["ِ",""],["ْ",""],["ً",""],["ٌ",""],["ٍ",""],["ّ",""],["ё","е"],["ά","α"],["έ","ε"],["ί","ι"],["ύ","υ"],["ό","ο"],["ή","η"],["ώ","ω"],["þ","th"]],B2=new Map(q2.flatMap(e=>[...e[0]].map(t=>[t,e[1]])));function F2(e,t){const o=e.toLowerCase(),a=t==null?void 0:t.find(l=>o.startsWith(l[0])),s=B2.get(o[0]),n=s!==void 0?[o[0],s]:void 0;return a!==void 0?a:n}function R2(e,t){if(!e)return e;const o=e.toUpperCase(),a=[...e].map((l,c)=>l===o[c]),s=[];let n=0;for(let l=0;l<e.length;l++){const c=l+n;if(c>=e.length)break;const u=e.slice(c),d=a.slice(c),p=F2(u,t);if(p!==void 0){for(let f=0;f<p[1].length;f++){const g=p[1][f],h=d[f]??!1;s.push(h?g.toUpperCase():g)}n+=p[0].length-1}else{const f=e[c],g=a[c];s.push(g?f.toUpperCase():f)}}return s.join("")}const Ow=[["are",["aren't"]],["can",["can't"]],["could",["couldn't"]],["did",["didn't"]],["does",["doesn't"]],["do",["don't"]],["had",["hadn't"]],["has",["hasn't"]],["have",["haven't"]],["is",["isn't"]],["it",["it's","it'll"]],["i",["i'm","i'll","i've","i'd"]],["you",["you'll","you're","you've","you'd"]],["that",["that's","that'll","that'd"]],["must",["mustn't","must've"]],["there",["there's","there'll","there'd"]],["he",["he's","he'll","he'd"]],["she",["she's","she'll","she'd"]],["we",["we're","we'll","we'd"]],["they",["they're","they'll","they'd"]],["should",["shouldn't","should've"]],["was",["wasn't"]],["were",["weren't"]],["will",["won't"]],["would",["wouldn't","would've"]],["going",["goin'"]]];async function D2(e){return Ow.find(t=>e.match(RegExp(`^([\\W]*${t[0]}[\\W]*)$`,"gi")))!==void 0}async function W2(e){const t=Ow.find(a=>e.match(RegExp(`^([\\W]*${a[0]}[\\W]*)$`,"gi")));if(t===void 0)return e;const o=Fo(t[1]);return e.replace(RegExp(`^(?:([\\W]*)(${t[0]})([\\W]*))$`,"gi"),(a,s,n,l)=>s+(n.charAt(0)===n.charAt(0).toUpperCase()?P2(n)?o.toUpperCase():mi(o):o)+l)}function P2(e){return e==="I"?!1:e===e.toUpperCase()}const Wt=Math.random;function z2(e){return/[?!.؟]/.test(e)}let Ti="";async function H2(e,t,o,a){let s=t;const n=r.language.split("_")[0],l=xb(e),c=za("punctuateWord");if(c)return c.functions.punctuateWord(s);if(n!=="code"&&n!=="georgian"&&(o===0||z2(l))){if(s=mi(s),n==="turkish"&&(s=s.replace(/I/g,"İ")),n==="spanish"){const u=Wt();u>.9?(s="¿"+s,Ti="?"):u>.8&&(s="¡"+s,Ti="!")}}else if(Wt()<.1&&l!=="."&&l!==","&&o!==a-2||o===a-1)if(n==="spanish")(Ti==="?"||Ti==="!")&&(s+=Ti,Ti="");else{const u=Wt();u<=.8?n==="kurdish"?s+=".":n==="nepali"||n==="bangla"||n==="hindi"?s+="।":n==="japanese"||n==="chinese"?s+="。":s+=".":u>.8&&u<.9?n==="french"?s="?":n==="arabic"||n==="persian"||n==="urdu"||n==="kurdish"?s+="؟":n==="greek"?s+=";":n==="japanese"||n==="chinese"?s+="？":s+="?":n==="french"?s="!":n==="japanese"||n==="chinese"?s+="！":s+="!"}else if(Wt()<.01&&l!==","&&l!=="."&&n!=="russian")s=`"${s}"`;else if(Wt()<.011&&l!==","&&l!=="."&&n!=="russian"&&n!=="ukrainian"&&n!=="slovak")s=`'${s}'`;else if(Wt()<.012&&l!==","&&l!==".")if(n==="code"){const u=Wt(),d=["()","{}","[]","<>"];r.language.startsWith("code_javascript")&&d.push("``");const p=Math.floor(u*d.length),f=d[p];s=`${f[0]}${s}${f[1]}`}else n==="japanese"||n==="chinese"?s=`（${s}）`:s=`(${s})`;else if(Wt()<.013&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!==":"&&l!=="；"&&l!=="：")n==="french"?s=":":n==="chinese"?s+="：":s+=":";else if(Wt()<.014&&l!==","&&l!=="."&&e!=="-")s="-";else if(Wt()<.015&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!=="；"&&l!=="：")n==="french"?s=";":n==="greek"?s=".":n==="arabic"||n==="kurdish"?s+="؛":n==="chinese"?s+="；":s+=";";else if(Wt()<.2&&l!==",")n==="arabic"||n==="urdu"||n==="persian"||n==="kurdish"?s+="،":n==="japanese"?s+="、":n==="chinese"?s+="，":s+=",";else if(Wt()<.25&&n==="code"){const u=["{","}","[","]","(",")",";","=","+","%","/"],d=["{","}","[","]","(",")",";","=","+","%","/","/*","*/","//","!=","==","<=",">=","||","&&","<<",">>","%=","&=","*=","++","+=","--","-=","/=","^=","|="];r.language.startsWith("code_c")&&!r.language.startsWith("code_css")||r.language.startsWith("code_arduino")?s=Fo(d):r.language.startsWith("code_javascript")?s=Fo([...u,"`"]):s=Fo(u)}else Wt()<.5&&n==="english"&&await D2(s)&&(s=await O2(s));return s.includes("	")&&(s=s.replace(/\t/g,""),s+="	"),s.includes(`
`)&&(s=s.replace(/\n/g,""),s+=`
`),s}async function O2(e){return W2(e)}function N2(){const e=za("getWordsFrequencyMode");if(e)return e.functions.getWordsFrequencyMode()}async function U2(){const e=[],t=za("pullSection");if(t){const o=await t.functions.pullSection(r.language);if(o===!1||o===void 0)throw Ki(t.name),new Error("Failed to pull section");for(const a of o.words){if(e.length>=r.words&&r.mode==="words")break;e.push(a)}}return e}function V2(e,t,o){const a=za("getWord");return a&&(e=a.functions.getWord(o,t)),e}function K2(e,t,o){for(const a of Ct("alterText"))e=a.functions.alterText(e,t,o);return e}async function G2(e,t){return!r.britishEnglish||!r.language.includes("english")||r.mode==="quote"&&(J==null?void 0:J.britishText)!==void 0&&(J==null?void 0:J.britishText)!==""?e:await Hw(e,t)}function Au(e,t){const o=!t.noLazyMode||r.mode==="custom";return r.lazyMode&&o&&(e=R2(e,t.additionalAccents)),e}function j2(){const e=Pa().flatMap(t=>t.properties??[]).find(t=>t.startsWith("wordOrder:"));return(e==null?void 0:e.split(":")[1])??"normal"}function Q2(){if(r.mode==="zen")return 0;let e=100;const t=J;if(r.mode==="quote"&&t===null)throw new ct("Random quote is null");const o=Pa().flatMap(a=>a.properties??[]).find(a=>a.startsWith("toPush:"))??"";return r.showAllLines&&(r.mode==="custom"&&(e=ke()),r.mode==="words"&&(e=r.words),r.mode==="quote"&&(e=t.textSplit.length)),r.mode==="words"&&r.words===0&&(e=100),r.mode==="custom"&&(ke()===0||Se()==="time"?e=100:e=ke()>100?100:ke()),o&&(e=+o.split(":")[1]),r.mode==="words"&&r.words!==0&&r.words<e&&(e=r.words),r.mode==="quote"&&t.textSplit.length<e&&(e=t.textSplit.length),r.mode==="custom"&&Se()==="word"&&ke()<e&&ke()!==0&&(e=ke()),e}async function Y2(e,t){if(Ao){if(Xe===null)throw new ct("Current wordset is null");return af(Nw),t==="reverse"?Xe.words.reverse():Xe.words}const o=e.name.startsWith("swiss_german")?"german":e.name;te();const a=await yt.getQuotes(o,r.quoteLength);if(V(),a.length===0)throw gt("words"),new ct(`No ${r.language.replace(/_\d*k$/g,"").replace(/_/g," ")} quotes found`);let s;if(r.quoteLength.includes(-2)&&r.quoteLength.length===1){const n=yt.getQuoteById(Xu);if(n===void 0)throw Gi(),new ct(`Quote ${Xu} does not exist`);s=n}else if(r.quoteLength.includes(-3)){const n=yt.getRandomFavoriteQuote(r.language);if(n===null)throw Gi(),new ct("No favorite quotes found");s=n}else{const n=yt.getRandomQuote();if(n===null)throw Gi(),new ct("No quotes found for selected quote length");s=n}if(s.language=No(r.language),s.text=s.text.replace(/ +/gm," "),s.text=s.text.replace(/( *(\r\n|\r|\n) *)/g,`
 `),s.text=s.text.replace(/…/g,"..."),s.text=s.text.trim(),s.britishText!==void 0&&s.britishText!==""&&r.britishEnglish?s.textSplit=s.britishText.split(" "):s.textSplit=s.text.split(" "),af(s),J===null)throw new ct("Random quote is null");if(J.textSplit===void 0)throw new ct("Random quote textSplit is undefined");return J.textSplit}let Xe=null,Ls=null,cc=!1,Nw=null;async function X2(e){Ao||(If=[]),Nw=J,af(null),Fs=[],Bs=0,fr=[],Ls=e;const t={words:[],sectionIndexes:[],hasTab:!1,hasNewline:!1};cc=Cv("pullSection");const o=j2();console.debug("Word order",o);let a=e.words;r.mode==="custom"?a=cl():r.mode==="quote"?a=await Y2(e,o):r.mode==="zen"&&(a=[]);const s=r.mode==="custom"&&dl(),n=Q2();console.debug(`${s?"Section":"Word"} limit ${n}`),o==="reverse"&&(a=a.reverse());const l=za("withWords");if(l?Xe=await l.functions.withWords(a):Xe=await jL(a),console.debug("Wordset",Xe),n===0)return t;let c=!1,u=0;for(;!c;){const p=await Uw(u,n,an(t.words,-1)??"",an(t.words,-2)??"");if(t.words.push(p.word),t.sectionIndexes.push(p.sectionIndex),s){const f=Fs.length===0&&Bs>=n,g=t.words.length>=100;(f||g)&&(c=!0)}else t.words.length>=n&&(c=!0);u++}const d=J;if(r.mode==="quote"&&d===null)throw new ct("Random quote is null");return t.hasTab=t.words.some(p=>p.includes("	"))||Xe.words.some(p=>p.includes("	"))||r.mode==="quote"&&d.textSplit.some(p=>p.includes("	")),t.hasNewline=t.words.some(p=>p.includes(`
`))||Xe.words.some(p=>p.includes(`
`))||r.mode==="quote"&&d.textSplit.some(p=>p.includes(`
`)),fr=[],t}let Bs=0,Fs=[],fr=[],If=[];async function Uw(e,t,o,a){if(console.debug("Getting next word",{isRepeated:Ao,currentWordset:Xe,wordIndex:e,language:Ls,wordsBound:t,previousWord:o,previousWord2:a}),Xe===null)throw new ct("Current wordset is null");if(Ls===null)throw new ct("Current language is null");if(Ao&&r.mode!=="quote"){const p=If[e];if(p===void 0){let f=!1;if((r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&Se()==="word"&&e<ke()||r.mode==="custom"&&Se()==="section"&&Bs<ke()||r.mode==="words"&&e<r.words)&&(f=!0),f)console.debug("Repeated word is undefined but random generation is allowed - getting random word");else throw new ct("Repeated word is undefined")}else return console.debug("Repeated word: ",p),Bs++,p}const s=N2()??"normal";let n=Xe.randomWord(s);const l=o.replace(/[.?!":\-,]/g,"").toLowerCase(),c=a==null?void 0:a.replace(/[.?!":\-,']/g,"").toLowerCase();if(Fs.length===0){const p=await U2();if(r.mode==="quote")n=Xe.nextWord();else if(r.mode==="custom"&&ac()==="repeat")n=Xe.nextWord();else if(r.mode==="custom"&&ac()==="random"&&(Xe.length<4||Le.mode!==null))n=Xe.randomWord(s);else if(r.mode==="custom"&&ac()==="shuffle")n=Xe.shuffledWord();else if(r.mode==="custom"&&Se()==="section"){n=Xe.randomWord(s);const f=an(fr,-1),g=an(fr,-2);let h=0;for(;h<100&&(f===n||g===n);)h++,n=Xe.randomWord(s)}else if(cc)n=p.join(" ");else{let f=0,g=n.split(" ")[0].toLowerCase(),h=Au(g,Ls);for(;f<100&&(l===h||c===h||r.mode!=="custom"&&!r.punctuation&&n==="I"||r.mode!=="custom"&&!r.punctuation&&!r.language.startsWith("code")&&/[-=_+[\]{};'\\:"|,./<>?]/i.test(n)||r.mode!=="custom"&&!r.numbers&&/[0-9]/i.test(n));)f++,n=Xe.randomWord(s),g=n.split(" ")[0],h=Au(g,Ls)}n=n.replace(/ +/g," "),n=n.replace(/(^ )|( $)/g,""),n=V2(n,e,Xe),Fs=[...n.split(" ")],fr.push(n),n=Fs.shift(),Bs++}else n=Fs.shift();if(n===void 0)throw new ct("Random word is undefined");if(n==="")throw new ct("Random word is empty");if(/ /g.test(n))throw new ct("Random word contains spaces");const u=Cv("getWord");r.mode!=="custom"&&r.mode!=="quote"&&/[A-Z]/.test(n)&&!r.punctuation&&!r.language.startsWith("german")&&!r.language.startsWith("swiss_german")&&!r.language.startsWith("code")&&!r.language.startsWith("klingon")&&!cc&&!u&&(n=n.toLowerCase()),n=n.replace(/ +/gm," "),n=n.replace(/(^ )|( $)/gm,""),n=Au(n,Ls),n=await G2(n,l),r.language.startsWith("swiss_german")&&(n=n.replace(/ß/g,"ss")),r.punctuation&&!Ls.originalPunctuation&&!cc&&(n=await H2(o,n,e,t)),r.numbers&&Wt()<.1&&(n=uv(4),r.language.startsWith("kurdish")?n=Ey(n):r.language.startsWith("nepali")?n=_y(n):r.language.startsWith("bangla")?n=Wk(n):r.language.startsWith("hindi")&&(n=Pk(n))),n=K2(n,e,t),console.debug("Word:",n);const d={word:n,sectionIndex:Bs};return If.push(d),d}let Vw=0,Kw=0;async function Z2(){const e=pi(r,J),[t,o]=(await pb(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode)).map(U);Vw=r.alwaysShowDecimalPlaces?t:Math.round(t),Kw=r.alwaysShowDecimalPlaces?o:Math.floor(o)}function J2(){return Vw}function eE(){return Kw}ge(e=>{["difficulty","blindMode","stopOnError","paceCaret","minWpm","minWpmCustomSpeed","minAcc","minAccCustom","minBurst","confidenceMode","layout","showAverage","typingSpeedUnit","quickRestart","customPolyglot","alwaysShowDecimalPlaces"].includes(e)&&Kt()});async function Kt(){var s,n;i(".pageTest #testModesNotice").empty(),Ao&&r.mode!=="quote"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>'),al||i(".pageTest #testModesNotice").append('<div class="textButton" commands="resultSaving" style="color:var(--error-color);"><i class="fas fa-save"></i>saving disabled</div>'),Tr&&(r.quickRestart==="esc"&&(i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to open commandline</div>'),i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + esc to restart</div>')),r.quickRestart==="tab"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + tab to restart</div>')),(Lr||r.funbox.includes("58008"))&&r.quickRestart==="enter"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + enter to restart</div>');const e=jp(),t=ta();r.mode==="custom"&&e!==""&&t&&i(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-book"></i>${e} (shift + enter to save progress)</div>`),zt&&i(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-award"></i>${zt.display}</div>`),r.mode==="zen"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-poll"></i>shift + enter to finish zen </div>');const o=wo().includes("polyglot");if(r.mode!=="zen"&&!o&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="languages"><i class="fas fa-globe-americas"></i>${ea(r.language,r.mode==="quote")}</button>`),o){const l=r.customPolyglot.map(c=>ea(c,!0)).join(", ");i(".pageTest #testModesNotice").append(`<button class="textButton" commandId="setCustomPolyglotCustom"><i class="fas fa-globe-americas"></i>${l}</button>`)}if(r.difficulty==="expert"?i(".pageTest #testModesNotice").append('<button class="textButton" commands="difficulty"><i class="fas fa-star-half-alt"></i>expert</button>'):r.difficulty==="master"&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="difficulty"><i class="fas fa-star"></i>master</button>'),r.blindMode&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="blindMode"><i class="fas fa-eye-slash"></i>blind</button>'),r.lazyMode&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="lazyMode"><i class="fas fa-couch"></i>lazy</button>'),r.paceCaret!=="off"||r.repeatedPace&&js){const l=z.typingSpeed((H==null?void 0:H.wpm)??0,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`});i(".pageTest #testModesNotice").append(`<button class="textButton" commands="paceCaretMode"><i class="fas fa-tachometer-alt"></i>${r.paceCaret==="average"?"average":r.paceCaret==="pb"?"pb":r.paceCaret==="tagPb"?"tag pb":r.paceCaret==="last"?"last":r.paceCaret==="daily"?"daily":"custom"} pace ${l}</button>`)}if(r.showAverage!=="off"){const l=J2(),c=eE();if(F()&&l>0){const u=["speed","both"].includes(r.showAverage)?z.typingSpeed(l,{suffix:` ${r.typingSpeedUnit}`}):"",d=["acc","both"].includes(r.showAverage)?z.accuracy(c,{suffix:" acc"}):"",p=`${u} ${d}`.trim();i(".pageTest #testModesNotice").append(`<button class="textButton" commands="showAverage"><i class="fas fa-chart-bar"></i>avg: ${p}</button>`)}}r.minWpm!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="minWpm"><i class="fas fa-bomb"></i>min ${z.typingSpeed(r.minWpmCustomSpeed,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`})}</button>`),r.minAcc!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="minAcc"><i class="fas fa-bomb"></i>min ${r.minAccCustom}% acc</button>`),r.minBurst!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="minBurst"><i class="fas fa-bomb"></i>min ${z.typingSpeed(r.minBurstCustomSpeed,{showDecimalPlaces:!1})} ${r.typingSpeedUnit} burst ${r.minBurst==="flex"?"(flex)":""}</button>`),r.funbox.length>0&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="funbox"><i class="fas fa-gamepad"></i>${r.funbox.map(l=>l.replace(/_/g," ")).join(", ")}</button>`),r.confidenceMode==="on"&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>confidence</button>'),r.confidenceMode==="max"&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>max confidence</button>'),r.stopOnError!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="stopOnError"><i class="fas fa-hand-paper"></i>stop on ${r.stopOnError}</button>`),r.layout!=="default"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="layouts"><i class="fas fa-keyboard"></i>emulating ${r.layout.replace(/_/g," ")}</button>`),r.oppositeShiftMode!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="oppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${r.oppositeShiftMode==="keymap"?" (keymap)":""}</button>`);let a="";try{(n=(s=x())==null?void 0:s.tags)==null||n.forEach(l=>{l.active===!0&&(a+=l.display+", ")}),a!==""&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="tags"><i class="fas fa-tag"></i>${a.substring(0,a.length-2)}</button>`)}catch{}}let dc;async function si(e,t){try{p1(dc,e,t)}catch{console.log("Analytics unavailable")}}function tE(){if(dc!==void 0){console.warn("Analytics already activated");return}console.log("Activating Analytics");try{dc=H1(),m1(dc,!0),i("body").append(`
    <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-165993088-1"
  ><\/script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-165993088-1");
  <\/script>`)}catch(e){console.error(re(e,"Failed to activate analytics"))}}const Gw=new Gt({key:"prefersArabicLazyMode",schema:P.boolean(),fallback:!0});function oE(){return Gw.get()}function aE(e){Gw.set(e)}const Yc=document.querySelector(".pageTest #testInitFailed"),Xc=document.querySelector(".pageTest #typingTest"),pr=document.querySelector(".pageTest #testInitFailed .error");function sE(){Yc&&Xc&&(Yc.classList.remove("hidden"),Xc.classList.add("hidden"))}function iE(){pr&&pr.classList.add("hidden")}function nE(e){pr&&(pr.classList.remove("hidden"),pr.innerText=e)}function rE(){Yc&&Xc&&(iE(),Yc.classList.add("hidden"),Xc.classList.remove("hidden"))}let Vr="";const lE=document.getElementById("koInputVisual");let Lo=null;function jw(){Lo=null}function cE(e){Lo!==null&&(Lo.uid=e,delete Lo.hash,Lo.hash=zy(Lo))}function dE(e){if(Ks())return!1;F()?si("testStarted"):si("testStartedNoLogin"),vp(!0),mA(),$f(I.list),gL(),Rp(),Ep(),Ip(),_p(),fl(),lm(),QM();for(const t of Ct("start"))t.functions.start();try{(r.paceCaret!=="off"||r.repeatedPace&&js)&&UM()}catch{}return sM(e),pA(),!0}function W(e={}){var n,l,c;e={...{withSameWordset:!1,practiseMissed:!1,noAnim:!1,nosave:!1},...e};const o=e.noAnim?0:fe(125),a=wv("no_quit");if(Ae&&a){m("No quit funbox is active. Please finish the test.",0,{important:!0}),(n=e.event)==null||n.preventDefault();return}if(Vt||Zs){(l=e.event)==null||l.preventDefault();return}if(ee()==="test"&&!tM()&&(r.mode!=="zen"&&((c=e.event)==null||c.preventDefault()),!Zd(r.mode,r.words,r.time,Ia(),ta()??!1))){let u="Use your mouse to confirm.";r.quickRestart==="tab"?u="Press shift + tab or use your mouse to confirm.":r.quickRestart==="esc"?u="Press shift + escape or use your mouse to confirm.":r.quickRestart==="enter"&&(u="Press shift + enter or use your mouse to confirm."),m(`Quick restart disabled in long tests. ${u}`,0,{duration:4,important:!0});return}if(Ae&&(Ao&&(e.withSameWordset=!0),al)){Ed(),Id(),_d();const u=pl(performance.now()),d=om(u);let p=U(u-d);p<0&&(p=0),Jp(p),Zp();const f=U(ml());em(f,p)}r.mode==="quote"&&J!==null&&r.language.startsWith(J.language)&&r.repeatQuotes==="typing"&&(Ae||Vr!=="")&&(e.withSameWordset=!0),Le.mode!==null&&!e.withSameWordset&&!e.practiseMissed&&(m("Reverting to previous settings.",0),Le.punctuation!==null&&ls(Le.punctuation),Le.numbers!==null&&ka(Le.numbers),Le.customText&&(_a(Le.customText.text),_o(Le.customText.limit.mode),Ko(Le.customText.limit.value),Xs(Le.customText.pipeDelimiter)),gt(Le.mode),zv()),Dr(),lm(),aM(),hL(),tt.reset(),fM(),pM(),ll(),vp(!1),pm(),qd(),Fd(),Bd(),Wd(),vl(),wp(!1),NM(),rw(),k.setKoreanStatus(!1),lr(),un(),xA(),D$(),Dp(!1),de&&(r.randomTheme!=="off"&&aw(),Rx()),it()||wd();let s=null;de?s=i("#result"):s=i("#typingTest"),kv(!1),ic(!0),s.stop(!0,!0).animate({opacity:0},o,async()=>{i("#result").addClass("hidden"),i("#typingTest").css("opacity",0).removeClass("hidden"),i("#wordsInput").css({left:0}).val(" "),r.language.startsWith("korean")?(lE.innerText=" ",r.mode!=="zen"?i("#koInputVisualContainer").show():i("#koInputVisualContainer").hide()):i("#koInputVisualContainer").hide(),zo(!1),ee()==="test"&&Qc(!1),t2(),GA(),await gM(),qf=0,Vr="";let u=!1;if(r.repeatedPace&&e.withSameWordset&&(u=!0),nb(e.withSameWordset??!1),Z1(u),rE(),lb(!0),!await Bf()){ic(!1);return}await Vc();for(const f of Ct("restart"))f.functions.restart();r.showAverage!=="off"?Z2().then(()=>{Kt()}):Kt(),i("#wordsInput").is(":focus")&&xn(),fn(),i("#typingTest").css("opacity",0).removeClass("hidden").stop(!0,!0).animate({opacity:1},o,()=>{BL(),SL(),ML(),TL(),V$(),Dr(),ic(!1)})}),Pp()}let Pn=null,uc,qf=0;async function Bf(){if(console.debug("Initializing test"),qf++,qf>3)return Pn&&(xp(Pn),nE(`${Pn.name}: ${Pn.message}`)),sE(),ic(!1),lb(!1),zo(!1),!1;Pw(),pm(),I.reset(),J1(0),cb(0),k.resetHistory(),k.current="",te();const{data:e,error:t}=await eo(kn(r.language));if(V(),t&&m(re(t,"Failed to load language"),-1),!e||e.name!==r.language)return rn("english"),await Bf();ee()==="test"&&await Nv(),r.mode==="quote"&&r.quoteLength.includes(-3)&&!F()&&Gi();const o=!e.noLazyMode||r.mode==="custom";r.lazyMode&&!o?(uc=!0,m("This language does not support lazy mode.",0,{important:!0}),Ac(!1,!0)):uc&&!e.noLazyMode&&Ac(!0,!0),!r.lazyMode&&!e.noLazyMode&&(uc=!1),r.mode==="custom"&&console.debug("Custom text",Ia()),console.log("Inializing test",{language:{...e,words:`${e.words.length} words`},customText:{...Ia(),text:`${cl().length} words`},mode:r.mode,mode2:pi(r,null),funbox:r.funbox,currentQuote:J});let a,s,n=!1,l=!1;try{const d=await X2(e);a=d.words,s=d.sectionIndexes,n=d.hasTab,l=d.hasNewline}catch(d){return V(),(d instanceof ct||d instanceof Error)&&(Pn=d),console.error(d),d instanceof ct?d.message.length>0&&m(d.message,0,{important:!0}):m(re(d,"Failed to generate words"),-1,{important:!0}),await Bf()}const c=Ap;let u=!1;for(const d of a)/\d/g.test(d)&&!u&&(u=!0);tL(u),JT(n),eL(l),c!==u&&Uc();for(let d=0;d<a.length;d++)I.push(a[d],s[d]);return r.keymapMode==="next"&&r.mode!=="zen"&&Za(an([...I.getCurrent()],0)),Oc(I.getCurrent()),K$(e.rightToLeft??!1),G$(e.ligatures??!1),P$(),console.debug("Test initialized with words",a),console.debug("Test initialized with section indexes",s),!0}function ym(){var e;return r.mode==="words"&&I.length>=r.words&&r.words>0||r.mode==="custom"&&Se()==="word"&&I.length>=ke()&&ke()!==0||r.mode==="quote"&&I.length>=(((e=J==null?void 0:J.textSplit)==null?void 0:e.length)??0)||r.mode==="custom"&&Se()==="section"&&Bs>=ke()&&Fs.length===0&&ke()!==0}async function nh(){if(r.mode==="zen"){$v();return}let e=100;const t=Pa().flatMap(s=>s.properties??[]).find(s=>s.startsWith("toPush:"))??"",o=t==null?void 0:t.split(":")[1];if(o!==void 0&&(e=+o-1),I.length-k.getHistory().length>e){console.debug("Not adding word, enough words already");return}if(ym()){console.debug("Not adding word, all words generated");return}const a=za("pullSection");if(a&&I.length-Z<20){const s=await a.functions.pullSection(r.language);if(s===!1){m("Error while getting section. Please try again later",-1),Ki(a.name),W();return}if(s===void 0)return;let n=0;for(let l=0;l<s.words.length;l++){const c=s.words[l];if(n>=r.words&&r.mode==="words")break;n++,I.push(c,l),Kg(c)}}try{const s=await Uw(I.length,e,I.get(I.length-1),I.get(I.length-2));I.push(s.word,s.sectionIndex),Kg(s.word)}catch(s){Or("fail","word generation error"),m(re(s,"Error while getting next word. Please try again later"),-1,{important:!0})}}const Rs={completedEvent:null,canRetry:!1};async function uE(){const{completedEvent:e}=Rs;if(e===null){m("Could not retry saving the result as the result no longer exists.",0,{duration:5,important:!0});return}Rs.canRetry&&(Rs.canRetry=!1,i("#retrySavingResultButton").addClass("hidden"),Yo(!0),m("Retrying to save..."),await Qw(e,!0))}function fE(e){var Y;let t=U(ve.spacing.first-Js);(t<0||r.mode==="zen")&&(t=0);let o=U(Tn-ve.spacing.last);(o<0||r.mode==="zen")&&(o=0);const a=cM();if(a.time%1!==0&&r.mode!=="time"&&iM(),HM(a.wpm),ei&&!e){const G=tm();Ub(G.wpm),Vb(G.raw),Ed(),Id(),_d()}const s=Ys.map(G=>Math.round(G/5*60));if(r.mode!=="time"&&ei&&a.time%1>=.5){const G=1/(a.time%1);s[s.length-1]=Math.round(s[s.length-1]*G)}const n=sr(s),l=Yl(s);let c=U(uu(n/l)),u=ve.spacing.array.slice();u.length>0&&(u=u.slice(0,u.length-1));let d=U(uu(sr(u)/Yl(u)));(!c||isNaN(c))&&(c=0),(!d||isNaN(d))&&(d=0);const p=[];for(const G of nl)p.push(G.count??0);const f={wpm:La,raw:s,err:p},g=sr(f.wpm??[]),h=Yl(f.wpm??[]),y=U(uu(g/h)),v=isNaN(y)?0:y;let w;if(r.mode==="custom"){const G=Ia();w={textLen:G.text.length,mode:G.mode,pipeDelimiter:G.pipeDelimiter,limit:G.limit}}const $=[];for(const G of((Y=x())==null?void 0:Y.tags)??[])G.active===!0&&$.push(G._id);const S=parseFloat(a.time.toString()),T=om(S);let q=r.language;r.mode==="quote"&&(q=No(r.language));const _=(J==null?void 0:J.group)??-1,N={wpm:a.wpm,rawWpm:a.wpmRaw,charStats:[a.correctChars+a.correctSpaces,a.incorrectChars,a.extraChars,a.missedChars],charTotal:a.allChars,acc:a.acc,mode:r.mode,mode2:pi(r,J),quoteLength:_,punctuation:r.punctuation,numbers:r.numbers,lazyMode:r.lazyMode,timestamp:Date.now(),language:q,restartCount:Yp,incompleteTests:Xp,incompleteTestSeconds:Hc<0?0:U(Hc),difficulty:r.difficulty,blindMode:r.blindMode,tags:$,keySpacing:ve.spacing.array,keyDuration:ve.duration.array,keyOverlap:U(da.total),lastKeyToEnd:o,startToFirstKey:t,consistency:c,wpmConsistency:v,keyConsistency:d,funbox:r.funbox,bailedOut:Ms,chartData:f,customText:w,testDuration:S,afkDuration:T,stopOnLetter:r.stopOnError==="letter"};return N.mode!=="custom"&&delete N.customText,N.mode!=="quote"&&delete N.quoteLength,N}async function ii(e=!1){var v,w,$,S;if(!Ae)return;Sv(!0);const t=performance.now();jg(t),Ao&&r.mode==="quote"&&nb(!1),await Te(1),k.current.length!==0&&(k.pushHistory(),tt.pushHistory(),$f(k.getHistory())),r.mode==="zen"&&$f(k.getHistory()),pL(t);const o=(t-ve.spacing.last)/1e3;if((r.mode==="zen"||Ms)&&o<7&&jg(ve.spacing.last),kv(!0),vp(!1),pm(),ll(),qd(),Fd(),Bd(),Wd(),xn(),lm(),rw(),Kt(),Do.length!==((v=k.getHistory())==null?void 0:v.length)){const T=Wv();Kb(T)}(r.mode==="zen"||Ms)&&nM();const a=fE(e);console.debug("Completed event object",a);function s(T){return typeof T=="number"?isNaN(T)?1:0:typeof T>"u"?1:typeof T=="object"&&T!==null?Object.values(T).reduce((q,_)=>q+s(_),0):0}let n=!1;s(a)>0&&(console.log(a),m("Failed to build result object: One of the fields is undefined or NaN",-1),n=!0);const l=structuredClone(a);let u=rl.slice(-5).every(T=>T);Ms&&(u=!1);const d=parseInt(l.mode2);let p=!1;const f=(Pr-Wr)/1e3;if(r.mode==="time"&&!Ms&&(a.testDuration<f-.1||a.testDuration>f+.1)&&a.testDuration<=120?(m("Test invalid - inconsistent test duration",0),console.error("Test duration inconsistent",a.testDuration,f),ql(),n=!0):e?(m(`Test failed - ${Vr}`,0,{duration:1}),n=!0):u?(m("Test invalid - AFK detected",0),n=!0):Ao?(m("Test invalid - repeated",0),n=!0):l.testDuration<1||r.mode==="time"&&d<15&&d>0||r.mode==="time"&&d===0&&l.testDuration<15||r.mode==="words"&&d<10&&d>0||r.mode==="words"&&d===0&&l.testDuration<15||r.mode==="custom"&&(Se()==="word"||Se()==="section")&&ke()<10||r.mode==="custom"&&Se()==="time"&&ke()<15||r.mode==="zen"&&l.testDuration<15?(m("Test invalid - too short",0),p=!0,n=!0):l.wpm<0||l.wpm>350&&l.mode!=="words"&&l.mode2!=="10"||l.wpm>420&&l.mode==="words"&&l.mode2==="10"?(m("Test invalid - wpm",0),ql(),n=!0):l.rawWpm<0||l.rawWpm>350&&l.mode!=="words"&&l.mode2!=="10"||l.rawWpm>420&&l.mode==="words"&&l.mode2==="10"?(m("Test invalid - raw",0),ql(),n=!0):(!((w=x())!=null&&w.lbOptOut)&&(l.acc<75||l.acc>100)||(($=x())==null?void 0:$.lbOptOut)===!0&&(l.acc<50||l.acc>100))&&(m("Test invalid - accuracy",0),ql(),n=!0),Ao){const T=l.testDuration,q=l.afkDuration;let _=U(T-q);_<0&&(_=0);const N=l.acc;Jp(_),Zp(),em(N,_)}const g=jp(),h=ta();if(r.mode==="custom"&&g!==""&&h)if(Ms||k.getHistory().length<I.length){const T=(S=k.getHistory())==null?void 0:S.length,q=qp(g)+T;rf(g,q),m("Long custom text progress saved",1,{duration:5,important:!0});let _=Rc(g,!0);_=_.slice(q),_a(_)}else{rf(g,0);const T=Rc(g,!0);_a(T),m("Long custom text completed",1,{duration:5,important:!0})}if(yA(l.testDuration-l.afkDuration),d2(),F()?i(".pageTest #result #reportQuoteButton").removeClass("hidden"):(i(".pageTest #result #rateQuoteButton").addClass("hidden"),i(".pageTest #result #reportQuoteButton").addClass("hidden"),si("testCompletedNoLogin"),n||(Lo=l),n=!0),i("#result .stats .dailyLeaderboard").addClass("hidden"),oM(structuredClone(l)),it()||wd(),await w2(l,e,Vr,u,Ao,p,J,n),l.chartData!=="toolong"&&delete l.chartData.unsmoothedRaw,l.testDuration>122&&(l.chartData="toolong",l.keySpacing="toolong",l.keyDuration="toolong"),l.wpm===0&&!e&&l.testDuration>=5){const T=Math.round(l.testDuration),q=[`Congratulations. You just wasted ${T} seconds of your life by typing nothing. Be proud of yourself.`,`Bravo! You've managed to waste ${T} seconds and accomplish exactly zero. A true productivity icon.`,`That was ${T} seconds of absolutely legendary idleness. History will remember this moment.`,`Wow, ${T} seconds of typing... nothing. Bold. Mysterious. Completely useless.`,`Thank you for those ${T} seconds of utter nothingness. The keyboard needed the break.`,`A breathtaking display of inactivity. ${T} seconds of absolutely nothing. Powerful.`,`You just gave ${T} seconds of your life to the void. And the void says thanks.`,`Stunning. ${T} seconds of intense... whatever that wasn't. Keep it up, champ.`,`Is it performance art? A protest? Or just ${T} seconds of glorious nothing? We may never know.`,`You typed nothing for ${T} seconds. And in that moment, you became legend.`];Dw(),m(Fo(q),0,{customTitle:"Nice",duration:15,important:!0})}if(n){si("testCompletedInvalid");return}const y=Po();if(y){if(Dv(),l.uid=y.uid,y2(J),Yo(!0),!l.bailedOut){const T=CA(l);T!==null&&(l.challenge=T)}l.hash=zy(l),await Qw(l,!1)}}async function Qw(e,t){var s;if(!al){m("Result not saved: disabled by user",-1,{duration:3,customTitle:"Notice",important:!0}),Yo(!1);return}if(!it()){m("Result not saved: offline",-1,{duration:2,customTitle:"Notice",important:!0}),Yo(!1),Rs.canRetry=!0,i("#retrySavingResultButton").removeClass("hidden"),t||(Rs.completedEvent=e);return}const o=await E.results.add({body:{result:e}});if(Yo(!1),o.status!==200){[460,461,463,464,465,466].includes(o.status)||(Rs.canRetry=!0,i("#retrySavingResultButton").removeClass("hidden"),t||(Rs.completedEvent=e)),console.log("Error saving result",e),o.body.message==="Old key data format"&&(o.body.message="Old key data format. Please refresh the page to download the new update. If the problem persists, please contact support."),/"result\..+" is (not allowed|required)/gi.test(o.body.message)&&(o.body.message="Looks like your result data is using an incorrect schema. Please refresh the page to download the new update. If the problem persists, please contact support."),m("Failed to save result: "+o.body.message,-1);return}const a=o.body.data;if(i("#result .stats .tags .editTagsButton").attr("data-result-id",a.insertedId),i("#result .stats .tags .editTagsButton").removeClass("invisible"),a.xp!==void 0){const n=((s=x())==null?void 0:s.xp)??0;kb(n,a.xp,de?a.xpBreakdown:void 0),bb(a.xp)}if(a.streak!==void 0&&Cx(a.streak),a.insertedId!==void 0){const n=structuredClone(e);n._id=a.insertedId,a.isPb!==void 0&&a.isPb&&(n.isPb=!0),hb(n),yb(e.incompleteTests.length+1,e.testDuration+e.incompleteTestSeconds-e.afkDuration)}si("testCompleted"),a.isPb!==void 0&&a.isPb?(await Cr(e.mode,e.mode2,e.punctuation,e.numbers,e.language,e.difficulty,e.lazyMode,vr(e.funbox))!==void 0&&Dw(),lc("normal"),await gx(e.mode,e.mode2,e.punctuation,e.numbers,e.language,e.difficulty,e.lazyMode,e.wpm,e.acc,e.rawWpm,e.consistency)):p2(),a.dailyLeaderboardRank===void 0?i("#result .stats .dailyLeaderboard").addClass("hidden"):(i("#result .stats .dailyLeaderboard").css({maxWidth:"13rem",opacity:0}).removeClass("hidden").animate({opacity:1},fe(500)),i("#result .stats .dailyLeaderboard .bottom").html(z.rank(a.dailyLeaderboardRank,{fallback:""}))),i("#retrySavingResultButton").addClass("hidden"),t&&m("Result saved",1,{important:!0})}function mr(e){if(Vr=e,Ed(),Id(),_d(),ii(!0),!al)return;const t=pl(performance.now()),o=om(t);let a=U(t-o);a<0&&(a=0),Jp(a),Zp();const s=U(ml());em(s,a)}i(".pageTest").on("click","#testModesNotice .textButton.restart",()=>{W()});i(".pageTest").on("click","#testInitFailed button.restart",()=>{W()});i(".pageTest").on("click","#restartTestButton",()=>{oe(),!Zs&&(Ae&&r.repeatQuotes==="typing"&&r.mode==="quote"?W({withSameWordset:!0}):W())});i(".pageTest").on("click","#retrySavingResultButton",uE);i(".pageTest").on("click","#nextTestButton",()=>{oe(),W()});i(".pageTest").on("click","#restartTestButtonWithSameWordset",()=>{if(r.mode==="zen"){m("Repeat test disabled in zen mode");return}oe(),W({withSameWordset:!0})});i(".pageTest").on("click","#testConfig .mode .textButton",e=>{if(Vt||i(e.currentTarget).hasClass("active"))return;const t=i(e.currentTarget).attr("mode")??"time";t!==void 0&&gt(t)&&(oe(),W())});i(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{if(Vt)return;const t=i(e.currentTarget).attr("wordCount")??"15";t!=="custom"&&Qs(parseInt(t))&&(oe(),W())});i(".pageTest").on("click","#testConfig .time .textButton",e=>{if(Vt)return;const t=i(e.currentTarget).attr("timeConfig")??"10";t!=="custom"&&wa(parseInt(t))&&(oe(),W())});i(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{if(Vt)return;const t=i(e.currentTarget).attr("quoteLength");if(t==="all")Gi()&&(oe(),W());else{const o=parseInt(t??"1");if(o!==-2){let a=[];e.shiftKey?a=[...r.quoteLength,o]:a=[o],Ld(a,!1)&&(oe(),W())}}});i(".pageTest").on("click","#testConfig .punctuationMode.textButton",()=>{Vt||ls(!r.punctuation)&&(oe(),W())});i(".pageTest").on("click","#testConfig .numbersMode.textButton",()=>{Vt||ka(!r.numbers)&&(oe(),W())});i("header").on("click","nav #startTestButton, #logo",()=>{ee()==="test"&&W()});ge((e,t,o)=>{ee()==="test"&&(e==="language"&&(t!=null&&t.startsWith("arabic")&&oE()&&Ac(!0,!0),W()),e==="difficulty"&&!o&&W(),e==="customLayoutfluid"&&r.funbox.includes("layoutfluid")&&W(),e==="keymapMode"&&t==="next"&&r.mode!=="zen"&&setTimeout(()=>{Za(an([...I.getCurrent()],0))},0)),e==="lazyMode"&&!o&&(r.language.startsWith("arabic")&&aE(t),t===!1&&(uc=!1))});YM((e,t)=>{e==="fail"&&t!==void 0&&mr(t),e==="finish"&&ii()});function Ff(){return r.mode==="custom"&&ta()===!0||r.mode==="custom"&&(Se()==="word"||Se()==="section")&&(qg().value>=5e3||qg().value===0)||r.mode==="custom"&&Se()==="time"&&(ke()>=3600||ke()===0)||r.mode==="words"&&r.words>=5e3||r.words===0||r.mode==="time"&&(r.time>=3600||r.time===0)||r.mode==="zen"}const pE={title:"Are you sure...",list:[{id:"bailOutNo",display:"Nevermind",available:()=>Ff()},{id:"bailOutForSure",display:"Yes, I am sure",exec:()=>{wp(!0),ii()},available:()=>Ff()}]},mE=[{id:"bailOut",display:"Bail out...",icon:"fa-running",subgroup:pE,visible:!1,available:()=>Ff()}],gE=[{id:"addQuoteToFavorite",display:"Add current quote to favorite",icon:"fa-heart",available:()=>{const e=J;return F()&&e!==null&&r.mode==="quote"&&!yt.isQuoteFavorite(e)},exec:async()=>{try{te(),await yt.setQuoteFavorite(J,!0),V(),m("Quote added to favorites",1)}catch(e){V();const t=re(e,"Failed to add quote to favorites");m(t,-1)}}},{id:"removeQuoteFromFavorite",display:"Remove current quote from favorite",icon:"fa-heart-broken",available:()=>{const e=J;return F()&&e!==null&&r.mode==="quote"&&yt.isQuoteFavorite(e)},exec:async()=>{try{te(),await yt.setQuoteFavorite(J,!1),V(),m("Quote removed from favorites",1)}catch(e){V();const t=re(e,"Failed to remove quote from favorites");m(t,-1)}}}],hE={title:"Result saving...",list:[{id:"setResultSavingOff",display:"off",alias:"disabled incognito",exec:()=>{vg(!1),Kt()}},{id:"setResultSavingOn",display:"on",alias:"enabled incognito",exec:()=>{vg(!0),Kt()}}]},Yw=[{id:"setResultSaving",display:"Result saving...",icon:"fa-save",alias:"results",subgroup:hE}];class Jd{constructor(t,o){var s;this.inputElement=t,i(this.inputElement).wrap('<div class="inputAndIndicator"></div>'),this.parentElement=i(this.inputElement).parent(".inputAndIndicator"),this.options=o,this.currentStatus=null;let a='<div class="statusIndicator">';for(const[n,l]of Object.entries(o))a+=`
      <div
        class="indicator level${l.level} hidden"
        data-option-id="${n}"
        
        ${(((s=l.message)==null?void 0:s.length)??0)>27?'data-balloon-length="large"':""}
        data-balloon-pos="left"
        ${l.message??""?`aria-label="${l.message}"`:""}
      >
        <i class="fas fa-fw ${l.icon} ${l.spinIcon?"fa-spin":""}"></i>
      </div>
      `;a+="</div>",this.parentElement.append(a)}hide(){this.parentElement.find(".statusIndicator div").addClass("hidden"),this.currentStatus=null,i(this.inputElement).css("padding-right","0.5em")}show(t,o){this.hide(),this.currentStatus=t;const a=this.parentElement.find(`[data-option-id="${t}"]`);a.removeClass("hidden"),o!==void 0&&o!==""&&(o.length>20?a.attr("data-balloon-length","large"):a.removeAttr("data-balloon-length"),a.attr("aria-label",o)),i(this.inputElement).css("padding-right","2.1em"),this.parentElement.attr("data-indicator-status",t)}get(){return this.currentStatus}}function yE(e,t){return e<=0?t:$t(e,t)}function Xw(e,t,o){let a=t.isValid!==void 0?yE(t.debounceDelay??250,async(s,n,l)=>{var u;const c=await((u=t.isValid)==null?void 0:u.call(t,l));s.value===n&&(c===!0?e({status:"success"}):typeof c=="object"&&"warning"in c?e({status:"warning",errorMessage:c.warning}):e({status:"failed",errorMessage:c}))}):void 0;return async s=>{var u,d;const n=s.target,l=n.value;let c=l;if(o!==void 0&&(c=o(l)),e({status:"checking"}),t.schema!==void 0){const p=t.schema.safeParse(c);if(!p.success){e({status:"failed",errorMessage:p.error.errors.map(f=>f.message).join(", ")});return}}if(a===void 0){e({status:"success"}),(u=n.oninput)==null||u.call(n,s);return}await a(n,l,c),(d=n.oninput)==null||d.call(n,s)}}function ys(e,t){const o=new Jd(e,{success:{icon:"fa-check",level:1},failed:{icon:"fa-times",level:-1},warning:{icon:"fa-exclamation-triangle",level:1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),s=Xw(n=>{var l;n.status==="failed"||n.status==="warning"?o.show(n.status,n.errorMessage):o.show(n.status),(l=t.callback)==null||l.call(t,n)},t,"inputValueConvert"in t?t.inputValueConvert:void 0);e.addEventListener("input",s)}function Fi({input:e,configName:t,validation:o}){if(e===null)throw new Error(`Failed to find input element for ${t}`);const a=o!==void 0&&"inputValueConvert"in o?o.inputValueConvert:void 0;let s="checking";if(o!==void 0){const l=ol.shape[t];ys(e,{schema:o.schema?l:void 0,isValid:o.isValid,inputValueConvert:a,callback:c=>{s=c.status}})}const n=()=>{if(e.value===""&&((o==null?void 0:o.resetIfEmpty)??!0)&&(e.value=new String(r[t]).toString(),e.dispatchEvent(new Event("input"))),s==="failed"){const u=i(e.parentElement);u.stop(!0,!0).addClass("hasError").animate({undefined:1},500,()=>{u.removeClass("hasError")});return}const l=(a==null?void 0:a(e.value))??e.value;if(r[t]===l)return;M(t,l,!1)&&m("Saved",1,{duration:1})};e.addEventListener("keypress",l=>{l.key==="Enter"&&n()}),e.addEventListener("focusout",l=>n())}class D{constructor(t,o,a,s){this.configName=t,this.mode=a,this.configFunction=o,this.setCallback=s==null?void 0:s.setCallback,this.updateCallback=s==null?void 0:s.updateCallback,this.validation=s==null?void 0:s.validation;const n=l=>{let c=l;return this.validation!==void 0&&"inputValueConvert"in this.validation&&(c=this.validation.inputValueConvert(l)),c==="true"&&(c=!0),c==="false"&&(c=!1),c};if(this.mode==="select"){const l=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] select`);if(l===null)throw new Error(`Failed to find select element for ${t}`);if(l.hasAttribute("multiple"))throw new Error("multi-select dropdowns not supported. Config: "+this.configName);l.addEventListener("change",c=>{const u=i(c.target);u.hasClass("disabled")||u.hasClass("no-auto-handle")||this.setValue(u.val())}),this.elements=[l]}else if(this.mode==="button"){const l=document.querySelectorAll(`
        .pageSettings .section[data-config-name=${this.configName}] .buttons button, .pageSettings .section[data-config-name=${this.configName}] .inputs button`);if(l.length===0)throw new Error(`Failed to find a button element for ${t}`);for(const c of l)c.addEventListener("click",u=>{if(c.classList.contains("disabled")||c.classList.contains("no-auto-handle"))return;let d=c.getAttribute("data-config-value");if(d===null||d===""){console.error(`Failed to handle settings button click for ${t}: data-${t} is missing or empty.`),m("Button is missing data property. Please report this.",-1);return}let p=n(d);this.setValue(p)});this.elements=Array.from(l)}else if(this.mode==="input"){const l=document.querySelector(`
        .pageSettings .section[data-config-name=${this.configName}] .inputs .inputAndButton input`);if(l===null)throw new Error(`Failed to find input element for ${t}`);let c;this.validation!==void 0&&(c={schema:this.validation.schema??!1,isValid:this.validation.isValid,inputValueConvert:"inputValueConvert"in this.validation?this.validation.inputValueConvert:void 0}),Fi({input:l,configName:this.configName,validation:c}),this.elements=[l]}else if(this.mode==="range"){const l=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] input[type=range]`);if(l===null)throw new Error(`Failed to find range element for ${t}`);const c=$t(250,u=>{this.setValue(u)});l.addEventListener("input",u=>{if(l.classList.contains("disabled")||l.classList.contains("no-auto-handle"))return;const d=parseFloat(l.value);this.updateUI(d),c(d)}),this.elements=[l]}else this.elements=[];if(this.elements.length===0||this.elements===void 0)throw new Error(`Failed to find elements for ${t} with mode ${a}`);this.updateUI()}setValue(t){if(r[this.configName]===t)return!1;const o=this.configFunction(t);return this.updateUI(),this.setCallback&&this.setCallback(),o}updateUI(t){var a,s;const o=t??r[this.configName];if(this.mode==="select"){const n=(a=this.elements)==null?void 0:a[0];if(!n)return;const l=n.slim;if(l!==void 0){const c=l.getSelected()[0]??null;o!==c&&l.setSelected(o)}else n.value!==o&&(n.value=o)}else if(this.mode==="button")for(const n of this.elements){let c=n.getAttribute("data-config-value");c==="true"&&(c=!0),c==="false"&&(c=!1),c!==o?n.classList.remove("active"):n.classList.add("active")}else if(this.mode==="range"){const n=(s=this.elements)==null?void 0:s[0],l=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] .value`);if(n==null||l===null)return;n.value=o,l.textContent=`${o.toFixed(1)}`}this.updateCallback&&this.updateCallback()}}const Zw=new Gt({key:"activeTags",schema:P.array(Wy),fallback:[]});function Mn(){var t,o;const e=[];(o=(t=x())==null?void 0:t.tags)==null||o.forEach(a=>{a.active===!0&&e.push(a._id)}),Zw.set(e)}function bE(e=!1){var o;const t=x();t&&(t.tags=(o=t.tags)==null?void 0:o.map(a=>(a.active=!1,a)),st(t),Kt(),e||Mn())}function vE(e,t,o=!1){var s;const a=x();a&&(a.tags=(s=a.tags)==null?void 0:s.map(n=>(n._id===e&&(n.active=t),n)),st(a),Kt(),o||Mn())}function bm(e,t=!1){var o,a;(a=(o=x())==null?void 0:o.tags)==null||a.forEach(s=>{s._id===e&&(s.active===void 0?s.active=!0:s.active=!s.active)}),Kt(),t||Mn()}function wE(){const e=Zw.get();for(const t of e)bm(t,!0);Mn()}sa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&wE()});async function Jw(e){var a,s;const t=x();if(!t)return;const o=(a=t.presets)==null?void 0:a.find(n=>n._id===e);if(o!==void 0){if(rh(o)?await ln({...structuredClone(r),...o.config}):await ln(o.config),(!rh(o)||(s=o.settingGroups)!=null&&s.includes("behavior"))&&(bE(!0),o.config.tags)){for(const n of o.config.tags)vE(n,!0,!1);Mn()}W(),m("Preset applied",1,{duration:2}),Cn()}}function rh(e){return e.settingGroups!==void 0&&e.settingGroups!==null}async function CE(e){var a;const t=x();if(!t)return;const o=(a=t.presets)==null?void 0:a.find(s=>s._id===e);if(o===void 0){m("Preset not found",0);return}return o}function e0(){var t;let e=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&je!==null&&(e=je),document.querySelectorAll(".pageSettings .section.themes .theme").forEach(o=>{o.classList.remove("active")}),(t=document.querySelector(`.pageSettings .section.themes .theme[theme='${e}']`))==null||t.classList.add("active")}function gn(e,t,o=!1,a=!1){if(o){const u=e.find("input.color").attr("id");u===void 0&&console.error("Could not find color ID!"),!a&&u!==void 0&&document.documentElement.style.setProperty(u,t);const d=e.find("label");d.val(t),d.attr("value",t),d.attr("for")!=="--bg-color"&&d.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t),e.find("input.color").val(t);return}const s=[{rule:/\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,start:"rgb(",end:")"},{rule:/\b[A-Z, a-z, 0-9]{6}\b/,start:"#",end:""},{rule:/\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,start:"hsl(",end:")"}];t=t.replace("°","");for(const u of s)if(t.match(u.rule)){t=u.start+t+u.end;break}i(".colorConverter").css("color",t);const n=WL(i(".colorConverter").css("color"));if(n===void 0)return;t=n;const l=e.find("input.color").attr("id");l===void 0&&console.error("Could not find color ID!"),!a&&l!==void 0&&document.documentElement.style.setProperty(l,t);const c=e.find("label");c.val(t),c.attr("value",t),c.attr("for")!=="--bg-color"&&c.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t),e.find("input.color").val(t)}async function t0(){const e=document.querySelector(".pageSettings .section.themes .favThemes.buttons"),t=document.querySelector(".pageSettings .section.themes .allThemes.buttons");if(e===null||t===null){const l="Failed to fill preset theme buttons: favThemes or allThemes element not found";m(l,-1),xp(new Error(l)),console.error(l,{favThemesEl:e,themesEl:t});return}e.innerHTML="",t.innerHTML="";let o="",a="",s=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&je!==null&&(s=je);const n=RM;if(r.favThemes.length>0){e.style.marginBottom="1rem";for(const l of n)if(r.favThemes.includes(l.name)){const c=s===l.name?"active":"";o+=`<div class="theme button ${c}" theme='${l.name}' style="background: ${l.bgColor}; color: ${l.mainColor};outline: 0 solid ${l.mainColor};">
          <div class="favButton active"><i class="fas fa-star"></i></div>
          <div class="text">${l.name.replace(/_/g," ")}</div>
          <div class="themeBubbles" style="background: ${l.bgColor};outline: 0.25rem solid ${l.bgColor};">
            <div class="themeBubble" style="background: ${l.mainColor}"></div>
            <div class="themeBubble" style="background: ${l.subColor}"></div>
            <div class="themeBubble" style="background: ${l.textColor}"></div>
          </div>
          </div>
          `}e.innerHTML=o}else e.style.marginBottom="0";for(const l of n){if(r.favThemes.includes(l.name))continue;const c=s===l.name?"active":"";a+=`<div class="theme button ${c}" theme='${l.name}' style="background: ${l.bgColor}; color: ${l.mainColor};outline: 0 solid ${l.mainColor};">
      <div class="favButton"><i class="far fa-star"></i></div>
      <div class="text">${l.name.replace(/_/g," ")}</div>
      <div class="themeBubbles" style="background: ${l.bgColor};outline: 0.25rem solid ${l.bgColor};">
        <div class="themeBubble" style="background: ${l.mainColor}"></div>
        <div class="themeBubble" style="background: ${l.subColor}"></div>
        <div class="themeBubble" style="background: ${l.textColor}"></div>
      </div>
      </div>
      `}t.innerHTML=a}async function eu(){var s;const e=i(".pageSettings .section.themes .allCustomThemes.buttons").empty(),t=i(".pageSettings .section.themes .addCustomThemeButton"),o=i(".pageSettings .section.themes .customThemeEdit #saveCustomThemeButton");if(!F()){o.text("save"),t.addClass("hidden"),e.css("margin-bottom","0");return}o.text("save as new"),t.removeClass("hidden");const a=((s=x())==null?void 0:s.customThemes)??[];a.length===0?e.css("margin-bottom","0"):e.css("margin-bottom","1rem");for(const n of a){const l=n.colors[0],c=n.colors[1];e.append(`<div class="customTheme button" customThemeId='${n._id}' 
      style="color:${c};background:${l}">
      <div class="editButton"><i class="fas fa-pen"></i></div>
      <div class="text">${n.name.replace(/_/g," ")}</div>
      <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
      </div>`)}}function kE(e=!1){i(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((t,o)=>{const a=r.customThemeColors[qa.indexOf(i(o).find("input.color").attr("id"))];gn(i(o),a,!1,e)})}function SE(e){if(r.favThemes.includes(e))Mc(r.favThemes.filter(t=>t!==e));else{const t=r.favThemes;t.push(e),Mc(t)}Cn()}function xE(){const e=[];for(const t of qa)e.push(i(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"));nn(e),m("Custom theme saved",1)}function TE(){i(".pageSettings .section.themes .tabs button").removeClass("active"),i(`.pageSettings .section.themes .tabs button[data-tab="${r.customTheme?"custom":"preset"}"]`).addClass("active"),r.customTheme?tn(i('.pageSettings [tabContent="preset"]'),i('.pageSettings [tabContent="custom"]'),250):tn(i('.pageSettings [tabContent="custom"]'),i('.pageSettings [tabContent="preset"]'),250)}async function LE(){await t0(),e0()}i(".pageSettings .section.themes .tabs button").on("click",e=>{i(".pageSettings .section.themes .tabs button").removeClass("active");const t=i(e.currentTarget);t.addClass("active"),t.attr("data-tab")==="preset"?Sa(!1):Sa(!0)});i(".pageSettings").on("click"," .section.themes .customTheme.button",e=>{var a,s;if(i(e.target).hasClass("delButton")||i(e.target).hasClass("editButton"))return;const t=i(e.currentTarget).attr("customThemeId")??"",o=(s=(a=x())==null?void 0:a.customThemes)==null?void 0:s.find(n=>n._id===t);if(o===void 0){console.error("Could not find custom theme in snapshot for id ",t);return}nn(o.colors)});i(".pageSettings").on("click",".section.themes .theme .favButton",e=>{const t=i(e.currentTarget).parents(".theme.button").attr("theme");t!==void 0?SE(t):console.error("Could not find the theme attribute attached to the button clicked!")});i(".pageSettings").on("click",".section.themes .theme.button",e=>{const t=i(e.currentTarget).attr("theme");!i(e.target).hasClass("favButton")&&t!==void 0&&$p(t)});i(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input",e=>{const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();gn(i(".colorPicker #"+t).parent(),o,!0)});i(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change",e=>{const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();gn(i(".colorPicker #"+t).parent(),o)});i(".pageSettings .section.themes .tabContainer .customTheme input.input").on("blur",e=>{if(e.target.id==="name")return;const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();gn(i(".colorPicker #"+t).parent(),o)}).on("keypress",function(e){if(e.target.id!=="name"&&e.code==="Enter"){i(this).attr("disabled","disabled");const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();gn(i(".colorPicker #"+t).parent(),o),i(this).removeAttr("disabled")}});i(".pageSettings #loadCustomColorsFromPreset").on("click",async()=>{await ew(r.theme),qa.forEach(t=>{document.documentElement.style.setProperty(t,"")}),Zv();const e=await ms();qa.forEach(t=>{let o;t==="--bg-color"?o=e.bg:t==="--main-color"?o=e.main:t==="--sub-color"?o=e.sub:t==="--sub-alt-color"?o=e.subAlt:t==="--caret-color"?o=e.caret:t==="--text-color"?o=e.text:t==="--error-color"?o=e.error:t==="--error-extra-color"?o=e.errorExtra:t==="--colorful-error-color"?o=e.colorfulError:t==="--colorful-error-extra-color"&&(o=e.colorfulErrorExtra),gn(i(".colorPicker #"+t).parent(),o)})});i(".pageSettings #saveCustomThemeButton").on("click",async()=>{if(xE(),F()){const e={name:"custom",colors:r.customThemeColors};te(),await dx(e),V()}eu()});ge(e=>{e==="theme"&&ee()==="settings"&&e0(),e==="favThemes"&&ee()==="settings"&&t0()});const ha={mode:"import",value:""};function o0(e,t){ha.mode=e,ha.value="",Rf.show({focusFirstInput:"focusAndSelect",beforeAnimation:async o=>{var a,s,n,l;o.querySelector("input").value=ha.value,ha.mode==="export"?((a=o.querySelector("button"))==null||a.classList.add("hidden"),(s=o.querySelector("input"))==null||s.setAttribute("readonly","true")):ha.mode==="import"&&((n=o.querySelector("button"))==null||n.classList.remove("hidden"),(l=o.querySelector("input"))==null||l.removeAttribute("readonly"))}})}const Rf=new le({dialogId:"importExportSettingsModal",setup:async e=>{var t;(t=e.querySelector("input"))==null||t.addEventListener("input",o=>{ha.value=o.target.value}),e==null||e.addEventListener("submit",async o=>{if(o.preventDefault(),ha.mode==="import"){if(ha.value===""){Rf.hide();return}await qb(ha.value),Rf.hide()}})}});async function Vn(){}class Ha{constructor(t){this.id=t.id,this.display=t.display,this.element=t.element,this.pathname=t.path,this.loadingOptions=t.loadingOptions,this.beforeHide=t.beforeHide??Vn,this.afterHide=t.afterHide??Vn,this._beforeShow=t.beforeShow??Vn,this.afterShow=t.afterShow??Vn}async beforeShow(t){var o;await((o=this._beforeShow)==null?void 0:o.call(this,t))}}class vm extends Ha{constructor(t){super(t),this.urlSchema=t.urlParamsSchema,this._beforeShow=t.beforeShow??Vn}readUrlParams(){const t=new URLSearchParams(window.location.search),o=OS({schema:this.urlSchema,input:t});if(o.success)return o.data}setUrlParams(t){const o=NS({schema:this.urlSchema,data:t}),a=`${window.location.pathname}?${o.toString()}`;window.history.replaceState({},"",a)}async beforeShow(t){var a;const o=this.readUrlParams();await((a=this._beforeShow)==null?void 0:a.call(this,{...t,urlParams:o}))}}const Zc=Zk._def.values,ya={Roboto_Mono:{fileName:"RobotoMono-Regular.woff2"},Noto_Naskh_Arabic:{fileName:"NotoNaskhArabic-Regular.woff2"},Source_Code_Pro:{fileName:"SourceCodePro-Regular.woff2"},IBM_Plex_Sans:{fileName:"IBMPlexSans-SemiBold.woff2",weight:600},Inconsolata:{fileName:"Inconsolata-Regular.woff2"},Fira_Code:{fileName:"FiraCode-Regular.woff2"},JetBrains_Mono:{fileName:"JetBrainsMono-Regular.woff2"},Roboto:{fileName:"Roboto-Regular.woff2"},Montserrat:{fileName:"Montserrat-Regular.woff2"},Titillium_Web:{fileName:"TitilliumWeb-Regular.woff2"},Lexend_Deca:{fileName:"LexendDeca-Regular.woff2"},Comic_Sans_MS:{display:"Helvetica",systemFont:!0},Oxygen:{fileName:"Oxygen-Regular.woff2"},Nunito:{fileName:"Nunito-Bold.woff2",weight:700},Itim:{fileName:"Itim-Regular.woff2"},Courier:{systemFont:!0},Comfortaa:{fileName:"Comfortaa-Regular.woff2"},Coming_Soon:{fileName:"ComingSoon-Regular.woff2"},Atkinson_Hyperlegible:{fileName:"AtkinsonHyperlegible-Regular.woff2"},Lato:{fileName:"Lato-Regular.woff2"},Lalezar:{fileName:"Lalezar-Regular.woff2"},Boon:{display:"Boon (ไทย)",fileName:"Boon-Regular.woff2"},Open_Dyslexic:{fileName:"OpenDyslexic-Regular.woff2"},Ubuntu:{fileName:"Ubuntu-Regular.woff2"},Ubuntu_Mono:{fileName:"UbuntuMono-Regular.woff2"},Georgia:{systemFont:!0},Cascadia_Mono:{fileName:"CascadiaMono-Regular.woff2"},IBM_Plex_Mono:{fileName:"IBMPlexMono-Regular.woff2"},Overpass_Mono:{fileName:"OverpassMono-Regular.woff2"},Hack:{fileName:"Hack-Regular.woff2"},CommitMono:{fileName:"CommitMono-Regular.woff2"},Mononoki:{fileName:"Mononoki-Regular.woff2"},Parkinsans:{fileName:"Parkinsans-Regular.woff2"},Geist:{fileName:"Geist-Medium.woff2"},Sarabun:{fileName:"Sarabun-Bold.woff2"},Kanit:{fileName:"Kanit-Regular.woff2"},Geist_Mono:{fileName:"GeistMono-Medium.woff2"},Iosevka:{fileName:"Iosevka-Regular.woff2"},Proto:{display:"0xProto",fileName:"0xProto-Regular.woff2"}},go=document.querySelector(".pageSettings .section[data-config-name='customBackgroundSize']"),ua=go==null?void 0:go.querySelector(".usingLocalImage"),Li=go==null?void 0:go.querySelector(".separator"),fa=go==null?void 0:go.querySelector(".uploadContainer"),$i=go==null?void 0:go.querySelector(".inputAndButton");async function $E(e){return new Promise((t,o)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=o,a.readAsDataURL(e)})}async function Kr(){await at.hasFile("LocalBackgroundFile")?(ua==null||ua.classList.remove("hidden"),Li==null||Li.classList.add("hidden"),fa==null||fa.classList.add("hidden"),$i==null||$i.classList.add("hidden")):(ua==null||ua.classList.add("hidden"),Li==null||Li.classList.remove("hidden"),fa==null||fa.classList.remove("hidden"),$i==null||$i.classList.remove("hidden"))}var iy;(iy=ua==null?void 0:ua.querySelector("button"))==null||iy.addEventListener("click",async()=>{await at.deleteFile("LocalBackgroundFile"),await Kr(),await mn()});var ny;(ny=fa==null?void 0:fa.querySelector("input[type='file']"))==null||ny.addEventListener("change",async e=>{var s;const t=e.target,o=(s=t.files)==null?void 0:s[0];if(!o)return;if(!o.type.match(/image\/(jpeg|jpg|png|gif|webp)/)){m("Unsupported image format",0),t.value="";return}const a=await $E(o);await at.storeFile("LocalBackgroundFile",a),await Kr(),await mn(),t.value=""});const ho=document.querySelector(".pageSettings .section[data-config-name='fontFamily']"),pa=ho==null?void 0:ho.querySelector(".usingLocalFont"),Mi=ho==null?void 0:ho.querySelector(".separator"),ma=ho==null?void 0:ho.querySelector(".uploadContainer"),Ai=ho==null?void 0:ho.querySelector(".buttons");async function ME(e){return new Promise((t,o)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=o,a.readAsDataURL(e)})}async function Gr(){await at.hasFile("LocalFontFamilyFile")?(pa==null||pa.classList.remove("hidden"),Mi==null||Mi.classList.add("hidden"),ma==null||ma.classList.add("hidden"),Ai==null||Ai.classList.add("hidden")):(pa==null||pa.classList.add("hidden"),Mi==null||Mi.classList.remove("hidden"),ma==null||ma.classList.remove("hidden"),Ai==null||Ai.classList.remove("hidden"))}var ry;(ry=pa==null?void 0:pa.querySelector("button"))==null||ry.addEventListener("click",async()=>{await at.deleteFile("LocalFontFamilyFile"),await Gr(),await Hr()});var ly;(ly=ma==null?void 0:ma.querySelector("input[type='file']"))==null||ly.addEventListener("change",async e=>{var s;const t=e.target,o=(s=t.files)==null?void 0:s[0];if(!o)return;if(!o.type.match(/font\/(woff|woff2|ttf|otf)/)&&!o.name.match(/\.(woff|woff2|ttf|otf)$/i)){m("Unsupported font format, must be woff, woff2, ttf or otf.",0),t.value="";return}const a=await ME(o);await at.storeFile("LocalFontFamilyFile",a),await Gr(),await Hr(),t.value=""});let lh=!1,fc,pc;const B={},AE=Jk.or(P.enum(["resetSettings","updateCookiePreferences","importexportSettings","theme","presets","tags"])),EE=P.object({highlight:AE}).partial();async function _E(){B.smoothCaret=new D("smoothCaret",AT,"button"),B.codeUnindentOnBackspace=new D("codeUnindentOnBackspace",ET,"button"),B.difficulty=new D("difficulty",ca,"button"),B.quickRestart=new D("quickRestart",qT,"button"),B.showAverage=new D("showAverage",bT,"button"),B.keymapMode=new D("keymapMode",xo,"button",{updateCallback:()=>{r.keymapMode==="off"?(i(".pageSettings .section[data-config-name='keymapStyle']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapLayout']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapLegendStyle']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapShowTopRow']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapSize']").addClass("hidden")):(i(".pageSettings .section[data-config-name='keymapStyle']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapLayout']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapLegendStyle']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapShowTopRow']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapSize']").removeClass("hidden"))}}),B.keymapStyle=new D("keymapStyle",OT,"button"),B.keymapLayout=new D("keymapLayout",Is,"select"),B.keymapLegendStyle=new D("keymapLegendStyle",HT,"button"),B.keymapShowTopRow=new D("keymapShowTopRow",NT,"button"),B.keymapSize=new D("keymapSize",$d,"range"),B.showKeyTips=new D("showKeyTips",MT,"button"),B.freedomMode=new D("freedomMode",BT,"button",{setCallback:()=>{var e;(e=B.confidenceMode)==null||e.updateUI()}}),B.strictSpace=new D("strictSpace",mT,"button"),B.oppositeShiftMode=new D("oppositeShiftMode",gT,"button"),B.confidenceMode=new D("confidenceMode",FT,"button",{setCallback:()=>{var e,t;(e=B.freedomMode)==null||e.updateUI(),(t=B.stopOnError)==null||t.updateUI()}}),B.indicateTypos=new D("indicateTypos",RT,"button"),B.hideExtraLetters=new D("hideExtraLetters",CT,"button"),B.blindMode=new D("blindMode",Zx,"button"),B.quickEnd=new D("quickEnd",cT,"button"),B.repeatQuotes=new D("repeatQuotes",uT,"button"),B.ads=new D("ads",dT,"button"),B.alwaysShowWordsHistory=new D("alwaysShowWordsHistory",nT,"button"),B.britishEnglish=new D("britishEnglish",zT,"button"),B.singleListCommandLine=new D("singleListCommandLine",rT,"button"),B.capsLockWarning=new D("capsLockWarning",lT,"button"),B.flipTestColors=new D("flipTestColors",fT,"button"),B.showOutOfFocusWarning=new D("showOutOfFocusWarning",tT,"button"),B.colorfulMode=new D("colorfulMode",pT,"button"),B.startGraphsAtZero=new D("startGraphsAtZero",_T,"button"),B.autoSwitchTheme=new D("autoSwitchTheme",_b,"button"),B.randomTheme=new D("randomTheme",PT,"button"),B.stopOnError=new D("stopOnError",Ab,"button",{setCallback:()=>{var e;(e=B.confidenceMode)==null||e.updateUI()}}),B.soundVolume=new D("soundVolume",Yx,"range"),B.playTimeWarning=new D("playTimeWarning",Xx,"button",{setCallback:()=>{r.playTimeWarning!=="off"&&Gc()}}),B.playSoundOnError=new D("playSoundOnError",jx,"button",{setCallback:()=>{r.playSoundOnError!=="off"&&yl()}}),B.playSoundOnClick=new D("playSoundOnClick",Qx,"button",{setCallback:()=>{r.playSoundOnClick!=="off"&&Ho("KeyQ")}}),B.showAllLines=new D("showAllLines",of,"button"),B.paceCaret=new D("paceCaret",oT,"button"),B.repeatedPace=new D("repeatedPace",aT,"button"),B.minWpm=new D("minWpm",sT,"button"),B.minAcc=new D("minAcc",iT,"button"),B.minBurst=new D("minBurst",oc,"button"),B.smoothLineScroll=new D("smoothLineScroll",IT,"button"),B.lazyMode=new D("lazyMode",Ac,"button"),B.layout=new D("layout",Qa,"select"),B.language=new D("language",rn,"select"),B.fontSize=new D("fontSize",UT,"input",{validation:{schema:!0,inputValueConvert:Number}}),B.maxLineWidth=new D("maxLineWidth",VT,"input",{validation:{schema:!0,inputValueConvert:Number}}),B.caretStyle=new D("caretStyle",hT,"button"),B.paceCaretStyle=new D("paceCaretStyle",yT,"button"),B.timerStyle=new D("timerStyle",kT,"button"),B.liveSpeedStyle=new D("liveSpeedStyle",ST,"button"),B.liveAccStyle=new D("liveAccStyle",xT,"button"),B.liveBurstStyle=new D("liveBurstStyle",TT,"button"),B.highlightMode=new D("highlightMode",As,"button"),B.tapeMode=new D("tapeMode",vT,"button"),B.tapeMargin=new D("tapeMargin",wT,"input",{validation:{schema:!0,inputValueConvert:Number}}),B.timerOpacity=new D("timerOpacity",$T,"button"),B.timerColor=new D("timerColor",LT,"button"),B.fontFamily=new D("fontFamily",Eb,"button",{updateCallback:()=>{const e=i(".pageSettings .section[data-config-name='fontFamily'] .buttons button[data-config-value='custom']");i(".pageSettings .section[data-config-name='fontFamily'] .buttons .active").length===0?(e.addClass("active"),e.text(`Custom (${r.fontFamily.replace(/_/g," ")})`)):e.text("Custom")}}),B.alwaysShowDecimalPlaces=new D("alwaysShowDecimalPlaces",Jx,"button"),B.typingSpeedUnit=new D("typingSpeedUnit",eT,"button"),B.customBackgroundSize=new D("customBackgroundSize",Ib,"button")}async function IE(){if(lh)return;new lt({select:".pageSettings .section[data-config-name='language'] select",data:ch(s=>s===r.language),settings:{searchPlaceholder:"search"}});const e=s=>({value:s,text:s.replace(/_/g," ")});new lt({select:".pageSettings .section[data-config-name='layout'] select",data:[{text:"off",value:"default"},...Zc.filter(s=>s!=="korean").map(e)]}),new lt({select:".pageSettings .section[data-config-name='keymapLayout'] select",data:[{text:"emulator sync",value:"overrideSync"},...Zc.map(e)]}),new lt({select:".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light",data:dh(s=>s.name===r.themeLight),events:{afterChange:s=>{var n;DT((n=s[0])==null?void 0:n.value)}}}),new lt({select:".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark",data:dh(s=>s.name===r.themeDark),events:{afterChange:s=>{var n;WT((n=s[0])==null?void 0:n.value)}}});const t=document.querySelector(".pageSettings .section[data-config-name='funbox'] .buttons");let o="";for(const s of mp())s.name==="mirror"?o+=`<button class="funbox" data-funbox-name="mirror" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1);">${s.name.replace(/_/g," ")}</button>`:s.name==="upside_down"?o+=`<button class="funbox" data-funbox-name="upside_down" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1) scaleY(-1); z-index:1;">${s.name.replace(/_/g," ")}</button>`:s.name==="underscore_spaces"?o+=`<button class="funbox" data-funbox-name="underscore_spaces" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit">${s.name}</button>`:o+=`<button class="funbox" data-funbox-name="${s.name}" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit">${s.name.replace(/_/g," ")}</button>`;t.innerHTML=o;const a=document.querySelector(".pageSettings .section[data-config-name='fontFamily'] .buttons");if(a.innerHTML===""){let s="";for(const n of vt(ya).sort((l,c)=>(ya[l].display??l.replace(/_/g," ")).localeCompare(ya[c].display??c.replace(/_/g," ")))){const l=ya[n];let c=n.replace(/_/g," ");l.systemFont||(c+=" Preview");const u=r.fontFamily===n?" active":"",d=l.display??n.replace(/_/g," ");s+=`<button class="${u}" style="font-family:'${c}'" data-config-value="${n}">${d}</button>`}s+='<button class="no-auto-handle" data-config-value="custom"">Custom</button>',a.innerHTML=s}fc=new lt({select:".pageSettings .section[data-config-name='customLayoutfluid'] select",settings:{keepOrder:!0,minSelected:2},events:{afterChange:s=>{const n=s.map(l=>l.value);br(n,r.customLayoutfluid)||GT(n)}}}),pc=new lt({select:".pageSettings .section[data-config-name='customPolyglot'] select",settings:{minSelected:2},data:ch(s=>r.customPolyglot.includes(s)),events:{afterChange:s=>{const n=s.map(l=>l.value);ps(n,r.customPolyglot)||jT(n)}}}),Fi({input:document.querySelector(".pageSettings .section[data-config-name='minWpm'] input"),configName:"minWpmCustomSpeed",validation:{schema:!0,inputValueConvert:s=>bt(r.typingSpeedUnit).toWpm(new Number(s).valueOf())}}),Fi({input:document.querySelector(".pageSettings .section[data-config-name='minAcc'] input"),configName:"minAccCustom",validation:{schema:!0,inputValueConvert:Number}}),Fi({input:document.querySelector(".pageSettings .section[data-config-name='minBurst'] input"),configName:"minBurstCustomSpeed",validation:{schema:!0,inputValueConvert:s=>bt(r.typingSpeedUnit).toWpm(new Number(s).valueOf())}}),Fi({input:document.querySelector(".pageSettings .section[data-config-name='paceCaret'] input"),configName:"paceCaretCustomSpeed",validation:{schema:!0,inputValueConvert:Number}}),Fi({input:document.querySelector(".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']"),configName:"customBackground",validation:{schema:!0,resetIfEmpty:!1}}),hn(!0),await _E(),await eu(),hn(!1),lh=!0}function a0(){i(".pageSettings .section.needsAccount").addClass("hidden")}function s0(){i(".pageSettings .section.needsAccount").removeClass("hidden"),n0(),r0()}function i0(){const e=document.querySelectorAll(".pageSettings .section[data-config-name='funbox'] button");for(const t of e){t.classList.remove("active"),t.classList.remove("disabled");const o=t.getAttribute("data-config-value"),a=t.getAttribute("data-funbox-name");o===null||a===null||(r.funbox.includes(a)?t.classList.add("active"):tl(wo(),a)||t.classList.add("disabled"))}}function n0(){var e,t;if(F()&&x()){const o=i(".pageSettings .section.tags .tagsList").empty();(t=(e=x())==null?void 0:e.tags)==null||t.forEach(a=>{o.append(`

      <div class="buttons tag" data-id="${a._id}" data-name="${a.name}" data-display="${a.display}">
        <button class="tagButton ${a.active?"active":""}" active="${a.active}">
          ${a.display}
        </button>
        <button class="clearPbButton" aria-label="clear tags personal bests" data-balloon-pos="left" >
          <i class="fas fa-crown fa-fw"></i>
        </button>
        <button class="editButton" aria-label="rename tag" data-balloon-pos="left" >
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton" aria-label="remove tag"  data-balloon-pos="left" >
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>

      `)}),i(".pageSettings .section.tags").removeClass("hidden")}else i(".pageSettings .section.tags").addClass("hidden")}function r0(){var e,t;if(F()&&x()){const o=i(".pageSettings .section.presets .presetsList").empty();(t=(e=x())==null?void 0:e.presets)==null||t.forEach(a=>{o.append(`
      <div class="buttons preset" data-id="${a._id}" data-name="${a.name}" data-display="${a.display}">
        <button class="presetButton">${a.display}</button>
        <button class="editButton">
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton">
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>
      
      `)}),i(".pageSettings .section.presets").removeClass("hidden")}else i(".pageSettings .section.presets").addClass("hidden")}async function l0(){const e=r.customBackground!==""||await at.hasFile("LocalBackgroundFile"),t=i(".customBackground img").is(":visible");e&&t?i(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden"):i(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden")}async function Ca(e={}){if(ee()!=="settings")return;r.showKeyTips?i(".pageSettings .tip").removeClass("hidden"):i(".pageSettings .tip").addClass("hidden");for(const n of Object.values(B))"updateUI"in n&&n.updateUI();n0(),r0(),i0(),await Te(0),TE(),kE(!0),await Kr(),await l0(),await Gr();const t=(n,l,c)=>{if(e.eventKey===void 0||e.eventKey===n){const u=document.querySelector(l);if(u===null)throw new Error("Unknown input element "+l);u.value=new String(c).toString(),u.dispatchEvent(new Event("input"))}};t("paceCaret",".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed",bt(r.typingSpeedUnit).fromWpm(r.paceCaretCustomSpeed)),t("minWpmCustomSpeed",".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed",bt(r.typingSpeedUnit).fromWpm(r.minWpmCustomSpeed)),t("minAccCustom",".pageSettings .section[data-config-name='minAcc'] input.customMinAcc",r.minAccCustom),t("minBurstCustomSpeed",".pageSettings .section[data-config-name='minBurst'] input.customMinBurst",bt(r.typingSpeedUnit).fromWpm(r.minBurstCustomSpeed)),r.autoSwitchTheme?i(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").removeClass("hidden"):i(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").addClass("hidden"),t("fontSize",".pageSettings .section[data-config-name='fontSize'] input",r.fontSize),t("maxLineWidth",".pageSettings .section[data-config-name='maxLineWidth'] input",r.maxLineWidth),t("keymapSize",".pageSettings .section[data-config-name='keymapSize'] input",r.keymapSize),t("tapeMargin",".pageSettings .section[data-config-name='tapeMargin'] input",r.tapeMargin),t("customBackground",".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']",r.customBackground),F()?s0():a0(),Jv();const o=window.navigator.userAgent.toLowerCase(),a=o.includes("mac")&&!o.includes("firefox")?"cmd":"ctrl",s=r.quickRestart==="esc"?"tab":"esc";i(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (<key>${s}</key> or <key>${a}</key> + <key>shift</key> + <key>p</key>)`),fc!==void 0&&!br(fc.getSelected(),r.customLayoutfluid)&&fc.setData(qE()),pc!==void 0&&!ps(pc.getSelected(),r.customPolyglot)&&pc.setSelected(r.customPolyglot)}function c0(e){u0(void 0);const t=i(`.pageSettings .settingsGroup.${e}`);t.stop(!0,!0).slideToggle(250).toggleClass("slideup"),t.hasClass("slideup")?i(`.pageSettings .sectionGroupTitle[group=${e}]`).addClass("rotateIcon"):i(`.pageSettings .sectionGroupTitle[group=${e}]`).removeClass("rotateIcon")}i(".pageSettings .section[data-config-name='funbox'] .buttons").on("click","button",e=>{const t=i(e.currentTarget).attr("data-config-value");Ov(t),i0()});i(".pageSettings .section.tags").on("click",".tagsList .tag .tagButton",e=>{const t=e.currentTarget,o=i(t).parent(".tag").attr("data-id");bm(o),i(t).toggleClass("active")});i(".pageSettings .section.presets").on("click",".presetsList .preset .presetButton",async e=>{const t=e.currentTarget,o=i(t).parent(".preset").attr("data-id");await Jw(o),Ca()});i("#importSettingsButton").on("click",()=>{o0("import")});i("#exportSettingsButton").on("click",()=>{const e=JSON.stringify(r);navigator.clipboard.writeText(e).then(function(){m("JSON Copied to clipboard",0)},function(){o0("export")})});i(".pageSettings .sectionGroupTitle").on("click",e=>{c0(i(e.currentTarget).attr("group"))});i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton button.save").on("click",()=>{$d(parseFloat(i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("focusout",()=>{$d(parseFloat(i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&$d(parseFloat(i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});i(".pageSettings .quickNav .links a").on("click",e=>{const t=e.target.innerText;i(`.pageSettings .settingsGroup.${t}`).hasClass("slideup")&&c0(t)});let d0=!1;function hn(e){d0=e}function ch(e){return Op.map(t=>{var o;return{label:t,options:(o=yv[t])==null?void 0:o.map(a=>({text:ea(a),value:a,selected:e(a)}))}})}function qE(){const e=r.customLayoutfluid;return[...e,...Zc.filter(t=>!e.includes(t))].map(t=>({text:t.replace(/_/g," "),value:t,selected:e.includes(t)}))}function dh(e){return hl.map(t=>({value:t.name,text:t.name.replace(/_/g," "),selected:e(t)}))}function u0(e){if(e===void 0){const o=document.querySelector(".section.highlight");o!==null&&o.classList.remove("highlight");return}const t=document.querySelector(`[data-config-name="${e}"] .groupTitle,[data-section-id="${e}"] .groupTitle`);t!==null&&setTimeout(()=>{var o,a;t.scrollIntoView({block:"center",behavior:"auto"}),(o=t.parentElement)==null||o.classList.remove("highlight"),(a=t.parentElement)==null||a.classList.add("highlight")},250)}i(".pageSettings .section .groupTitle button").on("click",e=>{var a,s,n;const t=(a=e.target.parentElement)==null?void 0:a.parentElement,o=((s=t==null?void 0:t.dataset)==null?void 0:s.configName)??((n=t==null?void 0:t.dataset)==null?void 0:n.sectionId);o!==void 0&&(f0.setUrlParams({highlight:o}),navigator.clipboard.writeText(window.location.toString()).then(()=>{m("Link copied to clipboard",1)}).catch(l=>{const c=re(l,"Failed to copy to clipboard");m(c,-1)}))});ge((e,t)=>{e==="fullConfigChange"&&hn(!0),e==="fullConfigChangeFinished"&&hn(!1),e==="themeLight"?i(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light option[value="${t}"]`).attr("selected","true"):e==="themeDark"&&i(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark option[value="${t}"]`).attr("selected","true"),!(d0||e==="saveToLocalStorage")&&ee()==="settings"&&e!=="theme"&&(e==="customBackground"?l0():Ca({eventKey:e}))});sa(e=>{e.type==="authStateChanged"&&(e.data.isUserSignedIn?s0():a0())});const f0=new vm({id:"settings",element:i(".page.pageSettings"),path:"/settings",urlParamsSchema:EE,afterHide:async()=>{Bt("pageSettings")},beforeShow:async e=>{var t;to("pageSettings","main"),await Bb,await IE(),await Ca(),await LE(),u0((t=e.urlParams)==null?void 0:t.highlight)}});i(async()=>{oo("pageSettings")});const BE={_id:"default",name:"defaults",pb:{no:!0,yes:!0},difficulty:{normal:!0,expert:!0,master:!0},mode:{words:!0,time:!0,quote:!0,zen:!0,custom:!0},words:{10:!0,25:!0,50:!0,100:!0,custom:!0},time:{15:!0,30:!0,60:!0,120:!0,custom:!0},quoteLength:{short:!0,medium:!0,long:!0,thicc:!0},punctuation:{on:!0,off:!0},numbers:{on:!0,off:!0},date:{last_day:!1,last_week:!1,last_month:!1,last_3months:!1,all:!0},tags:{none:!0},language:Object.fromEntries(Hp.map(e=>[e,!0])),funbox:{none:!0,...Object.fromEntries(eS().map(e=>[e,!0]))}},It=structuredClone(BE);function wm(e){try{const t={};for(const o of vt(It))if(o==="_id"){let a=e[o]??It[o];(a==="default-result-filters-id"||a==="")&&(a="default"),t[o]=a}else o==="name"?t[o]=e[o]??It[o]:t[o]={...It[o],...e[o]};return t}catch{return It}}const p0=new Gt({key:"resultFilters",schema:ju,fallback:It,migrate:(e,t)=>My(e)?wm(kp(ju.partial().strip(),e)):It}),FE=new Set(["language","funbox","tags"]),gr={};let Q=It;function Ba(){p0.set(Q)}async function RE(){try{Q=wm(p0.get());const e={none:!1};Object.keys(It.tags).forEach(t=>{Q.tags[t]!==void 0?e[t]=Q.tags[t]:e[t]=!0}),Q.tags=e,Ba()}catch{console.log("error in loading result filters"),Q=It,Ba()}}async function Cm(){var a;const e=document.querySelector(".pageAccount .presetFilterButtons"),t=document.querySelector(".pageAccount .presetFilterButtons .filterBtns");if(!e||!t)return;t.innerHTML="";const o=((a=x())==null?void 0:a.filterPresets)??[];if(o.length>0){let s="";for(const n of o)s+=`<div class="filterPresets">
      <div class="select-filter-preset button" data-id="${n._id}">${n.name.replace(/_/g," ")}</div>
      <div class="button delete-filter-preset" data-id="${n._id}">
        <i class="fas fa-fw fa-trash"></i>
      </div>
    </div>`;t.innerHTML=s,e.classList.remove("hidden")}else e.classList.add("hidden")}async function DE(e){var o;const t=(o=x())==null?void 0:o.filterPresets.find(a=>a._id===e);t&&(Q=GE(t),Ba(),Oa()),i(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active"),i(`.pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset[data-id=${e}]`).addClass("active")}function WE(e){const t=x();t&&st({...t,filterPresets:[...t.filterPresets,structuredClone(e)]})}async function PE(e){e=e.replace(/ /g,"_"),te();const t=await E.users.addResultFilterPreset({body:{...Q,name:e}});V(),t.status===200?(WE({...Q,name:e,_id:t.body.data}),Cm(),m("Filter preset created",1)):(m("Error creating filter preset: "+t.body.message,-1),console.log("error creating filter preset: "+t.body.message))}function zE(e){const t=x();if(!t)return;const o=[...t.filterPresets],a=o.findIndex(s=>s._id===e);a>-1&&o.splice(a,1),st({...t,filterPresets:o})}async function HE(e){te();const t=await E.users.removeResultFilterPreset({params:{presetId:e}});V(),t.status===200?(zE(e),Cm(),Sm(),m("Filter preset deleted",1)):(m("Error deleting filter preset: "+t.body.message,-1),console.log("error deleting filter preset",t.body.message))}function km(){i(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active")}function yn(){return Q}function Df(e){return Q[e]}function Ke(e,t){return Q[e][t]}function OE(e,t,o){Q[e][t]=o}function jo(e,t){Object.keys(Df(e)).forEach(o=>{Q[e][o]=t})}function NE(){const e=x();e!==void 0&&e.tags.forEach(t=>{It.tags[t._id]=!0})}function Sm(){Q=It,Ba()}function Oa(){var a,s,n,l,c;const e={};for(const u of vt(yn()))if(!(u==="_id"||u==="name")){e[u]={all:!0,array:[]};for(const d of vt(Df(u))){const p=e[u];if(p===void 0)continue;const f=Ke(u,d);if(f===!0?(a=p.array)==null||a.push(d):p.all!==void 0&&(p.all=!1),FE.has(u)){const g=i(`.pageAccount .group.filterButtons .filterGroup[group="${u}"] option[value="${d}"]`);f===!0?g.prop("selected",!0):g.prop("selected",!1)}else{let g;u==="date"?g=i(`.pageAccount .group.topFilters .filterGroup[group="${u}"] button[filter="${d}"]`):g=i(`.pageAccount .group.filterButtons .filterGroup[group="${u}"] button[filter="${d}"]`),f===!0?g.addClass("active"):g.removeClass("active")}}}for(const[u,d]of Object.entries(gr)){const p=d,f=Df(u),g=Object.values(f).every(v=>v===!0),h=p.store.getData(),y=i(`.pageAccount .group.filterButtons .filterGroup[group="${u}"] option[value="all"]`);if(g){y.prop("selected",!0);for(const v of h)"value"in v&&(v.value==="all"?v.selected=!0:v.selected=!1);p.store.setData(h),p.render.renderValues()}else y.prop("selected",!1);for(const v of h)"value"in v&&(f[v.value]===!0?v.selected=!0:(!g||v.value!=="all")&&(v.selected=!1));setTimeout(()=>{p.store.setData(h),g||p.render.renderValues(),p.render.renderOptions(h)},0)}function t(u){var p,f,g,h,y;let d="";return d+="<div class='group'>",u==="difficulty"?d+='<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>':u==="mode"?d+='<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>':u==="punctuation"?d+='<span aria-label="Punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i>':u==="numbers"?d+='<span aria-label="Numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i>':u==="words"?d+='<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>':u==="time"?d+='<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>':u==="date"?d+='<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>':u==="tags"?d+='<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>':u==="language"?d+='<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>':u==="funbox"&&(d+='<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>'),(p=e[u])!=null&&p.all?d+="all":u==="tags"?d+=(g=(f=e.tags)==null?void 0:f.array)==null?void 0:g.map(v=>{var S,T,q;if(v==="none")return v;const w=x();if(w===void 0)return v;const $=(S=w.tags)==null?void 0:S.find(_=>_._id===v);return $!==void 0?(q=(T=w.tags)==null?void 0:T.find(_=>_._id===v))==null?void 0:q.display:$}).join(", "):d+=(y=(h=e[u])==null?void 0:h.array)==null?void 0:y.join(", ").replace(/_/g," "),d+="</span></div>",d}let o="";o+=t("date"),o+='<div class="spacer"></div>',o+=t("mode"),o+='<div class="spacer"></div>',(n=(s=e.mode)==null?void 0:s.array)!=null&&n.includes("time")&&(o+=t("time"),o+='<div class="spacer"></div>'),(c=(l=e.mode)==null?void 0:l.array)!=null&&c.includes("words")&&(o+=t("words"),o+='<div class="spacer"></div>'),o+=t("difficulty"),o+='<div class="spacer"></div>',o+=t("punctuation"),o+='<div class="spacer"></div>',o+=t("numbers"),o+='<div class="spacer"></div>',o+=t("language"),o+='<div class="spacer"></div>',o+=t("funbox"),o+='<div class="spacer"></div>',o+=t("tags"),setTimeout(()=>{i(".pageAccount .group.chart .above").html(o)},0)}function UE(e,t){km();try{e==="date"&&jo("date",!1);const a=!Q[e][t];Q[e][t]=a,Ba()}catch(o){m("Something went wrong toggling filter. Reverting to defaults.",0),console.log("toggling filter error"),console.error(o),Sm(),Oa()}}i(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click","button",e=>{const t=i(e.target).parents(".buttons").attr("group"),o=i(e.target).attr("filter");i(e.target).hasClass("allFilters")?(vt(yn()).forEach(a=>{a==="_id"||a==="name"||jo(a,!0)}),jo("date",!1),Q.date.all=!0):i(e.target).hasClass("noFilters")?vt(yn()).forEach(a=>{a==="_id"||a==="name"||a!=="date"&&jo(a,!1)}):i(e.target).is("button")&&(e.shiftKey?(jo(t,!1),Q[t][o]=!0):UE(t,o)),Oa(),Ba()});i(".pageAccount .topFilters button.allFilters").on("click",()=>{km(),console.log(yn()),vt(yn()).forEach(e=>{e==="_id"||e==="name"||jo(e,!0)}),jo("date",!1),Q.date.all=!0,Oa(),Ba()});i(".pageAccount .topFilters button.currentConfigFilter").on("click",()=>{var e,t;if(km(),vt(yn()).forEach(o=>{o==="_id"||o==="name"||jo(o,!1)}),Q.pb.no=!0,Q.pb.yes=!0,Q.difficulty[r.difficulty]=!0,Q.mode[r.mode]=!0,r.mode==="time")if([15,30,60,120].includes(r.time)){const o=`${r.time}`;Q.time[o]=!0}else Q.time.custom=!0;else if(r.mode==="words")if([10,25,50,100,200].includes(r.words)){const o=`${r.words}`;Q.words[o]=!0}else Q.words.custom=!0;else r.mode==="quote"&&["short","medium","long","thicc"].forEach((a,s)=>{r.quoteLength.includes(s)?Q.quoteLength[a]=!0:Q.quoteLength[a]=!1});if(r.punctuation?Q.punctuation.on=!0:Q.punctuation.off=!0,r.numbers?Q.numbers.on=!0:Q.numbers.off=!0,r.mode==="quote"&&/english.*/.test(r.language)?Q.language.english=!0:Q.language[r.language]=!0,r.funbox.length===0)Q.funbox.none=!0;else for(const o of r.funbox)Q.funbox[o]=!0;Q.tags.none=!0,(t=(e=x())==null?void 0:e.tags)==null||t.forEach(o=>{o.active===!0&&(Q.tags.none=!1,Q.tags[o._id]=!0)}),Q.date.all=!0,Oa(),Ba()});i(".pageAccount .topFilters button.toggleAdvancedFilters").on("click",()=>{i(".pageAccount .filterButtons").slideToggle(250),i(".pageAccount .topFilters button.toggleAdvancedFilters").toggleClass("active")});function Eu(e,t=0){const o=gr[e];if(o===void 0)return;const a=o.render.content.list,s=a.children.item(t);a.scrollTop=s.offsetTop-a.offsetTop}function _u(e,t,o){const a=t.some(n=>n.value==="all"),s=o.some(n=>n.value==="all");a?s?t.length<o.length&&(t=t.filter(n=>n.value!=="all")):t=t.filter(n=>n.value==="all"):s&&(t=[]),jo(e,!1);for(const n of t){if(n.value==="all"){jo(e,!0);break}OE(e,n.value,!0)}return Oa(),Ba(),m0(),!1}let m0=()=>{};function g0(){const e=x();if(e===void 0)return;const t=e.tags.filter(s=>It.tags[s._id]===void 0);if(t.length>0){const s=Object.values(Q.tags).every(n=>n);It.tags={...It.tags,...Object.fromEntries(t.map(n=>[n._id,!0]))},Q.tags={...Q.tags,...Object.fromEntries(t.map(n=>[n._id,s]))}}const o=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select select");if(!(o instanceof HTMLElement))return;let a="";a+="<option value='all'>all</option>",a+="<option value='none'>no tag</option>";for(const s of e.tags)a+=`<option value="${s._id}" filter="${s.name}">${s.display}</option>`;o.innerHTML=a}let uh=!1;async function VE(e){if(uh)return;m0=e,gr.language=new lt({select:".pageAccount .content .filterButtons .buttonsAndTitle.languages .select .languageSelect",data:[{value:"all",text:"all"},...Hp.map(a=>({value:a,text:ea(a),filter:a}))],settings:{showSearch:!0,placeholderText:"select a language",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(a,s)=>_u("language",a,s),beforeOpen:()=>{Eu("language")}}}),gr.funbox=new lt({select:".pageAccount .content .filterButtons .buttonsAndTitle.funbox .select .funboxSelect",data:[{value:"all",text:"all"},{value:"none",text:"no funbox"},...mp().map(a=>({value:a.name,text:a.name.replace(/_/g," "),filter:a.name}))],settings:{showSearch:!0,placeholderText:"select a funbox",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(a,s)=>_u("funbox",a,s),beforeOpen:()=>{Eu("funbox")}}});const t=x(),o=i(".pageAccount .content .filterButtons .buttonsAndTitle.tags");if(t.tags.length===0)o.addClass("hidden");else{o.removeClass("hidden"),g0();const a=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select .tagsSelect");a&&(gr.tags=new lt({select:a,settings:{showSearch:!0,placeholderText:"select a tag",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(s,n)=>_u("tags",s,n),beforeOpen:()=>{Eu("tags")}}}))}Cm(),uh=!0}function KE(){i(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").empty(),i(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").empty(),i(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty()}i(".group.presetFilterButtons .filterBtns").on("click",".filterPresets .delete-filter-preset",e=>{HE(i(e.currentTarget).data("id"))});function GE(e){return wm(kp(ju.partial().strip(),structuredClone(e)))}sa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&(NE(),RE())});function jE(e){let t=[];for(let n=1;n<=e.wpm.length;n++)t.push(n.toString());e.wpm=e.wpm.slice(0,e.raw.length),e.err=e.err.slice(0,e.raw.length),t=t.slice(0,e.raw.length);const o=Iy(e.raw,1);lo.data.labels=t,lo.getDataset("wpm").data=e.wpm,lo.getDataset("raw").data=o,lo.getDataset("error").data=e.err;const a=Math.max(Math.max(...e.wpm),Math.max(...e.raw)),s=Math.min(Math.min(...e.wpm),Math.min(...e.raw));lo.getScale("wpm").max=Math.round(a),lo.getScale("raw").max=Math.round(a),r.startGraphsAtZero?(lo.getScale("wpm").min=0,lo.getScale("raw").min=0):(lo.getScale("wpm").min=Math.round(s),lo.getScale("raw").min=Math.round(s)),lo.updateColors()}function QE(e){jE(e),YE.show()}const YE=new le({dialogId:"miniResultChartModal"});function XE(e){const t=e?"Profile":"Account",a=e?"":`<div class="buttonGroup"><button
  class="showAllButton"
  data-balloon-pos="left"
  aria-label="Show all personal bests"
>
  <i class="fas fa-ellipsis-v"></i>
</button></div>`;i(`.page${t} .profile .pbsWords`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">10 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">25 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">50 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">100 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${a}
  `),i(`.page${t} .profile .pbsTime`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">15 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">30 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">60 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">120 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${a}
  `)}function Wf(e,t=!1){if(XE(t),e===void 0)return;let o="";const a=t?"Profile":"Account";i(`.page${a} .profile .pbsTime`).html(""),i(`.page${a} .profile .pbsWords`).html("");const s=["15","30","60","120"],n=["10","25","50","100"];s.forEach(c=>{o+=fh(e,"time",c)});const l=t?"":`<div class="buttonGroup"><button
      class="showAllButton"
      data-balloon-pos="left"
      aria-label="Show all personal bests"
    >
      <i class="fas fa-ellipsis-v"></i>
    </button></div>`;i(`.page${a} .profile .pbsTime`).append(o+l),o="",n.forEach(c=>{o+=fh(e,"words",c)}),i(`.page${a} .profile .pbsWords`).append(o+l)}function fh(e,t,o){let a="",s="";const n=`${o} ${t==="time"?"seconds":"words"}`,l=r.typingSpeedUnit;try{const c=(e[t][o]??[]).sort((d,p)=>p.wpm-d.wpm)[0];if(c===void 0)throw new Error("No PB data found");const u=new Date(c.timestamp);c.timestamp!==void 0&&c.timestamp>0&&(s=ae(u,"dd MMM yyyy")),a=`<div class="quick">
      <div class="test">${n}</div>
      <div class="wpm">${z.typingSpeed(c.wpm,{showDecimalPlaces:!1})}</div>
      <div class="acc">${z.accuracy(c.acc,{showDecimalPlaces:!1})}</div>
    </div>
    <div class="fullTest">
      <div>${n}</div>
      <div>${z.typingSpeed(c.wpm,{suffix:` ${l}`})}</div>
      <div>${z.typingSpeed(c.raw,{suffix:" raw"})}</div>
      <div>${z.accuracy(c.acc,{suffix:" acc"})}</div>
      <div>${z.percentage(c.consistency,{suffix:" con"})}</div>
      <div>${s}</div>
    </div>`}catch{a=`<div class="quick">
    <div class="test">${n}</div>
    <div class="wpm">-</div>
    <div class="acc">-</div>
  </div>`}return`
  <div class="group">
  ${a}
  </div>
  `}const h0={1:{id:1,name:"Developer",description:"I made this",icon:"fa-laptop",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},2:{id:2,name:"Collaborator",description:"I helped make this",icon:"fa-code",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},3:{id:3,name:"Server Mod",description:"Discord server moderator",icon:"fa-hammer",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},4:{id:4,name:"OG Account",description:"First 1000 users on the site",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},5:{id:5,name:"OG Discordian",description:"First 1000 Discord server members",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},6:{id:6,name:"Supporter",description:"Donated money",icon:"fa-heart",color:"var(--text-color)",background:"var(--sub-color)"},7:{id:7,name:"Sugar Daddy",description:"Donated a lot of money",icon:"fa-gem",color:"var(--bg-color)",background:"var(--main-color)"},8:{id:8,name:"Monkey Supporter",description:"Donated more money",icon:"fa-heart",color:"var(--bg-color)",background:"var(--main-color)"},9:{id:9,name:"White Hat",description:"Reported critical vulnerabilities on the site",icon:"fa-user-secret",color:"var(--bg-color)",background:"var(--main-color)"},10:{id:10,name:"Bug Hunter",description:"Reported or helped track down bugs on the site",icon:"fa-bug",color:"var(--text-color)",background:"var(--sub-color)"},11:{id:11,name:"Content Creator",description:"Verified content creator",icon:"fa-video",color:"var(--text-color)",background:"var(--sub-color)"},12:{id:12,name:"Contributor",description:"Contributed to the site",icon:"fa-hands-helping",color:"var(--text-color)",background:"var(--sub-color)"},13:{id:13,name:"Mythical",description:"Yes, I'm actually this fast",icon:"fa-rocket",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},14:{id:14,name:"All Year Long",description:"Reached a streak of 365 days",icon:"fa-fire",color:"var(--bg-color)",background:"var(--main-color)"},15:{id:15,name:"Insane",description:"I typed for 69 hours straight",icon:"fa-bomb",color:"white",background:"#093d79",customStyle:"animation: gold-shimmer 10s cubic-bezier(0.5, 0, 0.5, 1) infinite; background: linear-gradient(90deg, rgb(8 31 84) 0%, rgb(18 134 158) 100%); background-size: 200% 200%;"},16:{id:16,name:"Perfection",description:"Longest test with zero mistakes - 4 hours and 1 minute",icon:"fa-bullseye",color:"white",customStyle:"animation: gold-shimmer 10s cubic-bezier(0.5, -0.15, 0.5, 1.15) infinite; background: linear-gradient(45deg, #b8860b 0%, #daa520 25%, #ffd700 50%, #daa520 75%, #b8860b 100%); background-size: 200% 200%;"},17:{id:17,name:"Phineas",description:"Ferb, I know what we're gonna do today...",icon:"fa-sun",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"}};function jr(e,t=!1,o=!1,a=!1){const s=h0[e];if(!s&&!a)return"";let n="";(s==null?void 0:s.background)!==void 0&&(n+=`background: ${s.background};`),(s==null?void 0:s.color)!==void 0&&(n+=`color: ${s.color};`),(s==null?void 0:s.customStyle)!==void 0&&(n+=s.customStyle);const l=(s==null?void 0:s.name)??"Badge Name Missing",c=(s==null?void 0:s.description)??"Badge Description Missing",u=(t?l+": ":"")+c;let d="";o||(d=`aria-label="${u}" data-balloon-pos="right"`);let p="";(s==null?void 0:s.icon)!==void 0?p=`<i class="fas ${t?"fa-fw":""} ${s.icon}"></i>`:p='<i class="fas fa-question"></i>';const f=`<div class="text">${l}</div>`;return`<div class="badge" ${d} style="${n}">${p}${t?"":f}</div>`}function ZE(e){return h0[e]}async function Jc(e,t){var T,q,_,N,Y,G,xe,He,Fe,Re,X,we,Ve,Ze,jt,ao,so,ko,ws,na,Ll,vi,In,qn,Bn,C,Oe,he,Mt,Cs,ra,me;const o=e.charAt(0).toUpperCase()+e.slice(1),a=i(`.page${o} .profile`),s=i(`.page${o} .profile .details`);a.attr("uid",t.uid??""),a.attr("name",t.name??"");const n=t.banned===!0;if(s===void 0||t===void 0||t.name===void 0||t.addedAt===void 0)return;if(s.find(".avatarAndName .avatar").replaceWith(xd(t,{size:256})),(T=t.inventory)!=null&&T.badges&&!n){let ye="",Ee="";for(const Ne of t.inventory.badges)Ne.selected===!0?ye=jr(Ne.id):Ee+=jr(Ne.id,!0);s.find(".badges").empty().append(ye),s.find(".allBadges").empty().append(Ee)}s.find(".name").text(t.name),s.find(".userFlags").html(sl(t)),t.lbOptOut===!0&&(e==="profile"?a.find(".lbOptOutReminder").removeClass("hidden").text("Note: This account has opted out of the leaderboards, meaning their results aren't verified by the anticheat system and may not be legitimate."):a.find(".lbOptOutReminder").addClass("hidden")),setTimeout(()=>{xm(e)},10);const c="Joined "+ae(t.addedAt??0,"dd MMM yyyy"),u=new Date(t.addedAt),d=Di(new Date,u),p=`${d} day${d!==1?"s":""} ago`;s.find(".joined").text(c).attr("aria-label",p);let f="";if(t.streak&&(t==null?void 0:t.streak)>1?(s.find(".streak").text(`Current streak: ${t.streak} ${t.streak===1?"day":"days"}`),f=`Longest streak: ${t.maxStreak} ${t.maxStreak===1?"day":"days"}`):(s.find(".streak").text(""),f=""),e==="account"){const ye=(q=x())==null?void 0:q.results,Ee=ye==null?void 0:ye[0],Ne=t.streakHourOffset,kt=1e3*60*60*24;let Je=$l(Ne)+kt;Je<Date.now()&&(Je+=kt);const Rt=Oy(Je);if(console.debug("Streak hour offset"),console.debug("date.now()",Date.now(),new Date(Date.now())),console.debug("dayInMilis",kt),console.debug("difTarget",new Date($l(Ne)+kt)),console.debug("timeDif",Rt),console.debug("DateTime.getCurrentDayTimestamp()",$l(),new Date($l())),console.debug("profile.streakHourOffset",Ne),Ee!==void 0){const ks=tS(Ee.timestamp,Ne),Ss=oS(Ee.timestamp,Ne);console.debug("lastResult.timestamp",Ee.timestamp,new Date(Ee.timestamp)),console.debug("isToday",ks),console.debug("isYesterday",Ss);const nt=be(Ne)?`(${Ne>0?"+":""}${Ne} offset)`:"";ks?(f+=`
Claimed today: yes`,f+=`
Come back in: ${Rt} ${nt}`):Ss?(f+=`
Claimed today: no`,f+=`
Streak lost in: ${Rt} ${nt}`):(f+=`
Streak lost ${Rt} ${nt} ago`,f+=`
It will be removed from your profile on the next result save`),console.debug(f),Ne===void 0&&(f+=`

If the streak reset time doesn't line up with your timezone, you can change it in Account Settings > Account > Set streak hour offset.`)}}s.find(".streak").attr("aria-label",f).attr("data-balloon-break","");let g="",h="";t.typingStats.completedTests!==void 0&&t.typingStats.startedTests!==void 0&&(g=Math.floor(t.typingStats.completedTests/t.typingStats.startedTests*100).toString(),h=((t.typingStats.startedTests-t.typingStats.completedTests)/t.typingStats.completedTests).toFixed(1));const y=s.find(".typingStats");y.find(".started .value").text(((_=t.typingStats)==null?void 0:_.startedTests)??0),y.find(".completed .value").text(((N=t.typingStats)==null?void 0:N.completedTests)??0).attr("data-balloon-pos","up").attr("aria-label",`${g}% (${h} restarts per completed test)`),y.find(".timeTyping .value").text(ft(Math.round(((Y=t.typingStats)==null?void 0:Y.timeTyping)??0),!0,!0));let v=!1,w=!1,$=!1;if(!n&&(v=!!(((G=t.details)==null?void 0:G.bio)??""),s.find(".bio .value").text(((xe=t.details)==null?void 0:xe.bio)??""),w=!!(((He=t.details)==null?void 0:He.keyboard)??""),s.find(".keyboard .value").text(((Fe=t.details)==null?void 0:Fe.keyboard)??""),((X=(Re=t.details)==null?void 0:Re.socialProfiles)==null?void 0:X.github)!==void 0&&((Ve=(we=t.details)==null?void 0:we.socialProfiles)==null?void 0:Ve.github)!==""||((jt=(Ze=t.details)==null?void 0:Ze.socialProfiles)==null?void 0:jt.twitter)!==void 0&&((so=(ao=t.details)==null?void 0:ao.socialProfiles)==null?void 0:so.twitter)!==""||((ws=(ko=t.details)==null?void 0:ko.socialProfiles)==null?void 0:ws.website)!==void 0&&((Ll=(na=t.details)==null?void 0:na.socialProfiles)==null?void 0:Ll.website)!=="")){$=!0;const ye=s.find(".socials .value");ye.empty();const Ee=((vi=t.details)==null?void 0:vi.socialProfiles.github)??"";Ee&&ye.append(`<a href='https://github.com/${Ht(Ee)}/' target="_blank" rel="nofollow me" aria-label="${Ht(Ee)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-github"></i></a>`);const Ne=((In=t.details)==null?void 0:In.socialProfiles.twitter)??"";Ne&&ye.append(`<a href='https://x.com/${Ht(Ne)}' target="_blank" rel="nofollow me" aria-label="${Ht(Ne)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-twitter"></i></a>`);const kt=((qn=t.details)==null?void 0:qn.socialProfiles.website)??"",Je=/^https?:\/\/(?:www\.)?([^/]+)/,Rt=((Bn=kt==null?void 0:kt.match(Je))==null?void 0:Bn[1])??kt;kt&&ye.append(`<a href='${Ht(kt)}' target="_blank" rel="nofollow me" aria-label="${Ht(Rt??"")}" data-balloon-pos="up" class="textButton"><i class="fas fa-fw fa-globe"></i></a>`)}if(y0(t.xp??0),n)a.find(".leaderboardsPositions").addClass("hidden");else{a.find(".leaderboardsPositions").removeClass("hidden");const ye=((he=(Oe=(C=t.allTimeLbs)==null?void 0:C.time)==null?void 0:Oe["15"])==null?void 0:he.english)??null,Ee=((ra=(Cs=(Mt=t.allTimeLbs)==null?void 0:Mt.time)==null?void 0:Cs["60"])==null?void 0:ra.english)??null;ye===null&&Ee===null?a.find(".leaderboardsPositions").addClass("hidden"):(ye!==null&&(a.find(".leaderboardsPositions .group.t15 .pos").text(z.rank(ye==null?void 0:ye.rank)),a.find(".leaderboardsPositions .group.t15 .topPercentage").text(ph(ye))),Ee!==null&&(a.find(".leaderboardsPositions .group.t60 .pos").text(z.rank(Ee==null?void 0:Ee.rank)),a.find(".leaderboardsPositions .group.t60 .topPercentage").text(ph(Ee))))}t.uid===((me=Po())==null?void 0:me.uid)?a.find(".userReportButton").addClass("hidden"):a.find(".userReportButton").removeClass("hidden");const S=v||w;v?s.find(".bio").removeClass("hidden"):s.find(".bio").addClass("hidden"),w?s.find(".keyboard").removeClass("hidden"):s.find(".keyboard").addClass("hidden"),S?(s.find(".bioAndKeyboard").removeClass("hidden"),s.find(".sep2").removeClass("hidden")):(s.find(".bioAndKeyboard").addClass("hidden"),s.find(".sep2").addClass("hidden")),$?(s.find(".socials").removeClass("hidden"),s.find(".sep3").removeClass("hidden")):(s.find(".socials").addClass("hidden"),s.find(".sep3").addClass("hidden")),s.removeClass("none"),s.removeClass("bioAndKey"),s.removeClass("soc"),s.removeClass("both"),!$&&!S?s.addClass("none"):$&&!S?s.addClass("soc"):!$&&S?s.addClass("bioAndKey"):$&&S&&s.addClass("both")}function y0(e){const t=i(" .profile .details .levelAndBar");if(t==null)return;const o=Sr(e),a=o.levelMaxXp,s=o.levelCurrentXp;t.find(".level").text(o.level).attr("aria-label",`${Nl(e)} total xp`),t.find(".xp").text(`${Nl(s)}/${Nl(a)}`).attr("aria-label",`${Nl(a-s)} xp until next level`),t.find(".xpBar .bar").css("width",`${s/a*100}%`),t.find(".xpBar").attr("aria-label",`${(s/a*100).toFixed(2)}%`)}function xm(e){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return;let o;if(e==="account"?o=i(".pageAccount .profile .details"):e==="profile"&&(o=i(".pageProfile .profile .details")),!o)return;const a=o.find(".user"),s=a.parent()[0],n=a[0],l=Gs(2);if(!n||!s)return;n.style.fontSize="10px";const c=s.clientWidth,u=n.clientWidth,p=c/u*10,f=Math.min(Math.max(p,10),l);n.style.fontSize=`${f}px`}const JE=Hy(1e3,()=>{const e=ee();e&&["account","profile"].includes(e)&&xm(e)});i(window).on("resize",()=>{JE()});function ph(e){return e.rank===void 0?"-":e.rank===1?"GOAT":"Top "+U(e.rank/e.count*100)+"%"}function Nl(e){return e<1e3?Math.round(e).toString():Sc(e)}let b0;const{promise:e_,resolve:t_}=Da();function An(){return b0}async function o_(){const e=await E.configuration.get();if(e.status!==200){console.error("Could not fetch configuration",e.body.message);return}else b0=e.body.data??void 0,t_(!0)}function Pf(){i(".pageAccount .resultBatches").addClass("hidden")}function a_(){i(".pageAccount .resultBatches").removeClass("hidden")}async function s_(){var p,f,g,h,y;const e=(p=x())==null?void 0:p.results;if(e===void 0){console.error("(Result batches) Results are missing but they should be available at the time of drawing the account page?"),Pf();return}i_();const t=((g=(f=x())==null?void 0:f.typingStats)==null?void 0:g.completedTests)??0,o=Math.round(e.length/t*100),a=((h=An())==null?void 0:h.results.limits)??{regularUser:0,premiumUser:0},s=(y=x())!=null&&y.isPremium?a.premiumUser:a.regularUser,n=Math.round((e==null?void 0:e.length)/s*100),l=i(".pageAccount .resultBatches .bars"),c={downloaded:{fill:l.find(".downloaded .fill"),rightText:l.find(".downloaded.rightText")},limit:{fill:l.find(".limit .fill"),rightText:l.find(".limit.rightText")}};c.downloaded.fill.css("width",Math.min(o,100)+"%"),c.downloaded.rightText.text(`${e==null?void 0:e.length} / ${t} (${o}%)`);const u=await ms();c.limit.fill.css({width:Math.min(n,100)+"%",background:Uo(u.sub,u.error,wc(n,50,100,0,1))}),c.limit.rightText.text(`${e==null?void 0:e.length} / ${s} (${n}%)`),i(".pageAccount .resultBatches > .text").text(""),e.length>=t&&(zf(),mh("all results loaded")),e.length>=s&&(zf(),mh("limit reached"))}function zf(){i(".pageAccount .resultBatches button").prop("disabled",!0)}function i_(){i(".pageAccount .resultBatches button").prop("disabled",!1)}function mh(e){i(".pageAccount .resultBatches button").text(e)}function n_(){var a,s,n,l;if(!(((a=x())==null?void 0:a.isPremium)??!1)){Pf();return}const t=((n=(s=x())==null?void 0:s.typingStats)==null?void 0:n.completedTests)??0,o=((l=An())==null?void 0:l.results.maxBatchSize)??0;if(t<=o){Pf();return}a_()}let Pt;function v0(e,t,o){if(t===void 0){Tm(e);return}e.classList.remove("hidden"),e.querySelector(".yearSelect")!==null&&(Pt=k0(e),C0(e,"current",ar(o==null?void 0:o.getFullYear())??2022)),l_(e,t.firstDayOfWeek),w0(e,t)}function Tm(e){var t;e.classList.add("hidden"),(t=e.querySelector(".activity"))==null||t.replaceChildren()}function w0(e,t){var s,n;const o=e.querySelector(".activity");if(o===null)return;if(o.innerHTML="",t===void 0){gh([]),(s=e.querySelector(".nodata"))==null||s.classList.remove("hidden");return}gh(t.getMonths()),(n=e.querySelector(".nodata"))==null||n.classList.add("hidden");const a=e.querySelector(".title");a!==null&&(a.innerHTML=t.getTotalTests()+" tests");for(const l of t.getDays()){const c=document.createElement("div");c.setAttribute("data-level",l.level),l.label!==void 0&&(c.setAttribute("aria-label",l.label),c.setAttribute("data-balloon-pos","up")),o.appendChild(c)}}function C0(e,t,o){var l,c;const a=new Date().getFullYear(),s=[{text:"last 12 months",value:"current",selected:t==="current"}];for(let u=a;u>=o;u--)(s.length<2||(l=An())!=null&&l.users.premium.enabled&&((c=x())!=null&&c.isPremium))&&s.push({text:u.toString(),value:u.toString(),selected:u===t});const n=k0(e);n.setData(s),s.length>1?n.enable():n.disable()}function gh(e){const t=document.querySelector(".testActivity .months");t!==null&&(t.innerHTML=e.map(o=>`<div style="grid-column: span ${o.weeks}">${o.text}</div>`).join(""))}function k0(e){return Pt!==void 0||(Pt=new lt({select:e.querySelector(".yearSelect"),settings:{showSearch:!1},events:{afterChange:async t=>{var s;Pt==null||Pt.disable();const o=(s=t[0])==null?void 0:s.value,a=await kx(o);w0(e,a),((Pt==null?void 0:Pt.getData())??[]).length>1&&(Pt==null||Pt.enable())}}})),Pt}const r_=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function l_(e,t){const o=[];for(let s=0;s<7;s++)o.push(s%2!==t%2?r_[(t+s)%7]:void 0);const a=s=>{const n=s!==void 0?l=>l.substring(0,s):l=>l;return o.map(l=>l!==void 0?`<div><div class="text">${n(l)}</div></div>`:"<div></div>").join("")};e.querySelector(".daysFull").innerHTML=a(),e.querySelector(".days").innerHTML=a(3)}let St=!1;function c_(){St=!St,St&&console.log("filterDebug is on")}let De=[],Es=0,Hf;function tu(e){var o;if(De===void 0||De.length===0)return;let t;be(e)&&e>Es?t=Math.ceil(e/10)*10:t=Es+10;for(let a=Es;a<t;a++){const s=De[a];if(!s)continue;let n=s.difficulty;n===void 0&&(n="normal");let l=`<span aria-label="${(o=s.language)==null?void 0:o.replace("_"," ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;n==="normal"?l+=`<span aria-label="${s.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`:n==="expert"?l+=`<span aria-label="${s.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`:n==="master"&&(l+=`<span aria-label="${s.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`),s.punctuation&&(l+='<span aria-label="punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i></span>'),s.numbers&&(l+='<span aria-label="numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i></span>'),s.blindMode&&(l+='<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>'),s.lazyMode&&(l+='<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>'),s.funbox!==void 0&&s.funbox.length>0&&(l+=`<span aria-label="${s.funbox.map(w=>w.replace(/_/g," ")).join(", ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`),s.chartData==="toolong"||s.testDuration>122?l+='<span class="miniResultChartButton disabled" aria-label="Graph history is not available for long tests" data-balloon-pos="up"><i class="fas fa-fw fa-chart-line"></i></span>':l+=`<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${a}"><i class="fas fa-fw fa-chart-line"></i></span>`;let c="no tags";s.tags!==void 0&&s.tags.length>0&&(c="",s.tags.forEach(w=>{var $,S;(S=($=x())==null?void 0:$.tags)==null||S.forEach(T=>{w===T._id&&(c+=T.display+", ")})}),c=c.substring(0,c.length-2));let u;s.tags===void 0?u="[]":u=JSON.stringify(s.tags);const d=s.tags!==void 0&&s.tags.length>0,p=s.tags!==void 0&&s.tags.length>1?"fa-tags":"fa-tag",f=`<button class="textButton resultEditTagsButton ${d?"active":""}" data-result-id="${s._id}" data-tags='${u}' aria-label="${c}" data-balloon-pos="up"><i class="fas fa-fw ${p}"></i></button>`;let g="";s.isPb?g='<i class="fas fa-fw fa-crown"></i>':g="";const h=s.charStats.join("/"),y=s.mode==="custom"?"":s.mode2,v=new Date(s.timestamp);i(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${a}">
    <td>${g}</td>
    <td>${z.typingSpeed(s.wpm,{showDecimalPlaces:!0})}</td>
    <td>${z.typingSpeed(s.rawWpm,{showDecimalPlaces:!0})}</td>
    <td>${z.percentage(s.acc,{showDecimalPlaces:!0})}</td>
    <td>${z.percentage(s.consistency,{showDecimalPlaces:!0})}</td>
    <td>${h}</td>
    <td>${s.mode} ${y}</td>
    <td class="infoIcons">${l}</td>
    <td>${f}</td>
    <td>${ae(v,"dd MMM yyyy")}<br>
    ${ae(v,"HH:mm")}
    </td>
    </tr>`)}Es=t,Es>=De.length?i(".pageAccount .loadMoreButton").addClass("hidden"):i(".pageAccount .loadMoreButton").removeClass("hidden")}async function d_(){await O.updateColors(),await Te(0),await Ja.updateColors(),await Te(0),await Xi.updateColors(),await Te(0)}function u_(){i(".pageAccount .history table tbody").empty(),Xi.getDataset("count").data=[],Ja.getDataset("count").data=[],Ja.getDataset("avgWpm").data=[],O.getDataset("wpm").data=[],O.getDataset("pb").data=[],O.getDataset("acc").data=[],O.getDataset("wpmAvgTen").data=[],O.getDataset("accAvgTen").data=[],O.getDataset("wpmAvgHundred").data=[],O.getDataset("accAvgHundred").data=[]}let Ul=0,Dt=[],Ei=[];async function S0(){var In,qn,Bn;console.log("updating account page"),il();const e=x();if(!e)return;Wf(e.personalBests),Jc("account",e),v0(Hf,e.testActivity,new Date(e.addedAt)),s_(),Dt=[],Ei=[];const t=[];Es=0;let o=0,a="",s=0,n=0,l=0,c=0,u=0,d=0,p=0,f=0;const g={total:0,count:0,last10Total:0,last10Count:0,max:0};let h=0;Ul=0;let y=0,v=0,w=0,$=0;const S={},T=[],q=bt(r.typingSpeedUnit);De=[],i(".pageAccount .history table tbody").empty(),(qn=(In=x())==null?void 0:In.results)==null||qn.forEach(C=>{var ye,Ee,Ne,kt;try{if(!Ke("pb",C.isPb?"yes":"no")){St&&console.log("skipping result due to pb filter",C);return}let Je=C.difficulty;if(Je===void 0&&(Je="normal"),!Ke("difficulty",Je)){St&&console.log("skipping result due to difficulty filter",C);return}if(!Ke("mode",C.mode)){St&&console.log("skipping result due to mode filter",C);return}if(C.mode==="time"){let Ye="custom";if(["15","30","60","120"].includes(`${C.mode2}`)&&(Ye=`${C.mode2}`),!Ke("time",Ye)){St&&console.log("skipping result due to time filter",C);return}}else if(C.mode==="words"){let Ye="custom";if(["10","25","50","100","200"].includes(`${C.mode2}`)&&(Ye=`${C.mode2}`),!Ke("words",Ye)){St&&console.log("skipping result due to word filter",C);return}}if(C.quoteLength!==null){let Ye;if(C.quoteLength===0?Ye="short":C.quoteLength===1?Ye="medium":C.quoteLength===2?Ye="long":C.quoteLength===3&&(Ye="thicc"),Ye!==void 0&&!Ke("quoteLength",Ye)){St&&console.log("skipping result due to quoteLength filter",C);return}}let Rt=Ke("language",C.language);if(C.language==="english_expanded"&&Ke("language","english_1k")&&(Rt=!0),!Rt){St&&console.log("skipping result due to language filter",C);return}let ks="off";if(C.punctuation&&(ks="on"),!Ke("punctuation",ks)){St&&console.log("skipping result due to punctuation filter",C);return}let Ss="off";if(C.numbers&&(Ss="on"),!Ke("numbers",Ss)){St&&console.log("skipping result due to numbers filter",C);return}if(C.funbox===void 0||C.funbox.length===0){if(!Ke("funbox","none")){St&&console.log("skipping result due to funbox filter",C);return}}else{let Ye=0;for(const wi of C.funbox)if(Ke("funbox",wi)){Ye++;break}if(Ye===0){St&&console.log("skipping result due to funbox filter",C);return}}let nt=!0;if(C.tags===void 0||C.tags.length===0)(((Ee=(ye=x())==null?void 0:ye.tags)==null?void 0:Ee.length)??0)>0?Ke("tags","none")&&(nt=!1):nt=!1;else{const Ye=(kt=(Ne=x())==null?void 0:Ne.tags)==null?void 0:kt.map(wi=>wi._id);if(Ye===void 0)return;C.tags.forEach(wi=>{nt&&(Ye!=null&&Ye.includes(wi)?Ke("tags",wi)&&(nt=!1):Ke("tags","none")&&(nt=!1))})}if(nt){St&&console.log("skipping result due to tag filter",C);return}const io=Math.abs(C.timestamp-Date.now())/1e3;let ig=!0;if((Ke("date","all")||Ke("date","last_day")&&io<=86400||Ke("date","last_week")&&io<=604800||Ke("date","last_month")&&io<=2592e3||Ke("date","last_3months")&&io<=7776e3)&&(ig=!1),ig){St&&console.log("skipping result due to date filter",C);return}De.push(C)}catch(Je){m("Something went wrong when filtering. Resetting filters.",0),console.log(C),console.error(Je),Sm(),Oa(),bn();return}h+=Math.round(C.wpm/60*C.testDuration);const Oe=new Date(C.timestamp);Oe.setSeconds(0),Oe.setMinutes(0),Oe.setHours(0),Oe.setMilliseconds(0);const he=Oe.getTime(),Mt=S[he];Mt!==void 0?(Mt.amount++,Mt.restarts+=C.restartCount??0,Mt.time+=C.testDuration+(C.incompleteTestSeconds??0)-(C.afkDuration??0),C.wpm>Mt.maxWpm&&(Mt.maxWpm=C.wpm),Mt.totalWpm+=C.wpm,Mt.totalAcc+=C.acc,Mt.totalCon+=C.consistency??0):S[he]={amount:1,restarts:C.restartCount??0,time:C.testDuration+(C.incompleteTestSeconds??0)-(C.afkDuration??0),maxWpm:C.wpm,totalWpm:C.wpm,totalAcc:C.acc,totalCon:C.consistency??0};const Cs=q.histogramDataBucketSize,ra=Math.floor(Math.round(q.fromWpm(C.wpm))/Cs);if(T.length<=ra)for(let Je=T.length;Je<=ra;Je++)T.push(0);T[ra]++;let me=0;if(C.testDuration===void 0&&C.mode2!=="custom"&&C.mode2!=="zen"?C.mode==="time"?me=parseInt(C.mode2):C.mode==="words"&&(me=parseInt(C.mode2)/C.wpm*60):me=parseFloat(C.testDuration),C.incompleteTestSeconds!==void 0?me+=C.incompleteTestSeconds:C.restartCount!==void 0&&C.restartCount>0&&(me+=me/4*C.restartCount),Ul+=me,c<10&&(c++,u+=C.wpm,f+=C.acc,C.consistency!==void 0&&(w+=C.consistency)),l++,C.consistency!==void 0&&($++,v+=C.consistency,C.consistency>y&&(y=C.consistency)),C.rawWpm!==null&&(g.last10Count<10&&(g.last10Count++,g.last10Total+=C.rawWpm),g.total+=C.rawWpm,g.count++,C.rawWpm>g.max&&(g.max=C.rawWpm)),C.acc>d&&(d=C.acc),p+=C.acc,C.restartCount!==void 0&&(s+=C.restartCount),Dt.push({x:De.length,y:U(q.fromWpm(C.wpm)),wpm:U(q.fromWpm(C.wpm)),acc:C.acc,mode:C.mode,mode2:C.mode2,punctuation:C.punctuation,language:C.language,timestamp:C.timestamp,difficulty:C.difficulty,raw:U(q.fromWpm(C.rawWpm)),isPb:C.isPb??!1}),t.push(C.wpm),Ei.push({x:De.length,y:C.acc,errorRate:100-C.acc}),C.wpm>o)if(o=C.wpm,C.mode==="custom")a=C.mode;else{const Je=C.punctuation?",<br>with punctuation":"",Rt=C.numbers?",<br>with numbers":"";a=C.mode+" "+C.mode2+Je+Rt}n+=C.wpm}),i(".pageAccount .group.history table thead tr td:nth-child(2)").text(r.typingSpeedUnit),await Te(0),tu();const _=[],N=[],Y=q.historyStepSize;for(const C of Object.keys(S)){const Oe=parseInt(C),he=S[Oe];he!==void 0&&(_.push({x:Oe,y:he.time/60,amount:he.amount,restarts:he.restarts,maxWpm:U(q.fromWpm(he.maxWpm)),avgWpm:U(he.totalWpm/he.amount),avgAcc:U(he.totalAcc/he.amount),avgCon:U(he.totalCon/he.amount)}),N.push({x:Oe,y:U(q.fromWpm(he.totalWpm)/he.amount)}))}const xe=Ja.options.scales.avgWpm;xe.title.text="Average "+r.typingSpeedUnit,xe.ticks.stepSize=Y,Ja.getDataset("count").data=_,Ja.getDataset("avgWpm").data=N;const He=[],Fe=[],Re=q.histogramDataBucketSize,X=Re-(Re<=1?.01:1);T.forEach((C,Oe)=>{const he=Oe*Re;Fe.push(`${he} - ${he+X}`),He.push({x:he,y:C})}),Xi.data.labels=Fe,Xi.getDataset("count").data=He;const Ve=O.options.scales.wpm;if(Ve.title.text=q.fullUnitString,Dt.length>0){let C=0;const Oe=[];for(let me=Dt.length-1;me>=0;me--){const ye=Dt[me];ye.y>C&&(C=ye.y,Oe.push(ye))}Oe.push({x:1,y:(Bn=Vs(Oe))==null?void 0:Bn.y});const he=[],Mt=[],Cs=[],ra=[];for(let me=0;me<Dt.length;me++){const ye=Dt.slice(me,me+10),Ee=Ei.slice(me,me+10),Ne=ye.reduce((nt,{y:io})=>nt+io,0)/ye.length,kt=Ee.reduce((nt,{y:io})=>nt+io,0)/Ee.length;he.push({x:me+1,y:Ne}),Mt.push({x:me+1,y:kt});const Je=Dt.slice(me,me+100),Rt=Ei.slice(me,me+100),ks=Je.reduce((nt,{y:io})=>nt+io,0)/Je.length,Ss=Rt.reduce((nt,{y:io})=>nt+io,0)/Rt.length;Cs.push({x:me+1,y:ks}),ra.push({x:me+1,y:Ss})}O.getDataset("wpm").data=Dt,O.getDataset("pb").data=Oe,O.getDataset("acc").data=Ei,O.getDataset("wpmAvgTen").data=he,O.getDataset("accAvgTen").data=Mt,O.getDataset("wpmAvgHundred").data=Cs,O.getDataset("accAvgHundred").data=ra,O.getScale("x").max=Dt.length+1}const Ze=Dt.map(C=>C.y),jt=Math.min(...Ze),ao=Math.max(...Ze),so=isFinite(jt)?jt:0,ko=isFinite(ao)?ao:0,ws=Math.floor(ko)+(Y-Math.floor(ko)%Y);if(Ve.max=ws,Ve.ticks.stepSize=Y,O.getScale("pb").max=ws,O.getScale("wpmAvgTen").max=ws,O.getScale("wpmAvgHundred").max=ws,r.startGraphsAtZero)O.getScale("wpm").min=0,O.getScale("pb").min=0,O.getScale("wpmAvgTen").min=0,O.getScale("wpmAvgHundred").min=0;else{const C=Math.floor(so/Y)*Y;O.getScale("wpm").min=C,O.getScale("pb").min=C,O.getScale("wpmAvgTen").min=C,O.getScale("wpmAvgHundred").min=C}Dt===void 0||Dt.length===0?(i(".pageAccount .group.noDataError").removeClass("hidden"),i(".pageAccount .group.chart").addClass("hidden"),i(".pageAccount .group.dailyActivityChart").addClass("hidden"),i(".pageAccount .group.histogramChart").addClass("hidden"),i(".pageAccount .group.aboveHistory").addClass("hidden"),i(".pageAccount .group.history").addClass("hidden"),i(".pageAccount .triplegroup.stats").addClass("hidden"),i(".pageAccount .group.estimatedWordsTyped").addClass("hidden")):(i(".pageAccount .group.noDataError").addClass("hidden"),i(".pageAccount .group.chart").removeClass("hidden"),i(".pageAccount .group.dailyActivityChart").removeClass("hidden"),i(".pageAccount .group.histogramChart").removeClass("hidden"),i(".pageAccount .group.aboveHistory").removeClass("hidden"),i(".pageAccount .group.history").removeClass("hidden"),i(".pageAccount .triplegroup.stats").removeClass("hidden"),i(".pageAccount .group.estimatedWordsTyped").removeClass("hidden")),i(".pageAccount .timeTotalFiltered .val").text(ft(Math.round(Ul),!0,!0));const na=r.typingSpeedUnit;i(".pageAccount .highestWpm .title").text(`highest ${na}`),i(".pageAccount .highestWpm .val").text(z.typingSpeed(o)),i(".pageAccount .averageWpm .title").text(`average ${na}`),i(".pageAccount .averageWpm .val").text(z.typingSpeed(n/l)),i(".pageAccount .averageWpm10 .title").text(`average ${na} (last 10 tests)`),i(".pageAccount .averageWpm10 .val").text(z.typingSpeed(u/c)),i(".pageAccount .highestRaw .title").text(`highest raw ${na}`),i(".pageAccount .highestRaw .val").text(z.typingSpeed(g.max)),i(".pageAccount .averageRaw .title").text(`average raw ${na}`),i(".pageAccount .averageRaw .val").text(z.typingSpeed(g.total/g.count)),i(".pageAccount .averageRaw10 .title").text(`average raw ${na} (last 10 tests)`),i(".pageAccount .averageRaw10 .val").text(z.typingSpeed(g.last10Total/g.last10Count)),i(".pageAccount .highestWpm .mode").html(a),i(".pageAccount .testsTaken .val").text(l),i(".pageAccount .highestAcc .val").text(z.accuracy(d)),i(".pageAccount .avgAcc .val").text(z.accuracy(p/l)),i(".pageAccount .avgAcc10 .val").text(z.accuracy(f/c)),v===0||v===void 0?(i(".pageAccount .avgCons .val").text("-"),i(".pageAccount .avgCons10 .val").text("-")):(i(".pageAccount .highestCons .val").text(z.percentage(y)),i(".pageAccount .avgCons .val").text(z.percentage(v/$)),i(".pageAccount .avgCons10 .val").text(z.percentage(w/Math.min(c,$)))),i(".pageAccount .testsStarted .val").text(`${l+s}`),i(".pageAccount .testsCompleted .val").text(`${l}(${Math.floor(l/(l+s)*100)}%)`),i(".pageAccount .testsCompleted .avgres").text(`
    ${(s/l).toFixed(1)} restarts per completed test
  `);const Ll=De.map(C=>C.wpm).reverse(),vi=_1(Ll);if(vi){const Oe=(vi[1][1]-vi[0][1])*(3600/Ul),he=Oe>0?"+":"";i(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${he+z.typingSpeed(Oe,{showDecimalPlaces:!0})} ${r.typingSpeedUnit}`)}i(".pageAccount .estimatedWordsTyped .val").text(h),(Dt.length||Ei.length)&&(AM(),O.options.animation=!1,O.update(),delete O.options.animation),await Te(0),Ja.update(),Xi.update(),zo(!1),i(".page.pageAccount").css("height","unset"),setTimeout(()=>{xm("account")},0)}async function Lm(e){const t=await Sp(e);if(!t&&!it()){m("Could not get results - you are offline",-1,{duration:5});return}vA(),t&&Oa()}async function bn(){await Lm();try{await Te(0),await S0()}catch(e){console.error(e),m(`Something went wrong: ${e}`,-1)}}function f_(e,t){var s,n;const o=[];if(t.length>0)for(const l of t)(n=(s=x())==null?void 0:s.tags)==null||n.forEach(c=>{l===c._id&&o.push(c.display)});const a=i(`.pageAccount .resultEditTagsButton[data-result-id='${e}']`);a.attr("data-tags",JSON.stringify(t)),t.length>0?(a.attr("aria-label",o.join(", ")),a.addClass("active"),t.length>1?a.html('<i class="fas fa-fw fa-tags"></i>'):a.html('<i class="fas fa-fw fa-tag"></i>')):(a.attr("aria-label","no tags"),a.removeClass("active"),a.html('<i class="fas fa-fw fa-tag"></i>'))}function bs(e,t,o=null){var c,u;if(i("td").removeClass("headerSorted"),i("td").children("i").remove(),i(t).addClass("headerSorted"),De.length<2)return;const a=e;let s=!0;o!==null?o?i(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>'):(s=!1,i(t).append('<i class="fas fa-sort-up" aria-hidden="true"></i>')):parseInt((c=De==null?void 0:De[0])==null?void 0:c[a])<=parseInt((u=De==null?void 0:De[De.length-1])==null?void 0:u[a])?(s=!0,i(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>')):(s=!1,i(t).append('<i class="fas fa-sort-up", aria-hidden="true"></i>'));const n=[],l=[];for(;n.length<De.length;){let d=Number.MAX_VALUE,p=-1,f=-1;for(const[g,h]of De.entries())s?h[a]>=p&&!l.includes(g)&&(p=h[a],f=g):h[a]<=d&&!l.includes(g)&&(d=h[a],f=g);n.push(De[f]),l.push(f)}De=n,i(".pageAccount .history table tbody").empty(),Es=0,tu()}i(".pageAccount button.toggleResultsOnChart").on("click",()=>{const e=[...r.accountChart];e[0]=e[0]==="on"?"off":"on",Td(e)});i(".pageAccount button.toggleAccuracyOnChart").on("click",()=>{const e=[...r.accountChart];e[1]=e[1]==="on"?"off":"on",Td(e)});i(".pageAccount button.toggleAverage10OnChart").on("click",()=>{const e=[...r.accountChart];e[2]=e[2]==="on"?"off":"on",Td(e)});i(".pageAccount button.toggleAverage100OnChart").on("click",()=>{const e=[...r.accountChart];e[3]=e[3]==="on"?"off":"on",Td(e)});i(".pageAccount .loadMoreButton").on("click",()=>{tu()});i(".pageAccount #accountHistoryChart").on("click",()=>{var s;const e=Gv;if(tu(e),window===void 0)return;const t=i(window).height()??0,a=(((s=i(`#result-${e}`).offset())==null?void 0:s.top)??0)-t/2;i([document.documentElement,document.body]).stop(!0).animate({scrollTop:a},{duration:fe(500),done:()=>{const n=i(`#result-${e}`);i(".resultRow").removeClass("active"),requestAnimationFrame(()=>n.addClass("active"))}})});i(".pageAccount").on("click",".miniResultChartButton",async e=>{var n,l;const t=i(e.currentTarget);if(t.hasClass("loading")||t.hasClass("disabled"))return;const o=t.attr("filteredResultsId");if(o===void 0)return;const a=De[parseInt(o)];if(a===void 0)return;let s=a.chartData;if(s===void 0){t.addClass("loading"),t.attr("aria-label",null),t.html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>'),te();const c=await E.results.getById({params:{resultId:a._id}});if(V(),t.html('<i class="fas fa-fw fa-chart-line"></i>'),t.removeClass("loading"),c.status!==200){m("Error fetching result: "+c.body.message,-1);return}s=c.body.data.chartData,a.chartData=s;const u=(l=(n=x())==null?void 0:n.results)==null?void 0:l.find(d=>d._id===a._id);if(u!==void 0&&(u.chartData=a.chartData),c.body.data.chartData==="toolong"){t.attr("aria-label","Graph history is not available for long tests"),t.attr("data-baloon-pos","up"),t.addClass("disabled"),m("Graph history is not available for long tests",0);return}}t.attr("aria-label","View graph"),QE(s)});i(".pageAccount .group.history").on("click",".history-wpm-header",()=>{bs("wpm",".history-wpm-header")});i(".pageAccount .group.history").on("click",".history-raw-header",()=>{bs("rawWpm",".history-raw-header")});i(".pageAccount .group.history").on("click",".history-acc-header",()=>{bs("acc",".history-acc-header")});i(".pageAccount .group.history").on("click",".history-correct-chars-header",()=>{bs("correctChars",".history-correct-chars-header")});i(".pageAccount .group.history").on("click",".history-incorrect-chars-header",()=>{bs("incorrectChars",".history-incorrect-chars-header")});i(".pageAccount .group.history").on("click",".history-consistency-header",()=>{bs("consistency",".history-consistency-header")});i(".pageAccount .group.history").on("click",".history-date-header",()=>{bs("timestamp",".history-date-header")});i(".pageAccount .group.history").on("click",".buttonsAndTitle .buttons button",()=>{bs("timestamp",".history-date-header",!0)});i(".pageAccount .group.topFilters, .pageAccount .filterButtons").on("click","button",()=>{setTimeout(()=>{bn()},0)});i(".pageAccount .group.presetFilterButtons").on("click",".filterBtns .filterPresets .select-filter-preset",async e=>{await DE(i(e.target).data("id")),bn()});i(".pageAccount .content .group.aboveHistory .exportCSV").on("click",()=>{zk(De)});i(".pageAccount .profile").on("click",".details .copyLink",()=>{const e=x();if(!e)return;const{name:t}=e,o=`${location.origin}/profile/${t}`;navigator.clipboard.writeText(o).then(function(){m("URL Copied to clipboard",0)},function(){alert("Failed to copy using the Clipboard API. Here's the link: "+o)})});i(".pageAccount button.loadMoreResults").on("click",async()=>{var t,o;const e=((o=(t=x())==null?void 0:t.results)==null?void 0:o.length)??0;te(),zf(),await Lm(e),await S0(),V()});ge(e=>{ee()==="account"&&e==="typingSpeedUnit"&&bn()});const p_=new Ha({id:"account",element:i(".page.pageAccount"),path:"/account",loadingOptions:{shouldLoad:()=>{var e;return((e=x())==null?void 0:e.results)===void 0},waitFor:async()=>{if(x()===null)throw new Error("Looks like your account data didn't download correctly. Please refresh the page.<br>If this error persists, please contact support.");return Lm()},style:"bar",keyframes:[{percentage:90,durationMs:2e3,text:"Downloading results..."}]},afterHide:async()=>{u_(),KE(),Bt("pageAccount")},beforeShow:async()=>{to("pageAccount","main");const e=x();g0(),await VE(bn),Oa(),await Te(0),Hf=document.querySelector(".page.pageAccount .testActivity"),C0(Hf,"current",e!==void 0?new Date(e.addedAt).getFullYear():2020),await bn().then(()=>{var t;d_(),i(".pageAccount .content .accountVerificatinNotice").remove(),((t=Po())==null?void 0:t.emailVerified)===!1&&i(".pageAccount .content").prepend('<div class="accountVerificatinNotice"><i class="fas icon fa-exclamation-triangle"></i><p>Your email address is still not verified</p><button class="sendVerificationEmail">resend verification email</button></div>'),n_()})}});i(()=>{oo("pageAccount")});let ed=!1;function x0(){i(".scrollToTopButton").addClass("invisible"),ed=!1}function m_(){i(".scrollToTopButton").removeClass("invisible"),ed=!0}i(document).on("click",".scrollToTopButton",()=>{i(".scrollToTopButton").addClass("invisible"),window.scrollTo({top:0,behavior:Ay()?"instant":"smooth"})});i(window).on("scroll",()=>{if(ee()==="test")return;const t=window.scrollY;!ed&&t>100?m_():ed&&t<100&&x0()});const g_=new Ha({id:"test",element:i(".page.pageTest"),path:"/",beforeHide:async()=>{i("#wordsInput").trigger("focusout")},afterHide:async()=>{oe(),W({noAnim:!0}),zi(),Kt(),Qc(!0)},beforeShow:async()=>{Qc(!1),Dv(),oe(),W({noAnim:!0}),Iw(),Uc(),x0()}});function h_(){i(".pageAbout .contributors").empty(),i(".pageAbout .supporters").empty(),Zi.getDataset("count").data=[],Zi.updateColors()}let td,ja;function y_(){var e;if(td){Zi.updateColors();const t=w_(td);Zi.data.labels=t.labels,Zi.getDataset("count").data=t.data}if(ja){const t=Math.round(ja.timeTyping),o=Ny({start:0,end:t*1e3});i(".pageAbout #totalTimeTypingStat .val").text(((e=o.years)==null?void 0:e.toString())??""),i(".pageAbout #totalTimeTypingStat .valSmall").text("years"),i(".pageAbout #totalTimeTypingStat").attr("aria-label",pu(Math.round(t/3600))+" hours");const a=gg(ja.testsStarted);i(".pageAbout #totalStartedTestsStat .val").text(a.rounded<10?a.roundedTo2:a.rounded),i(".pageAbout #totalStartedTestsStat .valSmall").text(a.orderOfMagnitude),i(".pageAbout #totalStartedTestsStat").attr("aria-label",pu(ja.testsStarted)+" tests");const s=gg(ja.testsCompleted);i(".pageAbout #totalCompletedTestsStat .val").text(s.rounded<10?s.roundedTo2:s.rounded),i(".pageAbout #totalCompletedTestsStat .valSmall").text(s.orderOfMagnitude),i(".pageAbout #totalCompletedTestsStat").attr("aria-label",pu(ja.testsCompleted)+" tests")}}async function b_(){if(td&&ja)return;if(!it()){m("Cannot update all time stats - offline",0);return}const e=await E.public.getSpeedHistogram({query:{language:"english",mode:"time",mode2:"60"}});e.status===200?td=e.body.data:m(`Failed to get global speed stats for histogram: ${e.body.message}`,-1);const t=await E.public.getTypingStats();t.status===200?ja=t.body.data:m(`Failed to get global typing stats: ${e.body.message}`,-1)}async function v_(){const{data:e,error:t}=await eo(nL());t&&m(re(t,"Failed to get supporters"),-1);const{data:o,error:a}=await eo(rL());a&&m(re(a,"Failed to get contributors"),-1),b_().then(()=>{y_()});const s=document.querySelector(".pageAbout .supporters");let n="";for(const u of e??[])n+=`<div>${u}</div>`;s&&(s.innerHTML=n);const l=document.querySelector(".pageAbout .contributors");let c="";for(const u of o??[])c+=`<div>${u}</div>`;l&&(l.innerHTML=c)}function w_(e){const t=[],o=[],a=Object.keys(e).sort((s,n)=>parseInt(s,10)-parseInt(n,10));for(const[s,n]of a.entries()){const l=a[s+1],c=parseInt(n,10);if(t.push({x:c,y:e[c]}),o.push(`${c} - ${c+9}`),l!==void 0&&c+10!==parseInt(l,10))for(let u=c+10;u<parseInt(l,10);u+=10)t.push({x:u,y:0}),o.push(`${u} - ${u+9}`)}return{data:t,labels:o}}const C_=new Ha({id:"about",element:i(".page.pageAbout"),path:"/about",afterHide:async()=>{h_(),Bt("pageAbout")},beforeShow:async()=>{to("pageAbout","main"),v_()}});i(()=>{oo("pageAbout")});const k_=["gmaill.com","gamil.com","gmali.com","gnail.com","gmil.com","gamail.com","hotmai.com","gmial.com","hotmal.com","yaho.com","outlokk.com","gmil.com","hotmial.com","yahooo.com","otulook.com","gamil.com","hotnail.com","yaoo.com","outlok.com","gmail.cmo","hotmail.cmo","yahho.com","outloook.com","gmaail.com","hottmail.com","yaho.com","outllok.com","gmai.com","hotmil.com","yhaoo.com","outlookk.com","gmil.com","htmial.com","yaahoo.com","otlook.com","gamail.com","hotnail.com","yaoho.com","outlok.com","gemail.com","hotmiall.com","yahhoo.com","outloookk.com","gmal.com","hottmail.com","yahio.com","outlokkk.com",".comm",".con",".cmo",".coom",".cim",".vom","-online.de","-tonline.de","acor.de","aecor.de","ahoo.de","al.com","ao.com","aol.cm","aol.con","aol.ocm","aol.om","aoll.com","apl.com","arco.de","arocr.de","aror.de","feenet.de","freeenet.de","freeent.de","freeet.de","freemet.de","freeneet.de","freent.de","frenet.de","gm.de","gm.net","gm.xde","gmc.de","gmx.ded","gmx.dw","gmxx.de","gmy.de","gx.de","hmx.de","homail.de","hotmai.de","hotmal.de","mx.de","mx.net","@otmail.com","r-online.de","rcor.de","reenet.de","t--online.de","t-0nline.de","t-nline.de","t-oline.de","t-omline.de","t-onine.de","t-onlien.de","t-onliine.de","t-onlin.de","t-onlinde.de","t-onlinr.de","t-onlione.de","t-onlline.de","t-onlne.de","t-onlone.de","t.-online.de","t.online.de","tonline.de","wb.de","we.de","web.ded","web.dw","wed.de","weeb.de","wen.de","wweb.de","yaho.de","yahooo.de","yaoo.de","yhoo.de","yahhoo.de","icoud.com","icloud.cim","icloud.con","icloud.ocm","icloud.om","icloud.cm"];let ni={};function $m(){i(".page.pageLogin .register.side button").prop("disabled",!1)}function Cl(){i(".page.pageLogin .register.side button").prop("disabled",!0)}function oa(){i(".pageLogin input").prop("disabled",!1),i(".pageLogin button").prop("disabled",!1)}function Mm(){i(".pageLogin input").prop("disabled",!0),i(".pageLogin button").prop("disabled",!0)}function Am(){i(".pageLogin .preloader").removeClass("hidden")}function Zo(){i(".pageLogin .preloader").addClass("hidden")}const ri=()=>{Object.values(ni).some(e=>e===void 0)?Cl():$m()};function S_(){return Object.values(ni).some(e=>e===void 0)?!1:ni}const hh=document.querySelector(".page.pageLogin .register.side input.usernameInput");ys(hh,{schema:hd,isValid:async e=>(await E.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available",debounceDelay:1e3,callback:e=>{ni.name=e.status==="success"?hh.value:void 0,ri()}});let mc=null,yh=!1;const od=document.querySelector(".page.pageLogin .register.side input.emailInput");od.addEventListener("focus",async()=>{if(!yh){yh=!0;try{mc=await bd(()=>import("./vendor.CUQxkLCO.js").then(e=>e.i),__vite__mapDeps([0,1,2]))}catch{}}});ys(od,{schema:Cc,isValid:async e=>{if(/@.*(student|education|school|\.edu$|\.edu\.|\.ac\.|\.sch\.)/i.test(e))return{warning:"Some education emails will fail to receive our messages, or disable the account as soon as you graduate. Consider using a personal email address."};if(k_.some(a=>e.endsWith(a)))return{warning:"Please check your email address, it may contain a typo."};if(mc&&mc.isDisposableEmail!==void 0)try{if(mc.isDisposableEmail(e))return{warning:"Using a temporary email may cause issues with logging in, password resets and support. Consider using a permanent email address. Don't worry, we don't send spam."}}catch{}return!0},debounceDelay:0,callback:e=>{e.status==="success"&&T0.dispatchEvent(new Event("input"))}});const T0=document.querySelector(".page.pageLogin .register.side input.verifyEmailInput");ys(T0,{isValid:async e=>od.value===e?!0:"verify email not matching email",debounceDelay:0,callback:e=>{ni.email=e.status==="success"?od.value:void 0,ri()}});const Of=document.querySelector(".page.pageLogin .register.side .passwordInput");ys(Of,{schema:P.string().min(6),isValid:async e=>qy(e)?!0:e.length<8?"Password must be at least 8 characters":e.length>64?"Password must be at most 64 characters":"Password must contain at least one capital letter, number, and special character",debounceDelay:0,callback:e=>{e.status==="success"&&L0.dispatchEvent(new Event("input"))}});const L0=document.querySelector(".page.pageLogin .register.side .verifyPasswordInput");ys(L0,{isValid:async e=>Of.value===e?!0:"verify password not matching password",debounceDelay:0,callback:e=>{ni.password=e.status==="success"?Of.value:void 0,ri()}});const x_=new Ha({id:"login",element:i(".page.pageLogin"),path:"/login",afterHide:async()=>{Zo(),Bt("pageLogin")},beforeShow:async()=>{to("pageLogin","main"),ni={},i(".pageLogin input").val(""),i(".pageLogin .register .indicator").addClass("hidden"),oa(),Cl()}});i(()=>{oo("pageLogin")});const kl=i(".page.pageLoading"),ou=kl.find(".bar"),Em=kl.find(".error"),_m=kl.find(".spinner"),au=kl.find(".text");async function Nf(e,t){return new Promise(o=>{ou.find(".fill").stop(!0,!1).animate({width:e+"%"},t,()=>{o()})})}function ad(e){au.removeClass("hidden").html(e)}function T_(){ou.addClass("hidden"),Em.addClass("hidden"),_m.removeClass("hidden"),au.addClass("hidden")}function L_(){ou.addClass("hidden"),_m.addClass("hidden"),Em.removeClass("hidden"),au.addClass("hidden")}async function $_(){ou.removeClass("hidden"),Em.addClass("hidden"),_m.addClass("hidden"),au.addClass("hidden")}const $s=new Ha({id:"loading",element:kl,path:"/",afterHide:async()=>{Bt("pageLoading")},beforeShow:async()=>{to("pageLoading","main")}}),M_=wn.recaptchaSiteKey,$a={};function Im(){if(!("grecaptcha"in window))throw new Error("grecaptcha is not defined");return window.grecaptcha}function li(){return"grecaptcha"in window}function En(e,t,o){if($a[t]!==void 0&&$a[t]!==null)return;const a=Im().render(e,{sitekey:M_,callback:o});$a[t]=a}function Fa(e){$a[e]===void 0||$a[e]===null||Im().reset($a[e])}function Sl(e){return $a[e]===void 0||$a[e]===null?"":Im().getResponse($a[e])}class Qr{constructor(t,o){this.textareaElement=t,this.maxLength=o,this.textareaElement.attr("maxlength",this.maxLength.toString()),this.textareaElement.parent().hasClass("textareaWithCounter")||i(this.textareaElement).wrap('<div class="textareaWithCounter"></div>'),this.parentElement=i(this.textareaElement).parent(".textareaWithCounter"),this.parentElement.find(".char-counter").length===0?(this.counterElement=i('<span class="char-counter"></span>'),this.parentElement.append(this.counterElement)):this.counterElement=this.parentElement.find(".char-counter"),this.updateCounter(),this.textareaElement.on("input",()=>this.updateCounter())}updateCounter(){const t=this.maxLength,o=this.textareaElement.val().length,a=t-o;this.counterElement.text(`${o}/${t}`);const s=a/this.maxLength*100;this.counterElement.removeClass("warning"),this.counterElement.removeClass("error"),s===0?this.counterElement.addClass("error"):s<10&&this.counterElement.addClass("warning")}setMaxLength(t){this.maxLength=t,this.updateCounter()}}const sd={userUid:void 0,lbOptOut:void 0};let Kn;async function A_(e){if(!F()){m("You must be logged in to submit a report",0);return}if(!li()){m("Could not show user report popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}$0.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async t=>{En(t.querySelector(".g-recaptcha"),"userReportModal");const{name:o}=e;sd.userUid=e.uid,sd.lbOptOut=e.lbOptOut,t.querySelector(".user").textContent=o,t.querySelector(".reason").value="Inappropriate name",t.querySelector(".comment").value="",Kn=new lt({select:t.querySelector(".reason"),settings:{showSearch:!1,contentLocation:t}})}}),new Qr(i("#userReportModal .comment"),250)}async function E_(){$0.hide()}async function __(){const e=Sl("userReportModal");if(!e){m("Please complete the captcha");return}const t=i("#userReportModal .reason").val(),o=i("#userReportModal .comment").val(),a=e;if(!t){m("Please select a valid report reason");return}if(!o){m("Please provide a comment");return}if(t==="Suspected cheating"&&sd.lbOptOut){m("You cannot report this user for suspected cheating as they have opted out of the leaderboards.",0,{duration:10});return}const s=o.length-250;if(s>0){m(`Report comment is ${s} character(s) too long`);return}te();const n=await E.users.report({body:{uid:sd.userUid,reason:t,comment:o,captcha:a}});if(V(),n.status!==200){m("Failed to report user: "+n.body.message,-1);return}m("Report submitted. Thank you!",1),E_()}const $0=new le({dialogId:"userReportModal",setup:async e=>{var t;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{__()})},cleanup:async()=>{Kn==null||Kn.destroy(),Kn=void 0,Fa("userReportModal")}}),I_=db();function bh(){i(".page.pageProfile .error").addClass("hidden"),i(".page.pageProfile .preloader").removeClass("hidden"),i(".page.pageProfile .profile").html(`
      <div class="details none">
        <div class="avatarAndName">
          <div class="avatar"></div>
          <div>
             <div class="user">
              <div class="name">-</div>
              <div class="userFlags"></div>
            </div>
            <div class="badges"></div>
            <div class="allBadges"></div>
            <div class="joined" data-balloon-pos="up">-</div>
	          <div class="streak" data-balloon-pos="up">-</div>
          </div>
          <div class="levelAndBar">
            <div class="level" data-balloon-pos="up">-</div>
            <div class="xpBar" data-balloon-pos="up">
              <div class="bar" style="width: 0%;"></div>
            </div>
            <div class="xp" data-balloon-pos="up">-/-</div>
          </div>
        </div>
        <div class="separator sep1"></div>
        <div class="typingStats vertical">
          <div class="started">
            <div class="title">tests started</div>
            <div class="value">-</div>
          </div>
          <div class="completed">
            <div class="title">tests completed</div>
            <div class="value">-</div>
          </div>
          <div class="timeTyping">
            <div class="title">time typing</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep2 hidden"></div>

        <div class="bioAndKeyboard vertical hidden">
          <div class="bio">
            <div class="title">bio</div>
            <div class="value">-</div>
          </div>
          <div class="keyboard hidden">
            <div class="title">keyboard</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep3 hidden"></div>

        <div class="socials big hidden">
          <div class="title">socials</div>
          <div class="value">-</div>
        </div>
        <div class="buttonGroup">
          <button
            class="userReportButton"
            data-balloon-pos="left"
            aria-label="Report user"
          >
            <i class="fas fa-flag"></i>
          </button>
        </div>
      </div>
      <div class="leaderboardsPositions">
        <div class="title">All-Time English Leaderboards</div>
        <div class="group t15">
          <div class="testType">15 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
        <div class="group t60">
          <div class="testType">60 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
      </div>
      <div class="pbsWords">
        <div class="group">
          <div class="quick">
            <div class="test">10 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">25 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">50 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">100 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div>
      <div class="pbsTime">
        <div class="group">
          <div class="quick">
            <div class="test">15 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">30 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">60 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">120 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div><div class="lbOptOutReminder hidden"></div>
      `);const e=document.querySelector(".page.pageProfile .testActivity");e!==null&&Tm(e)}async function q_(e){const t=Hk("isUid");if(e.data)i(".page.pageProfile .preloader").addClass("hidden"),await Jc("profile",e.data),Wf(e.data.personalBests,!0);else if(e.uidOrName!==void 0&&e.uidOrName!==""){const o=await E.users.getProfile({params:{uidOrName:e.uidOrName},query:{isUid:t}});if(i(".page.pageProfile .preloader").addClass("hidden"),o.status===404){const a=t?"User not found":`User ${e.uidOrName} not found`;i(".page.pageProfile .preloader").addClass("hidden"),i(".page.pageProfile .error").removeClass("hidden"),i(".page.pageProfile .error .message").text(a)}else if(o.status===200){const a=o.body.data;window.history.replaceState(null,"",`/profile/${a.name}`),await Jc("profile",a),Wf(a.personalBests,!0);const s=document.querySelector(".page.pageProfile .testActivity");if(a.testActivity!==void 0){const n=new nr(a.testActivity.testsByDays,new Date(a.testActivity.lastDay),I_);v0(s,n);const l=s.querySelector(".top .title");l.innerHTML=(l==null?void 0:l.innerHTML)+" in last 12 months"}else Tm(s)}else{m("Failed to load profile: "+o.body.message,-1);return}}else m("Missing update parameter!",-1)}i(".page.pageProfile").on("click",".profile .userReportButton",()=>{const e=i(".page.pageProfile .profile").attr("uid")??"",t=i(".page.pageProfile .profile").attr("name")??"",o=(i(".page.pageProfile .profile").attr("lbOptOut")??"false")==="true";A_({uid:e,name:t,lbOptOut:o})});const B_=new Ha({id:"profile",element:i(".page.pageProfile"),path:"/profile",afterHide:async()=>{Bt("pageProfile"),bh()},beforeShow:async e=>{var o;to("pageProfile","main");const t=((o=e==null?void 0:e.params)==null?void 0:o.uidOrName)??"";t?(i(".page.pageProfile .preloader").removeClass("hidden"),i(".page.pageProfile .search").addClass("hidden"),i(".page.pageProfile .content").removeClass("hidden"),bh(),q_({uidOrName:t,data:e==null?void 0:e.data})):(i(".page.pageProfile .preloader").addClass("hidden"),i(".page.pageProfile .search").removeClass("hidden"),i(".page.pageProfile .content").addClass("hidden"))}});oo("pageProfile");const F_=new Ha({id:"profileSearch",element:i(".page.pageProfileSearch"),path:"/profile",afterHide:async()=>{Bt("pageProfileSearch")},beforeShow:async()=>{to("pageProfileSearch","main"),i(".page.pageProfileSearch input").val("")},afterShow:async()=>{i(".page.pageProfileSearch input").trigger("focus")}}),R_=new Ha({id:"404",element:i(".page.page404"),path:"/404",afterHide:async()=>{Bt("page404")},beforeShow:async()=>{to("page404","main")}});oo("page404");const D_=P.enum(["allTime","weekly","daily"]),Iu="EEEE, do MMMM yyyy",vh="EEEE, do MMMM yyyy HH:mm",b={loading:!0,updating:!1,type:"allTime",mode:"time",mode2:"15",data:null,userData:null,page:0,pageSize:50,title:"All-time English Time 15 Leaderboard",scrollToUserAfterFill:!1,goToUserPage:!1},M0=P.object({type:D_,mode:Py.optional(),mode2:P.string().optional(),language:Dy.optional(),yesterday:P.boolean().optional(),lastWeek:P.boolean().optional()}),W_=M0.extend({page:P.number(),goToUserPage:P.boolean()}).partial(),A0=new Gt({key:"leaderboardSelector",schema:M0,fallback:{type:"allTime",mode2:"15"}}),is={allTime:{time:{15:["english"],60:["english"]}},daily:{}};function xl(){const e=b.type==="allTime"?"All-time":b.type==="weekly"?"Weekly XP":"Daily",t=b.type!=="weekly"?Ft(b.language):"",o=b.type!=="weekly"?` ${Ft(b.mode)} ${b.mode2}`:"";if(b.title=`${e} ${t} ${o} Leaderboard`,i(".page.pageLeaderboards .bigtitle >.text").text(b.title),i(".page.pageLeaderboards .bigtitle .subtext").addClass("hidden"),i(".page.pageLeaderboards .bigtitle button").addClass("hidden"),i(".page.pageLeaderboards .bigtitle .subtext .divider").addClass("hidden"),b.type==="daily"){i(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),b.yesterday?i(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-forward"></i>
            show today
        `):i(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-backward"></i>
            show yesterday
        `);let a=US(new ba);b.yesterday&&(a=VS(a)),Th(ae(a,Iu)+" UTC",Vl(a),Vl(Uy(a)))}else if(b.type==="weekly"){i(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),b.lastWeek?i(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-forward"></i>
            show this week
        `):i(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-backward"></i>
            show last week
        `);let a=KS(new ba,{weekStartsOn:1});b.lastWeek&&(a=GS(a,7));const s=Vy(a,{weekStartsOn:1}),n=`${ae(a,Iu)} - ${ae(s,Iu)} UTC`;Th(n,Vl(a),Vl(s))}}async function _n(e=!1){var n;e?(b.updating=!0,b.error=void 0):(b.loading=!0,b.error=void 0,b.data=null,b.userData=null),Ra();const t=(l,c,u)=>({rank:async()=>c({query:u}),data:async()=>l({query:{...u,page:b.page,pageSize:b.pageSize}})});let o;if(b.type==="allTime")o=t(E.leaderboards.get,E.leaderboards.getRank,{language:"english",mode:"time",mode2:b.mode2});else if(b.type==="daily")o=t(E.leaderboards.getDaily,E.leaderboards.getDailyRank,{language:b.language,mode:b.mode,mode2:b.mode2,daysBefore:b.yesterday?1:void 0});else if(b.type==="weekly")o=t(E.leaderboards.getWeeklyXp,E.leaderboards.getWeeklyXpRank,{weeksBefore:b.lastWeek?1:void 0});else throw new Error("unknown state type");if((!F()||b.userData!==null)&&(o.rank=void 0),b.goToUserPage&&o.rank!==void 0){b.goToUserPage=!1;const l=await o.rank();l!==void 0&&l.status===200&&l.body.data!==null&&(b.userData=l.body.data,b.page=Math.floor((b.userData.rank-1)/b.pageSize),hi()),o.rank=void 0}const[a,s]=await Promise.all([o.data(),(n=o.rank)==null?void 0:n.call(o)]);a.status===200?(b.data=a.body.data.entries,b.count=a.body.data.count,b.pageSize=a.body.data.pageSize,b.type==="daily"&&(b.minWpm=a.body.data.minWpm)):(b.data=null,a.status===404?b.error="No leaderboard found":(b.error="Something went wrong",m("Failed to get leaderboard: "+a.body.message,-1))),b.userData===null&&s!==void 0&&(s.status===200?s.body.data!==null&&(b.userData=s.body.data):(b.userData=null,b.error="Something went wrong",m("Failed to get rank: "+s.body.message,-1))),b.loading=!1,b.updating=!1,Ra(),!e&&F()&&E0()}function P_(){const e=i(".page.pageLeaderboards .titleAndButtons .jumpButtons");e.find("button").removeClass("active");const t=Math.ceil(b.count/b.pageSize);if(t<=1?e.find("button").addClass("disabled"):e.find("button").removeClass("disabled"),b.page===0?(e.find("button[data-action='previousPage']").addClass("disabled"),e.find("button[data-action='firstPage']").addClass("disabled")):(e.find("button[data-action='previousPage']").removeClass("disabled"),e.find("button[data-action='firstPage']").removeClass("disabled")),F()){const o=e.find("button[data-action='userPage']");if(!b.userData)o.addClass("disabled");else{const a=Math.floor((b.userData.rank-1)/b.pageSize);b.page===a?o.addClass("disabled"):o.removeClass("disabled")}}b.page>=t-1?e.find("button[data-action='nextPage']").addClass("disabled"):e.find("button[data-action='nextPage']").removeClass("disabled")}function z_(e,t=!1){var s;const o={wpm:z.typingSpeed(e.wpm,{showDecimalPlaces:!0}),acc:z.percentage(e.acc,{showDecimalPlaces:!0}),raw:z.typingSpeed(e.raw,{showDecimalPlaces:!0}),con:z.percentage(e.consistency,{showDecimalPlaces:!0})},a=document.createElement("tr");return t&&a.classList.add("me"),a.dataset.uid=e.uid,a.innerHTML=`
    
      <td>${e.rank===1?'<i class="fas fa-fw fa-crown"></i>':e.rank}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="avatarPlaceholder"></div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${sl(e)}
            ${be(e.badgeId)?jr(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat narrow">
      ${o.wpm}
        <div class="sub">${o.acc}</div>
      </td>
      </td>
      <td class="stat narrow rawAndConsistency">
      ${o.raw}
        <div class="sub">${o.con}</div>
      </td>
      <td class="stat wide">${o.wpm}</td>
      <td class="stat wide">${o.acc}</td>
      <td class="stat wide">${o.raw}</td>
      <td class="stat wide">${o.con}</td>
      <td class="date">${ae(e.timestamp,"dd MMM yyyy")}<div class="sub">${ae(e.timestamp,"HH:mm")}</div></td>
    
  `,(s=a.querySelector(".avatarPlaceholder"))==null||s.replaceWith(xd(e)),a}function H_(e,t=!1){var s;const o=QS(e.lastActivityTimestamp,{addSuffix:!0}),a=document.createElement("tr");return t&&a.classList.add("me"),a.dataset.uid=e.uid,a.innerHTML=`
      <td>${e.rank===1?'<i class="fas fa-fw fa-crown"></i>':e.rank}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="avatarPlaceholder"></div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${sl(e)}
            ${be(e.badgeId)?jr(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat wide">${e.totalXp<1e3?e.totalXp:Sc(e.totalXp)}</td>
      <td class="stat wide">${ft(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      <td class="stat narrow">
      ${e.totalXp<1e3?e.totalXp:Sc(e.totalXp)}
      <div class="sub">${ft(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      </td>
      <td class="date" data-balloon-pos="left"  aria-label="${o}">
        ${ae(e.lastActivityTimestamp,"dd MMM yyyy")}
        <div class="sub">
          ${ae(e.lastActivityTimestamp,"HH:mm")}
        </div>
      </td>
    </tr>
  `,(s=a.querySelector(".avatarPlaceholder"))==null||s.replaceWith(xd(e)),a}function O_(){var t,o;const e=i(".page.pageLeaderboards table tbody");if(e.empty(),i(".page.pageLeaderboards table thead").addClass("hidden"),b.type==="allTime"||b.type==="daily"?i(".page.pageLeaderboards table thead.allTimeAndDaily").removeClass("hidden"):b.type==="weekly"&&i(".page.pageLeaderboards table thead.weekly").removeClass("hidden"),b.data===null||b.data.length===0){e.append('<tr><td colspan="7" class="empty">No data</td></tr>'),i(".page.pageLeaderboards table").removeClass("hidden");return}if(b.type==="allTime"||b.type==="daily")for(const a of b.data){const s=((t=Po())==null?void 0:t.uid)===a.uid;e.append(z_(a,s))}else if(b.type==="weekly")for(const a of b.data){const s=((o=Po())==null?void 0:o.uid)===a.uid;e.append(H_(a,s))}i(".page.pageLeaderboards table").removeClass("hidden")}function wh(){var a,s,n,l;if(b.type!=="allTime"||b.userData===null)return null;const e=((l=(n=(s=(a=x())==null?void 0:a.lbMemory)==null?void 0:s.time)==null?void 0:n[b.mode2])==null?void 0:l.english)??0,t=b.userData.rank,o=e-t;return o!==0&&yx("time",b.mode2,"english",t,!0),o}function E0(){var t,o,a,s,n;if(F()&&((t=x())==null?void 0:t.lbOptOut)===!0){i(".page.pageLeaderboards .bigUser").html('<div class="warning">You have opted out of the leaderboards.</div>');return}if(F()&&((o=x())==null?void 0:o.banned)===!0){i(".page.pageLeaderboards .bigUser").html('<div class="warning">Your account is banned</div>');return}const e=((a=An())==null?void 0:a.leaderboards.minTimeTyping)??7200;if(F()&&(((n=(s=x())==null?void 0:s.typingStats)==null?void 0:n.timeTyping)??0)<e){i(".page.pageLeaderboards .bigUser").html(`<div class="warning">Your account must have ${YS(Ny({start:0,end:e*1e3}))} typed to be placed on the leaderboard.</div>`);return}if(F()&&b.type==="daily"&&b.userData===null){let l="Not qualified";b.yesterday||(l+=` (min speed required: ${z.typingSpeed(b.minWpm,{showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`})})`),i(".page.pageLeaderboards .bigUser").html(`<div class="warning">${l}</div>`);return}if(F()&&b.userData===null){i(".page.pageLeaderboards .bigUser").html('<div class="warning">Not qualified</div>');return}if(b.data!==null){if(b.type==="allTime"||b.type==="daily"){if(!b.userData||!b.count){i(".page.pageLeaderboards .bigUser").addClass("hidden"),i(".page.pageLeaderboards .tableAndUser > .divider").removeClass("hidden");return}const l=b.userData;let u=`Top ${(l.rank/b.count*100).toFixed(2)}%`;l.rank===1&&(u="GOAT");const d=wh();let p;d===null?p="":d===0?p=" ( = since you last checked)":d>0?p=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(d)} since you last checked
      )`:p=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(d)} since you last checked
        )`;const f={wpm:z.typingSpeed(l.wpm,{showDecimalPlaces:!0}),acc:z.percentage(l.acc,{showDecimalPlaces:!0}),raw:z.typingSpeed(l.raw,{showDecimalPlaces:!0}),con:z.percentage(l.consistency,{showDecimalPlaces:!0})},g=`
          <div class="rank">${l.rank===1?'<i class="fas fa-fw fa-crown"></i>':l.rank}</div>
        <div class="userInfo">
          <div class="top">You (${u})</div>
          <div class="bottom">${p}</div>
        </div>
        <div class="stat wide">
          <div class="title">${r.typingSpeedUnit}</div>
          <div class="value">${f.wpm}</div>
        </div>
        <div class="stat wide">
          <div class="title">accuracy</div>
          <div class="value">${f.acc}</div>
        </div>
        <div class="stat wide">
          <div class="title">raw</div>
          <div class="value">${f.raw}</div>
        </div>
        <div class="stat wide">
          <div class="title">consistency</div>
          <div class="value">${f.con}</div>
        </div>
        <div class="stat wide">
          <div class="title">date</div>
          <div class="value">${ae(l.timestamp,"dd MMM yyyy HH:mm")}</div>
        </div>


        <div class="stat narrow">
          <div>${f.wpm}</div>
          <div class="sub">${f.acc}</div>
        </div>
        <div class="stat narrow rawAndConsistency">
          <div>${f.raw}</div>
          <div class="sub">${f.con}</div>
        </div>
        <div class="stat narrow">
          <div>${ae(l.timestamp,"dd MMM yyyy")}</div>
          <div class="sub">${ae(l.timestamp,"HH:mm")}</div>
        </div>
        `;i(".page.pageLeaderboards .bigUser").html(g)}else if(b.type==="weekly"){if(!b.userData||!b.count){i(".page.pageLeaderboards .bigUser").addClass("hidden");return}const l=b.userData;let u=`Top ${(l.rank/b.count*100).toFixed(2)}%`;l.rank===1&&(u="GOAT");const d=wh();let p;d===null?p="":d===0?p=" ( = since you last checked)":d>0?p=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(d)} since you last checked
      )`:p=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(d)} since you last checked
        )`;const f={xp:l.totalXp<1e3?l.totalXp:Sc(l.totalXp),time:ft(Math.round(l.timeTypedSeconds),!0,!0,":")},g=`
          <div class="rank">${l.rank===1?'<i class="fas fa-fw fa-crown"></i>':l.rank}</div>
        <div class="userInfo">
          <div class="top">You (${u})</div>
          <div class="bottom">${p}</div>
        </div>
        <div class="stat wide">
          <div class="title">xp gained</div>
          <div class="value">${f.xp}</div>
        </div>
        <div class="stat wide">
          <div class="title">time typed</div>
          <div class="value">${f.time}</div>
        </div>
        <div class="stat narrow">
          <div>${f.xp}</div>
          <div class="sub">${f.time}</div>
        </div>
        <div class="stat wide">
          <div class="title">last activity</div>
          <div class="value">${ae(l.lastActivityTimestamp,"dd MMM yyyy HH:mm")}</div>
        </div>
        <div class="stat narrow">
          <div>${ae(l.lastActivityTimestamp,"dd MMM yyyy")}</div>
          <div class="sub">${ae(l.lastActivityTimestamp,"HH:mm")}</div>
        </div>
        `;i(".page.pageLeaderboards .bigUser").html(g)}i(".page.pageLeaderboards .bigUser").removeClass("hidden"),i(".page.pageLeaderboards .tableAndUser > .divider").addClass("hidden")}}function Ra(){var e;if(i(".page.pageLeaderboards .loading").addClass("hidden"),i(".page.pageLeaderboards .updating").addClass("invisible"),i(".page.pageLeaderboards .error").addClass("hidden"),b.error!==void 0){i(".page.pageLeaderboards .error").removeClass("hidden"),i(".page.pageLeaderboards .error p").text(b.error),xh();return}if(b.updating){Sh(),i(".page.pageLeaderboards .updating").removeClass("invisible");return}else if(b.loading){Sh(),i(".page.pageLeaderboards .bigUser").addClass("hidden"),i(".page.pageLeaderboards .titleAndButtons").addClass("hidden"),i(".page.pageLeaderboards .loading").removeClass("hidden"),i(".page.pageLeaderboards table").addClass("hidden");return}else xh();if(F()?i(".page.pageLeaderboards .needAuth").removeClass("hidden"):i(".page.pageLeaderboards .needAuth").addClass("hidden"),b.data===null){m("Data is null");return}i(".page.pageLeaderboards .titleAndButtons").removeClass("hidden"),P_(),K_(),O_();for(const t of document.querySelectorAll(".page.pageLeaderboards .wide.speedUnit, .page.pageLeaderboards .narrow.speedUnit span"))t.innerHTML=r.typingSpeedUnit;if(b.scrollToUserAfterFill){const t=i(window).height()??0,a=(((e=i(".tableAndUser .me").offset())==null?void 0:e.top)??0)-t/2;i([document.documentElement,document.body]).animate({scrollTop:a},fe(500)),b.scrollToUserAfterFill=!1}}function su(){N_(),U_(),V_()}function N_(){const e=i(".page.pageLeaderboards .buttonGroup.typeButtons");e.find("button").removeClass("active"),e.find(`button[data-type=${b.type}]`).addClass("active")}function U_(){if(b.type!=="allTime"&&b.type!=="daily"){i(".page.pageLeaderboards .buttonGroup.modeButtons").addClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider").addClass("hidden");return}i(".page.pageLeaderboards .buttonGroup.modeButtons").removeClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider").removeClass("hidden");const e=i(".page.pageLeaderboards .buttonGroup.modeButtons");e.find("button").removeClass("active"),e.find(`button[data-mode=${b.mode}][data-mode2=${b.mode2}]`).addClass("active"),i(".page.pageLeaderboards .buttonGroup.modeButtons button").addClass("hidden");for(const t of Object.keys(is[b.type]))for(const o of Object.keys(is[b.type][t]))i(`.page.pageLeaderboards .buttonGroup.modeButtons button[data-mode="${t}"][data-mode2="${o}"]`).removeClass("hidden")}function V_(){var t;if(b.type!=="daily"){i(".page.pageLeaderboards .buttonGroup.languageButtons").addClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider2").addClass("hidden");return}i(".page.pageLeaderboards .buttonGroup.languageButtons").removeClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider2").removeClass("hidden");const e=i(".page.pageLeaderboards .buttonGroup.languageButtons");e.find("button").removeClass("active"),e.find(`button[data-language=${b.language}]`).addClass("active"),i(".page.pageLeaderboards .buttonGroup.languageButtons button").addClass("hidden");for(const o of((t=is[b.type][b.mode])==null?void 0:t[b.mode2])??[])i(`.page.pageLeaderboards .buttonGroup.languageButtons button[data-language="${o}"]`).removeClass("hidden")}let Uf;function Ch(){if(b.type==="daily"){const e=ug(new Date,Uy(new ba));i(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+ft(e,!0))}else if(b.type==="allTime"){const e=new Date,t=14-e.getMinutes()%15,o=60-e.getSeconds(),a=t*60+o;i(".page.pageLeaderboards .titleAndButtons .timer").text("Next update in: "+ft(a,!0))}else if(b.type==="weekly"){const e=Vy(new ba,{weekStartsOn:1}),t=ug(new Date,e);i(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+ft(t,!0,!0,":",!0,!0))}}function K_(){let e=!0;(b.type==="daily"&&b.yesterday||b.type==="weekly"&&b.lastWeek)&&(e=!1),e?i(".page.pageLeaderboards .titleAndButtons .timer").removeClass("invisible"):i(".page.pageLeaderboards .titleAndButtons .timer").addClass("invisible")}function G_(){Ch(),Uf=setInterval(()=>{Ch()},1e3)}function j_(){clearInterval(Uf),Uf=void 0,i(".page.pageLeaderboards .titleAndButtons .timer").text("-")}function kh(e){return e.startsWith("(")?e.slice(1,-1).split("|"):[e]}async function Q_(){var o;const e=(o=An())==null?void 0:o.dailyLeaderboards.validModeRules;if(e===void 0)throw new Error("cannot load server configuration for dailyLeaderboards.validModeRules");const t=e.flatMap(a=>{const s=kh(a.language);return kh(a.mode2).map(l=>({mode:a.mode,mode2:l,languages:s}))});is.daily=t.reduce((a,{mode:s,mode2:n,languages:l})=>{let c=a[s];c===void 0&&(c={},a[s]=c);let u=c[n];return u===void 0&&(u=[],c[n]=u),u.push(...l),a},{})}function iu(){if(b.type==="weekly")return;const e=is[b.type];let t=e[b.mode];if(t===void 0){const a=Object.keys(e).sort()[0];if(a===void 0)throw new Error(`no valid leaderboard config for type ${b.type}`);b.mode=a,t=e[b.mode]}let o=t[b.mode2];if(o===void 0){const a=Object.keys(t).sort((s,n)=>parseInt(s)-parseInt(n))[0];if(a===void 0)throw new Error(`no valid leaderboard config for type ${b.type} and mode ${b.mode}`);b.mode2=a,o=t[b.mode2]}if(o===void 0||o.length<1)throw new Error(`Daily leaderboard config not valid for mode:${b.mode} mode2:${b.mode2}`);o.includes(b.language)||(b.language=o.sort()[0])}async function Y_(){const t=Array.from(new Set(Object.values(is).flatMap(s=>Object.keys(s)))).sort().flatMap(s=>{const n=Array.from(new Set(Object.values(is).flatMap(c=>Object.keys(c[s]??{})))).sort((c,u)=>parseInt(c)-parseInt(u)),l=s==="time"?"fas fa-clock":"fas fa-align-left";return n.map(c=>`<button data-mode="${s}" data-mode2="${c}">
      <i class="${l}"></i>
       ${s} ${c}
    </button>`)});i(".modeButtons").html(t.join(`
`));const a=Array.from(new Set(Object.values(is).flatMap(s=>Object.values(s)).flatMap(s=>Object.values(s)).flatMap(s=>s))).sort().map(s=>`<button data-language="${s}">
          <i class="fas fa-globe"></i>
          ${s}
        </button>`);i(".languageButtons").html(a.join(`
`))}function Sh(){i(".page.pageLeaderboards button").prop("disabled",!0)}function xh(){i(".page.pageLeaderboards button").prop("disabled",!1)}function X_(e){e<0||e===b.page||_0("goToPage",e)}function _0(e,t){var o;if(e==="firstPage")b.page=0;else if(e==="previousPage"&&b.page>0){const a=Math.ceil(b.count/b.pageSize);b.page>a?b.page=a-1:b.page-=1}else if(e==="nextPage")b.page+=1;else if(e==="goToPage"&&t!==void 0)b.page=t;else if(e==="userPage"){if(F()){const a=(o=b.userData)==null?void 0:o.rank;if(be(a)){const s=Math.floor((a-1)/b.pageSize);if(b.page===s)return;b.page=s,b.scrollToUserAfterFill=!0}}}else return;hi(),_n(!0),Ra()}function Z_(e){b.type==="daily"&&e==="toggleYesterday"?b.yesterday=!b.yesterday:b.type==="weekly"&&e==="toggleLastWeek"&&(b.lastWeek=!b.lastWeek),hi(),_n(),Ra(),xl()}function hi(){if(b.goToUserPage)return;const e={};e.type=b.type,b.type==="allTime"?e.mode2=b.mode2:b.type==="daily"?(e.mode=b.mode,e.language=b.language,e.mode2=b.mode2,b.yesterday&&(e.yesterday=!0)):b.type==="weekly"&&b.lastWeek&&(e.lastWeek=!0),e.page=b.page+1,I0.setUrlParams(e),A0.set(b)}function J_(e){if(e===void 0){Object.assign(b,A0.get());return}e.type!==void 0&&(b.type=e.type),b.type==="allTime"?e.mode2!==void 0&&(b.mode2=e.mode2):b.type==="daily"?(e.language!==void 0&&(b.language=e.language),e.mode2!==void 0&&(b.mode2=e.mode2),e.mode!==void 0&&(b.mode=e.mode),e.yesterday!==void 0&&(b.yesterday=e.yesterday)):b.type==="weekly"&&e.lastWeek!==void 0&&(b.lastWeek=e.lastWeek),e.page!==void 0&&(b.page=e.page-1,b.page<0&&(b.page=0)),e.goToUserPage===!0&&(b.goToUserPage=!0)}function Vl(e){return jS(e,new Date().getTimezoneOffset())}function Th(e,t,o){const a=`local time 
`+ae(t,vh)+` - 
`+ae(o,vh),s=i(".page.pageLeaderboards .bigtitle .subtext > .text");s.text(`${e}`),s.attr("aria-label",a)}i(".page.pageLeaderboards .jumpButtons button").on("click",function(){const e=i(this).data("action");e!=="goToPage"&&_0(e)});i(".page.pageLeaderboards .bigtitle button").on("click",function(){const e=i(this).data("action");Z_(e)});i(".page.pageLeaderboards .buttonGroup.typeButtons").on("click","button",function(){const e=i(this).data("type");b.type!==e&&(b.type=e,b.type==="daily"&&(b.language="english",b.yesterday=!1),b.type==="weekly"&&(b.lastWeek=!1),iu(),b.data=null,b.page=0,_n(),xl(),su(),Ra(),hi())});i(".page.pageLeaderboards .buttonGroup.modeButtons").on("click","button",function(){const e=i(this).attr("data-mode"),t=i(this).attr("data-mode2");if(e!==void 0&&t!==void 0&&(b.type==="allTime"||b.type==="daily")){if(b.mode===e&&b.mode2===t)return;b.mode=e,b.mode2=t,b.page=0}else return;iu(),b.data=null,_n(),su(),xl(),Ra(),hi()});i(".page.pageLeaderboards .buttonGroup.languageButtons").on("click","button",function(){const e=i(this).attr("data-language");if(e!==void 0&&b.type==="daily"){if(b.language===e)return;b.language=e,b.page=0}else return;iu(),b.data=null,_n(),su(),xl(),Ra(),hi()});const I0=new vm({id:"leaderboards",element:i(".page.pageLeaderboards"),path:"/leaderboards",urlParamsSchema:W_,afterHide:async()=>{Bt("pageLeaderboards"),j_()},beforeShow:async e=>{await e_,to("pageLeaderboards","main"),await Q_(),await Y_(),J_(e.urlParams),iu(),G_(),xl(),Ra(),su(),hi(),_n(!1)},afterShow:async()=>{}});i(async()=>{oo("pageLeaderboards")});ge(e=>{ee()==="leaderboards"&&e==="typingSpeedUnit"&&(Ra(),E0())});function eI(){if(!it()){m("You are offline",0,{duration:2});return}Yr.show({focusFirstInput:!0,beforeAnimation:async e=>{var t,o,a,s;((t=x())==null?void 0:t.streakHourOffset)!==void 0?((o=e.querySelector("input"))==null||o.remove(),(a=e.querySelector(".preview"))==null||a.remove(),(s=e.querySelector("button"))==null||s.remove(),e.querySelector(".text").textContent="You have already set your streak hour offset."):(e.querySelector("input").value="0",q0())}})}function q0(){var s;const e=parseInt((s=Yr.getModal().querySelector("input"))==null?void 0:s.value,10),t=Yr.getModal().querySelector(".preview"),o=new Date;o.setUTCHours(0),o.setUTCMinutes(0),o.setUTCSeconds(0),o.setUTCMilliseconds(0);const a=new Date;a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0),a.setHours(a.getHours()- -1*e),t.innerHTML=`
    <div class="row"><div>Current local reset time:</div><div>${o.toLocaleTimeString()}</div></div>
    <div class="row"><div>New local reset time:</div><div>${a.toLocaleTimeString()}</div></div>
  `}function tI(){Yr.hide()}async function oI(){var o;const e=parseInt((o=Yr.getModal().querySelector("input"))==null?void 0:o.value,10);if(isNaN(e)){m("Streak hour offset must be a number",0);return}if(e<-11||e>12){m("Streak hour offset must be between -11 and 12",0);return}te();const t=await E.users.setStreakHourOffset({body:{hourOffset:e}});if(V(),t.status!==200)m("Failed to set streak hour offset: "+t.body.message,-1);else{m("Streak hour offset set",1);const a=x();a.streakHourOffset=e,st(a),tI()}}const Yr=new le({dialogId:"streakHourOffsetModal",setup:async e=>{var t,o;(t=e.querySelector("input"))==null||t.addEventListener("input",()=>{q0()}),(o=e.querySelector("button"))==null||o.addEventListener("click",()=>{oI()})}});function Kl({tagname:e,classes:t,attributes:o,innerHTML:a}){let s=`<${e}`;return t!==void 0&&(s+=` class="${t.join(" ")}"`),o!==void 0&&(s+=" "+Object.entries(o).filter(n=>n[1]!==void 0).sort((n,l)=>n[0].localeCompare(l[0])).map(n=>n[1]===!0?`${n[0]}`:`${n[0]}="${n[1]}"`).join(" ")),a!==void 0?s+=`>${a}</${e}>`:s+=" />",s}class pe{constructor(t){this.parameters=[],this.id=t.id,this.execFn=t.execFn,this.title=t.title,this.inputs=t.inputs??[],this.text=t.text,this.textAllowHtml=t.textAllowHtml??!1,this.wrapper=zn.getWrapper(),this.element=zn.getModal(),this.modal=zn,this.buttonText=t.buttonText,this.beforeInitFn=t.beforeInitFn,this.beforeShowFn=t.beforeShowFn,this.canClose=t.canClose??!0,this.onlineOnly=t.onlineOnly??!1,this.hideCallsExec=t.hideCallsExec??!1,this.showLabels=t.showLabels??!1}reset(){this.element.innerHTML=`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <button type="submit" class="submitButton"></button>`}init(){const t=i(this.element);t.find("input").val(""),this.reset(),t.attr("data-popup-id",this.id),t.find(".title").text(this.title),this.textAllowHtml?t.find(".text").html(this.text??""):t.find(".text").text(this.text??""),this.initInputs(),this.buttonText===""?t.find(".submitButton").remove():t.find(".submitButton").text(this.buttonText),(this.text??"")===""?t.find(".text").addClass("hidden"):t.find(".text").removeClass("hidden")}initInputs(){const t=i(this.element);if(this.inputs.every(s=>s.hidden)||this.inputs.length===0){t.find(".inputs").addClass("hidden");return}const a=t.find(".inputs");this.showLabels&&a.addClass("withLabel"),this.inputs.forEach((s,n)=>{var f,g,h,y;const l=`${this.id}_${n}`;this.showLabels&&!s.hidden&&a.append(`<label for="${l}">${s.label??""}</label>`);const c=s.type==="textarea"?"textarea":"input",u=s.hidden?["hidden"]:void 0,d={id:l,placeholder:s.placeholder??"",autocomplete:"off"};if(s.type!=="textarea"&&(d.value=((f=s.initVal)==null?void 0:f.toString())??"",d.type=s.type),!s.hidden&&!s.optional&&(d.required=!0),s.disabled&&(d.disabled=!0),s.type==="textarea")a.append(Kl({tagname:c,classes:u,attributes:d,innerHTML:s.initVal}));else if(s.type==="checkbox"){let v=Kl({tagname:c,classes:u,attributes:d});s.description!==void 0&&(v+=`<span>${s.description}</span>`),this.showLabels?v=`<div>${v}</div>`:v=`
          <label class="checkbox">
            ${v}
            <div>${s.label}</div>
          </label>
        `,a.append(v)}else if(s.type==="range")a.append(`
          <div>
            ${Kl({tagname:c,classes:u,attributes:{...d,min:s.min.toString(),max:s.max.toString(),step:(g=s.step)==null?void 0:g.toString(),oninput:"this.nextElementSibling.innerHTML = this.value"}})}
            <span>${s.initVal??""}</span>
          </div>
          `);else{switch(s.type){case"text":case"password":case"email":break;case"datetime-local":{s.min!==void 0&&(d.min=ae(s.min,"yyyy-MM-dd'T'HH:mm:ss")),s.max!==void 0&&(d.max=ae(s.max,"yyyy-MM-dd'T'HH:mm:ss")),s.initVal!==void 0&&(d.value=ae(s.initVal,"yyyy-MM-dd'T'HH:mm:ss"));break}case"date":{s.min!==void 0&&(d.min=ae(s.min,"yyyy-MM-dd")),s.max!==void 0&&(d.max=ae(s.max,"yyyy-MM-dd")),s.initVal!==void 0&&(d.value=ae(s.initVal,"yyyy-MM-dd"));break}case"number":{d.min=(h=s.min)==null?void 0:h.toString(),d.max=(y=s.max)==null?void 0:y.toString();break}}a.append(Kl({tagname:c,classes:u,attributes:d}))}const p=document.querySelector("#"+d.id);if(s.oninput!==void 0&&(p.oninput=s.oninput),s.currentValue=()=>p.type==="checkbox"?p.checked?"true":"false":p.value,s.validation!==void 0){const v={schema:s.validation.schema??void 0,isValid:s.validation.isValid!==void 0?async w=>s.validation.isValid(w,this):void 0,callback:w=>{s.hasError=w.status!=="success"},debounceDelay:s.validation.debounceDelay};ys(p,v)}}),t.find(".inputs").removeClass("hidden")}exec(){if(!this.canClose)return;if(this.inputs.filter(o=>o.hidden!==!0&&o.optional!==!0).some(o=>o.currentValue()===void 0||o.currentValue()==="")){m("Please fill in all fields",0);return}if(this.inputs.some(o=>o.hasError===!0)){m("Please solve all validation errors",0);return}this.disableInputs(),te();const t=this.inputs.map(o=>o.currentValue());this.execFn(this,...t).then(o=>{V(),(o.showNotification??!0)&&m(o.message,o.status,o.notificationOptions),o.status===1?this.hide(!0,o.hideOptions).then(()=>{o.afterHide&&o.afterHide()}):(this.enableInputs(),i(i("#simpleModal").find("input")[0]).trigger("focus"))})}disableInputs(){i("#simpleModal input").prop("disabled",!0),i("#simpleModal button").prop("disabled",!0),i("#simpleModal textarea").prop("disabled",!0),i("#simpleModal .checkbox").addClass("disabled")}enableInputs(){i("#simpleModal input").prop("disabled",!1),i("#simpleModal button").prop("disabled",!1),i("#simpleModal textarea").prop("disabled",!1),i("#simpleModal .checkbox").removeClass("disabled")}show(t=[],o){if(this.onlineOnly&&!it()){m("You are offline",0,{duration:2});return}Ns=this,this.parameters=t,zn.show({focusFirstInput:!0,...o,beforeAnimation:async()=>{var a,s;(a=this.beforeInitFn)==null||a.call(this,this),this.init(),(s=this.beforeShowFn)==null||s.call(this,this)}})}async hide(t,o){this.canClose&&(this.hideCallsExec&&!t?this.exec():(Ns=null,await zn.hide(o)))}}function Lh(){if(Ns){Ns.hide();return}}let Ns=null;const zn=new le({dialogId:"simpleModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),Ns==null||Ns.exec()})},customEscapeHandler:e=>{Lh()},customWrapperClickHandler:e=>{Lh()}}),aI=new pe({id:"editApeKey",title:"Edit Ape key",inputs:[{type:"text",placeholder:"name",initVal:""}],buttonText:"edit",onlineOnly:!0,execFn:async(e,t)=>{const o=await E.apeKeys.save({params:{apeKeyId:e.parameters[0]??""},body:{name:t}});return o.status!==200?{status:-1,message:"Failed to update key: "+o.body.message}:{status:1,message:"Key updated",hideOptions:{clearModalChain:!0}}}}),sI=new pe({id:"deleteApeKey",title:"Delete Ape key",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>{const t=await E.apeKeys.delete({params:{apeKeyId:e.parameters[0]??""}});return t.status!==200?{status:-1,message:"Failed to delete key: "+t.body.message}:(Us==null||Us(),{status:1,message:"Key deleted",hideOptions:{clearModalChain:!0}})}}),iI=new pe({id:"viewApeKey",title:"Ape key",inputs:[{type:"textarea",disabled:!0,placeholder:"key",initVal:""}],textAllowHtml:!0,text:`
    This is your new Ape Key. Please keep it safe. You will only see it once!<br><br>
    <strong>Note:</strong> Ape Keys are disabled by default, you need to enable them before they can be used.`,buttonText:"close",hideCallsExec:!0,execFn:async e=>({status:1,message:"Key generated",showNotification:!1,hideOptions:{clearModalChain:!0}}),beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},beforeShowFn:e=>{e.canClose=!1,i("#simpleModal textarea").css("height","110px"),i("#simpleModal .submitButton").addClass("hidden"),setTimeout(()=>{e.canClose=!0,i("#simpleModal .submitButton").removeClass("hidden")},5e3)}}),nI=new pe({id:"generateApeKey",title:"Generate new Ape key",inputs:[{type:"text",placeholder:"Name",initVal:""}],buttonText:"generate",onlineOnly:!0,execFn:async(e,t)=>{const o=await E.apeKeys.add({body:{name:t,enabled:!1}});if(o.status!==200)return{status:-1,message:"Failed to generate key: "+o.body.message};const a=o.body.data,s=e.modal.getPreviousModalInChain();return Us==null||Us(),{status:1,message:"Key generated",hideOptions:{clearModalChain:!0,animationMode:"modalOnly"},afterHide:()=>{iI.show([a.apeKey],{modalChain:s,animationMode:"modalOnly"})}}}});let Hi={};const B0=i("#pageAccountSettings .tab[data-tab='apeKeys']");async function rI(){if(!F())return!1;lI();const e=await E.apeKeys.get();return e.status!==200?e.body.message==="You have lost access to ape keys, please contact support"?(R0=!0,D0(),!1):(m("Error getting ape keys: "+e.body.message,-1),!1):(Hi=e.body.data,!0)}function lI(){const e=B0.find("table tbody");e.empty(),e.append("<tr><td colspan='6' style='text-align: center;font-size:1rem;'><i class='fas fa-spin fa-circle-notch'></i></td></tr>")}function F0(){var a,s,n;const e=Hi;if(e==null)return;const t=B0.find("table tbody");t.empty();const o=Object.keys(e);if(o.length===0){t.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");return}o.forEach(l=>{const c=e[l];t.append(`
      <tr keyId="${l}">
        <td>
          <button class="textButton toggleActive" style="font-size: 1.25rem">
            ${c.enabled?'<i class="fas fa-fw fa-check-square"></i>':'<i class="far fa-fw fa-square"></i>'}
          </button>
        </td>
        <td>${c.name}</td>
        <td>${ae(new Date(c.createdOn),"dd MMM yyyy HH:mm")}</td>
        <td>${ae(new Date(c.modifiedOn),"dd MMM yyyy HH:mm")}</td>
        <td>${c.lastUsedOn===-1?"-":ae(new Date(c.lastUsedOn),"dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <button class="editButton">
              <i class="fas fa-fw fa-pen"></i>
            </button>
            <button class="deleteButton">
              <i class="fas fa-fw fa-trash-alt"></i>
            </button>
          </div>
        </td>
      </tr>
    `)});for(const l of t.find("tr")){const c=l.getAttribute("keyid");(a=l.querySelector("button.toggleActive"))==null||a.addEventListener("click",u=>{cI(c)}),(s=l.querySelector("button.deleteButton"))==null||s.addEventListener("click",u=>{sI.show([c],{})}),(n=l.querySelector("button.editButton"))==null||n.addEventListener("click",u=>{aI.show([c],{})})}}async function cI(e){const t=Hi==null?void 0:Hi[e];if(!t||Hi===void 0)return;te();const o=await E.apeKeys.save({params:{apeKeyId:e},body:{enabled:!t.enabled}});if(V(),o.status!==200){m("Failed to update key: "+o.body.message,-1);return}t.enabled=!t.enabled,F0(),t.enabled?m("Key active",1):m("Key inactive",1)}let Us,R0=!1;async function D0(e){if(R0){i(".pageAccountSettings .tab[data-tab='apeKeys'] table").remove(),i(".pageAccountSettings .section.apeKeys .buttons").remove(),i(".pageAccountSettings .section.apeKeys .lostAccess").removeClass("hidden");return}Us=e,await rI(),F0()}i(".pageAccountSettings").on("click","#generateNewApeKey",()=>{nI.show([],{})});const ie=i(".page.pageAccountSettings"),dI=P.object({tab:P.enum(["authentication","account","apeKeys","dangerZone"])}),uI=dI.partial(),ns={tab:"account"};function fI(){ie.find(".section.passwordAuthSettings button").addClass("hidden"),ie.find(".section.googleAuthSettings button").addClass("hidden"),ie.find(".section.githubAuthSettings button").addClass("hidden");const e=Po();if(e===null)return;const t=e.providerData.some(s=>s.providerId==="password"),o=e.providerData.some(s=>s.providerId==="google.com"),a=e.providerData.some(s=>s.providerId==="github.com");t?(ie.find(".section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden"),ie.find(".section.passwordAuthSettings #passPasswordAuth").removeClass("hidden"),(o||a)&&ie.find(".section.passwordAuthSettings #removePasswordAuth").removeClass("hidden")):ie.find(".section.passwordAuthSettings #addPasswordAuth").removeClass("hidden"),o?(ie.find(".section.googleAuthSettings #removeGoogleAuth").removeClass("hidden"),t||a?ie.find(".section.googleAuthSettings #removeGoogleAuth").removeClass("disabled"):ie.find(".section.googleAuthSettings #removeGoogleAuth").addClass("disabled")):ie.find(".section.googleAuthSettings #addGoogleAuth").removeClass("hidden"),a?(ie.find(".section.githubAuthSettings #removeGithubAuth").removeClass("hidden"),t||o?ie.find(".section.githubAuthSettings #removeGithubAuth").removeClass("disabled"):ie.find(".section.githubAuthSettings #removeGithubAuth").addClass("disabled")):ie.find(".section.githubAuthSettings #addGithubAuth").removeClass("hidden")}function pI(){var e;if(!F())ie.find(".section.discordIntegration").addClass("hidden");else{if(!x())return;ie.find(".section.discordIntegration").removeClass("hidden"),((e=x())==null?void 0:e.discordId)===void 0?(ie.find(".section.discordIntegration .buttons").removeClass("hidden"),ie.find(".section.discordIntegration .info").addClass("hidden")):(ie.find(".section.discordIntegration .buttons").addClass("hidden"),ie.find(".section.discordIntegration .info").removeClass("hidden"))}}function W0(){tn(ie.find(".tab.active"),ie.find(`.tab[data-tab="${ns.tab}"]`),250,async()=>{},async()=>{ie.find(".tab").removeClass("active"),ie.find(`.tab[data-tab="${ns.tab}"]`).addClass("active")}),ie.find("button").removeClass("active"),ie.find(`button[data-tab="${ns.tab}"]`).addClass("active")}function mI(){ie.find(".section.optOutOfLeaderboards .optedOut").addClass("hidden"),ie.find(".section.optOutOfLeaderboards .buttons").removeClass("hidden"),ie.find(".section.setStreakHourOffset .info").addClass("hidden"),ie.find(".section.setStreakHourOffset .buttons").removeClass("hidden");const e=x();if((e==null?void 0:e.lbOptOut)===!0&&(ie.find(".section.optOutOfLeaderboards .optedOut").removeClass("hidden"),ie.find(".section.optOutOfLeaderboards .buttons").addClass("hidden")),(e==null?void 0:e.streakHourOffset)!==void 0){ie.find(".section.setStreakHourOffset .info").removeClass("hidden");const t=(e==null?void 0:e.streakHourOffset)>0?"+":"";ie.find(".section.setStreakHourOffset .info span").text(t+(e==null?void 0:e.streakHourOffset)),ie.find(".section.setStreakHourOffset .buttons").addClass("hidden")}}function vs(){ee()==="accountSettings"&&(fI(),pI(),mI(),D0(vs),W0(),qm.setUrlParams(ns))}i(".page.pageAccountSettings").on("click",".tabs button",e=>{ns.tab=i(e.target).data("tab"),W0(),qm.setUrlParams(ns)});i(".page.pageAccountSettings .section.discordIntegration .getLinkAndGoToOauth").on("click",()=>{te(),E.users.getDiscordOAuth().then(e=>{e.status===200?window.open(e.body.data.url,"_self"):m("Failed to get OAuth from discord: "+e.body.message,-1)})});i(".page.pageAccountSettings #setStreakHourOffset").on("click",()=>{eI()});sa(e=>{e.type==="authConfigUpdated"&&vs()});const qm=new vm({id:"accountSettings",display:"Account Settings",element:ie,path:"/account-settings",urlParamsSchema:uI,afterHide:async()=>{Bt("pageAccountSettings")},beforeShow:async e=>{var t;((t=e.urlParams)==null?void 0:t.tab)!==void 0&&(ns.tab=e.urlParams.tab),to("pageAccountSettings","main"),ie.find(`.tab[data-tab="${ns.tab}"]`).addClass("active"),vs()}});i(()=>{oo("pageAccountSettings")});function gI(){const e=document.querySelector('meta[property="og:url"]'),t=window.location.href;if(e)e.setAttribute("content",t);else{const o=document.createElement("meta");o.setAttribute("property","og:url"),o.content=t,document.head.appendChild(o)}}function hI(e){if(e.id==="test")ng();else{const t=e.display??mi(e.id);ng(`${t} | Monkeytype`)}}async function yI({loadingOptions:e,totalDuration:t,easingMethod:o}){$s.element.removeClass("hidden").css("opacity",0),await $s.beforeShow({});const a=e.length,s=100/a;Mo($s.element,{opacity:"1"},t/2,o);for(let n=0;n<e.length;n++){const l=s*n,c=e[n];c.style==="bar"?(await $_(),n===0&&(await Nf(0,0),ad(""))):T_(),c.style==="bar"?(await bI(c,a,l),Nf(100,125),ad("Done")):await c.waitFor()}await Mo($s.element,{opacity:"0"},t/2,o),await $s.afterHide(),$s.element.addClass("hidden")}async function bI(e,t,o){let a=!1,s=e.waitFor();const n=(async()=>{for(const l of e.keyframes){if(a)break;l.text!==void 0&&ad(l.text),await Nf(o+l.percentage/t,l.durationMs)}})();await Promise.race([n,(async()=>{await s,a=!0})()]),await s}async function So(e,t={}){var u,d,p;if(t={...{force:!1},...t},Ks()&&!t.force)return console.debug(`change page to ${e} stopped, page transition is true`),!1;if(!t.force&&ee()===e)return console.debug(`change page ${e} stoped, page already active`),!1;console.log(`changing page ${e}`);const a={loading:$s,test:g_,settings:f0,about:C_,account:p_,login:x_,profile:B_,profileSearch:F_,404:R_,accountSettings:qm,leaderboards:I0},s=a[ee()],n=a[e],l=fe(250),c="swing";fu(!0),i(".page").removeClass("active"),await((u=s==null?void 0:s.beforeHide)==null?void 0:u.call(s)),s.element.removeClass("hidden").css("opacity",1),await Mo(s.element,{opacity:"0"},l/2,c),s.element.addClass("hidden"),await(s==null?void 0:s.afterHide());try{let f=[];t.loadingOptions&&f.push(t.loadingOptions),n.loadingOptions&&f.push(n.loadingOptions),f.length>0&&(((d=t.loadingOptions)==null?void 0:d.shouldLoad())||((p=n.loadingOptions)==null?void 0:p.shouldLoad()))===!0&&await yI({loadingOptions:f,totalDuration:l,easingMethod:c})}catch(f){return a.loading.element.addClass("active"),Pg(a.loading.id),zo(!1),L_(),ad(`Failed to load the ${n.id} page: ${f instanceof Error?f.message:String(f)}`),fu(!1),!1}return hI(n),Pg(n.id),gI(),zo(!1),await(n==null?void 0:n.beforeShow({params:t.params,data:t.data})),n.element.removeClass("hidden").css("opacity",0),await Mo(n.element,{opacity:"1"},l/2,c),n.element.addClass("active"),await(n==null?void 0:n.afterShow()),fu(!1),UA(),!0}function vI(e){return new RegExp("^"+e.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}function wI(e){const t=e.result.slice(1),a=Array.from(e.route.path.matchAll(/:(\w+)/g)).map(s=>s[1]).map((s,n)=>[s,t[n]]);return Object.fromEntries(a)}const CI={path:"404",load:async()=>{await So("404")}},kI=[{path:"/",load:async(e,t)=>{await So("test",t)}},{path:"/verify",load:async(e,t)=>{await So("test",t)}},{path:"/leaderboards",load:async(e,t)=>{await So("leaderboards",t)}},{path:"/about",load:async(e,t)=>{await So("about",t)}},{path:"/settings",load:async(e,t)=>{await So("settings",t)}},{path:"/login",load:async(e,t)=>{if(!Ro()){await Qe("/",t);return}if(F()){await Qe("/account",t);return}await So("login",t)}},{path:"/account",load:async(e,t)=>{if(!Ro()){await Qe("/",t);return}if(!F()){await Qe("/login",t);return}await So("account",t)}},{path:"/account-settings",load:async(e,t)=>{if(!Ro()){await Qe("/",t);return}if(!F()){await Qe("/login",t);return}await So("accountSettings",t)}},{path:"/profile",load:async(e,t)=>{await So("profileSearch",t)}},{path:"/profile/:uidOrName",load:async(e,t)=>{await So("profile",{...t,force:!0,params:{uidOrName:e.uidOrName},data:t.data})}}];async function Qe(e=window.location.pathname+window.location.search+window.location.hash,t={}){if(!t.force&&(Vt||Zs||Ks())){console.debug(`navigate: ${e} ignored, page is busy (testRestarting: ${Vt}, resultCalculating: ${Zs}, pageTransition: ${Ks()})`);return}const o=wv("no_quit");if(Ae&&o){m("No quit funbox is active. Please finish the test.",0,{important:!0});return}e=e.replace(/\/$/,""),e===""&&(e="/");const a=new URL(window.location.href),s=new URL(e,window.location.origin);a.pathname+a.search+a.hash!==s.pathname+s.search+s.hash&&history.pushState(null,"",e),await P0(t)}async function P0(e={}){const o=kI.map(a=>({route:a,result:location.pathname.match(vI(a.path))})).find(a=>a.result!==null);if(o===void 0){await CI.load({},{});return}await o.route.load(wI(o),e)}window.addEventListener("popstate",()=>{P0()});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{const t=e==null?void 0:e.target;t.matches("[router-link]")&&(t!=null&&t.href)&&(e.preventDefault(),Qe(t.href))})});const SI=[{id:"viewTypingPage",display:"View Typing Page",alias:"navigate go to start begin type test",icon:"fa-keyboard",exec:()=>{Qe("/")}},{id:"viewLeaderboards",display:"View Leaderboards",alias:"navigate go to",icon:"fa-crown",exec:()=>{Qe("/leaderboards")}},{id:"viewAbout",display:"View About Page",alias:"navigate go to",icon:"fa-info",exec:()=>{Qe("/about")}},{id:"viewSettings",display:"View Settings Page",alias:"navigate go to",icon:"fa-cog",exec:()=>{Qe("/settings")}},{id:"viewAccount",display:"View Account Page",alias:"navigate go to stats",icon:"fa-user",exec:()=>{F()?Qe("/account"):Qe("/login")}},{id:"toggleFullscreen",display:"Toggle Fullscreen",icon:"fa-expand",exec:()=>{Ok()}}],es={missed:"words",slow:!1},_i="#practiseWordsModal .modal";function qu(){i(`${_i} .group[data-id="missed"] button`).removeClass("active"),i(`${_i} .group[data-id="missed"] button[value="${es.missed}"]`).addClass("active"),i(`${_i} .group[data-id="slow"] button`).removeClass("active"),i(`${_i} .group[data-id="slow"] button[value="${es.slow}"]`).addClass("active"),es.missed==="off"&&!es.slow?i(`${_i} .start`).prop("disabled",!0):i(`${_i} .start`).prop("disabled",!1)}async function xI(e){var t;for(const o of e.querySelectorAll(".group[data-id='missed'] button"))o.addEventListener("click",a=>{es.missed=a.target.value,qu()});for(const o of e.querySelectorAll(".group[data-id='slow'] button"))o.addEventListener("click",a=>{es.slow=a.target.value==="true",qu()});(t=e.querySelector(".start"))==null||t.addEventListener("click",()=>{$h()}),e.addEventListener("submit",o=>{o.preventDefault(),$h()}),qu()}function z0(e){H0.show(e)}function TI(e=!1){H0.hide({clearModalChain:e})}function $h(){wf(es.missed,es.slow),TI(!0),W({practiseMissed:!0})}const H0=new le({dialogId:"practiseWordsModal",setup:xI});let O0=!1,Vf=!1;function Mh(){V(),i("#ad-result-wrapper").removeClass("hidden"),i("#ad-result-small-wrapper").removeClass("hidden"),i("#testConfig").removeClass("hidden"),i(".pageTest .screenshotSpacer").remove(),i("#notificationCenter").removeClass("hidden"),i("#commandLineMobileButton").removeClass("hidden"),i(".pageTest .ssWatermark").addClass("hidden"),i(".pageTest .ssWatermark").text("monkeytype.com"),i(".pageTest .buttons").removeClass("hidden"),i("noscript").removeClass("hidden"),i("#nocss").removeClass("hidden"),i("header, footer").removeClass("invisible"),i("#result").removeClass("noBalloons"),i(".wordInputHighlight").removeClass("hidden"),i(".highlightContainer").removeClass("hidden"),Vf&&i("#cookiesModal").removeClass("hidden"),O0&&i("#resultReplay").removeClass("hidden"),F()||i(".pageTest .loginTip").removeClass("hidden"),document.querySelector("html").style.scrollBehavior="smooth";for(const e of Ct("applyGlobalCSS"))e.functions.applyGlobalCSS()}let Ah=!1;async function N0(){var f,g;const{domToCanvas:e}=await bd(async()=>{const{domToCanvas:h}=await import("./vendor.CUQxkLCO.js").then(y=>y.ad);return{domToCanvas:h}},__vite__mapDeps([0,1,2]));te(!0),i("#resultReplay").hasClass("hidden")||(O0=!0,vl()),(Nk("#cookiesModal")||document.contains(document.querySelector("#cookiesModal")))&&(Vf=!0);const t=new Date(Date.now());i("#resultReplay").addClass("hidden"),i(".pageTest .ssWatermark").removeClass("hidden");const o=x(),a=[ae(t,"dd MMM yyyy HH:mm"),"monkeytype.com"];if((o==null?void 0:o.name)!==void 0){const h=`${o==null?void 0:o.name}${sl(o,{iconsOnly:!0})}`;a.unshift(h)}i(".pageTest .ssWatermark").html(a.map(h=>`<span>${h}</span>`).join("<span class='pipe'>|</span>")),i(".pageTest .buttons").addClass("hidden"),i("#notificationCenter").addClass("hidden"),i("#commandLineMobileButton").addClass("hidden"),i(".pageTest .loginTip").addClass("hidden"),i("noscript").addClass("hidden"),i("#nocss").addClass("hidden"),i("#ad-result-wrapper").addClass("hidden"),i("#ad-result-small-wrapper").addClass("hidden"),i("#testConfig").addClass("hidden"),i(".pageTest .screenshotSpacer").remove(),i(".page.pageTest").prepend("<div class='screenshotSpacer'></div>"),i("header, footer").addClass("invisible"),i("#result").addClass("noBalloons"),i(".wordInputHighlight").addClass("hidden"),i(".highlightContainer").addClass("hidden"),Vf&&i("#cookiesModal").addClass("hidden");for(const h of Ct("clearGlobal"))h.functions.clearGlobal();document.querySelector("html").style.scrollBehavior="auto",window.scrollTo({top:0,behavior:"auto"});const s=i("#result .wrapper");if(!s.length)return console.error("Result wrapper not found for screenshot"),m("Screenshot target element not found",-1),Mh(),null;await Te(50);const n=((f=s.offset())==null?void 0:f.left)??0,l=((g=s.offset())==null?void 0:g.top)??0,c=s.outerWidth(!0),u=s.outerHeight(!0),d=Gs(2),p=Gs(2);try{const h=document.documentElement,{scrollWidth:y,clientWidth:v,scrollHeight:w,clientHeight:$}=h,S=Math.max(y,v),T=Math.max(w,$),q=await e(h,{backgroundColor:await Yt("bg"),scale:window.devicePixelRatio??1,style:{width:`${S}px`,height:`${T}px`,overflow:"hidden"},fetch:{requestInit:{mode:"cors",credentials:"omit"},bypassingCache:!0},filter:ao=>{if(!(ao instanceof HTMLElement))return!0;const so=getComputedStyle(ao);return!(ao.classList.contains("hidden")||so.display==="none")},onCloneEachNode:ao=>{if(ao instanceof HTMLElement){const so=ao;if(so.classList.contains("customBackground")){so.style.zIndex="0",so.style.width=`${S}px`,so.style.height=`${T}px`;const ko=so.querySelector("img");ko&&(window.innerWidth<=720?(ko.style.transform="translateY(20vh)",ko.style.height="100%"):(ko.style.width="100%",ko.style.height="100%"))}}}}),_=q.width/S,N=c+d*2,Y=u+p*2,G=Math.round(N*_),xe=Math.round(Y*_),He=Math.ceil(N*_),Fe=Math.ceil(Y*_),Re=document.createElement("canvas");Re.width=G,Re.height=xe;const X=Re.getContext("2d");if(!X)return m("Failed to get canvas context for screenshot",-1),null;X.imageSmoothingEnabled=!0,X.imageSmoothingQuality="high";const we=Math.max(0,Math.floor((n-d)*_)),Ve=Math.max(0,Math.floor((l-p)*_)),Ze=Math.min(He,q.width-we),jt=Math.min(Fe,q.height-Ve);return X.drawImage(q,we,Ve,Ze,jt,0,0,Re.width,Re.height),Re}catch(h){return m(re(h,"Error creating screenshot canvas"),-1),null}finally{Mh()}}async function U0(){const e=await N0();e&&e.toBlob(async t=>{if(!t){m("Failed to generate image data (blob is null)",-1);return}try{const o=new ClipboardItem(Object.defineProperty({},t.type,{value:t,enumerable:!0}));await navigator.clipboard.write([o]),m("Copied screenshot to clipboard",1,{duration:2})}catch(o){console.error("Error saving image to clipboard",o),navigator.userAgent.toLowerCase().includes("firefox")&&!Ah&&(Ah=!0,m("On Firefox you can enable the asyncClipboard.clipboardItem permission in about:config to enable copying straight to the clipboard",0,{duration:10})),m("Could not copy screenshot to clipboard. Opening in new tab instead (make sure popups are allowed)",0,{duration:5});try{const a=URL.createObjectURL(t);window.open(a)}catch(a){m("Failed to open screenshot in new tab",-1),console.error("Error opening blob URL:",a)}}})}async function LI(){const e=await N0();return e?new Promise(t=>{e.toBlob(o=>{o?t(o):(m("Failed to convert canvas to Blob for download",-1),t(null))},"image/png")}):null}async function V0(){try{const e=await LI();if(!e){m("Failed to generate screenshot data",-1);return}const t=URL.createObjectURL(e),o=document.createElement("a");o.href=t;const a=new Date().toISOString().replace(/[:.]/g,"-");o.download=`monkeytype-result-${a}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t),m("Screenshot download started",1)}catch(e){console.error("Error downloading screenshot:",e),m("Failed to download screenshot",-1)}}i(".pageTest").on("click","#saveScreenshotButton",e=>{e.shiftKey?V0():U0(),i("#saveScreenshotButton i").removeClass("fas fa-download").addClass("far fa-image")});i(document).on("keydown",e=>{de&&ee()==="test"&&e.key==="Shift"&&i("#result #saveScreenshotButton i").removeClass("far fa-image").addClass("fas fa-download")});i(document).on("keyup",e=>{de&&ee()==="test"&&e.key==="Shift"&&i("#result #saveScreenshotButton i").removeClass("fas fa-download").addClass("far fa-image")});const $I={title:"Practice words...",list:[{id:"practiseWordsMissed",display:"missed",exec:()=>{wf("words",!1),W({practiseMissed:!0})}},{id:"practiseWordsSlow",display:"slow",exec:()=>{wf("off",!0),W({practiseMissed:!0})}},{id:"practiseWordsCustom",display:"custom...",opensModal:!0,exec:e=>{z0({animationMode:"modalOnly",modalChain:e.commandlineModal})}}]},MI=[{id:"nextTest",display:"Next test",alias:"restart start begin type test typing",icon:"fa-chevron-right",available:()=>de,exec:()=>{W()}},{id:"repeatTest",display:"Repeat test",icon:"fa-sync-alt",exec:()=>{W({withSameWordset:!0})},available:()=>de},{id:"practiseWords",display:"Practice words...",icon:"fa-exclamation-triangle",subgroup:$I,available:()=>de},{id:"toggleWordHistory",display:"Toggle word history",icon:"fa-align-left",exec:()=>{Kp()},available:()=>de},{id:"copyScreenshot",display:"Copy screenshot to clipboard",icon:"fa-copy",alias:"copy image clipboard",exec:()=>{setTimeout(()=>{U0()},500)},available:()=>de},{id:"downloadScreenshot",display:"Download screenshot",icon:"fa-download",alias:"save image download file",exec:()=>{setTimeout(async()=>{V0()},500)},available:()=>de},{id:"copyWordsToClipboard",display:"Copy words to clipboard",icon:"fa-copy",exec:()=>{const e=(r.mode==="zen"?k.getHistory():I.list.slice(0,k.getHistory().length)).join(" ");navigator.clipboard.writeText(e).then(()=>{m("Copied to clipboard",1)},()=>{m("Failed to copy!",-1)})},available:()=>de}];let Kf=!1;function K0(e){document.documentElement.style.setProperty("--font",'"'+e.replaceAll(/_/g," ")+'", "Roboto Mono", "Vazirmatn"'),Hd(),Kf=!0}function Gf(){Kf&&(K0(r.fontFamily),Kf=!1)}function AI(){const e=window.navigator.userAgent.toLowerCase(),t=e.includes("mac")&&!e.includes("firefox")?"cmd":"ctrl",o=r.quickRestart==="esc"?"tab":"esc";i("footer .keyTips").html(`
    ${r.quickRestart==="off"?"<key>tab</key> + <key>enter</key>":`<key>${r.quickRestart}</key>`} - restart test<br>
    <key>${o}</key> or <key>${t}</key>+<key>shift</key>+<key>p</key> - command line`)}window.addEventListener("keydown",function(e){e.code==="Space"&&e.target===document.body&&e.preventDefault()});window.addEventListener("beforeunload",e=>{Zd(r.mode,r.words,r.time,Ia(),ta()??!1)||Ae&&(e.preventDefault(),e.returnValue="")});const EI=$t(250,()=>{ee()==="test"&&!de&&(r.tapeMode!=="off"?Nd():(Ev(),Hd()),setTimeout(()=>{Np(),i("#wordsInput").is(":focus")&&Qb(!0)},250))}),_I=Hy(250,()=>{ll()});i(window).on("resize",()=>{_I(),EI()});ge(async e=>{e==="quickRestart"&&AI(),e==="showKeyTips"&&(r.showKeyTips?i("footer .keyTips").removeClass("hidden"):i("footer .keyTips").addClass("hidden")),e==="fontFamily"&&await Hr()});const II={punctuation:{subgroup:{options:"fromSchema",afterExec:()=>{W()}}},numbers:{subgroup:{options:"fromSchema",afterExec:()=>{W()}}},words:{alias:"words",subgroup:{options:[10,25,50,100],afterExec:()=>{oe(),W()}},input:{inputValueConvert:Number,afterExec:()=>{oe(),W()}}},time:{subgroup:{options:[15,30,60,120],afterExec:()=>{oe(),W()}},input:{inputValueConvert:Number,afterExec:()=>{oe(),W()}}},mode:{subgroup:{options:"fromSchema",afterExec:()=>{oe(),W()}}},quoteLength:{alias:"quotes",subgroup:{options:[[0,1,2,3],[0],[1],[2],[3],[-3]],configValueMode:()=>"include",isAvailable:e=>{if(e[0]===-3)return F},display:e=>ps(e,[0,1,2,3])?"all":{0:"short",1:"medium",2:"long",3:"thicc","-3":"favorite"}[e[0]],afterExec:()=>{W()}}},language:{subgroup:{options:"fromSchema",display:e=>ea(e)}},difficulty:{subgroup:{options:"fromSchema"}},quickRestart:{subgroup:{options:"fromSchema"}},repeatQuotes:{subgroup:{options:"fromSchema"}},blindMode:{subgroup:{options:"fromSchema"}},alwaysShowWordsHistory:{subgroup:{options:"fromSchema"}},singleListCommandLine:{subgroup:{options:"fromSchema"}},minWpm:{display:"Minimum speed...",alias:"wpm",subgroup:{options:["off"]},input:{configValue:"custom",display:"custom...",secondKey:"minWpmCustomSpeed",inputValueConvert:e=>{let t=Number(e);return t=bt(r.typingSpeedUnit).toWpm(t),t}}},minAcc:{display:"Minimum accuracy...",subgroup:{options:["off"]},input:{configValue:"custom",display:"custom...",secondKey:"minAccCustom",inputValueConvert:e=>Number(e)}},britishEnglish:{subgroup:{options:"fromSchema",afterExec:()=>{W()}}},customLayoutfluid:{input:{defaultValue:()=>r.customLayoutfluid.join(" "),inputValueConvert:e=>e.trim().split(" ")}},customPolyglot:{input:{defaultValue:()=>r.customPolyglot.join(" "),inputValueConvert:e=>e.trim().split(" "),afterExec:()=>{ee()==="test"&&W()}}},freedomMode:{subgroup:{options:"fromSchema"}},strictSpace:{subgroup:{options:"fromSchema"}},oppositeShiftMode:{subgroup:{options:"fromSchema",afterExec:()=>{Kt()}}},stopOnError:{subgroup:{options:"fromSchema"}},confidenceMode:{subgroup:{options:"fromSchema"}},quickEnd:{subgroup:{options:"fromSchema"}},indicateTypos:{subgroup:{options:"fromSchema"}},hideExtraLetters:{subgroup:{options:"fromSchema"}},lazyMode:{subgroup:{options:"fromSchema",afterExec:()=>W()}},layout:{subgroup:{options:"fromSchema",display:e=>e==="default"?"off":e.replace(/_/g," "),afterExec:()=>W()}},codeUnindentOnBackspace:{subgroup:{options:"fromSchema"}},soundVolume:{subgroup:{options:[.1,.5,1],display:e=>new Map([[.1,"quiet"],[.5,"medium"],[1,"loud"]]).get(e)??"custom...",afterExec:()=>Ho},input:{inputValueConvert:Number}},playSoundOnClick:{alias:"play",display:"Sound on click...",subgroup:{options:"fromSchema",display:e=>({off:"off",1:"click",2:"beep",3:"pop",4:"nk creams",5:"typewriter",6:"osu",7:"hitmarker",8:"sine",9:"sawtooth",10:"square",11:"triangle",12:"pentatonic",13:"wholetone",14:"fist fight",15:"rubber keys"})[e],hover:e=>{e!=="off"&&ZM(e)},afterExec:()=>{Ho()}}},playSoundOnError:{alias:"play",display:"Sound on error...",subgroup:{options:"fromSchema",display:e=>({off:"off",1:"damage",2:"triangle",3:"square",4:"punch miss"})[e],hover:e=>{e!=="off"&&JM(e)},afterExec:()=>{yl()}}},playTimeWarning:{alias:"sound",subgroup:{options:"fromSchema",display:e=>e==="off"?"off":`${e} second${e!=="1"?"s":""}`,afterExec:e=>{e!=="off"&&Gc()},hover:e=>{e!=="off"&&Gc()}}},smoothCaret:{subgroup:{options:"fromSchema"}},caretStyle:{subgroup:{options:"fromSchema",isVisible:e=>!["banana","carrot"].includes(e)}},paceCaret:{display:"Pace caret mode...",subgroup:{options:["off","pb","tagPb","last","average","daily"],afterExec:()=>{W()}},input:{secondKey:"paceCaretCustomSpeed",configValue:"custom",inputValueConvert:e=>{let t=Number(e);return t=bt(r.typingSpeedUnit).toWpm(t),t},afterExec:()=>{W()}}},repeatedPace:{subgroup:{options:"fromSchema"}},paceCaretStyle:{subgroup:{options:"fromSchema",isVisible:e=>!["banana","carrot"].includes(e)}},liveSpeedStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},liveAccStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},liveBurstStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},timerStyle:{display:"Live progress style...",subgroup:{options:"fromSchema"},alias:"timer"},timerColor:{display:"Live progress color...",alias:"timer speed wpm burst acc",subgroup:{options:"fromSchema",alias:()=>"timer"}},timerOpacity:{display:"Live progress opacity...",alias:"timer speed wpm burst acc",subgroup:{options:"fromSchema",alias:()=>"timer"}},highlightMode:{subgroup:{options:"fromSchema"}},tapeMode:{subgroup:{options:"fromSchema"}},tapeMargin:{input:{inputValueConvert:Number}},smoothLineScroll:{subgroup:{options:"fromSchema"}},showAllLines:{subgroup:{options:"fromSchema"}},typingSpeedUnit:{subgroup:{options:"fromSchema",isVisible:e=>e!=="wph"}},alwaysShowDecimalPlaces:{subgroup:{options:"fromSchema"}},startGraphsAtZero:{subgroup:{options:"fromSchema"}},maxLineWidth:{input:{alias:"page",inputValueConvert:Number}},fontSize:{input:{inputValueConvert:Number}},fontFamily:{subgroup:{options:vt(ya).sort((e,t)=>{var o,a;return(((o=ya[e])==null?void 0:o.display)??e.replace(/_/g," ")).localeCompare(((a=ya[t])==null?void 0:a.display)??t.replace(/_/g," "))}),display:e=>{var t;return((t=ya[e])==null?void 0:t.display)??e.replaceAll(/_/g," ")},customData:e=>{const t=ya[e];return t===void 0?{}:{name:e.replaceAll(/_/g," "),isSystem:t.systemFont===!0,display:t.display}},hover:e=>K0(e)}},keymapMode:{alias:"keyboard",subgroup:{options:"fromSchema",alias:e=>e==="react"?"flash":""}},keymapStyle:{subgroup:{options:"fromSchema"},alias:"keyboard"},keymapLegendStyle:{subgroup:{options:"fromSchema"},alias:"keyboard"},keymapSize:{input:{alias:"keyboard",inputValueConvert:Number}},keymapLayout:{alias:"keyboard",subgroup:{options:"fromSchema",alias:e=>e==="overrideSync"?"default":"",display:e=>e==="overrideSync"?"emulator sync":e.replace(/_/g," "),afterExec:()=>W()}},keymapShowTopRow:{subgroup:{options:"fromSchema"},alias:"keyboard"},customTheme:{subgroup:{options:"fromSchema"}},flipTestColors:{subgroup:{options:"fromSchema"}},colorfulMode:{subgroup:{options:"fromSchema"}},customBackground:{input:{}},customBackgroundSize:{subgroup:{options:"fromSchema"}},randomTheme:{subgroup:{options:"fromSchema",isAvailable:e=>e==="custom"?F:void 0}},showKeyTips:{subgroup:{options:"fromSchema"},display:"Key tips..."},showOutOfFocusWarning:{subgroup:{options:"fromSchema"},display:"Out of focus warning..."},capsLockWarning:{subgroup:{options:"fromSchema"}},showAverage:{subgroup:{options:"fromSchema"}},monkeyPowerLevel:{alias:"powermode",isVisible:!1,subgroup:{options:"fromSchema",display:e=>({off:"off",1:"mellow",2:"high",3:"ultra",4:"over 9000"})[e]}},monkey:{subgroup:{options:"fromSchema"}},ads:{subgroup:{options:"fromSchema"}}};function jf(e){if(e instanceof P.ZodLiteral)return[e.value];if(e instanceof P.ZodEnum)return e.options;if(e instanceof P.ZodBoolean)return[!0,!1];if(e instanceof P.ZodUnion)return e.options.flatMap(jf).filter(t=>t!==void 0)}function Be(e){const t=Mb[e],o=II[e],a=ol.shape[e];return qI(e,t,o,a)}function qI(e,t,o,a){var n;if(o==null)throw new Error(`No commandline metadata found for config key "${e}".`);let s;if("subgroup"in o&&o.subgroup!==void 0&&(s=BI(e,o.display,o.alias,o.subgroup,t,a)),"input"in o&&o.input!==void 0){const l=o.input,c=RI({key:"secondKey"in l?l.secondKey:e,isPartOfSubgruop:"subgroup"in o,inputProps:l,configMeta:t,schema:"secondKey"in l?ol.shape[l.secondKey]:a});if(s===void 0)return c;(n=s.subgroup)==null||n.list.push(c)}if(s===void 0)throw new Error(`Nothing returned for config key "${e}". This is a bug in the commandline metadata.`);return s}function BI(e,t,o,a,s,n){if(a===null)throw new Error(`No commandline metadata found for config key "${e}".`);const l=t??`${Ft((s==null?void 0:s.displayString)??e)}...`;let c=a.options??jf(n);if(c==="fromSchema"&&(c=jf(n)),c===void 0)throw new Error(`Unsupported schema type for key "${e}": ${n._def.typeName}`);const u=c.map(d=>FI(e,d,a));return u.sort((d,p)=>d.configValue==="off"||d.configValue===!1?-1:p.configValue==="off"||p.configValue===!1?1:0),{id:`change${Ft(e)}`,display:l,icon:(s==null?void 0:s.icon)??"fa-cog",subgroup:{title:l,configKey:e,list:u},alias:o}}function FI(e,t,{afterExec:o,hover:a,display:s,alias:n,configValueMode:l,isVisible:c,isAvailable:u,customData:d}){const p=t;let f=s==null?void 0:s(t);return f===void 0&&(t===!0?f="on":t===!1?f="off":f=t.toString()),{id:`set${Ft(e)}${Ft(p.toString())}`,display:f,configValueMode:l==null?void 0:l(t),alias:(n==null?void 0:n(t))??void 0,configValue:p,visible:(c==null?void 0:c(t))??void 0,available:(u==null?void 0:u(t))??void 0,exec:()=>{M(e,p),o==null||o(p)},hover:a!==void 0?()=>{a==null||a(p)}:void 0,customData:(d==null?void 0:d(p))??void 0}}function RI({key:e,isPartOfSubgruop:t,inputProps:o,configMeta:a,schema:s}){const n=(o==null?void 0:o.validation)??{schema:!0},l=(o==null?void 0:o.display)??(t?"custom...":`${Ft(a.displayString??e)}...`),c={id:`set${Ft(e)}Custom`,defaultValue:(o==null?void 0:o.defaultValue)??(()=>{var u;return((u=r[e])==null?void 0:u.toString())??""}),configValue:o!==void 0&&"configValue"in o?o.configValue??void 0:void 0,display:l,alias:(o==null?void 0:o.alias)??void 0,input:!0,icon:a.icon??"fa-cog",exec:({input:u})=>{var d;u!==void 0&&(M(e,u),(d=o==null?void 0:o.afterExec)==null||d.call(o,u))},hover:o==null?void 0:o.hover};return(o==null?void 0:o.inputValueConvert)!==void 0&&(c.inputValueConvert=o.inputValueConvert),c.validation={schema:n.schema===!0?s:void 0,isValid:n.isValid},c}const DI=Be("customBackground"),WI={id:"customBackground",display:"Custom background...",icon:"fa-image",subgroup:{title:"Custom background...",list:[DI,{id:"customLocalBackground",display:"Local background...",icon:"fa-file-import fa-fw",alias:"upload background",available:async()=>!await at.hasFile("LocalBackgroundFile"),exec:async()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.style.display="none",document.body.appendChild(e);const t=()=>{document.body.removeChild(e)};e.onchange=async o=>{var n;const a=(n=o.target.files)==null?void 0:n[0];if(!a){t();return}if(!a.type.match(/image\/(jpeg|jpg|png|gif|webp)/)){m("Unsupported image format",0),t();return}const s=new FileReader;s.onload=async l=>{var u;const c=(u=l.target)==null?void 0:u.result;try{await at.storeFile("LocalBackgroundFile",c),await mn(),await Kr()}catch(d){m("Error uploading background: "+d.message,0)}t()},s.onerror=t,s.readAsDataURL(a)},e.click()}},{id:"removeLocalBackground",display:"Remove local background",icon:"fa-trash",alias:"remove background",available:async()=>await at.hasFile("LocalBackgroundFile"),exec:async()=>{try{await at.deleteFile("LocalBackgroundFile"),await mn(),await Kr()}catch(e){m("Error removing background: "+e.message,0)}}}]}},PI=[WI],Qf=Be("fontFamily");Qf.subgroup&&Qf.subgroup.list.push({id:"customFont",display:"Custom font...",icon:"fa-font",alias:"custom font options",subgroup:{title:"Custom font...",list:[{id:"customFontName",display:"Custom name...",icon:"fa-font",alias:"custom font name",input:!0,defaultValue:()=>r.fontFamily.replace(/_/g," "),exec:({input:e})=>{if(e===void 0||e==="")return;const t=e.replaceAll(/ /g,"_");Eb(t)}},{id:"customLocalFont",display:"Local font...",icon:"fa-file-import fa-fw",alias:"upload font",available:async()=>!await at.hasFile("LocalFontFamilyFile"),exec:async()=>{const e=document.createElement("input");e.type="file",e.accept="font/woff,font/woff2,font/ttf,font/otf",e.style.display="none",document.body.appendChild(e);const t=()=>{document.body.removeChild(e)};e.onchange=async o=>{var n;const a=(n=o.target.files)==null?void 0:n[0];if(!a){t();return}if(!a.type.match(/font\/(woff|woff2|ttf|otf)/)&&!a.name.match(/\.(woff|woff2|ttf|otf)$/i)){m("Unsupported font format, must be woff, woff2, ttf or otf.",0),t();return}const s=new FileReader;s.onload=async l=>{var u;const c=(u=l.target)==null?void 0:u.result;try{await at.storeFile("LocalFontFamilyFile",c),await Hr(),await Gr()}catch(d){m("Error uploading font: "+d.message,0)}t()},s.onerror=t,s.readAsDataURL(a)},e.click()}},{id:"removeLocalFont",display:"Remove local font",icon:"fa-trash",alias:"remove font",available:async()=>await at.hasFile("LocalFontFamilyFile"),exec:async()=>{try{await at.deleteFile("LocalFontFamilyFile"),await Gr(),await Hr()}catch(e){m("Error removing font: "+e.message,0)}}}]}});const zI=[Qf],HI={title:"Custom background filter...",configKey:"customBackgroundFilter",list:[{id:"setCustomBackgroundBlur",display:"blur...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[0].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[0]=parseFloat(e),Wi(t)}},{id:"setCustomBackgroundBrightness",display:"brightness...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[1].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[1]=parseFloat(e),Wi(t)}},{id:"setCustomBackgroundSaturation",display:"saturation...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[2].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[2]=parseFloat(e),Wi(t)}},{id:"setCustomBackgroundOpacity",display:"opacity...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[3].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[3]=parseFloat(e),Wi(t)}}]},OI=[{id:"setCustomBackgroundFilter",display:"Custom background filter...",icon:"fa-image",subgroup:HI}],NI=[{id:"addThemeToFavorite",display:"Add current theme to favorite",icon:"fa-star",available:()=>!r.customTheme&&!r.favThemes.includes(je??r.theme),exec:()=>{const{theme:e,favThemes:t,customTheme:o}=r,a=je??e;!o&&!t.includes(a)&&Mc([...t,a])}},{id:"removeThemeFromFavorite",display:"Remove current theme from favorite",icon:"fa-star",iconType:"regular",available:()=>!r.customTheme&&r.favThemes.includes(je??r.theme),exec:()=>{const{theme:e,favThemes:t,customTheme:o}=r,a=je??e;!o&&t.includes(a)&&Mc([...t.filter(s=>s!==a)])}}],Yf=e=>e.replaceAll(" ","_"),Eh=async e=>{const t=aS.safeParse(Yf(e));return t.success?!0:t.error.errors.map(o=>o.message).join(", ")},UI={add:new pe({id:"addTag",title:"Add new tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:Eh,debounceDelay:0}}],onlineOnly:!0,buttonText:"add",execFn:async(e,t)=>{var s,n;const o=Yf(t),a=await E.users.createTag({body:{tagName:o}});return a.status!==200?{status:-1,message:"Failed to add tag: "+a.body.message.replace(o,t)}:((n=(s=x())==null?void 0:s.tags)==null||n.push({display:t,name:a.body.data.name,_id:a.body.data._id,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}}}),Ca(),{status:1,message:"Tag added"})}}),edit:new pe({id:"editTag",title:"Edit tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:Eh,debounceDelay:0}}],onlineOnly:!0,buttonText:"save",beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},execFn:async(e,t)=>{var n,l;const o=Yf(t),a=e.parameters[1],s=await E.users.editTag({body:{tagId:a,newName:o}});return s.status!==200?{status:-1,message:"Failed to edit tag: "+s.body.message}:((l=(n=x())==null?void 0:n.tags)==null||l.forEach(c=>{c._id===a&&(c.name=o,c.display=t)}),Ca(),{status:1,message:"Tag updated"})}}),remove:new pe({id:"removeTag",title:"Delete tag",onlineOnly:!0,buttonText:"delete",beforeInitFn:e=>{e.text=`Are you sure you want to delete tag ${e.parameters[0]} ?`},execFn:async e=>{var a,s;const t=e.parameters[1],o=await E.users.deleteTag({params:{tagId:t}});return o.status!==200?{status:-1,message:"Failed to remove tag: "+o.body.message}:((s=(a=x())==null?void 0:a.tags)==null||s.forEach((n,l)=>{var c,u;n._id===t&&((u=(c=x())==null?void 0:c.tags)==null||u.splice(l,1))}),Ca(),{status:1,message:"Tag removed"})}}),clearPb:new pe({id:"clearTagPb",title:"Clear personal bests",onlineOnly:!0,buttonText:"clear",beforeInitFn:e=>{e.text=`Are you sure you want to clear personal bests for tag ${e.parameters[0]} ?`},execFn:async e=>{const t=e.parameters[1],o=await E.users.deleteTagPersonalBest({params:{tagId:t}});return o.status!==200?{status:-1,message:"Failed to clear tag pb: "+o.body.message}:(Ca(),{status:1,message:"Tag PB cleared"})}})};function Gn(e,t,o,a){const s={modalChain:a,focusFirstInput:"focusAndSelect"};e!=="add"&&(o===void 0||t===void 0)||UI[e].show([o??"",t??""],s)}const jn={title:"Tags...",list:[],beforeList:()=>{VI()}},G0=[{id:"changeTags",display:"Tags...",icon:"fa-tag",subgroup:jn,available:()=>F()}];function VI(){const e=x();if(jn.list=[],e!==void 0&&e.tags!==void 0&&e.tags.length>0){jn.list.push({id:"clearTags",display:"Clear tags",icon:"fa-times",sticky:!0,exec:async()=>{var o;const t=x();t&&(t.tags=(o=t.tags)==null?void 0:o.map(a=>(a.active=!1,a)),st(t),(r.paceCaret==="average"||r.paceCaret==="tagPb"||r.paceCaret==="daily")&&await Vc(),Kt(),Mn())}});for(const t of e.tags)jn.list.push({id:"toggleTag"+t._id,display:t.display,sticky:!0,active:()=>{var o,a,s;return((s=(a=(o=x())==null?void 0:o.tags)==null?void 0:a.find(n=>n._id===t._id))==null?void 0:s.active)??!1},exec:async()=>{bm(t._id),(r.paceCaret==="average"||r.paceCaret==="tagPb"||r.paceCaret==="daily")&&await Vc(),Kt()}})}jn.list.push({id:"createTag",display:"Create tag",icon:"fa-plus",shouldFocusTestUI:!1,opensModal:!0,exec:({commandlineModal:t})=>{Gn("add",void 0,void 0,t)}})}const Xf={title:"Custom themes list...",beforeList:()=>GI(),list:[]},KI=[{id:"setCustomThemeId",display:"Custom themes...",icon:"fa-palette",subgroup:Xf,available:()=>F()}];function GI(){var t;if(!F())return;Xf.list=[];const e=x();if(e&&e.customThemes!==void 0&&((t=e.customThemes)==null?void 0:t.length)!==0)for(const o of e.customThemes)Xf.list.push({id:"setCustomThemeId"+o._id,display:o.name.replace(/_/gi," "),configValue:o._id,hover:()=>{im("custom",o.colors)},exec:()=>{Sa(!0),nn(o.colors)}})}const ue={presetType:"full",checkboxes:new Map(yd.options.map(e=>[e,!0])),setPresetToCurrent:!1};function gc(e,t,o){if(!it()){m("You are offline",0,{duration:2});return}Q0.show({focusFirstInput:!0,beforeAnimation:async()=>{i("#editPresetModal .modal .text").addClass("hidden"),YI(),e==="add"?(i("#editPresetModal .modal").attr("data-action","add"),i("#editPresetModal .modal .popupTitle").html("Add new preset"),i("#editPresetModal .modal .submit").html("add"),i("#editPresetModal .modal input").val(""),i("#editPresetModal .modal input").removeClass("hidden"),i("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),i("#editPresetModal .modal .inputs").removeClass("hidden"),i("#editPresetModal .modal .presetType").removeClass("hidden"),i("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),ue.presetType="full"):e==="edit"&&t!==void 0&&o!==void 0?(i("#editPresetModal .modal").attr("data-action","edit"),i("#editPresetModal .modal").attr("data-preset-id",t),i("#editPresetModal .modal .popupTitle").html("Edit preset"),i("#editPresetModal .modal .submit").html("save"),i("#editPresetModal .modal input").val(o),i("#editPresetModal .modal input").removeClass("hidden"),i("#editPresetModal .modal label.changePresetToCurrentCheckbox").removeClass("hidden"),i("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),ue.setPresetToCurrent=!1,await j0()):e==="remove"&&t!==void 0&&o!==void 0&&(i("#editPresetModal .modal").attr("data-action","remove"),i("#editPresetModal .modal").attr("data-preset-id",t),i("#editPresetModal .modal .popupTitle").html("Delete preset"),i("#editPresetModal .modal .submit").html("delete"),i("#editPresetModal .modal input").addClass("hidden"),i("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),i("#editPresetModal .modal .text").removeClass("hidden"),i("#editPresetModal .modal .deletePrompt").text(`Are you sure you want to delete the preset ${o}?`),i("#editPresetModal .modal .inputs").addClass("hidden"),i("#editPresetModal .modal .presetType").addClass("hidden"),i("#editPresetModal .modal .presetNameTitle").addClass("hidden")),Bm()}})}async function jI(e){for(const o of ue.checkboxes.keys())ue.checkboxes.set(o,!1);const t=await CE(e);if(t===void 0){m("Preset not found",-1);return}if(t.settingGroups===void 0||t.settingGroups===null){ue.presetType="full";for(const o of ue.checkboxes.keys())ue.checkboxes.set(o,!0)}else ue.presetType="partial",t.settingGroups.forEach(o=>ue.checkboxes.set(o,!0));ue.setPresetToCurrent=!1,Bm()}function QI(){yd.options.forEach(t=>{const o=i(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${t}"] input`);o.on("change",a=>{ue.checkboxes.set(t,o.prop("checked"))})});const e=i("#editPresetModal .modal .changePresetToCurrentCheckbox input");e.on("change",async()=>{ue.setPresetToCurrent=e.prop("checked"),await j0()})}function YI(){function e(o){return o.replace(/([a-z])([A-Z])/g,"$1 $2")}const t=i("#editPresetModal .modal .inputs .checkboxList").empty();yd.options.forEach(o=>{const a=e(o),s=`<label class="checkboxTitlePair" data-id="${o}">
              <input type="checkbox" />
              <div class="title">${a}</div>
              </label>`;t.append(s)});for(const o of ue.checkboxes.keys())ue.checkboxes.set(o,!0);QI()}function Bm(){yd.options.forEach(e=>{i(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${e}"] input`).prop("checked",ue.checkboxes.get(e))}),i("#editPresetModal .modal .presetType button").removeClass("active"),i(`#editPresetModal .modal .presetType button[value="${ue.presetType}"]`).addClass("active"),i("#editPresetModal .modal .partialPresetGroups").removeClass("hidden"),ue.presetType==="full"&&i("#editPresetModal .modal .partialPresetGroups").addClass("hidden")}async function j0(){if(i("#editPresetModal .modal label.changePresetToCurrentCheckbox input").prop("checked",ue.setPresetToCurrent),ue.setPresetToCurrent){const e=i("#editPresetModal .modal").attr("data-preset-id");await jI(e),i("#editPresetModal .modal .inputs").removeClass("hidden"),i("#editPresetModal .modal .presetType").removeClass("hidden")}else i("#editPresetModal .modal .inputs").addClass("hidden"),i("#editPresetModal .modal .presetType").addClass("hidden")}function XI(){Q0.hide()}async function ZI(){var u;const e=i("#editPresetModal .modal").attr("data-action"),t=i("#editPresetModal .modal input").val(),o=t.replaceAll(" ","_"),a=i("#editPresetModal .modal").attr("data-preset-id"),s=i("#editPresetModal .modal label input").prop("checked"),n=((u=x())==null?void 0:u.presets)??[];if(e===void 0)return;if(["add","edit"].includes(e)&&ue.presetType==="partial"&&Array.from(ue.checkboxes.values()).every(d=>!d)){m("At least one setting group must be active while saving partial presets",0);return}if(["add","edit"].includes(e)&&o.replace(/^_+|_+$/g,"").length===0){m("Preset name cannot be empty",0);return}if(XI(),te(),e==="add"){const d=_h(),p=Bu(),f=await E.presets.add({body:{name:o,config:d,...ue.presetType==="partial"&&{settingGroups:p}}});f.status!==200||f.body.data===null?m("Failed to add preset: "+f.body.message.replace(o,t),-1):(m("Preset added",1,{duration:2}),n.push({name:o,config:d,...ue.presetType==="partial"&&{settingGroups:p},display:t,_id:f.body.data.presetId}))}else if(e==="edit"){const d=n.find(h=>h._id===a);if(d===void 0){m("Preset not found",-1);return}const p=_h(),f=ue.presetType==="partial"?Bu():null,g=await E.presets.save({body:{_id:a,name:o,...s&&{config:p,settingGroups:f}}});g.status!==200?m("Failed to edit preset: "+g.body.message,-1):(m("Preset updated",1),d.name=o,d.display=o.replace(/_/g," "),s&&(d.config=p,ue.presetType==="partial"?d.settingGroups=Bu():d.settingGroups=null))}else if(e==="remove"){const d=await E.presets.delete({params:{presetId:a}});d.status!==200?m("Failed to remove preset: "+d.body.message,-1):(m("Preset removed",1),n.forEach((p,f)=>{p._id===a&&n.splice(f,1)}))}Ca(),V()}function JI(e){return iS[e]}function eq(e){const t={},o=Jo();return Object.keys(o).filter(a=>{const s=JI(a);return s===null?!1:ue.checkboxes.get(s)===!0}).forEach(a=>{const s=a,n=e[s]!==void 0?e[s]:o[s];t[s]=n}),t}function Bu(){return Array.from(ue.checkboxes.entries()).filter(([,e])=>e).map(([e])=>e)}function _h(){var s;const e=ue.presetType==="partial"?eq(_g()):_g(),o=(((s=x())==null?void 0:s.tags)??[]).filter(n=>n.active).map(n=>n._id),a=ue.presetType==="full"||ue.checkboxes.get("behavior")===!0;return{...e,...a&&{tags:o}}}async function tq(e){e.addEventListener("submit",t=>{t.preventDefault(),ZI()}),sS.options.forEach(t=>{const o=e.querySelector(`.presetType button[value="${t}"]`);o!==null&&o.addEventListener("click",()=>{ue.presetType=t,Bm()})})}const Q0=new le({dialogId:"editPresetModal",setup:tq}),hc={title:"Presets...",list:[],beforeList:()=>{aq()}},oq=[{visible:!1,id:"applyPreset",display:"Presets...",icon:"fa-sliders-h",subgroup:hc,available:()=>F()}];function aq(){const e=x();hc.list=[],!(!(e!=null&&e.presets)||e.presets.length===0)&&(e.presets.forEach(t=>{const o=t.display;hc.list.push({id:"applyPreset"+t._id,display:o,exec:async()=>{hn(!0),await Jw(t._id),hn(!1),Ca(),Kt()}})}),hc.list.push({id:"createPreset",display:"Create preset",icon:"fa-plus",exec:()=>{gc("add")}}))}const Y0=[{id:"changeFunboxNone",display:"none",configValue:"none",alias:"off",sticky:!0,exec:()=>{oe(),mM([])&&W()}}];for(const e of mp())Y0.push({id:"changeFunbox"+e.name,display:e.name.replace(/_/g," "),available:()=>{const t=wo();return t.includes(e.name)?!0:tl(t,e.name)},sticky:!0,alias:e.alias,configValue:e.name,configValueMode:"include",exec:()=>{Ov(e.name),oe(),W()}});const sq={title:"Funbox...",configKey:"funbox",list:Y0},X0=[{id:"changeFunbox",display:"Funbox...",alias:"fun box",icon:"fa-gamepad",subgroup:sq}],Zf=e=>r.favThemes.includes(e.name),Z0=e=>({id:"changeTheme"+mi(e.name),display:e.name.replace(/_/g," "),configValue:e.name,customData:{mainColor:e.mainColor,bgColor:e.bgColor,subColor:e.subColor,textColor:e.textColor,isFavorite:Zf(e)},hover:()=>{im(e.name)},exec:()=>{$p(e.name)}}),J0=e=>[...e.filter(Zf),...e.filter(nS(Zf))],Jf={title:"Theme...",configKey:"theme",list:J0(hl).map(e=>Z0(e))},eC=[{id:"changeTheme",display:"Theme...",icon:"fa-palette",subgroup:Jf}];function iq(e){Jf.list=[],Jf.list=J0(e).map(t=>Z0(t))}ge((e,t)=>{if(e==="favThemes")try{iq(hl)}catch(o){console.error(re(o,"Failed to update themes commands"))}});const tC={title:"Load challenge...",list:[]},oC=[{id:"loadChallenge",display:"Load challenge...",icon:"fa-award",subgroup:tC}];function nq(e){e.forEach(t=>{tC.list.push({id:"loadChallenge"+mi(t.name),display:t.display,exec:async()=>{await Qe("/"),await vw(t.name),W({nosave:!0})}})})}const aC={homeKeys:{display:"home keys",getIncludeString:e=>{const t=e.keys.row3.slice(0,4),o=e.keys.row3.slice(6,10);return[...t,...o]},getExcludeString:e=>{const t=e.keys.row2,o=e.keys.row4,a=e.keys.row3.slice(10),s=e.keys.row3.slice(4,6);return[...t,...s,...a,...o]}},leftHand:{display:"left hand",getIncludeString:e=>{const t=e.keys.row2.slice(0,5),o=e.keys.row3.slice(0,5),a=e.keys.row4.slice(0,5);return[...t,...o,...a]},getExcludeString:e=>{const t=e.keys.row2.slice(5),o=e.keys.row3.slice(5),a=e.keys.row4.slice(5);return[...t,...o,...a]}},rightHand:{display:"right hand",getIncludeString:e=>{const t=e.keys.row2.slice(5),o=e.keys.row3.slice(5),a=e.keys.row4.slice(4);return[...t,...o,...a]},getExcludeString:e=>{const t=e.keys.row2.slice(0,5),o=e.keys.row3.slice(0,5),a=e.keys.row4.slice(0,4);return[...t,...o,...a]}},homeRow:{display:"home row",getIncludeString:e=>e.keys.row3,getExcludeString:e=>{const t=e.keys.row2,o=e.keys.row4;return[...t,...o]}},topRow:{display:"top row",getIncludeString:e=>e.keys.row2,getExcludeString:e=>{const t=e.keys.row3,o=e.keys.row4;return[...t,...o]}},bottomRow:{display:"bottom row",getIncludeString:e=>e.keys.row4,getExcludeString:e=>{const t=e.keys.row2,o=e.keys.row3;return[...t,...o]}}};async function rq(){i("#wordFilterModal .languageInput").empty(),i("#wordFilterModal .layoutInput").empty(),i("wordFilterModal .presetInput").empty(),Hp.forEach(e=>{const t=e.replace(/_/gi," ");i("#wordFilterModal .languageInput").append(`
        <option value=${e}>${t}</option>
      `)});for(const e of Zc){const t=e.replace(/_/gi," ");i("#wordFilterModal .layoutInput").append(`
      <option value=${e}>${t}</option>
    `)}for(const[e,t]of Object.entries(aC))i("#wordFilterModal .presetInput").append(`<option value=${e}>${t.display}</option>`)}let Qn,Yn,Xn;async function lq(e){Ji.show({...e,beforeAnimation:async t=>{Qn=new lt({select:"#wordFilterModal .languageInput",settings:{contentLocation:t}}),Yn=new lt({select:"#wordFilterModal .layoutInput",settings:{contentLocation:Ji.getModal()}}),Xn=new lt({select:"#wordFilterModal .presetInput",settings:{contentLocation:Ji.getModal()}}),i("#wordFilterModal .loadingIndicator").removeClass("hidden"),sC()}})}function cq(e){Ji.hide({...e})}async function dq(e){let t=i("#wordFilterModal .wordIncludeInput").val();t=rg(t==null?void 0:t.trim()),t=t.replace(/\s+/gi,"|");const o=new RegExp(t,"i");let a=i("#wordFilterModal .wordExcludeInput").val();a=rg(a.trim()),a=a.replace(/\s+/gi,"|");const s=new RegExp(a,"i"),n=[],{data:l,error:c}=await eo(kn(e));if(c)return m(re(c,"Failed to filter language words"),-1),[];const u=i("#wordFilterModal .wordMaxInput").val(),d=i("#wordFilterModal .wordMinInput").val();let p,f;u===""?p=999:p=parseInt(u),d===""?f=1:f=parseInt(d);for(const g of l.words){const h=o.test(g),y=s.test(g);(h&&!y||h&&a==="")&&g.length<=p&&g.length>=f&&n.push(g)}return n}async function Ih(e){const t=i("#wordFilterModal .languageInput").val(),o=await dq(t);if(o.length===0){m("No words found",0),sC();return}const a=o.join(dl()?"|":" ");cq({modalChainData:{text:a,set:e}})}function qh(){for(const e of Ji.getModal().querySelectorAll("button"))e.setAttribute("disabled","true")}function sC(){for(const e of Ji.getModal().querySelectorAll("button"))e.removeAttribute("disabled")}async function uq(){await rq(),i("#wordFilterModal button.generateButton").on("click",async()=>{const e=i("#wordFilterModal .presetInput").val(),t=i("#wordFilterModal .layoutInput").val(),o=aC[e];if(o===void 0){m(`Preset ${e} not found`,-1);return}const a=await zs(t);i("#wordIncludeInput").val(o.getIncludeString(a).map(s=>s[0]).join(" ")),i("#wordExcludeInput").val(o.getExcludeString(a).map(s=>s[0]).join(" "))}),i("#wordFilterModal button.addButton").on("click",()=>{i("#wordFilterModal .loadingIndicator").removeClass("hidden"),qh(),setTimeout(()=>{Ih(!1)},0)}),i("#wordFilterModal button.setButton").on("click",()=>{i("#wordFilterModal .loadingIndicator").removeClass("hidden"),qh(),setTimeout(()=>{Ih(!0)},0)})}async function fq(){Qn==null||Qn.destroy(),Yn==null||Yn.destroy(),Xn==null||Xn.destroy(),Qn=void 0,Yn=void 0,Xn=void 0}const Ji=new le({dialogId:"wordFilterModal",setup:uq,cleanup:fq});let{promise:iC,resolve:yc}=Da();async function pq(){if(!li()){m("Could not show register popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1),yc(void 0);return}await nC.show({mode:"dialog",beforeAnimation:async e=>{({promise:iC,resolve:yc}=Da()),Fa("register"),En(e.querySelector(".g-recaptcha"),"register",t=>{yc(t),ep()})}})}function ep(e=!1){e&&yc(void 0),nC.hide()}const nC=new le({dialogId:"registerCaptchaModal",customEscapeHandler:async()=>{ep(!0)},customWrapperClickHandler:async()=>{ep(!0)}}),Fm=new g1,Rm=new h1;async function rC(){if(!Ro()){m("Authentication uninitialized",-1,{duration:3});return}te(),i(".sendVerificationEmail").prop("disabled",!0);const e=await E.users.verificationEmail();i(".sendVerificationEmail").prop("disabled",!1),e.status!==200?(V(),m("Failed to request verification email: "+e.body.message,-1)):(V(),m("Verification email sent",1))}async function mq(){try{console.log("getting account data");const e=await cx();if(e===!1)throw new Error("Snapshot didn't initialize due to lacking authentication even though user is authenticated");xx(e.uid,e.name),e.needsToChangeName&&Ws("You need to update your account name. <a class='openNameChange'>Click here</a> to change it and learn more about why.",-1,void 0,!0,void 0,!0);const t=JSON.stringify(r)===JSON.stringify(e.config);if(r===void 0||!t){console.log("no local config or local and db configs are different - applying db"),await ln(e.config),Cn(!0);for(const o of Ct("applyGlobalCSS"))o.functions.applyGlobalCSS()}return!0}catch(e){if(console.error(e),oa(),i("header nav .view-account").css("opacity",1),e instanceof On)e.responseCode===429&&(m("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).",0,{duration:0}),m("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.",0,{duration:0})),m("Failed to get user data: "+e.message,-1);else{const t=re(e,"Failed to get user data");m(t,-1)}return!1}}async function lC(e){if(!await mq()){yi();return}kd({type:"snapshotUpdated",data:{isInitial:!0}})}async function cC(e,t){console.debug("account controller ready");let o=Promise.resolve();e&&(console.debug(`auth state changed, user ${t?"true":"false"}`),console.debug(t),t?o=lC():st(void 0)),(!e||!t)&&Tx(),await Qe(void 0,{force:!0,loadingOptions:{shouldLoad:()=>t!==null,waitFor:async()=>{await o},style:"bar",keyframes:[{percentage:90,durationMs:1e3,text:"Downloading user data..."}]}}),kd({type:"authStateChanged",data:{isUserSignedIn:t!==null}})}async function gq(e,t){if(!Ro()){m("Authentication uninitialized",-1);return}if(!it()){m("You are offline",0,{duration:2});return}if(Am(),Mm(),Cl(),e===""||t===""){m("Please fill in all fields",0),Zo(),oa(),$m();return}const o=i(".pageLogin .login #rememberMe input").prop("checked"),{error:a}=await eo(N1(e,t,o));if(a!==null){m(a.message,-1),Zo(),oa(),ri();return}}async function dC(e){if(!Ro()){m("Authentication uninitialized",-1,{duration:3});return}if(!it()){m("You are offline",0,{duration:2});return}Am(),Mm(),Cl();const t=i(".pageLogin .login #rememberMe input").prop("checked"),{error:o}=await eo(U1(e,t));if(o!==null){o.message!==""&&m(o.message,-1),Zo(),oa(),ri();return}}async function hq(){return dC(Fm)}async function yq(){return dC(Rm)}async function bq(){return uC("Google",Fm)}async function vq(){return uC("GitHub",Rm)}async function uC(e,t){if(!it()){m("You are offline",0,{duration:2});return}if(!Ro()){m("Authentication uninitialized",-1,{duration:3});return}te();const o=Po();if(o)try{await y1(o,t),V(),m(`${e} authentication added`,1),kd({type:"authConfigUpdated"})}catch(a){V();const s=re(a,`Failed to add ${e} authentication`);m(s,-1)}}function yi(){if(!Ro()){m("Authentication uninitialized",-1,{duration:3});return}F()&&O1()}async function wq(){if(!Ro()){m("Authentication uninitialized",-1,{duration:3});return}if(!it()){m("You are offline",0,{duration:2});return}await pq();const e=await iC;if(e===void 0||e===""){m("Please complete the captcha",-1);return}Mm(),Cl(),Am();const t=S_();if(t===!1){Zo(),oa(),ri(),m("Please fill in all fields",0);return}const{name:o,email:a,password:s}=t;try{const n=await V1(a,s),l=await E.users.create({body:{name:o,captcha:e,email:a,uid:n.user.uid}});if(l.status!==200)throw new Error(`Failed to sign in: ${l.body.message}`);await Gy(n.user,{displayName:o}),await rC(),Zo(),await cC(!0,n.user),eb(),m("Account created",1)}catch(n){let l=re(n,"Failed to create account");n instanceof Error&&"code"in n&&n.code==="auth/email-already-in-use"&&(l=re({message:"Email already in use"},"Failed to create account")),m(l,-1),Zo(),oa(),ri(),yi();return}}i(".pageLogin .login form").on("submit",e=>{e.preventDefault();const t=i(".pageLogin .login input")[0].value??"",o=i(".pageLogin .login input")[1].value??"";gq(t,o)});i(".pageLogin .login button.signInWithGoogle").on("click",()=>{hq()});i(".pageLogin .login button.signInWithGitHub").on("click",()=>{yq()});i("nav .accountButtonAndMenu .menu button.signOut").on("click",()=>{if(!Ro()){m("Authentication uninitialized",-1,{duration:3});return}yi()});i(".pageLogin .register form").on("submit",e=>{e.preventDefault(),wq()});i(".pageAccountSettings").on("click","#addGoogleAuth",()=>{bq()});i(".pageAccountSettings").on("click","#addGithubAuth",()=>{vq()});i(".pageAccount").on("click",".sendVerificationEmail",()=>{if(!it()){m("You are offline",0,{duration:2});return}rC()});const ze={updateEmail:void 0,updateName:void 0,updatePassword:void 0,removeGoogleAuth:void 0,removeGithubAuth:void 0,removePasswordAuth:void 0,addPasswordAuth:void 0,deleteAccount:void 0,resetAccount:void 0,optOutOfLeaderboards:void 0,applyCustomFont:void 0,resetPersonalBests:void 0,resetSettings:void 0,revokeAllTokens:void 0,unlinkDiscord:void 0,editApeKey:void 0,deleteCustomText:void 0,deleteCustomTextLong:void 0,resetProgressCustomTextLong:void 0,updateCustomTheme:void 0,deleteCustomTheme:void 0,devGenerateData:void 0,lbGoToPage:void 0};function Cq(e){const o=["password","github.com","google.com"].filter(a=>a!==e);for(const a of o)if(nu(a))return a}function ia(){return nu("password")}function kq(){return nu("github.com")}function Sq(){return nu("google.com")}function nu(e){var t;return((t=Po())==null?void 0:t.providerData.some(o=>o.providerId===e))||!1}async function Co(e){if(!Ro())return{status:-1,message:"Authentication is not initialized"};const t=Po();if(t===null)return{status:-1,message:"User is not signed in"};const o=Cq(e.excludeMethod);try{if(o===void 0)return{status:-1,message:"Failed to reauthenticate: there is no valid authentication present on the account."};if(o==="password"){if(e.password===void 0)return{status:-1,message:"Failed to reauthenticate using password: password missing."};const a=jy.credential(t.email,e.password);await v1(t,a)}else await w1(t,o==="github.com"?Rm:Fm);return{status:1,message:"Reauthenticated",user:t}}catch(a){const s=a;return s.code==="auth/wrong-password"?{status:0,message:"Incorrect password"}:s.code==="auth/invalid-credential"?{status:0,message:"Password is incorrect or your account does not have password authentication enabled."}:{status:-1,message:"Failed to reauthenticate: "+((s==null?void 0:s.message)??JSON.stringify(a))}}}ze.updateEmail=new pe({id:"updateEmail",title:"Update email",inputs:[{placeholder:"Password",type:"password",initVal:""},{type:"text",placeholder:"New email",initVal:"",validation:{schema:Cc}},{type:"text",placeholder:"Confirm new email",initVal:"",validation:{schema:Cc,isValid:async(e,t)=>{var o,a;return e===((a=(o=t.inputs)==null?void 0:o[1])==null?void 0:a.currentValue())||"Emails don't match"},debounceDelay:0}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o,a)=>{if(o!==a)return{status:0,message:"Emails don't match"};const s=await Co({password:t});if(s.status!==1)return{status:s.status,message:s.message};const n=await E.users.updateEmail({body:{newEmail:o,previousEmail:s.user.email}});return n.status!==200?{status:-1,message:"Failed to update email: "+n.body.message}:(yi(),{status:1,message:"Email updated"})},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});ze.removeGoogleAuth=new pe({id:"removeGoogleAuth",title:"Remove Google authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const o=await Co({password:t,excludeMethod:"google.com"});if(o.status!==1)return{status:o.status,message:o.message};try{await hp(o.user,"google.com")}catch(a){return{status:-1,message:re(a,"Failed to unlink Google account")}}return vs(),Wa(3),{status:1,message:"Google authentication removed"}},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],kq()||(e.buttonText="",e.text="Password or GitHub authentication is not enabled")))}});ze.removeGithubAuth=new pe({id:"removeGithubAuth",title:"Remove GitHub authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const o=await Co({password:t,excludeMethod:"github.com"});if(o.status!==1)return{status:o.status,message:o.message};try{await hp(o.user,"github.com")}catch(a){return{status:-1,message:re(a,"Failed to unlink GitHub account")}}return vs(),Wa(3),{status:1,message:"GitHub authentication removed"}},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],Sq()||(e.buttonText="",e.text="Password or Google authentication is not enabled")))}});ze.removePasswordAuth=new pe({id:"removePaswordAuth",title:"Remove Password authentication",inputs:[{type:"checkbox",label:"I understand I will lose access to my Monkeytype account if my Google/GitHub account is lost or disabled."}],onlineOnly:!0,buttonText:"reauthenticate to remove",execFn:async e=>{const t=await Co({excludeMethod:"password"});if(t.status!==1)return{status:t.status,message:t.message};try{await hp(t.user,"password")}catch(o){return{status:-1,message:re(o,"Failed to remove password authentication")}}return vs(),Wa(3),{status:1,message:"Password authentication removed"}},beforeInitFn:()=>{F()}});ze.updateName=new pe({id:"updateName",title:"Update name",inputs:[{placeholder:"password",type:"password",initVal:""},{placeholder:"new name",type:"text",initVal:"",validation:{schema:hd,isValid:async e=>(await E.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available",debounceDelay:1e3}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o)=>{const a=await Co({password:t});if(a.status!==1)return{status:a.status,message:a.message};const s=await E.users.updateName({body:{name:o}});if(s.status!==200)return{status:-1,message:"Failed to update name: "+s.body.message};const n=x();return n&&(n.name=o,st(n),n.needsToChangeName&&Wa(2)),{status:1,message:"Name updated"}},beforeInitFn:e=>{if(!F())return;const t=x();t&&(ia()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to update"),t.needsToChangeName===!0&&(e.text="You need to change your account name. This might be because you have a duplicate name, no account name or your name is not allowed (contains whitespace or invalid characters). Sorry for the inconvenience."))}});ze.updatePassword=new pe({id:"updatePassword",title:"Update password",inputs:[{placeholder:"current password",type:"password",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o,a)=>{if(o!==a)return{status:0,message:"New passwords don't match"};if(o===t)return{status:0,message:"New password must be different from previous password"};if(!qy(o))return{status:0,message:"New password must contain at least one capital letter, number, a special character and must be between 8 and 64 characters long"};const s=await Co({password:t});if(s.status!==1)return{status:s.status,message:s.message};const n=await E.users.updatePassword({body:{newPassword:o}});return n.status!==200?{status:-1,message:"Failed to update password: "+n.body.message}:(yi(),{status:1,message:"Password updated"})},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});ze.addPasswordAuth=new pe({id:"addPasswordAuth",title:"Add password authentication",inputs:[{placeholder:"email",type:"email",initVal:""},{placeholder:"confirm email",type:"email",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"reauthenticate to add",onlineOnly:!0,execFn:async(e,t,o,a,s)=>{if(t!==o)return{status:0,message:"Emails don't match"};if(a!==s)return{status:0,message:"Passwords don't match"};const n=await Co({password:a});if(n.status!==1)return{status:n.status,message:n.message};try{const c=jy.credential(t,a);await b1(n.user,c)}catch(c){return{status:-1,message:re(c,"Failed to add password authentication")}}const l=await E.users.updateEmail({body:{newEmail:t,previousEmail:n.user.email}});return l.status!==200?{status:-1,message:"Password authentication added but updating the database email failed. This shouldn't happen, please contact support. Error: "+l.body.message}:(vs(),{status:1,message:"Password authentication added"})}});ze.deleteAccount=new pe({id:"deleteAccount",title:"Delete account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"delete",onlineOnly:!0,execFn:async(e,t)=>{const o=await Co({password:t});if(o.status!==1)return{status:o.status,message:o.message};m("Deleting all data...",0);const a=await E.users.delete();return a.status!==200?{status:-1,message:"Failed to delete user data: "+a.body.message}:(Wa(3),{status:1,message:"Account deleted, goodbye"})},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],e.buttonText="reauthenticate to delete"))}});ze.resetAccount=new pe({id:"resetAccount",title:"Reset account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const o=await Co({password:t});if(o.status!==1)return{status:o.status,message:o.message};m("Resetting settings...",0),await Mp(),await at.deleteFile("LocalBackgroundFile"),m("Resetting account...",0);const a=await E.users.reset();return a.status!==200?{status:-1,message:"Failed to reset account: "+a.body.message}:(Wa(3),{status:1,message:"Account reset"})},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});ze.optOutOfLeaderboards=new pe({id:"optOutOfLeaderboards",title:"Opt out of leaderboards",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to opt out of leaderboards?",buttonText:"opt out",onlineOnly:!0,execFn:async(e,t)=>{const o=await Co({password:t});if(o.status!==1)return{status:o.status,message:o.message};const a=await E.users.optOutOfLeaderboards();return a.status!==200?{status:-1,message:"Failed to opt out: "+a.body.message}:(Wa(3),{status:1,message:"Leaderboards opt out successful"})},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],e.buttonText="reauthenticate to opt out"))}});ze.applyCustomFont=new pe({id:"applyCustomFont",title:"Custom font",inputs:[{type:"text",placeholder:"Font name",initVal:""}],text:"Make sure you have the font installed on your computer before applying",buttonText:"apply",execFn:async(e,t)=>{var o;return(o=B.fontFamily)==null||o.setValue(t.replace(/\s/g,"_")),{status:1,message:"Font applied"}}});ze.resetPersonalBests=new pe({id:"resetPersonalBests",title:"Reset personal bests",inputs:[{placeholder:"password",type:"password",initVal:""}],buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const o=await Co({password:t});if(o.status!==1)return{status:o.status,message:o.message};const a=await E.users.deletePersonalBests();if(a.status!==200)return{status:-1,message:"Failed to reset personal bests: "+a.body.message};const s=x();return s?(s.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},{status:1,message:"Personal bests reset"}):{status:-1,message:"Failed to reset personal bests: no snapshot"}},beforeInitFn:e=>{F()&&(ia()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});ze.resetSettings=new pe({id:"resetSettings",title:"Reset settings",text:"Are you sure you want to reset all your settings?",buttonText:"reset",onlineOnly:!0,execFn:async()=>(await Mp(),await at.deleteFile("LocalBackgroundFile"),{status:1,message:"Settings reset"})});ze.revokeAllTokens=new pe({id:"revokeAllTokens",title:"Revoke all tokens",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to do this? This will log you out of all devices.",buttonText:"revoke all",onlineOnly:!0,execFn:async(e,t)=>{const o=await Co({password:t});if(o.status!==1)return{status:o.status,message:o.message};const a=await E.users.revokeAllTokens();return a.status!==200?{status:-1,message:"Failed to revoke tokens: "+a.body.message}:(Wa(3),{status:1,message:"Tokens revoked"})},beforeInitFn:e=>{!F()||!x()||ia()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to revoke all tokens")}});ze.unlinkDiscord=new pe({id:"unlinkDiscord",title:"Unlink Discord",text:"Are you sure you want to unlink your Discord account?",buttonText:"unlink",onlineOnly:!0,execFn:async()=>{const e=x();if(!e)return{status:-1,message:"Failed to unlink Discord: no snapshot"};const t=await E.users.unlinkDiscord();return t.status!==200?{status:-1,message:"Failed to unlink Discord: "+t.body.message}:(e.discordAvatar=void 0,e.discordId=void 0,st(e),vs(),{status:1,message:"Discord unlinked"})}});ze.deleteCustomText=new pe({id:"deleteCustomText",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(Jb(e.parameters[0],!1),cs("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});ze.deleteCustomTextLong=new pe({id:"deleteCustomTextLong",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(Jb(e.parameters[0],!0),cs("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});ze.resetProgressCustomTextLong=new pe({id:"resetProgressCustomTextLong",title:"Reset progress for custom text",text:"Are you sure?",buttonText:"reset",execFn:async e=>{rf(e.parameters[0],0);const t=Rc(e.parameters[0],!0);return _a(t),{status:1,message:"Custom text progress reset"}},beforeInitFn:e=>{e.text=`Are you sure you want to reset your progress for custom text ${e.parameters[0]}?`}});ze.updateCustomTheme=new pe({id:"updateCustomTheme",title:"Update custom theme",inputs:[{type:"text",placeholder:"name",initVal:""},{type:"checkbox",initVal:!1,label:"Update custom theme to current colors",optional:!0}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o)=>{var u;const a=x();if(!a)return{status:-1,message:"Failed to update custom theme: no snapshot"};const s=(u=a.customThemes)==null?void 0:u.find(d=>d._id===e.parameters[0]);if(s===void 0)return{status:-1,message:"Failed to update custom theme: theme not found"};let n=[];if(o==="true")for(const d of qa)n.push(i(`.pageSettings .customTheme .customThemeEdit #${d}[type='color']`).attr("value"));else n=s.colors;const l={name:t.replaceAll(" ","_"),colors:n};return await ux(s._id,l)?(nn(n),eu(),{status:1,message:"Custom theme updated"}):{status:-1,message:"Failed to update custom theme"}},beforeInitFn:e=>{var a;const t=x();if(!t)return;const o=(a=t.customThemes)==null?void 0:a.find(s=>s._id===e.parameters[0]);o&&(e.inputs[0].initVal=o.name)}});ze.deleteCustomTheme=new pe({id:"deleteCustomTheme",title:"Delete custom theme",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>(await fx(e.parameters[0]),eu(),{status:1,message:"Custom theme deleted"})});ze.devGenerateData=new pe({id:"devGenerateData",title:"Generate data",showLabels:!0,inputs:[{type:"text",label:"username",placeholder:"username",oninput:e=>{const t=e.target,o=document.querySelector("#devGenerateData_1 + span");o.innerHTML=`if checked, user will be created with ${t.value}@example.com and password: password`},validation:{schema:hd}},{type:"checkbox",label:"create user",description:"if checked, user will be created with {username}@example.com and password: password",optional:!0},{type:"date",label:"first test",optional:!0},{type:"date",label:"last test",max:new Date,optional:!0},{type:"range",label:"min tests per day",initVal:0,min:0,max:200,step:10},{type:"range",label:"max tests per day",initVal:50,min:0,max:200,step:10}],buttonText:"generate (might take a while)",execFn:async(e,t,o,a,s,n,l)=>{const c={username:t,createUser:o==="true"};a!==void 0&&a.length>0&&(c.firstTestTimestamp=Date.parse(a)),s!==void 0&&s.length>0&&(c.lastTestTimestamp=Date.parse(s)),n!==void 0&&n.length>0&&(c.minTestsPerDay=Number.parseInt(n)),l!==void 0&&l.length>0&&(c.maxTestsPerDay=Number.parseInt(l));const u=await E.dev.generateData({body:c});return{status:u.status===200?1:-1,message:u.body.message,hideOptions:{clearModalChain:!0}}}});ze.lbGoToPage=new pe({id:"lbGoToPage",title:"Go to page",inputs:[{type:"number",placeholder:"Page number"}],buttonText:"Go",execFn:async(e,t)=>{const o=parseInt(t,10);return isNaN(o)||o<1?{status:0,message:"Invalid page number"}:(X_(o-1),{status:1,message:"Navigating to page "+o,showNotification:!1})}});function Ue(e,t=[],o={}){const a=ze[e];if(a===void 0){m("Failed to show popup - popup is not defined",-1);return}a.show(t,o)}i(".pageAccountSettings").on("click","#unlinkDiscordButton",()=>{Ue("unlinkDiscord")});i(".pageAccountSettings").on("click","#removeGoogleAuth",()=>{Ue("removeGoogleAuth")});i(".pageAccountSettings").on("click","#removeGithubAuth",()=>{Ue("removeGithubAuth")});i(".pageAccountSettings").on("click","#removePasswordAuth",()=>{Ue("removePasswordAuth")});i("#resetSettingsButton").on("click",()=>{Ue("resetSettings")});i(".pageAccountSettings").on("click","#revokeAllTokens",()=>{Ue("revokeAllTokens")});i(".pageAccountSettings").on("click","#resetPersonalBestsButton",()=>{Ue("resetPersonalBests")});i(".pageAccountSettings").on("click","#updateAccountName",()=>{Ue("updateName")});i("#bannerCenter").on("click",".banner .text .openNameChange",()=>{Ue("updateName")});i(".pageAccountSettings").on("click","#addPasswordAuth",()=>{Ue("addPasswordAuth")});i(".pageAccountSettings").on("click","#emailPasswordAuth",()=>{Ue("updateEmail")});i(".pageAccountSettings").on("click","#passPasswordAuth",()=>{Ue("updatePassword")});i(".pageAccountSettings").on("click","#deleteAccount",()=>{Ue("deleteAccount")});i(".pageAccountSettings").on("click","#resetAccount",()=>{Ue("resetAccount")});i(".pageAccountSettings").on("click","#optOutOfLeaderboardsButton",()=>{Ue("optOutOfLeaderboards")});i(".pageSettings").on("click",".section.themes .customTheme .delButton",e=>{const o=i(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Ue("deleteCustomTheme",[o])});i(".pageSettings").on("click",".section.themes .customTheme .editButton",e=>{const o=i(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Ue("updateCustomTheme",[o],{focusFirstInput:"focusAndSelect"})});i(".pageSettings").on("click",".section[data-config-name='fontFamily'] button[data-config-value='custom']",()=>{Ue("applyCustomFont")});async function fC(){const e=lf(),t=i("#savedTextsModal .list").empty();let o="";if(e.length===0)o+="<div>No saved custom texts found</div>";else for(const l of e)o+=`<div class="savedText" data-name="${Ht(l)}">
      <div class="button name">${Ht(l)}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;t.html(o);const a=lf(!0),s=i("#savedTextsModal .listLong").empty();let n="";if(a.length===0)n+="<div>No saved long custom texts found</div>";else for(const l of a)n+=`<div class="savedLongText" data-name="${Ht(l)}">
      <div class="button name">${Ht(l)}</div>
      <div class="button ${qp(l)<=0?"disabled":""} resetProgress">reset</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;s.html(n),i("#savedTextsModal .list .savedText .button.delete").on("click",l=>{const c=i(l.target).closest(".savedText").data("name");if(c===void 0){m("Failed to show delete modal: no name found",-1);return}Ue("deleteCustomText",[c],{modalChain:hr})}),i("#savedTextsModal .listLong .savedLongText .button.delete").on("click",l=>{const c=i(l.target).closest(".savedLongText").data("name");if(c===void 0){m("Failed to show delete modal: no name found",-1);return}Ue("deleteCustomTextLong",[c],{modalChain:hr})}),i("#savedTextsModal .listLong .savedLongText .button.resetProgress").on("click",l=>{const c=i(l.target).closest(".savedLongText").data("name");if(c===void 0){m("Failed to show delete modal: no name found",-1);return}Ue("resetProgressCustomTextLong",[c],{modalChain:hr})}),i("#savedTextsModal .list .savedText .button.name").on("click",l=>{const c=i(l.target).text();cs(c,!1);const u=Fh(c,!1);Bh({modalChainData:{text:u,long:!1}})}),i("#savedTextsModal .listLong .savedLongText .button.name").on("click",l=>{const c=i(l.target).text();cs(c,!0);const u=Fh(c,!0);Bh({modalChainData:{text:u,long:!0}})})}async function xq(e){hr.show({...e,beforeAnimation:async()=>{fC()}})}function Bh(e){hr.hide({...e})}function Fh(e,t){let o=Rc(e,t);return t&&(o=o.slice(qp(e))),o.join(" ")}async function Tq(){}const hr=new le({dialogId:"savedTextsModal",setup:Tq,showOptionsWhenInChain:{beforeAnimation:async()=>{fC()}}});let Tt;const id={textToSave:[]};async function Lq(e){id.textToSave=[],pC.show({...e,beforeAnimation:async(t,o)=>{id.textToSave=(o==null?void 0:o.text)??[],i("#saveCustomTextModal .textName").val(""),i("#saveCustomTextModal .isLongText").prop("checked",!1),i("#saveCustomTextModal button.save").prop("disabled",!0)}})}function $q(){pC.hide()}function Mq(){const e=i("#saveCustomTextModal .textName").val(),t=i("#saveCustomTextModal .isLongText").prop("checked");return e?id.textToSave.length===0?(m("Custom text can't be empty",0),!1):_L(e,id.textToSave,t)?(cs(e,t),m("Custom text saved",1),!0):(m("Error saving custom text",-1),!1):(m("Custom text needs a name",0),!1)}function Aq(){const e=i("#saveCustomTextModal .textName").val(),t=i("#saveCustomTextModal .isLongText").prop("checked");e?lf(t).includes(e)?(Tt==null||Tt.show("unavailable"),i("#saveCustomTextModal button.save").prop("disabled",!0)):(Tt==null||Tt.show("available"),i("#saveCustomTextModal button.save").prop("disabled",!1)):(Tt==null||Tt.hide(),i("#saveCustomTextModal button.save").prop("disabled",!0))}const Rh=$t(500,Aq);async function Eq(e){var t,o;Tt=new Jd(i("#saveCustomTextModal .textName"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},loading:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),e.addEventListener("submit",a=>{a.preventDefault(),Mq()&&$q()}),(t=e.querySelector(".textName"))==null||t.addEventListener("input",a=>{a.target.value.length>0&&(Tt==null||Tt.show("loading"),Rh())}),(o=e.querySelector(".isLongText"))==null||o.addEventListener("input",a=>{a.target.value.length>0&&(Tt==null||Tt.show("loading"),Rh())})}const pC=new le({dialogId:"saveCustomTextModal",setup:Eq}),j="#customTextModal .modal",L={textarea:cl().join(dl()?"|":" "),longCustomTextWarning:!1,challengeWarning:!1,customTextMode:"simple",customTextLimits:{word:"",time:"",section:""},removeFancyTypographyEnabled:!0,replaceControlCharactersEnabled:!0,customTextPipeDelimiter:!1,replaceNewlines:"off",removeZeroWidthCharactersEnabled:!0};function Qt(){i(`${j} .inputs .group[data-id="mode"] button`).removeClass("active"),i(`${j} .inputs .group[data-id="mode"] button[value="${L.customTextMode}"]`).addClass("active"),i(`${j} .inputs .group[data-id="limit"] input.words`).addClass("hidden"),i(`${j} .inputs .group[data-id="limit"] input.sections`).addClass("hidden"),i(`${j} .inputs .group[data-id="limit"] input.words`).val(L.customTextLimits.word),i(`${j} .inputs .group[data-id="limit"] input.time`).val(L.customTextLimits.time),i(`${j} .inputs .group[data-id="limit"] input.sections`).val(L.customTextLimits.section),L.customTextLimits.word!==""&&i(`${j} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),L.customTextLimits.section!==""&&i(`${j} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),L.customTextPipeDelimiter?(i(`${j} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),i(`${j} .inputs .group[data-id="limit"] input.words`).addClass("hidden")):(i(`${j} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),i(`${j} .inputs .group[data-id="limit"] input.sections`).addClass("hidden")),L.customTextMode==="simple"?(i(`${j} .inputs .group[data-id="limit"]`).addClass("disabled"),i(`${j} .inputs .group[data-id="limit"] input`).val(""),i(`${j} .inputs .group[data-id="limit"] input`).prop("disabled",!0)):(i(`${j} .inputs .group[data-id="limit"]`).removeClass("disabled"),i(`${j} .inputs .group[data-id="limit"] input`).prop("disabled",!1)),i(`${j} .inputs .group[data-id="fancy"] button`).removeClass("active"),i(`${j} .inputs .group[data-id="fancy"] button[value="${L.removeFancyTypographyEnabled}"]`).addClass("active"),i(`${j} .inputs .group[data-id="control"] button`).removeClass("active"),i(`${j} .inputs .group[data-id="control"] button[value="${L.replaceControlCharactersEnabled}"]`).addClass("active"),i(`${j} .inputs .group[data-id="zeroWidth"] button`).removeClass("active"),i(`${j} .inputs .group[data-id="zeroWidth"] button[value="${L.removeZeroWidthCharactersEnabled}"]`).addClass("active"),i(`${j} .inputs .group[data-id="delimiter"] button`).removeClass("active"),i(`${j} .inputs .group[data-id="delimiter"] button[value="${L.customTextPipeDelimiter}"]`).addClass("active"),i(`${j} .inputs .group[data-id="newlines"] button`).removeClass("active"),i(`${j} .inputs .group[data-id="newlines"] button[value="${L.replaceNewlines}"]`).addClass("active"),i(`${j} textarea`).val(L.textarea),L.longCustomTextWarning?(i(`${j} .longCustomTextWarning`).removeClass("hidden"),i(`${j} .randomWordsCheckbox input`).prop("checked",!1),i(`${j} .delimiterCheck input`).prop("checked",!1),i(`${j} .typographyCheck`).prop("checked",!0),i(`${j} .replaceNewlineWithSpace input`).prop("checked",!1),i(`${j} .inputs`).addClass("disabled")):(i(`${j} .longCustomTextWarning`).addClass("hidden"),i(`${j} .inputs`).removeClass("disabled")),L.challengeWarning?(i(`${j} .challengeWarning`).removeClass("hidden"),i(`${j} .randomWordsCheckbox input`).prop("checked",!1),i(`${j} .delimiterCheck input`).prop("checked",!1),i(`${j} .typographyCheck`).prop("checked",!0),i(`${j} .replaceNewlineWithSpace input`).prop("checked",!1),i(`${j} .inputs`).addClass("disabled")):(i(`${j} .challengeWarning`).addClass("hidden"),i(`${j} .inputs`).removeClass("disabled"))}async function mC(e,t){if(L.customTextMode=ac(),L.customTextMode==="repeat"&&Se()==="word"&&ke()===cl().length&&(L.customTextMode="simple"),L.customTextLimits.word="",L.customTextLimits.time="",L.customTextLimits.section="",Se()==="word"?L.customTextLimits.word=`${ke()}`:Se()==="time"?L.customTextLimits.time=`${ke()}`:Se()==="section"&&(L.customTextLimits.section=`${ke()}`),L.customTextPipeDelimiter=dl(),L.longCustomTextWarning=ta()??!1,(t==null?void 0:t.text)!==void 0){t.long!==!0&&ta()&&(cs("",void 0),m("Disabled long custom text progress tracking",0,{duration:5}),L.longCustomTextWarning=!1);const o=t.set??!0?t.text:L.textarea+" "+t.text;L.textarea=o,L.customTextMode="simple",L.customTextLimits.word=`${nd().length}`,L.customTextLimits.time="",L.customTextLimits.section=""}Qt()}async function gC(){!L.challengeWarning&&!L.longCustomTextWarning&&i(`${j} textarea`).trigger("focus")}function Dm(e){L.textarea=cl().join(dl()?"|":" ").replace(/^ +/gm,""),yr.show({...e,beforeAnimation:mC,afterAnimation:gC})}function tp(){yr.hide()}function _q(){var t;const e=(t=i("#fileInput")[0].files)==null?void 0:t[0];if(e){if(e.type!=="text/plain"){m("File is not a text file",-1,{duration:5});return}const o=new FileReader;o.readAsText(e,"UTF-8"),o.onload=a=>{var n;const s=(n=a.target)==null?void 0:n.result;L.textarea=s,Qt(),i("#fileInput").val("")},o.onerror=()=>{m("Failed to read file",-1,{duration:5})}}}function nd(){let e=L.textarea;return e===""?[]:(e=e.normalize().trim(),e=e.replace(/[\u2000-\u200A\u202F\u205F\u00A0]/g," "),L.removeZeroWidthCharactersEnabled&&(e=e.replace(/[\u200B-\u200D\u2060\uFEFF]/g,"")),L.replaceControlCharactersEnabled&&(e=Vx(e)),e=e.replace(/ +/gm," "),e=e.replace(/( *(\r\n|\r|\n) *)/g,`
 `),L.removeFancyTypographyEnabled&&(e=Tb(e)),L.replaceNewlines!=="off"&&(L.replaceNewlines==="periodSpace"?(e=e.replace(/\n/gm,". "),e=e.replace(/\.\. /gm,". "),e=e.replace(/ +/gm," ")):(e=e.replace(/\n/gm," "),e=e.replace(/ +/gm," "))),e.split(L.customTextPipeDelimiter?"|":" ").filter(o=>o!==""))}function Iq(){if(L.textarea===""){m("Text cannot be empty",0);return}if([L.customTextLimits.word,L.customTextLimits.time,L.customTextLimits.section].filter(t=>t!=="").length>1){m("You can only specify one limit",0,{duration:5});return}if(L.customTextMode!=="simple"&&L.customTextLimits.word===""&&L.customTextLimits.time===""&&L.customTextLimits.section===""){m("You need to specify a limit",0,{duration:5});return}(L.customTextLimits.section==="0"||L.customTextLimits.word==="0"||L.customTextLimits.time==="0")&&m("Infinite test! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});const e=nd();if(e.length===0){m("Text cannot be empty",0);return}L.customTextMode==="simple"?(cn("repeat"),L.customTextLimits.word=`${e.length}`,L.customTextLimits.time="",L.customTextLimits.section=""):cn(L.customTextMode),Xs(L.customTextPipeDelimiter),_a(e),L.customTextMode==="simple"&&L.customTextPipeDelimiter?(_o("section"),Ko(e.length)):L.customTextLimits.word!==""?(_o("word"),Ko(parseInt(L.customTextLimits.word))):L.customTextLimits.time!==""?(_o("time"),Ko(parseInt(L.customTextLimits.time))):L.customTextLimits.section!==""&&(_o("section"),Ko(parseInt(L.customTextLimits.section))),bw(),oe(),r.mode!=="custom"&&gt("custom"),W(),tp()}function qq(){let e=L.textarea.split(L.customTextPipeDelimiter?" ":"|").join(L.customTextPipeDelimiter?"|":" ");e=e.replace(/\n /g,`
`),L.textarea=e}async function Bq(e){var a,s,n,l,c,u,d,p,f,g;(a=e.querySelector("#fileInput"))==null||a.addEventListener("change",_q);const t=e.querySelectorAll(".group[data-id='mode'] button");for(const h of t)h.addEventListener("click",y=>{if(L.customTextMode=y.target.value,L.customTextMode==="simple"){const v=nd();L.customTextLimits.word=`${v.length}`,L.customTextLimits.time="",L.customTextLimits.section=""}Qt()});for(const h of e.querySelectorAll(".group[data-id='fancy'] button"))h.addEventListener("click",y=>{L.removeFancyTypographyEnabled=y.target.value==="true",Qt()});for(const h of e.querySelectorAll(".group[data-id='control'] button"))h.addEventListener("click",y=>{L.replaceControlCharactersEnabled=y.target.value==="true",Qt()});for(const h of e.querySelectorAll(".group[data-id='zeroWidth'] button"))h.addEventListener("click",y=>{L.removeZeroWidthCharactersEnabled=y.target.value==="true",Qt()});for(const h of e.querySelectorAll(".group[data-id='delimiter'] button"))h.addEventListener("click",y=>{L.customTextPipeDelimiter=y.target.value==="true",L.customTextPipeDelimiter&&L.customTextLimits.word!==""&&(L.customTextLimits.word=""),!L.customTextPipeDelimiter&&L.customTextLimits.section!==""&&(L.customTextLimits.section=""),qq(),Qt()});for(const h of e.querySelectorAll(".group[data-id='newlines'] button"))h.addEventListener("click",y=>{L.replaceNewlines=y.target.value,Qt()});(s=e.querySelector(".group[data-id='limit'] input.words"))==null||s.addEventListener("input",h=>{L.customTextLimits.word=h.target.value,L.customTextLimits.time="",L.customTextLimits.section="",Qt()}),(n=e.querySelector(".group[data-id='limit'] input.time"))==null||n.addEventListener("input",h=>{L.customTextLimits.time=h.target.value,L.customTextLimits.word="",L.customTextLimits.section="",Qt()}),(l=e.querySelector(".group[data-id='limit'] input.sections"))==null||l.addEventListener("input",h=>{L.customTextLimits.section=h.target.value,L.customTextLimits.word="",L.customTextLimits.time="",Qt()});const o=e.querySelector("textarea");o==null||o.addEventListener("input",h=>{L.textarea=h.target.value}),o==null||o.addEventListener("keydown",h=>{if(h.key!=="Tab")return;h.preventDefault();const y=h.target,v=y.selectionStart,w=y.selectionEnd;y.value=y.value.substring(0,v)+"	"+y.value.substring(w),y.selectionStart=y.selectionEnd=v+1,L.textarea=y.value}),o==null||o.addEventListener("keypress",h=>{if(L.longCustomTextWarning||L.challengeWarning){h.preventDefault();return}h.code==="Enter"&&h.ctrlKey&&i(`${j} .button.apply`).trigger("click"),ta()&&jp()!==""&&(cs("",void 0),L.longCustomTextWarning=!1,m("Disabled long custom text progress tracking",0,{duration:5}))}),(c=e.querySelector(".button.apply"))==null||c.addEventListener("click",()=>{Iq()}),(u=e.querySelector(".button.wordfilter"))==null||u.addEventListener("click",()=>{lq({modalChain:yr})}),(d=e.querySelector(".button.showSavedTexts"))==null||d.addEventListener("click",()=>{xq({modalChain:yr})}),(p=e.querySelector(".button.saveCustomText"))==null||p.addEventListener("click",()=>{Lq({modalChain:yr,modalChainData:{text:nd()}})}),(f=e.querySelector(".longCustomTextWarning"))==null||f.addEventListener("click",()=>{L.longCustomTextWarning=!1,Qt()}),(g=e.querySelector(".challengeWarning"))==null||g.addEventListener("click",()=>{L.challengeWarning=!1,Qt()})}const yr=new le({dialogId:"customTextModal",setup:Bq,customEscapeHandler:async()=>{tp()},customWrapperClickHandler:async()=>{tp()},showOptionsWhenInChain:{beforeAnimation:mC,afterAnimation:gC}}),Xr="videoAdPopupWrapper";async function hC(){if(to(Xr,"popups"),await gm(),Xd){m("Looks like you're using an adblocker. Video ads will not work until you disable it.",0,{duration:6});return}if(await hm(),Ur){m("Looks like you're using a cookie popup blocker. Video ads will not work without giving your consent through the popup.",0,{duration:7});return}Xt(Xr)||i("#videoAdPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},125,()=>{window.dataLayer.push({event:"EG_Video"})})}function Dh(){Xt(Xr)&&i("#videoAdPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},125,()=>{i("#videoAdPopupWrapper").addClass("hidden"),Bt(Xr)})}function Fq(e){const t=e.event;t==="started"||(t==="finished"?Dh():t==="empty"&&(m("Failed to load video ad. Please try again later",-1,{duration:3}),Dh()))}i(".pageTest #watchVideoAdButton").on("click",()=>{hC()});oo(Xr);function yC(e){return i(`#shareTestSettingsModal label.${e} input`).prop("checked")}function bC(){const e=location.origin+"?testSettings=",t=new Array(8).fill(null),o=[{key:"mode",getValue:()=>r.mode},{key:"mode2",getValue:()=>pi(r,J)},{key:"customText",getValue:()=>Ia()},{key:"punctuation",getValue:()=>r.punctuation},{key:"numbers",getValue:()=>r.numbers},{key:"language",getValue:()=>r.language},{key:"difficulty",getValue:()=>r.difficulty},{key:"funbox",getValue:()=>r.funbox}];for(const[n,{key:l,getValue:c}]of o.entries())yC(l)&&(t[n]=c());const a=Ky.compressToURI(JSON.stringify(t)),s=e+a;Rq(s)}function Rq(e){const t=i("#shareTestSettingsModal");t.find("textarea.url").val(e),t.find(".tooLongWarning").toggleClass("hidden",e.length<=2e3)}function vC(){yC("mode")?i("#shareTestSettingsModal .subgroup").removeClass("hidden"):i("#shareTestSettingsModal .subgroup").addClass("hidden")}function Wm(e){Wq.show({...e,beforeAnimation:async()=>{bC(),vC()}})}async function Dq(e){var o;(o=e.querySelector("textarea.url"))==null||o.addEventListener("click",async a=>{a.target.select()});const t=e.querySelectorAll("label input");for(const a of t)a.addEventListener("change",async()=>{bC(),vC()})}const Wq=new le({dialogId:"shareTestSettingsModal",setup:Dq});let Wh=!1;async function Pq(){if(!Wh){for(const e of Op)e!=="swiss_german"&&i("#quoteSubmitModal .newQuoteLanguage").append(`<option value="${e}">${e.replace(/_/g," ")}</option>`);Wh=!0}}let Zn;async function zq(){const e=i("#quoteSubmitModal .newQuoteText").val(),t=i("#quoteSubmitModal .newQuoteSource").val(),o=i("#quoteSubmitModal .newQuoteLanguage").val(),a=Sl("submitQuote");if(!e||!t||!o){m("Please fill in all fields",0);return}te();const s=await E.quotes.add({body:{text:e,source:t,language:o,captcha:a}});if(V(),s.status!==200){m("Failed to submit quote: "+s.body.message,-1);return}m("Quote submitted.",1),i("#quoteSubmitModal .newQuoteText").val(""),i("#quoteSubmitModal .newQuoteSource").val(""),Fa("submitQuote")}async function Hq(e){if(!li()){m("Could not show quote submit popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}wC.show({...e,mode:"dialog",focusFirstInput:!0,afterAnimation:async()=>{En(document.querySelector("#quoteSubmitModal .g-recaptcha"),"submitQuote"),await Pq(),Zn=new lt({select:"#quoteSubmitModal .newQuoteLanguage"}),i("#quoteSubmitModal .newQuoteLanguage").val(No(r.language)),i("#quoteSubmitModal .newQuoteLanguage").trigger("change"),i("#quoteSubmitModal input").val(""),new Qr(i("#quoteSubmitModal .newQuoteText"),250)}})}function Oq(e){wC.hide({clearModalChain:e})}async function Nq(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{zq(),Oq(!0)})}async function Uq(){Fa("submitQuote"),Zn==null||Zn.destroy(),Zn=void 0}const wC=new le({dialogId:"quoteSubmitModal",setup:Nq,cleanup:Uq});let fs=[];function ru(){i("#quoteApproveModal .quotes").empty(),fs.forEach((e,t)=>{const o=i(`
      <div class="quote" data-id="${t}" data-db-id="${e._id}">
        <textarea class="text">${e.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${e.source}">
        <div class="buttons">
          <button disabled class="textButton undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></button>
          <button class="textButton refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></button>
          <button class="textButton approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></button>
          <button class="textButton edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></button>
        </div>
        <div class="bottom">
          <div class="length ${e.text.length<60?"red":""}"><i class="fas fa-fw fa-ruler"></i>${e.text.length}</div>
          <div class="language"><i class="fas fa-fw fa-globe-americas"></i>${e.language}</div>
          <div class="timestamp"><i class="fas fa-fw fa-calendar"></i>${ae(new Date(e.timestamp),"dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);i("#quoteApproveModal .quotes").append(o),o.find(".source").on("input",()=>{i(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),i(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),i(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden")}),o.find(".text").on("input",()=>{i(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),i(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),i(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden"),CC(t)}),o.find(".undo").on("click",()=>{Kq(t)}),o.find(".approve").on("click",()=>{Gq(t,e._id)}),o.find(".refuse").on("click",()=>{jq(t,e._id)}),o.find(".edit").on("click",()=>{Qq(t,e._id)})})}function CC(e){var o;const t=(o=i(`#quoteApproveModal .quote[data-id=${e}] .text`).val())==null?void 0:o.length;i(`#quoteApproveModal .quote[data-id=${e}] .length`).html(`<i class="fas fa-fw fa-ruler"></i>${t}`),t<60?i(`#quoteApproveModal .quote[data-id=${e}] .length`).addClass("red"):i(`#quoteApproveModal .quote[data-id=${e}] .length`).removeClass("red")}async function kC(){te();const e=await E.quotes.get();if(V(),e.status!==200){m("Failed to get new quotes: "+e.body.message,-1);return}fs=e.body.data??[],ru()}async function Vq(e){Xq.show({...e,beforeAnimation:async()=>{fs=[],kC()}})}function Pm(e){const t=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);t.find("button").prop("disabled",!1),t.find(".edit").hasClass("hidden")&&t.find(".undo").prop("disabled",!0)}function Kq(e){var t,o;i(`#quoteApproveModal .quote[data-id=${e}] .text`).val(((t=fs[e])==null?void 0:t.text)??""),i(`#quoteApproveModal .quote[data-id=${e}] .source`).val(((o=fs[e])==null?void 0:o.source)??""),i(`#quoteApproveModal .quote[data-id=${e}] .undo`).prop("disabled",!0),i(`#quoteApproveModal .quote[data-id=${e}] .approve`).removeClass("hidden"),i(`#quoteApproveModal .quote[data-id=${e}] .edit`).addClass("hidden"),CC(e)}async function Gq(e,t){if(!confirm("Are you sure?"))return;const o=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);o.find("button").prop("disabled",!0),o.find("textarea, input").prop("disabled",!0),te();const a=await E.quotes.approveSubmission({body:{quoteId:t}});if(V(),a.status!==200){Pm(e),o.find("textarea, input").prop("disabled",!1),m("Failed to approve quote: "+a.body.message,-1);return}m(`Quote approved. ${a.body.message??""}`,1),fs.splice(e,1),ru()}async function jq(e,t){if(!confirm("Are you sure?"))return;const o=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);o.find("button").prop("disabled",!0),o.find("textarea, input").prop("disabled",!0),te();const a=await E.quotes.rejectSubmission({body:{quoteId:t}});if(V(),a.status!==200){Pm(e),o.find("textarea, input").prop("disabled",!1),m("Failed to refuse quote: "+a.body.message,-1);return}m("Quote refused.",1),fs.splice(e,1),ru()}async function Qq(e,t){if(!confirm("Are you sure?"))return;const o=i(`#quoteApproveModal .quote[data-id=${e}] .text`).val(),a=i(`#quoteApproveModal .quote[data-id=${e}] .source`).val(),s=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);s.find("button").prop("disabled",!0),s.find("textarea, input").prop("disabled",!0),te();const n=await E.quotes.approveSubmission({body:{quoteId:t,editText:o,editSource:a}});if(V(),n.status!==200){Pm(e),s.find("textarea, input").prop("disabled",!1),m("Failed to approve quote: "+n.body.message,-1);return}m(`Quote edited and approved. ${n.body.message??""}`,1),fs.splice(e,1),ru()}async function Yq(e){var t;(t=e.querySelector("button.refreshList"))==null||t.addEventListener("click",()=>{i("#quoteApproveModal .quotes").empty(),kC()})}const Xq=new le({dialogId:"quoteApproveModal",setup:Yq}),en={quoteToReport:void 0,reasonSelect:void 0};async function SC(e,t){if(!li()){m("Could not show quote report popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}xC.show({mode:"dialog",...t,beforeAnimation:async()=>{var s;En(document.querySelector("#quoteReportModal .g-recaptcha"),"quoteReportModal");const o=r.language==="swiss_german"?"german":r.language,{quotes:a}=await yt.getQuotes(o);en.quoteToReport=a.find(n=>n.id===e),i("#quoteReportModal .quote").text((s=en.quoteToReport)==null?void 0:s.text),i("#quoteReportModal .reason").val("Grammatical error"),i("#quoteReportModal .comment").val(""),en.reasonSelect=new lt({select:"#quoteReportModal .reason",settings:{showSearch:!1}}),new Qr(i("#quoteReportModal .comment"),250)}})}async function Zq(e=!1){xC.hide({clearModalChain:e})}async function Jq(){var u;const e=Sl("quoteReportModal");if(!e){m("Please complete the captcha");return}const t=(u=en.quoteToReport)==null?void 0:u.id.toString(),o=No(r.language),a=i("#quoteReportModal .reason").val(),s=i("#quoteReportModal .comment").val(),n=e;if(t===void 0||t===""){m("Please select a quote");return}if(!a){m("Please select a valid report reason");return}if(!s){m("Please provide a comment");return}const l=s.length-250;if(l>0){m(`Report comment is ${l} character(s) too long`);return}te();const c=await E.quotes.report({body:{quoteId:t,quoteLanguage:o,reason:a,comment:s,captcha:n}});if(V(),c.status!==200){m("Failed to report quote: "+c.body.message,-1);return}m("Report submitted. Thank you!",1),Zq(!0)}async function eB(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",async()=>{await Jq()})}async function tB(){var e;Fa("quoteReportModal"),(e=en.reasonSelect)==null||e.destroy(),en.reasonSelect=void 0}const xC=new le({dialogId:"quoteReportModal",setup:eB,cleanup:tB}),oB={fuzzyMatchSensitivity:.2,scoreForSimilarMatch:.5,scoreForExactMatch:1};function aB(e,t){return t===0?0:Math.log10(e/t)}const Ph=.4;function sB(e,t){return Ph+(1-Ph)*(t.termFrequencies[e]/t.maxTermFrequency)}function zh(e){return e.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g)??[]}const iB=(e,t,o=oB)=>{const a={},s={};e.forEach((c,u)=>{const d=zh(t(c)),p={id:u,termFrequencies:{},maxTermFrequency:0};let f=0;d.forEach(g=>{var y,v;const h=fg(g);Object.hasOwn(s,h)||(s[h]=new Set),(y=s[h])==null||y.add(g),Object.hasOwn(a,h)||(a[h]=new Set),(v=a[h])==null||v.add(p),h in p.termFrequencies||(p.termFrequencies[h]=0),p.termFrequencies[h]++,f=Math.max(f,p.termFrequencies[h])}),p.maxTermFrequency=f});const n=Object.keys(a);return{query:c=>{const u={results:[],matchedQueryTerms:[]},d=new Set(zh(c).map(h=>fg(h)));if(d.size===0)return u;const p=new Map,f=new Set;d.forEach(h=>{n.forEach(y=>{var S;const{similarity:v}=XS(h,y),w=y===h,$=v>=1-o.fuzzyMatchSensitivity;if(w||$){const T=a[y],q=aB(e.length,T.size);T.forEach(_=>{const N=p.get(_.id)??0,Y=sB(y,_),G=w?o.scoreForExactMatch:0,xe=$?o.scoreForSimilarMatch:0,Fe=(G+xe)*q*Y;p.set(_.id,N+Fe)}),(S=s[y])==null||S.forEach(_=>{f.add(_)})}})});const g=[...p].sort((h,y)=>y[1]-h[1]).map(h=>e[h[0]]);return u.results=g,u.matchedQueryTerms=[...f],u}}},Fu={},Ru=100;let ts=1;function nB(e,t,o){if(e in Fu)return Fu[e];const a=iB(t,o);return Fu[e]=a,a}function Du(e,t){return t.length===0?e:Ux(e,'.,"/#!$%^&*;:{}=-_`~() '.split("")).map(s=>t.find(l=>s.startsWith(l))!==void 0?`<span class="highlight">${s}</span>`:s).join("")}function rB(e){if(!Wo.isOpen())return[];const t=i("#quoteSearchModal .quoteLengthFilter").val();if(t.length===0)return e;const o=new Set(t.map(s=>parseInt(s,10)));return e.filter(s=>o.has(s.group))}function lB(e){if(!Wo.isOpen())return[];const t=document.querySelector(".toggleFavorites").classList.contains("active");return e.filter(a=>t?yt.isQuoteFavorite(a):!0)}function cB(e,t){let o;e.length<101?o="short":e.length<301?o="medium":e.length<601?o="long":o="thicc";const a=!F(),s=!a&&yt.isQuoteFavorite(e);return`
  <div class="searchResult" data-quote-id="${e.id}">

    <div class="text">
      ${Du(e.text,t)}
    </div>

    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${Du(e.id.toString(),t)}
      </span>
    </div>

    <div class="length">
      <div class="sub">length</div>
      ${o}
    </div>

    <div class="source">
      <div class="sub">source</div>
      ${Du(e.source,t)}
    </div>

    <div class="textButton report ${a&&"hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>

    <div class="textButton favorite ${a&&"hidden"}" aria-label="Favorite quote" data-balloon-pos="left">
      <i class="${s?"fas":"far"} fa-heart favorite"></i>
    </div>

  </div>
  `}async function rd(e){var f,g;if(!Wo.isOpen())return;const{quotes:t}=await yt.getQuotes(r.language),o=nB(r.language,t,h=>`${h.text} ${h.id} ${h.source}`),{results:a,matchedQueryTerms:s}=o.query(e),n=rB(lB(e===""?t:a)),l=i("#quoteSearchResults");l.empty();const c=Math.ceil(n.length/Ru);if(ts>=c?i("#quoteSearchPageNavigator .nextPage").prop("disabled",!0):i("#quoteSearchPageNavigator .nextPage").prop("disabled",!1),ts<=1?i("#quoteSearchPageNavigator .prevPage").prop("disabled",!0):i("#quoteSearchPageNavigator .prevPage").prop("disabled",!1),n.length===0){i("#quoteSearchModal  .pageInfo").html("No search results");return}const u=(ts-1)*Ru,d=Math.min(ts*Ru,n.length);i("#quoteSearchModal  .pageInfo").html(`${u+1} - ${d} of ${n.length}`),n.slice(u,d).forEach(h=>{const y=cB(h,s);l.append(y)});const p=Wo.getModal().querySelectorAll(".searchResult");for(const h of p){const y=parseInt(h.dataset.quoteId);(f=h.querySelector(".textButton.favorite"))==null||f.addEventListener("click",v=>{if(v.stopPropagation(),y===void 0||isNaN(y)){m("Could not toggle quote favorite: quote id is not a number",-1);return}fB(`${y}`)}),(g=h.querySelector(".textButton.report"))==null||g.addEventListener("click",v=>{if(v.stopPropagation(),y===void 0||isNaN(y)){m("Could not open quote report modal: quote id is not a number",-1);return}SC(y,{modalChain:Wo})}),h.addEventListener("click",v=>{Cp(y),uB(y)})}}let Jn;async function zm(e){Wo.show({...e,focusFirstInput:!0,beforeAnimation:async()=>{var a;F()?(i("#quoteSearchModal .goToQuoteSubmit").removeClass("hidden"),i("#quoteSearchModal .toggleFavorites").removeClass("hidden")):(i("#quoteSearchModal .goToQuoteSubmit").addClass("hidden"),i("#quoteSearchModal .toggleFavorites").addClass("hidden"));const t=(a=x())==null?void 0:a.quoteMod;t!==void 0&&(t===!0||t!=="")?i("#quoteSearchModal .goToQuoteApprove").removeClass("hidden"):i("#quoteSearchModal .goToQuoteApprove").addClass("hidden"),Jn=new lt({select:"#quoteSearchModal .quoteLengthFilter",settings:{showSearch:!1,placeholderText:"filter by length",contentLocation:Wo.getModal()},data:[{text:"short",value:"0"},{text:"medium",value:"1"},{text:"long",value:"2"},{text:"thicc",value:"3"}]})},afterAnimation:async()=>{const t=i("#quoteSearchModal input").val();ts=1,rd(t)}})}function dB(e=!1){Wo.hide({clearModalChain:e})}function uB(e){if(isNaN(e)&&(e=parseInt(document.getElementById("searchBox").value)),e!==null&&!isNaN(e)&&e>=0)Ld([-2],!1),Cp(e),oe();else{m("Quote ID must be at least 1",0);return}W(),dB(!0)}const Wu=$t(250,()=>{if(!Wo.isOpen())return;const e=document.getElementById("searchBox").value;ts=1,rd(e)});async function fB(e){const t=r.language;if(t===void 0||e===""){m("Could not get quote stats!",-1);return}const o={language:t,id:parseInt(e,10)},a=yt.isQuoteFavorite(o),s=i(`#quoteSearchModal .searchResult[data-quote-id=${e}] .textButton.favorite i`);if(x())if(a)try{te(),await yt.setQuoteFavorite(o,!1),V(),s.removeClass("fas").addClass("far")}catch(l){V();const c=re(l,"Failed to remove quote from favorites");m(c,-1)}else try{te(),await yt.setQuoteFavorite(o,!0),V(),s.removeClass("far").addClass("fas")}catch(l){V();const c=re(l,"Failed to add quote to favorites");m(c,-1)}}async function pB(e){var t,o,a,s,n,l,c;(t=e.querySelector(".searchBox"))==null||t.addEventListener("input",u=>{Wu()}),(o=e.querySelector("button.toggleFavorites"))==null||o.addEventListener("click",u=>{F()&&(i(u.target).toggleClass("active"),Wu())}),(a=e.querySelector(".goToQuoteApprove"))==null||a.addEventListener("click",u=>{Vq({modalChain:Wo})}),(s=e.querySelector(".goToQuoteSubmit"))==null||s.addEventListener("click",async u=>{var f;te();const d=await E.quotes.isSubmissionEnabled(),p=(d.status===200&&((f=d.body.data)==null?void 0:f.isEnabled))??!1;if(V(),!p){m("Quote submission is disabled temporarily due to a large submission queue.",0,{duration:5});return}Hq({modalChain:Wo})}),(n=e.querySelector(".quoteLengthFilter"))==null||n.addEventListener("change",Wu),(l=e.querySelector(".nextPage"))==null||l.addEventListener("click",()=>{const u=document.getElementById("searchBox").value;ts++,rd(u)}),(c=e.querySelector(".prevPage"))==null||c.addEventListener("click",()=>{const u=document.getElementById("searchBox").value;ts--,rd(u)})}async function mB(){Jn==null||Jn.destroy(),Jn=void 0}const Wo=new le({dialogId:"quoteSearchModal",setup:pB,cleanup:mB});let bc=0,op,ap,Hm=!0;const _s=document.querySelector("#fpsCounter");function TC(e){if(Hm)return;const t=e-ap;if(bc++,t>500){const o=U(bc*1e3/t).toFixed(2);bc=0,ap=e,yB(o)}window.requestAnimationFrame(TC)}function gB(){Hm=!1,bc=0,ap=performance.now(),op||(op=window.requestAnimationFrame(TC)),_s.classList.remove("hidden")}function hB(){cancelAnimationFrame(op),Hm=!0,_s.classList.add("hidden")}async function yB(e){_s.innerHTML=`FPS ${e}`;const t=parseFloat(e);_s.classList.remove("error"),_s.classList.remove("main"),t<30?_s.classList.add("error"):t>55&&_s.classList.add("main")}const Om=Rb();Om.then(e=>{nq(e)}).catch(e=>{console.error(re(e,"Failed to update challenges commands"))});const LC=Be("language"),$C=Be("difficulty"),MC=Be("blindMode"),AC=Be("oppositeShiftMode"),EC=Be("stopOnError"),_C=Be("confidenceMode"),IC=Be("lazyMode"),qC=Be("layout"),BC=Be("showAverage"),FC=Be("keymapLayout"),RC=Be("customTheme"),DC=Be("ads"),WC=Be("minWpm"),PC=Be("minAcc"),zC=Be("paceCaret"),Nm={title:"",list:[...MI,Be("punctuation"),Be("numbers"),Be("mode"),Be("time"),Be("words"),Be("quoteLength"),LC,{id:"changeCustomModeText",display:"Change custom text",icon:"fa-align-left",exec:()=>{Dm()}},{id:"viewQuoteSearchPopup",display:"Search for quotes",icon:"fa-search",exec:()=>{gt("quote"),zm()},shouldFocusTestUI:!1},...gE,...mE,{id:"shareTestSettings",display:"Share test settings",icon:"fa-share",exec:async()=>{Wm()}},...G0,...oq,...Yw,...xs($C,"quickRestart","repeatQuotes",MC,"alwaysShowWordsHistory","singleListCommandLine",WC,PC,...ov,"britishEnglish",...X0,"customLayoutfluid","customPolyglot"),...xs("freedomMode","strictSpace",AC,EC,_C,"quickEnd","indicateTypos","hideExtraLetters",IC,qC,"codeUnindentOnBackspace"),...xs("soundVolume","playSoundOnClick","playSoundOnError","playTimeWarning"),...xs("smoothCaret","caretStyle",zC,"repeatedPace","paceCaretStyle"),...xs("timerStyle","liveSpeedStyle","liveAccStyle","liveBurstStyle","timerColor","timerOpacity","highlightMode","tapeMode","tapeMargin","smoothLineScroll","showAllLines","typingSpeedUnit","alwaysShowDecimalPlaces","startGraphsAtZero","maxLineWidth","fontSize",...zI,"keymapMode","keymapStyle","keymapLegendStyle","keymapSize",FC,"keymapShowTopRow"),...xs(...eC,RC,...KI,"flipTestColors","colorfulMode",...NI,...PI,"customBackgroundSize",...OI,"randomTheme"),{id:"randomizeTheme",display:"Next random theme",icon:"fa-random",exec:async()=>aw(),available:()=>r.randomTheme!=="off"},...xs("showKeyTips","showOutOfFocusWarning","capsLockWarning",BC,"monkeyPowerLevel","monkey"),DC,...oC,...SI,{id:"watchVideoAd",display:"Watch video ad",alias:"support donate",icon:"fa-ad",exec:()=>{hC()}},{id:"importSettingsJSON",display:"Import settings JSON",icon:"fa-cog",alias:"import config",input:!0,exec:async({input:e})=>{e===void 0||e===""||await qb(e)}},{id:"exportSettingsJSON",display:"Export settings JSON",icon:"fa-cog",alias:"export config",input:!0,defaultValue:()=>JSON.stringify(r)},{id:"clearNotifications",display:"Clear all notifications",icon:"fa-trash-alt",alias:"dismiss",exec:async()=>{B1()}},{id:"clearSwCache",display:"Clear SW cache",icon:"fa-cog",exec:async()=>{const e=await caches.keys();for(const t of e)await caches.delete(t);window.location.reload()}},{id:"getSwCache",display:"Get SW cache",icon:"fa-cog",exec:async()=>{alert(await caches.keys())}},{id:"copyResultStats",display:"Copy result stats",icon:"fa-cog",visible:!1,exec:async()=>{navigator.clipboard.writeText(JSON.stringify(Rv())).then(()=>{m("Copied to clipboard",1)}).catch(e=>{const t=re(e,"Failed to copy to clipboard");m(t,-1)})}},{id:"fpsCounter",display:"FPS counter...",icon:"fa-cog",visible:!1,subgroup:{title:"FPS counter...",list:[{id:"startFpsCounter",display:"show",icon:"fa-cog",exec:()=>{gB()}},{id:"stopFpsCounter",display:"hide",icon:"fa-cog",exec:()=>{hB()}}]}},{id:"joinDiscord",display:"Join the Discord server",icon:"fa-users",exec:()=>{window.open("https://discord.gg/monkeytype")}}]};var cy,dy,uy,fy,py,my;const HC={keymapLayouts:FC.subgroup,enableAds:DC.subgroup,customThemesList:RC.subgroup,themes:(cy=eC[0])==null?void 0:cy.subgroup,loadChallenge:(dy=oC[0])==null?void 0:dy.subgroup,languages:LC.subgroup,difficulty:$C.subgroup,lazyMode:IC.subgroup,paceCaretMode:zC.subgroup,showAverage:BC.subgroup,minWpm:WC.subgroup,minAcc:PC.subgroup,minBurst:(uy=ov[0])==null?void 0:uy.subgroup,funbox:(fy=X0[0])==null?void 0:fy.subgroup,confidenceMode:_C.subgroup,stopOnError:EC.subgroup,layouts:qC.subgroup,oppositeShiftMode:AC.subgroup,tags:(py=G0[0])==null?void 0:py.subgroup,resultSaving:(my=Yw[0])==null?void 0:my.subgroup,blindMode:MC.subgroup};function bB(e){return HC[e]!==void 0}async function vB(e){await Promise.allSettled([Om]);const t=HC[e];if(!t)throw m(`List not found: ${e}`,-1),new Error(`List ${e} not found`);return t}let ci=[];ci=[Nm];function wB(){return ci.length}function CB(){kB([Nm])}function kB(e){ci=e}function SB(e){ci.push(e)}function xB(){ci.pop()}function TB(){return ci[ci.length-1]}let Hh;async function LB(){await Promise.allSettled([Om]);const e=[];for(const t of Nm.list){const o=OC(t);e.push(...o)}return Hh={title:"",list:e},Hh}function OC(e,t){var a;const o=[];if(e.subgroup){e.subgroup.beforeList&&e.subgroup.beforeList();const s={...e,subgroup:{...e.subgroup,list:[]}};for(const n of e.subgroup.list)o.push(...OC(n,s))}else if(t){const s=t.display.replace(/\s?\.\.\.$/g,""),n=s+'<i class="fas fa-fw fa-chevron-right chevronIcon"></i>'+e.display,l=s+" "+e.display;let c;((t.alias??"")||(e.alias??""))&&(c=[t.alias,e.alias].filter(Boolean).join(" "));const u={...e,singleListDisplay:n,singleListDisplayNoIcon:l,configKey:(a=t.subgroup)==null?void 0:a.configKey,icon:t.icon,alias:c,visible:(t.visible??!0)&&(e.visible??!0),available:async()=>{var d,p;return(await((d=t==null?void 0:t.available)==null?void 0:d.call(t))??!0)&&(await((p=e==null?void 0:e.available)==null?void 0:p.call(e))??!0)}};o.push(u)}else o.push(e);return o}function xs(...e){return e.map(t=>typeof t=="string"?Be(t):t)}let qt=0,Nt=!1,Zt="",ld=null,Oi=!1,Ma="search",$e={command:null,placeholder:"",value:"",icon:""},os=null,Zr=!1,sp="",er;function $B(){i("#commandLine").addClass("noBackground"),r.showOutOfFocusWarning&&xn()}function ip(){i("#commandLine").removeClass("noBackground");const e=i("#wordsInput").is(":focus");r.showOutOfFocusWarning&&!e&&sv()}function bi(e,t){aa.show({...t,focusFirstInput:!0,beforeAnimation:async()=>{Oi=!1,Zt="",qt=0,Ma="search",vc=null,$e={command:null,placeholder:null,value:null,icon:null},(e==null?void 0:e.subgroupOverride)!==void 0?(typeof e.subgroupOverride=="string"?bB(e.subgroupOverride)?(te(),os=await vB(e.subgroupOverride),V()):(os=null,Nt=r.singleListCommandLine==="on",m(`Command list ${e.subgroupOverride} not found`,0)):os=e.subgroupOverride,Nt=!1):(os=null,Nt=r.singleListCommandLine==="on");let o;if((e==null?void 0:e.commandOverride)!==void 0){const a=(await du()).find(s=>s.id===e.commandOverride);a===void 0?m(`Command ${e.commandOverride} not found`,0):(a==null?void 0:a.input)!==!0?m(`Command ${e.commandOverride} is not an input command`,0):o=a}e!=null&&e.singleListOverride&&(Nt=e.singleListOverride),ld=null,zo(!1),CB(),await fi(),await di(),await ui(),await Bo(),setTimeout(()=>{var a;if(NC(),o){const s=o.display.split("</i>")[1]??o.display;Ma="input",$e={command:o,placeholder:s,value:((a=o.defaultValue)==null?void 0:a.call(o))??"",icon:o.icon??"fa-chevron-right"},VC(o),fi($e.value),Um()}},1)}})}function lu(e=!1){Gf(),zr(),ee()==="test"&&fn(),Zr=!0,aa.hide({clearModalChain:e,afterAnimation:async()=>{var t;if(cd(),ip(),ee()==="test"){const o=i("#wordsInput").is(":focus");ee()==="test"&&!o&&fn()}else(t=document.activeElement)==null||t.blur();Zr=!1}})}async function MB(){if(Ma==="input"){Ma="search",$e={command:null,placeholder:null,value:null,icon:null},await fi(""),await di(),await ui(),await Bo(),cd();return}wB()>1?(xB(),qt=0,await fi(""),await di(),await ui(),await Bo(),cd()):lu()}async function di(){var u,d,p;const e=await cu();(u=e.beforeList)==null||u.call(e);const t=e.list,o=Zt.replace(/^>/gi,"").toLowerCase().trim(),a=o.length===0?[]:o.split(" "),s=[],n=[];for(const f of t){if(!(await((d=f.available)==null?void 0:d.call(f))??!0)){s.push({matchCount:-1,matchStrength:-1});continue}if(o.length===0||a.length===0){s.push({matchCount:0,matchStrength:0});continue}const h=(Nt&&(f.singleListDisplayNoIcon??"")||f.display).toLowerCase().split(" "),y=((p=f.alias)==null?void 0:p.toLowerCase().split(" "))??[],v=h.concat(y),w=v.map(()=>null);let $=0;for(const[T,q]of a.entries())for(const[_,N]of v.entries()){const Y=w[_];N.startsWith(q)&&Y===null&&!w.includes(T)&&(w[_]=T,$+=q.length)}const S=w.filter(T=>T!==null).length;n.push(S),s.push({matchCount:S,matchStrength:$})}const l=Math.max(...s.map(f=>f.matchStrength));let c=a.length;do{if(n.filter(g=>g>=c).length>0)break;c--}while(c>0);c===0&&(c=1);for(const[f,g]of t.entries()){const h=s[f];if(h===void 0){g.found=!1;continue}h.matchCount>=c&&h.matchStrength>=l?g.found=!0:g.found=!1}}function Um(){const e=document.querySelector("#commandLine .suggestions");if(e===null)throw new Error("Commandline element not found");e.innerHTML="",er=void 0}let vc=null;async function cu(){if(os!==null)return os;if(Nt)if(vc===null)vc=await LB();else return vc;return TB()}async function du(){return(await cu()).list}function AB(e){let t='<i class="fas fa-fw fa-chevron-right"></i>';if(e.icon!==void 0&&e.icon!==""){const a=e.icon.startsWith("fa-"),n=(e.iconType??"solid")==="solid"?"fas":"far";a?t=`<i class="${n} fa-fw ${e.icon}"></i>`:t=`<div class="textIcon">${e.icon}</div>`}let o='<i class="fas fa-fw"></i>';return e.isActive&&(o='<i class="fas fa-fw fa-check"></i>'),{iconHtml:t,configIconHtml:o}}async function ui(){const e=document.querySelector("#commandLine .suggestions");if(e===null)throw new Error("Commandline element not found");if(Zt===""&&Nt){Um();return}const t=await cu(),o=t.list.filter(n=>n.found===!0).map(n=>{let l=!1;if(n.active!==void 0)l=n.active();else{const c=n.configKey??t.configKey;c!==void 0&&(n.configValueMode==="include"?Array.isArray(n.configValue)?l=ps(Fy(r[c],n.configValue),n.configValue):l=r[c].includes(n.configValue):l=r[c]===n.configValue)}return{...n,isActive:l}});if(er&&Nt===er.usingSingleList&&br(o,er.list))return;er={list:o,usingSingleList:Nt};let a="",s=0;for(const n of o){if(n.found!==!0)continue;let l="";n.customStyle!==void 0&&n.customStyle!==""&&(l=n.customStyle);const{iconHtml:c,configIconHtml:u}=AB(n);let d=n.display;Nt&&(d=(n.singleListDisplay??"")||n.display,(n.configValue!==void 0||n.active!==void 0)&&(d=d.replace('<i class="fas fa-fw fa-chevron-right chevronIcon"></i>','<i class="fas fa-fw fa-chevron-right chevronIcon"></i>'+u)));let p=c;if((!Nt&&n.subgroup===void 0&&n.configValue!==void 0||!Nt&&n.active!==void 0)&&(p=u),n.customData!==void 0){if(n.id.startsWith("changeTheme")&&(a+=`<div class="command changeThemeCommand" data-command-id="${n.id}" data-index="${s}" style="${l}">
      <div class="icon">${p}</div><div>${d}</div>
      <div class="themeFavIcon ${n.customData.isFavorite===!0?"":"hidden"}">
        <i class="fas fa-star"></i>
      </div>
      <div class="themeBubbles" style="background: ${n.customData.bgColor};outline: 0.25rem solid ${n.customData.bgColor};">
        <div class="themeBubble" style="background: ${n.customData.mainColor}"></div>
        <div class="themeBubble" style="background: ${n.customData.subColor}"></div>
        <div class="themeBubble" style="background: ${n.customData.textColor}"></div>
      </div>
      </div>`),n.id.startsWith("setFontFamily")){let f=n.customData.name;f==="Helvetica"&&(f="Comic Sans MS"),n.customData.isSystem===!1&&(f+=" Preview"),a+=`<div class="command" data-command-id="${n.id}" data-index="${s}" style="font-family: '${f}'"><div class="icon">${p}</div><div>${d}</div></div>`}}else a+=`<div class="command" data-command-id="${n.id}" data-index="${s}" style="${l}"><div class="icon">${p}</div><div>${d}</div></div>`;s++}e.innerHTML=a}async function Bo(){var a;if(Zr)return;const e=[...document.querySelectorAll("#commandLine .suggestions .command")];for(const s of e)s.classList.remove("active");const t=e[qt],o=(await du()).filter(s=>s.found)[qt];if(ld=o??null,t===void 0||o===void 0){Gf(),zr(!1),ip();return}t.classList.add("active"),NC(),Gf(),/changeTheme.+/gi.test(o.id)?$B():(zr(!1),ip()),(a=o.hover)==null||a.call(o)}function EB(){var e,t,o,a,s,n;if(!Zr){if($e.command===null)throw new Error("Can't handle input submit - command is null");if(((e=$e.validation)==null?void 0:e.status)!=="checking"){if(((t=$e.validation)==null?void 0:t.status)==="failed"){const l=i("#commandLine .modal");l.stop(!0,!0).addClass("hasError").animate({undefined:1},500,()=>{l.removeClass("hasError")});return}"inputValueConvert"in $e.command?(a=(o=$e.command).exec)==null||a.call(o,{commandlineModal:aa,input:$e.command.inputValueConvert(Zt)}):(n=(s=$e.command).exec)==null||n.call(s,{commandlineModal:aa,input:Zt}),si("usedCommandLine",{command:$e.command.id}),lu()}}}async function Oh(){var t,o;if(Zr||ld===null)return;const e=ld;if(e.input){const a=e.display.split("</i>")[1]??e.display;Ma="input",$e={command:e,placeholder:a,value:((t=e.defaultValue)==null?void 0:t.call(e))??"",icon:e.icon??"fa-chevron-right"},VC(e),await fi($e.value),Um()}else e.subgroup?(SB(e.subgroup),await fi(""),await di(),await ui(),await Bo()):((o=e.exec)==null||o.call(e,{commandlineModal:aa}),r.singleListCommandLine==="on"&&(sp=Zt),e.sticky??!1?(await di(),await ui(),await Bo()):(si("usedCommandLine",{command:e.id}),e.opensModal||lu(!0)))}let Nh;function NC(){if(Oi)return;const e=document.querySelector(".suggestions .command.active");e===null||e.dataset.index===Nh||(e.scrollIntoView({behavior:"auto",block:"center"}),Nh=e.dataset.index)}async function fi(e){const t=document.querySelector("#commandLine .searchicon"),o=document.querySelector("#commandLine input");if(o===null||t===null)throw new Error("Commandline element or icon element not found");if(e!==void 0&&(Zt=e),o.value=Zt,Ma==="input")$e.icon!==null&&(t.innerHTML=`<i class="fas fa-fw ${$e.icon}"></i>`),$e.placeholder!==null&&(o.placeholder=$e.placeholder),$e.value!==null&&(o.value=$e.value,o.setSelectionRange(0,o.value.length));else{t.innerHTML='<i class="fas fa-fw fa-search"></i>',o.placeholder="Search...";const a=await cu();a.title!==void 0&&a.title!==""&&(o.placeholder=`${a.title}`);let s=Zt.length;e!==void 0&&(s=e.length),setTimeout(()=>{o.setSelectionRange(s,s)},0)}}async function Uh(){qt++,qt>=(await du()).filter(e=>e.found).length&&(qt=0),await Bo()}async function Vh(){qt--,qt<0&&(qt=(await du()).filter(e=>e.found).length-1),await Bo()}function _B(e){const t=aa.getModal().querySelector(".warning"),o=aa.getModal().querySelector(".warning .text");if(t===null||o===null)throw new Error("Commandline warning element not found");t.classList.remove("hidden"),o.textContent=e}const UC=$t(200,async()=>{const e=aa.getModal().querySelector(".checkingicon");if(e===null)throw new Error("Commandline checking icon element not found");e.classList.remove("hidden")});function Kh(){UC.cancel({upcomingOnly:!0});const e=aa.getModal().querySelector(".checkingicon");if(e===null)throw new Error("Commandline checking icon element not found");e.classList.add("hidden")}function cd(){const e=aa.getModal().querySelector(".warning");if(e===null)throw new Error("Commandline warning element not found");e.classList.add("hidden")}function IB(e){$e.validation=e,e.status==="checking"?UC():e.status==="failed"&&e.errorMessage!==void 0?(_B(e.errorMessage),Kh()):(cd(),Kh())}const np=new Map;function VC(e){if("validation"in e&&!np.has(e.id)){const t=e,o=Xw(IB,t.validation,"inputValueConvert"in t?t.inputValueConvert:void 0);np.set(e.id,o)}}const aa=new le({dialogId:"commandLine",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{lu()},showOptionsWhenInChain:{focusFirstInput:!0},setup:async e=>{const t=e.querySelector("input");t.addEventListener("input",$t(50,async s=>{Zt=s.target.value,os===null&&(r.singleListCommandLine==="on"?Nt=!0:Nt=Zt.startsWith(">")),Ma==="search"&&(Oi=!1,qt=0,await di(),await ui(),await Bo())})),t.addEventListener("keydown",async s=>{if(Oi=!1,s.key==="ArrowUp"||s.ctrlKey&&(s.key.toLowerCase()==="k"||s.key.toLowerCase()==="p")){if(r.singleListCommandLine==="on"&&os===null&&Zt===""&&sp!==""){Zt=sp,await fi(),await di(),await ui(),await Bo();return}s.preventDefault(),await Vh()}if((s.key==="ArrowDown"||s.ctrlKey&&(s.key.toLowerCase()==="j"||s.key.toLowerCase()==="n"))&&(s.preventDefault(),await Uh()),s.key==="Tab"&&(s.preventDefault(),s.shiftKey?await Vh():await Uh()),s.key==="Enter")if(s.preventDefault(),Ma==="search")await Oh();else if(Ma==="input")EB();else throw new Error("Unknown mode, can't handle enter press");s.key==="Escape"&&(s.preventDefault(),s.stopPropagation(),await MB())}),t.addEventListener("input",async s=>{if($e===null||$e.command===null||!("validation"in $e.command))return;const n=np.get($e.command.id);if(n===void 0)throw new Error(`Expected handler for command ${$e.command.id} is missing`);await n(s)}),e.addEventListener("mousemove",s=>{Oi=!0});const o=document.querySelector(".suggestions");let a;o.addEventListener("mousemove",async s=>{Oi=!0;const n=s.target;if(n===a)return;const l=hg(n==null?void 0:n.getAttribute("data-index"));l!==void 0&&(a=s.target,qt=l,await Bo())}),o.addEventListener("click",async s=>{const n=s.target,l=hg(n==null?void 0:n.getAttribute("data-index"));if(l===void 0)return;const c=qt;qt=l,c!==qt&&await Bo(),await Oh()})}});document.addEventListener("keydown",async e=>{Ks()||e.key!==void 0&&(e.key==="Escape"&&r.quickRestart!=="esc"||e.key==="Tab"&&r.quickRestart==="esc"&&!Tr&&!e.shiftKey||e.key==="Tab"&&r.quickRestart==="esc"&&Tr&&e.shiftKey||e.key.toLowerCase()==="p"&&(e.metaKey||e.ctrlKey)&&e.shiftKey)&&(e.preventDefault(),md()||bi())});window.onerror=function(e,t,o,a,s){};window.onunhandledrejection=function(e){};function KC(){GC.show()}const GC=new le({dialogId:"supportModal",setup:async e=>{var t;(t=e.querySelector("button.ads"))==null||t.addEventListener("click",async()=>{bi({subgroupOverride:"enableAds"},{modalChain:GC})})}});function jC(){qB.show()}const qB=new le({dialogId:"contactModal"});function BB(){FB.show({beforeAnimation:async()=>{i("#versionHistoryModal .modal").html(`
    <div class="preloader">
      <i class="fas fa-fw fa-spin fa-circle-notch"></i>
    </div
  `),cL().then(e=>{i("#versionHistoryModal .modal").html('<div class="releases"></div'),e.forEach(t=>{if(!t.draft&&!t.prerelease){let o=t.body;o=o.replace(/\r\n/g,"<br>"),o=o.replace(/### (.*?)<br>/g,"<h3>$1</h3>"),o=o.replace(/<\/h3><br>/gi,"</h3>"),o=o.replace(/^- /gm,""),o=o.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),o=o.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>'),i("#versionHistoryModal .modal .releases").append(`
        <div class="release">
          <div class="title">${t.name}</div>
          <div class="date">${ae(new Date(t.published_at),"dd MMM yyyy")}</div>
          <div class="body">${o}</div>
        </div>
      `)}})}).catch(e=>{const t=re(e,"Failed to fetch version history");i("#versionHistoryModal .modal").html(`<div class="releases">${t}</div`)}),i("#newVersionIndicator").addClass("hidden")}})}const FB=new le({dialogId:"versionHistoryModal"});var gy;(gy=document.querySelector("footer #commandLineMobileButton"))==null||gy.addEventListener("click",async()=>{bi({singleListOverride:!1})});var hy;(hy=document.querySelector("footer #newVersionIndicator"))==null||hy.addEventListener("click",e=>{var t;e.stopPropagation(),(t=document.querySelector("#newVersionIndicator"))==null||t.classList.add("hidden")});var yy;(yy=document.querySelector("footer .currentVersion"))==null||yy.addEventListener("click",e=>{e.shiftKey?alert(JSON.stringify({clientVersion:wn.clientVersion,clientCompatibility:Gu,lastSeenServerCompatibility:tb},null,2)):BB()});var by;(by=document.querySelector("footer .right .current-theme"))==null||by.addEventListener("click",async e=>{var o,a;if(e.shiftKey){if(r.customTheme){Sa(!1);return}if(F()&&(((a=(o=x())==null?void 0:o.customThemes)==null?void 0:a.length)??0)<1){m("No custom themes!",0),Sa(!1);return}Sa(!0)}else{const s=r.customTheme?"customThemesList":"themes";bi({subgroupOverride:s})}});var vy;(vy=document.querySelector("footer #supportMeButton"))==null||vy.addEventListener("click",()=>{KC()});var wy;(wy=document.querySelector("footer #contactPopupButton"))==null||wy.addEventListener("click",()=>{jC()});i("#keymap").on("click",".r5 .layoutIndicator",async()=>{bi({subgroupOverride:"keymapLayouts"})});function QC(e){Vm.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.words}`}})}function RB(e=!1){Vm.hide({clearModalChain:e})}function DB(){var t;const e=parseInt((t=Vm.getModal().querySelector("input"))==null?void 0:t.value,10);e!==null&&!isNaN(e)&&e>=0&&isFinite(e)?Qs(e)&&(oe(),W(),e>2e3?m("Stay safe and take breaks!",0):e===0&&m("Infinite words! Make sure to use Bail Out from the command line to save your result.",0,{duration:7})):m("Custom word amount must be at least 1",0),RB(!0)}const Vm=new le({dialogId:"customWordAmountModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),DB()})}}),We={resultId:"",startingTags:[],tags:[],source:"accountPage"};function YC(e,t,o){if(!it()){m("You are offline",0,{duration:2});return}if(e===""){m("Failed to show edit result tags modal: result id is empty",-1);return}We.resultId=e,We.startingTags=[...t],We.tags=[...t],We.source=o,Km.show({beforeAnimation:async()=>{WB(),XC()}})}function Gh(){Km.hide()}function WB(){var o,a;const e=Km.getModal().querySelector(".buttons");if(e===null){m("Failed to append buttons to edit result tags modal: could not find buttons element",-1);return}const t=new Set([...((o=x())==null?void 0:o.tags.map(s=>s._id))??[],...We.tags]);e.innerHTML="";for(const s of t){const n=(a=x())==null?void 0:a.tags.find(c=>c._id===s),l=document.createElement("button");l.classList.add("toggleTag"),l.setAttribute("data-tag-id",s),l.innerHTML=(n==null?void 0:n.display)??"unknown tag",l.addEventListener("click",c=>{PB(s),XC()}),e.appendChild(l)}}function XC(){for(const e of i("#editResultTagsModal .modal .buttons button")){const t=i(e).attr("data-tag-id")??"";We.tags.includes(t)?i(e).addClass("active"):i(e).removeClass("active")}}function PB(e){We.tags.includes(e)?We.tags=We.tags.filter(t=>t!==e):We.tags.push(e)}async function zB(){var o,a,s;te();const e=await E.results.updateTags({body:{resultId:We.resultId,tagIds:We.tags}});if(V(),We.tags=We.tags.filter(n=>n!==void 0),e.status!==200){m("Failed to update result tags: "+e.body.message,-1);return}const t=((o=e.body.data)==null?void 0:o.tagPbs)??[];m("Tags updated",1,{duration:2}),(s=(a=x())==null?void 0:a.results)==null||s.forEach(n=>{n._id===We.resultId&&(n.tags=We.tags)}),We.source==="accountPage"?f_(We.resultId,We.tags):We.source==="resultPage"&&C2(We.tags,t)}const Km=new le({dialogId:"editResultTagsModal",setup:async e=>{var t;(t=e.querySelector("button.saveButton"))==null||t.addEventListener("click",o=>{if(ps(We.startingTags,We.tags)){Gh();return}Gh(),zB()})}});function ZC(e){const t=/((-\s*)?\d+(\.\d+)?\s*[hms]?)/g,o=[...e.toLowerCase().matchAll(t)].map(a=>{const s=a[0],n=parseFloat(s.replace(/\s+/g,""));return s.includes("h")?3600*n:s.includes("m")?60*n:n}).reduce((a,s)=>a+s,0);return Math.floor(o)}function HB(e){const t=Math.floor(e/3600),o=Math.floor(e%3600/60),a=e%3600%60,s=[];return t>0&&s.push(`${t} hour${t===1?"":"s"}`),o>0&&s.push(`${o} minute${o===1?"":"s"}`),a>0&&s.push(`${a} second${a===1?"":"s"}`),s.length===3?`${s[0]}, ${s[1]} and ${s[2]}`:s.length===2?`${s[0]} and ${s[1]}`:`${s[0]}`}function JC(){const e=i("#customTestDurationModal input").val(),t=ZC(e);let o="";t<0?o="Negative time? Really?":t===0?o="Infinite test":o=HB(t),i("#customTestDurationModal .preview").text(o)}function ek(e){tk.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.time}`,JC()}})}function OB(e=!1){tk.hide({clearModalChain:e})}function NB(){const e=ZC(i("#customTestDurationModal input").val());if(e!==null&&!isNaN(e)&&e>=0&&isFinite(e))wa(e),oe(),W(),e>=1800?m("Stay safe and take breaks!",0):e===0&&m("Infinite time! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});else{m("Custom time must be a positive number or zero",0);return}OB(!0)}async function UB(e){var t;e.addEventListener("submit",o=>{o.preventDefault(),NB()}),(t=e.querySelector("input"))==null||t.addEventListener("input",o=>{JC()})}const tk=new le({dialogId:"customTestDurationModal",setup:UB});function ok(){const e=i("#mobileTestConfigModal");if(e.find("button").removeClass("active"),e.find(`.modeGroup button[data-mode='${r.mode}']`).addClass("active"),e.find(".timeGroup").addClass("hidden"),e.find(".wordsGroup").addClass("hidden"),e.find(".quoteGroup").addClass("hidden"),e.find(".customGroup").addClass("hidden"),e.find(`.${r.mode}Group`).removeClass("hidden"),r.punctuation?e.find(".punctuation").addClass("active"):e.find(".punctuation").removeClass("active"),r.numbers?e.find(".numbers").addClass("active"):e.find(".numbers").removeClass("active"),r.mode==="time")e.find(`.timeGroup button[data-time='${r.time}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="words")e.find(`.wordsGroup button[data-words='${r.words}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="quote"){if(ps(r.quoteLength,[0,1,2,3]))e.find(".quoteGroup button[data-quoteLength='all']").addClass("active");else for(const t of r.quoteLength)e.find(`.quoteGroup button[data-quoteLength='${t}']`).addClass("active");e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")}else r.mode==="zen"?(e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")):r.mode==="custom"&&(e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled"))}function VB(){Ri.show({beforeAnimation:async()=>{ok()}})}async function KB(e){var l,c,u,d;const t=e.querySelectorAll(".wordsGroup button");for(const p of t)p.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-words");if(h==="custom")QC({modalChain:Ri});else if(h!==void 0){const y=parseInt(h);Qs(y),oe(),W()}});const o=e.querySelectorAll(".modeGroup button");for(const p of o)p.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-mode");h!==r.mode&&(gt(h),oe(),W())});const a=e.querySelectorAll(".timeGroup button");for(const p of a)p.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-time");if(h==="custom")ek({modalChain:Ri});else if(h!==void 0){const y=parseInt(h);wa(y),oe(),W()}});const s=e.querySelectorAll(".quoteGroup button");for(const p of s)p.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-quoteLength")??"0";if(h==="all")Gi()&&(oe(),W());else if(h==="-2")zm({modalChain:Ri});else{const y=parseInt(h,10);let v=[];f.shiftKey?v=[...r.quoteLength,y]:v=[y],Ld(v,!1)&&(oe(),W())}});(l=e.querySelector(".customChange"))==null||l.addEventListener("click",()=>{Dm({modalChain:Ri})}),(c=e.querySelector(".punctuation"))==null||c.addEventListener("click",()=>{ls(!r.punctuation),oe(),W()}),(u=e.querySelector(".numbers"))==null||u.addEventListener("click",()=>{ka(!r.numbers),oe(),W()}),(d=e.querySelector(".shareButton"))==null||d.addEventListener("click",()=>{Wm({modalChain:Ri})});const n=e.querySelectorAll("button");for(const p of n)p.addEventListener("click",()=>{ok()})}const Ri=new le({dialogId:"mobileTestConfigModal",setup:KB});i(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=i(e.currentTarget).attr("commands");t!==void 0&&bi({subgroupOverride:t})});i(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=i(e.currentTarget).attr("commandId");t!==void 0&&bi({commandOverride:t})});i(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{i(e.currentTarget).attr("wordCount")==="custom"&&QC()});i(".pageTest").on("click","#testConfig .time .textButton",e=>{i(e.currentTarget).attr("timeconfig")==="custom"&&ek()});i(".pageTest").on("click","#testConfig .shareButton",e=>{Wm()});i(".pageTest").on("click",".tags .editTagsButton",()=>{var e,t;if((((t=(e=x())==null?void 0:e.tags)==null?void 0:t.length)??0)>0){const o=i(".pageTest .tags .editTagsButton").attr("data-result-id"),a=i(".pageTest .tags .editTagsButton").attr("data-active-tag-ids"),s=a===""?[]:a.split(",");YC(o,s,"resultPage")}});i(".pageTest").on("click","#mobileTestConfigButton",()=>{VB()});i(".pageTest #rateQuoteButton").on("click",async()=>{if(J===null){m("Failed to show quote rating popup: no quote",-1);return}MA(J)});i(".pageTest #reportQuoteButton").on("click",async()=>{if(J===null){m("Failed to show quote report popup: no quote",-1);return}SC(J==null?void 0:J.id)});i(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{parseInt(i(e.currentTarget).attr("quoteLength")??"0")===-2&&zm()});i(".pageTest").on("click","#testConfig .customText .textButton",()=>{Dm()});i(".pageTest").on("click","#practiseWordsButton",()=>{if(r.mode==="zen"){m("Practice words is unsupported in zen mode",0);return}z0()});i(".pageTest #dailyLeaderboardRank").on("click",async()=>{Qe(`/leaderboards?type=daily&language=${r.language}&mode2=${pi(r,null)}&goToUserPage=true`)});var Cy;(Cy=document.querySelector("#pageAbout #supportMeAboutButton"))==null||Cy.addEventListener("click",()=>{KC()});var ky;(ky=document.querySelector("#pageAbout #contactPopupButton2"))==null||ky.addEventListener("click",()=>{jC()});const Gm={includeBackground:!1};function GB(){rp.show({beforeAnimation:async e=>{e.querySelector("input[type='checkbox']").checked=!1,Gm.includeBackground=!1}})}async function jB(){const e={c:qa.map(t=>i(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"))};return Gm.includeBackground&&(e.i=r.customBackground,e.s=r.customBackgroundSize,e.f=r.customBackgroundFilter),window.location.origin+"?customTheme="+btoa(JSON.stringify(e))}async function QB(){const e=await jB();try{await navigator.clipboard.writeText(e),m("URL Copied to clipboard",1),rp.hide()}catch{m("Looks like we couldn't copy the link straight to your clipboard. Please copy it manually.",0,{duration:5}),lp.show({modalChain:rp,focusFirstInput:"focusAndSelect",beforeAnimation:async o=>{o.querySelector("input").value=e}})}}const rp=new le({dialogId:"shareCustomThemeModal",setup:async e=>{var t,o;(t=e.querySelector("button"))==null||t.addEventListener("click",QB),(o=e.querySelector("input[type='checkbox']"))==null||o.addEventListener("change",a=>{Gm.includeBackground=a.target.checked})}}),lp=new le({dialogId:"shareCustomThemeUrlModal",customEscapeHandler:async()=>{await lp.hide({clearModalChain:!0})},customWrapperClickHandler:async()=>{await lp.hide({clearModalChain:!0})}}),YB=P.object({security:P.boolean(),analytics:P.boolean(),sentry:P.boolean()}).strict().nullable();function jm(){return ak.get()}function Pu(e){ak.set(e),sk()}const ak=new Gt({key:"acceptedCookies",schema:YB,fallback:null});function sk(){const e=jm();e!=null&&e.analytics&&tE(),e!=null&&e.sentry&&Sx()}function ik(e){Ds.show({beforeAnimation:async()=>{if(e){const t=jm();nk(t)}},afterAnimation:async()=>{Xt("cookiesModal")||Ds.destroy()}})}function nk(e){var t,o;(t=Ds.getModal().querySelector(".main"))==null||t.classList.add("hidden"),(o=Ds.getModal().querySelector(".settings"))==null||o.classList.remove("hidden"),e&&(e.analytics&&(Ds.getModal().querySelector(".cookie.analytics input").checked=!0),e.sentry&&(Ds.getModal().querySelector(".cookie.sentry input").checked=!0))}async function zu(){Ds.hide({afterAnimation:async()=>{fn()}})}const Ds=new le({dialogId:"cookiesModal",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{},setup:async e=>{var t,o,a,s,n;(t=e.querySelector(".acceptAll"))==null||t.addEventListener("click",()=>{Pu({security:!0,analytics:!0,sentry:!0}),zu()}),(o=e.querySelector(".rejectAll"))==null||o.addEventListener("click",()=>{Pu({security:!0,analytics:!1,sentry:!1}),zu()}),(a=e.querySelector(".openSettings"))==null||a.addEventListener("click",()=>{nk()}),(s=e.querySelector(".cookie.ads .textButton"))==null||s.addEventListener("click",()=>{try{KA()}catch{console.error("Failed to open ad consent UI"),m("Failed to open Ad consent popup. Do you have an ad or cookie popup blocker enabled?",-1)}}),(n=e.querySelector(".acceptSelected"))==null||n.addEventListener("click",()=>{const l=e.querySelector(".cookie.analytics input").checked,c=e.querySelector(".cookie.sentry input").checked;Pu({security:!0,analytics:l,sentry:c}),zu()})}}),yo=document.querySelector("#pageSettings");var Sy;(Sy=yo==null?void 0:yo.querySelector("#shareCustomThemeButton"))==null||Sy.addEventListener("click",()=>{GB()});var xy;(xy=yo==null?void 0:yo.querySelector(".section.updateCookiePreferences .buttons button"))==null||xy.addEventListener("click",()=>{ik(!0)});var Ty;(Ty=yo==null?void 0:yo.querySelector(".section.presets"))==null||Ty.addEventListener("click",e=>{var o,a,s,n;const t=e.target;if(t.classList.contains("addPresetButton"))gc("add");else if(t.classList.contains("editButton")){const l=(o=t.parentElement)==null?void 0:o.getAttribute("data-id"),c=(a=t.parentElement)==null?void 0:a.getAttribute("data-display");if(l===void 0||c===void 0||l===""||c===""||l===null||c===null){m("Failed to edit preset: Could not find preset id or name",-1);return}gc("edit",l,c)}else if(t.classList.contains("removeButton")){const l=(s=t.parentElement)==null?void 0:s.getAttribute("data-id"),c=(n=t.parentElement)==null?void 0:n.getAttribute("data-display");if(l===void 0||c===void 0||l===""||c===""||l===null||c===null){m("Failed to remove preset: Could not find preset id or name",-1);return}gc("remove",l,c)}});var Ly;(Ly=yo==null?void 0:yo.querySelector(".section.tags"))==null||Ly.addEventListener("click",e=>{var o,a,s,n,l,c;const t=e.target;if(t.classList.contains("addTagButton"))Gn("add");else if(t.classList.contains("editButton")){const u=(o=t.parentElement)==null?void 0:o.getAttribute("data-id"),d=(a=t.parentElement)==null?void 0:a.getAttribute("data-display");if(u===void 0||d===void 0||u===""||d===""||u===null||d===null){m("Failed to edit tag: Could not find tag id or name",-1);return}Gn("edit",u,d)}else if(t.classList.contains("clearPbButton")){const u=(s=t.parentElement)==null?void 0:s.getAttribute("data-id"),d=(n=t.parentElement)==null?void 0:n.getAttribute("data-display");if(u===void 0||d===void 0||u===""||d===""||u===null||d===null){m("Failed to clear tag PB: Could not find tag id or name",-1);return}Gn("clearPb",u,d)}else if(t.classList.contains("removeButton")){const u=(l=t.parentElement)==null?void 0:l.getAttribute("data-id"),d=(c=t.parentElement)==null?void 0:c.getAttribute("data-display");if(u===void 0||d===void 0||u===""||d===""||u===null||d===null){m("Failed to remove tag: Could not find tag id or name",-1);return}Gn("remove",u,d)}});function XB(e){var l;const t=lk.getModal();t.querySelector("table tbody").innerHTML="",t.querySelector("table thead tr td").textContent=e,t.querySelector("table thead tr td span.unit").textContent=r.typingSpeedUnit;const o=x();if(!o)return;const a=(l=o.personalBests)==null?void 0:l[e];if(a===void 0)return;const s=[];Object.keys(a).forEach(function(c){let u=a[c]??[];u=u.sort(function(d,p){return p.wpm-d.wpm}),u.forEach(function(d){d.mode2=c,s.push(d)})});let n;s.forEach(c=>{var p;let u='-<br><span class="sub">-</span>';const d=new Date(c.timestamp);c.timestamp&&(u=ae(d,"dd MMM yyyy")+"<br><div class='sub'>"+ae(d,"HH:mm")+"</div>"),(p=t.querySelector("table tbody"))==null||p.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${n===c.mode2?"":c.mode2}</td>
        <td>
          ${z.typingSpeed(c.wpm)}
          <br />
          <span class="sub">${z.accuracy(c.acc)}</span>
        </td>
        <td>
          ${z.typingSpeed(c.raw)}
          <br />
          <span class="sub">${z.percentage(c.consistency)}</span>
        </td>
        <td>${c.difficulty}</td>
        <td>${c.language?ea(c.language):"-"}</td>
        <td>${c.punctuation?'<i class="fas fa-check"></i>':""}</td>
        <td>${c.numbers?'<i class="fas fa-check"></i>':""}</td>
        <td>${c.lazyMode?'<i class="fas fa-check"></i>':""}</td>
        <td>${u}</td>
      </tr>
    `),n=c.mode2})}function rk(e){lk.show({beforeAnimation:async()=>{XB(e)}})}const lk=new le({dialogId:"pbTablesModal"});function ZB(){if(!it()){m("You are offline",0,{duration:2});return}dk.show({beforeAnimation:async()=>{tF(),oF()}})}function JB(){dk.hide({afterAnimation:async()=>{const e=x();e&&Jc("account",e)}})}const Qm=i("#editProfileModal .bio"),Ym=i("#editProfileModal .keyboard"),Xm=i("#editProfileModal .twitter"),Zm=i("#editProfileModal .github"),Jm=i("#editProfileModal .website"),Gl=i("#editProfileModal .badgeSelectionContainer"),ck=document.querySelector("#editProfileModal .editProfileShowActivityOnPublicProfile"),eF=[Hu(Xm,rS),Hu(Zm,lS),Hu(Jm,cS)];let Ni=-1;function tF(){var l;const e=x();if(!e)return;const t=((l=e.inventory)==null?void 0:l.badges)??[],{bio:o,keyboard:a,socialProfiles:s,showActivityOnPublicProfile:n}=e.details??{};Ni=-1,Qm.val(o??""),Ym.val(a??""),Xm.val((s==null?void 0:s.twitter)??""),Zm.val((s==null?void 0:s.github)??""),Jm.val((s==null?void 0:s.website)??""),Gl.html(""),ck.checked=n||!1,t==null||t.forEach(c=>{c.selected&&(Ni=c.id);const u=jr(c.id,!1,!0),d=`<button type="button" class="badgeSelectionItem ${c.selected?"selected":""}" selection-id=${c.id}>${u}</button>`;Gl.append(d)}),Gl.prepend(`<button type="button" class="badgeSelectionItem ${Ni===-1?"selected":""}" selection-id=-1>
      <div class="badge">
        <i class="fas fa-frown-open"></i>
        <div class="text">none</div>
      </div>
    </button>`),i(".badgeSelectionItem").on("click",({currentTarget:c})=>{const u=i(c).attr("selection-id");Ni=parseInt(u,10),Gl.find(".badgeSelectionItem").removeClass("selected"),i(c).addClass("selected")}),eF.forEach(c=>c.hide())}function oF(){new Qr(Qm,250),new Qr(Ym,75)}function aF(){const e=Qm.val()??"",t=Ym.val()??"",o=Xm.val()??"",a=Zm.val()??"",s=Jm.val()??"",n=ck.checked??!1;return{bio:e,keyboard:t,socialProfiles:{twitter:o,github:a,website:s},showActivityOnPublicProfile:n}}async function sF(){var n,l,c,u,d;const e=x();if(!e)return;const t=aF(),o=39;if(((n=t.socialProfiles)==null?void 0:n.github)!==void 0&&((l=t.socialProfiles)==null?void 0:l.github.length)>o){m(`GitHub username exceeds maximum allowed length (${o} characters).`,-1);return}const a=20;if(((c=t.socialProfiles)==null?void 0:c.twitter)!==void 0&&((u=t.socialProfiles)==null?void 0:u.twitter.length)>a){m(`Twitter username exceeds maximum allowed length (${a} characters).`,-1);return}te();const s=await E.users.updateProfile({body:{...t,selectedBadgeId:Ni}});if(V(),s.status!==200){m("Failed to update profile: "+s.body.message,-1);return}e.details=s.body.data??t,(d=e.inventory)==null||d.badges.forEach(p=>{p.id===Ni?p.selected=!0:delete p.selected}),m("Profile updated",1),JB()}function Hu(e,t){const o=new Jd(e,{valid:{icon:"fa-check",level:1},invalid:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}});return e.on("input",a=>{const s=a.target.value;if(s===void 0||s===""){o.hide();return}const n=t.safeParse(s);if(!n.success){o.show("invalid",n.error.errors.map(l=>l.message).join(", "));return}o.show("valid")}),o}const dk=new le({dialogId:"editProfileModal",setup:async e=>{e.addEventListener("submit",async t=>{t.preventDefault(),await sF()})}});function iF(e){uk.show({...e,focusFirstInput:!0,beforeAnimation:async t=>{t.querySelector("input").value=""}})}function nF(e=!1){uk.hide({clearModalChain:e})}function rF(){const e=i("#newFilterPresetModal input").val();if(e===""){m("Name cannot be empty",0);return}PE(e),nF(!0)}async function lF(e){e.addEventListener("submit",t=>{t.preventDefault(),rF()})}const uk=new le({dialogId:"newFilterPresetModal",setup:lF}),Tl=document.querySelector("#pageAccount");i(Tl).on("click",".pbsTime .showAllButton",()=>{rk("time")});i(Tl).on("click",".pbsWords .showAllButton",()=>{rk("words")});i(Tl).on("click",".editProfileButton",()=>{if(!F()){m("You must be logged in to edit your profile",0);return}const e=x();if(!e){m("Failed to open edit profile modal: No user snapshot found",-1);return}if(e.banned===!0){m("Banned users cannot edit their profile",0);return}ZB()});const cF=P.array(P.string());i(Tl).on("click",".group.history .resultEditTagsButton",e=>{const t=i(e.target).attr("data-result-id"),o=i(e.target).attr("data-tags");YC(t??"",vn(o??"[]",cF),"accountPage")});i(Tl).find("button.createFilterPresetBtn").on("click",()=>{iF()});const Ou=document.getElementById("pageLeaderboards");for(const e of(Ou==null?void 0:Ou.querySelectorAll(".jumpButtons button[data-action='goToPage']"))??[])e==null||e.addEventListener("click",()=>{Ue("lbGoToPage")});function dF(){if(!li()){m("Could not show forgot password popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}eg.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async e=>{Fa("forgotPasswordModal"),En(e.querySelector(".g-recaptcha"),"forgotPasswordModal",async()=>{await fk()})}})}async function fk(){const e=Sl("forgotPasswordModal");if(!e){m("Please complete the captcha");return}const t=eg.getModal().querySelector("input").value.trim();if(!t){m("Please enter your email address"),Fa("forgotPasswordModal");return}if(!Cc.safeParse(t).success){m("Please enter a valid email address"),Fa("forgotPasswordModal");return}te(),E.users.forgotPasswordEmail({body:{email:t,captcha:e}}).then(a=>{if(V(),a.status!==200){m("Failed to send password reset email: "+a.body.message,-1);return}m(a.body.message,1,{duration:5})}),cp()}function cp(){eg.hide()}async function uF(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",async()=>{await fk()})}const eg=new le({dialogId:"forgotPasswordModal",setup:uF,customEscapeHandler:async()=>{cp()},customWrapperClickHandler:async()=>{cp()}}),fF=document.querySelector("#pageLogin");i(fF).on("click","#forgotPasswordButton",()=>{dF()});let rt;function pF(e){pk.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async()=>{if(rt=e,!li()){m("Could not show google sign up popup: Captcha is not avilable. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}Fa("googleSignUpModal"),En(i("#googleSignUpModal .captcha")[0],"googleSignUpModal"),hF(),tg()},afterAnimation:async()=>{li()||Jr()}})}async function Jr(){pk.hide({afterAnimation:async()=>{var e;eb(),rt!==void 0&&(m("Sign up process cancelled",0,{duration:5}),Zo(),oa(),(e=gp(rt))!=null&&e.isNewUser&&(await E.users.delete(),await(rt==null?void 0:rt.user.delete().catch(()=>{}))),yi(),rt=void 0)}})}async function mF(){var o;if(!rt){m("Missing user credential. Please close the popup and try again.",-1);return}const e=Sl("googleSignUpModal");if(!e){m("Please complete the captcha",0);return}yF(),tg(),te();const t=i("#googleSignUpModal input").val();try{if(t.length===0)throw new Error("Name cannot be empty");const a=await E.users.create({body:{name:t,captcha:e}});if(a.status!==200)throw new Error(`Failed to create user: ${a.body.message}`);a.status===200&&(await Gy(rt.user,{displayName:t}),await C1(rt.user),m("Account created",1),oa(),Zo(),await lC(rt.user),rt=void 0,V(),Jr())}catch(a){console.log(a);const s=re(a,"Failed to sign in with Google");m(s,-1),Zo(),oa(),$m(),rt&&((o=gp(rt))!=null&&o.isNewUser)&&(await E.users.delete(),await(rt==null?void 0:rt.user.delete().catch(()=>{}))),yi(),rt=void 0,Jr(),V();return}}function gF(){i("#googleSignUpModal button").prop("disabled",!1)}function tg(){i("#googleSignUpModal button").prop("disabled",!0)}const og=document.querySelector("#googleSignUpModal input");function hF(){og.disabled=!1}function yF(){og.disabled=!0}ys(og,{schema:hd,isValid:async e=>(await E.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available",debounceDelay:1e3,callback:e=>{e.status==="success"?gF():tg()}});async function bF(e){e.addEventListener("submit",t=>{t.preventDefault(),mF()})}R1((e,t)=>{e!==void 0&&t&&pF(e)});const pk=new le({dialogId:"googleSignUpModal",setup:bF,customEscapeHandler:async()=>{Jr()},customWrapperClickHandler:async()=>{Jr()}}),mk=console.log,vF=console.warn,wF=console.error,gk=new Gt({key:"debugLogs",schema:P.boolean(),fallback:!1});let tr=gk.get();function CF(){tr=!tr,hk(`Debug logs ${tr?"enabled":"disabled"}`),gk.set(tr)}function hk(...e){mk("%cINFO","background:#4CAF50;color: #111;padding:0 5px;border-radius:10px",...e)}function kF(...e){vF("%cWRN","background:#FFC107;color: #111;padding:0 5px;border-radius:10px",...e)}function SF(...e){wF("%cERR","background:#F44336;color: #111;padding:0 5px;border-radius:10px",...e)}function xF(...e){tr&&mk("%cDEBG","background:#2196F3;color: #111;padding:0 5px;border-radius:10px",...e)}console.log=hk;console.warn=kF;console.error=SF;console.debug=xF;const yk=new Gt({key:"accountSettingsMessageDismissed",schema:P.boolean(),fallback:!1});yk.get()&&i(".pageSettings .accountSettingsNotice").remove();i(".pageSettings .accountSettingsNotice .dismissAndGo").on("click",()=>{yk.set(!0),Qe("/account-settings"),i(".pageSettings .accountSettingsNotice").remove()});let dp=!1;const TF=new RegExp("\\p{P}","u");async function LF(e){function t(d,p){let f=d.shiftKey;const g=dp&&p.length>2?2:0,h=!TF.test(p.slice(g,g+2).join());pn&&h&&(f=!d.shiftKey);const y=p[(f?1:0)+g]??"",v=p[f?1:0]??"",w=p[0];return y||v||w}let o;try{o=await zs(r.layout)}catch(d){return m(re(d,"Failed to emulate event"),-1),null}wo().includes("layout_mirror")&&(o=sm(o));let s=[];if(o.type==="ansi"?s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:o.type==="iso"?s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:o.type==="matrix"&&(s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]),!s.includes(e.code))return null;const n=o.keys,l=n.row1.concat(n.row2).concat(n.row3).concat(n.row4).concat(n.row5),c=s.indexOf(e.code);if(c===-1)return e.code.includes("Numpad")?e.key:null;const u=t(e,l[c]??[]);return u!==void 0?u:null}function bk(e){const t=e.code==="AltLeft"&&navigator.userAgent.includes("Mac");e.code!=="AltRight"&&!t||(e.type==="keydown"&&(dp=!0),e.type==="keyup"&&(dp=!1))}i(document).on("keydown",bk);i(document).on("keyup",bk);const vk=["MediaTrackNext","MediaTrackPrevious","MediaPlayPause","AudioVolumeUp","AudioVolumeDown","AudioVolumeMute","Home","End"],$F=["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","OS","NumLock","ScrollLock","Scroll","Shift","Super","Symbol","SymbolLock"];let dd=!1,ud=!0,Nu=!1,wk,Uu=0,fd=!1;const jh=document.getElementById("wordsInput"),Ck=document.getElementById("koInputVisual");function $o(e){e!==jh.value&&(jh.value=e)}function Ui(){var t;const e=U(ml());if(isNaN(e)||$L(e),r.keymapMode==="next"&&r.mode!=="zen")if(!r.language.startsWith("korean"))Za(I.getCurrent().charAt(k.current.length));else{const o=dt.disassemble(I.getCurrent(),!0),a=dt.disassemble(k.current,!0),s=a.length-1;if(a[s]){const n=a[s].length;try{const l=o[s][n]??o[a.length][n-o[s].length];Za(l)}catch{Za("")}}else{const n=(t=o==null?void 0:o[0])==null?void 0:t[0];n!==void 0&&Za(n)}}}function kk(){var a,s,n,l;if(!Ae)return;const e=Z-ut;if(k.getHistory().length===0||e===0)return;const t=document.querySelectorAll("#words > .word");if(k.getHistory(Z-1)===I.get(Z-1)&&!r.freedomMode||(a=t[e-1])!=null&&a.classList.contains("hidden")||r.confidenceMode==="on"||r.confidenceMode==="max")return;const o=(n=(s=t[e])==null?void 0:s.children[0])==null?void 0:n.classList.contains("incorrect");if(r.stopOnError==="letter"&&o&&Io(),k.current=k.popHistory(),tt.popHistory(),gi("nospace")&&(k.current=k.current.slice(0,-1),$o(" "+k.current+" ")),ex(),Od(!0),Oc(I.getCurrent()),Io(),r.mode==="zen"){fl();const c=((l=document.querySelector("#words"))==null?void 0:l.children)??[];for(let u=c.length-1;u>=0;u--){const d=c[u];if(d.classList.contains("newline")||d.classList.contains("beforeNewline")||d.classList.contains("afterNewline"))d.remove();else break}}Ea(),Os("backWord")}async function Qh(){var u;if(!Ae||k.current===""||Hs()&&r.language.startsWith("chinese"))return;const e=I.getCurrent();for(const d of Ct("handleSpace"))d.functions.handleSpace();dd=!0;const t=Wv();LL(Math.round(t)),Kb(t);const o=gi("nospace"),a=e===k.current||r.mode==="zen";if(zw(a,!0),zb(a),a)r.stopOnError==="letter"&&Io(),Zg(!0,e),k.pushHistory(),wg(),Oc(I.getCurrent()),sf(),nf(Z),o||Ho(),Os("submitCorrectWord");else{o||(r.playSoundOnError==="off"||r.blindMode?Ho():yl()),Nb(I.getCurrent()),Pb();const d=k.current.length;if(d<=I.getCurrent().length&&(d>=tt.current.length?tt.current+="_":tt.current=tt.current.substring(0,d)+"_"+tt.current.substring(d+1)),r.stopOnError!=="off"){if(r.difficulty==="expert"||r.difficulty==="master"){mr("difficulty");return}r.stopOnError==="word"&&(dd=!1,Os("incorrectLetter","_"),Io(),Ea());return}Zg(!1,e),r.blindMode?r.highlightMode!=="off"&&X$(Z-ut):Y$(Z-ut),k.pushHistory(),wg(),Oc(I.getCurrent()),sf(),nf(Z),Os("submitErrorWord"),(r.difficulty==="expert"||r.difficulty==="master")&&mr("difficulty")}tt.pushHistory();const s=Z===I.length;if(ym()&&s){ii();return}let n;r.mode==="zen"?n=k.current.length:n=I.getCurrent().length;const l=Vk(r.minBurstCustomSpeed,n);if(r.minBurst==="fixed"&&t<r.minBurstCustomSpeed||r.minBurst==="flex"&&t<l){mr("min burst");return}r.keymapMode==="react"&&gv(" ",!0),(r.mode==="words"||r.mode==="custom"||r.mode==="quote"||r.mode==="zen")&&fl(),s?(fd=!0,te(),await nh(),V(),fd=!1):nh(),Od(),Ea();const c=r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&ke()===0;if(!r.showAllLines||c){const d=Math.floor(((u=document.querySelectorAll("#words .word")[Z-ut-1])==null?void 0:u.offsetTop)??0),{data:p}=gd(()=>{var f;return Math.floor(((f=document.querySelectorAll("#words .word")[Z-ut])==null?void 0:f.offsetTop)??0)});(p??0)>d&&Vp(d)}}function Sk(e,t){if(!ud)return!1;if(r.mode==="zen")return!0;if(k.getKoreanStatus()){const n=dt.disassemble(I.getCurrent())[t];return n===void 0?!1:n===e}const o=I.getCurrent()[t];if(o===void 0)return!1;if(o===e)return!0;const a=za("isCharCorrect");return a?a.functions.isCharCorrect(e,o):!!(r.language.startsWith("russian")&&(e==="ё"||e==="е"||e==="e")&&(o==="ё"||o==="е"||o==="e")||(e==="’"||e==="‘"||e==="'"||e==="ʼ"||e==="׳"||e==="ʻ")&&(o==="’"||o==="‘"||o==="'"||o==="ʼ"||o==="׳"||o==="ʻ")||(e==='"'||e==="”"||e==="“"||e==="„")&&(o==='"'||o==="”"||o==="“"||o==="„")||(e==="–"||e==="—"||e==="-")&&(o==="-"||o==="–"||o==="—"))}async function Ut(e,t,o){var v;if(Zs||de)return;if(e==="…"&&I.getCurrent()[t]!=="…"){for(let w=0;w<3;w++)await Ut(".",t+w);return}if(e==="œ"&&I.getCurrent()[t]!=="œ"){await Ut("o",t),await Ut("e",t+1);return}if(e==="æ"&&I.getCurrent()[t]!=="æ"){await Ut("a",t),await Ut("e",t+1);return}console.debug("Handling char",e,t,o);const a=performance.now(),s=k.getKoreanStatus();for(const w of Ct("handleChar"))e=w.functions.handleChar(e);const n=gi("nospace");if(e!==`
`&&e!=="	"&&/\s/.test(e)){if(n)return;if(Qh(),r.difficulty!=="normal"||r.strictSpace&&r.mode!=="zen"||r.stopOnError==="word"&&t>0){if(dd){dd=!1;return}}else return}if(r.mode!=="zen"&&I.getCurrent()[t]!==`
`&&e===`
`||!Ae&&!dE(a))return;zo(!0),Gb();const l=Sk(e,t);let c;if(l&&r.mode!=="zen"&&(e=s?dt.disassemble(I.getCurrent())[t]??"":I.getCurrent().charAt(t)),!l&&e===`
`){if(k.current==="")return;e=" "}if(k.current===""&&fL(a),s||r.language.startsWith("korean")?(c=(o??"").slice(1),Ck.innerText=c.slice(-1)):r.language.startsWith("chinese")?c=(o??"").slice(1):c=k.current.substring(0,t)+e+k.current.substring(t+1),!l&&Hs()&&!r.language.startsWith("korean")){k.current=c,Io(),Ea();return}if(zw(l),zb(l),l||(Pb(),Nb(I.getCurrent())),S$(r.mode==="zen"?e:I.getCurrent()[t]??"",l),l||r.playSoundOnError==="off"||r.blindMode?Ho():yl(),r.keymapMode==="react"&&gv(e,l),r.difficulty!=="master")if(ud)Uu=0;else{Uu++,Uu>=5&&m("Opposite shift mode is on.",0,{important:!0,customTitle:"Reminder"});return}if(tt.current==="")tt.current+=s?dt.disassemble(c).join(""):c;else{const w=s?dt.disassemble(tt.current).length:tt.current.length;t>=w?tt.current+=s?dt.disassemble(e).concat().join(""):e:l||(tt.current=tt.current.substring(0,t)+e+tt.current.substring(t+1))}if(sf(),nf(Z),r.difficulty!=="master"&&r.stopOnError==="letter"&&!l){r.blindMode||Io(k.current+e);return}Os(l?"correctLetter":"incorrectLetter",e);const u=(v=document.querySelectorAll("#words .word"))==null?void 0:v[Z-ut];if((s?dt.disassemble(k.current).length:k.current.length)===1&&Z===0&&(u==null||u.offsetTop,void 0),r.mode==="zen"&&t<30||r.mode!=="zen"&&c.length<I.getCurrent().length+20?k.current=c:console.error("Hitting word limit"),!l&&r.difficulty==="master"){mr("difficulty");return}if(r.mode!=="zen"){const w=I.getCurrent(),S=Z===I.length-1,T=ym(),q=w===k.current,_=r.quickEnd&&!r.language.startsWith("korean")&&w.length===k.current.length&&r.stopOnError==="off",N=r.language.startsWith("chinese");if(S&&T&&(q||_)&&(!N||o!==void 0&&t+2===o.length)){ii();return}}const p=u==null?void 0:u.offsetTop;await Io();const f=u==null?void 0:u.offsetTop;p<f&&!gf&&(r.mode==="zen"||r.indicateTypos==="replace"?r.showAllLines||Vp(p):(k.current=k.current.slice(0,-1),await Io())),(n&&k.current.length===I.getCurrent().length||e===`
`&&l)&&Qh();const g=I.getCurrent(),h=/^\t+/.test(I.getCurrent()),y=g[k.current.length]==="	";setTimeout(()=>{if(l&&r.language.startsWith("code")&&h&&y){const w=new KeyboardEvent("keydown",{key:"Tab",code:"Tab"});document.dispatchEvent(w)}},0),e!==`
`&&Ea()}async function MF(e,t){if(Zs){e.preventDefault();return}let o=!1;(r.mode==="zen"&&!e.shiftKey||Tr&&!e.shiftKey)&&(o=!0);const a=Xt("commandLineWrapper")||t;if(r.quickRestart==="esc"){if(a||ee()==="login")return;if(e.preventDefault(),!de&&o){await Ut("	",k.current.length),$o(" "+k.current);return}}else if(r.quickRestart==="tab"){if(a||ee()==="login")return;if(ee()!=="test"){await Qe("/");return}if(e.shiftKey?oe():Dr(),!de&&o){e.preventDefault(),await Ut("	",k.current.length),$o(" "+k.current);return}W({event:e})}else{if(a||ee()!=="test"||de)return;if(o){e.preventDefault(),await Ut("	",k.current.length),$o(" "+k.current);return}setTimeout(()=>{var s;((s=document.activeElement)==null?void 0:s.id)!=="wordsInput"&&zo(!1)},0)}}i("#wordsInput").on("keydown",e=>{const t=ee()==="test",o=Xt("commandLineWrapper"),a=Xt("leaderboardsWrapper"),s=md();t&&!o&&!a&&!s&&!de&&e.key!=="Enter"&&!fd&&ib||e.preventDefault()});let Vu=-1;i(document).on("keydown",async e=>{var c,u;if(Ks()){console.debug("Ignoring keydown during page transition.");return}if(vk.includes(e.key)){console.debug(`Key ${e.key} is on the list of ignored keys. Stopping keydown event.`),e.preventDefault();return}for(const d of Ct("handleKeydown"))d.functions.handleKeydown(e);const t=i("#wordsInput").is(":focus"),o=ee()==="test",a=Xt("commandLineWrapper"),s=Xt("leaderboardsWrapper"),n=md(),l=o&&!a&&!s&&!n&&!de&&(t||e.key!=="Enter")&&!fd;if(l&&!t&&!["Enter"," ","Escape","Tab",...$F].includes(e.key)&&(fn(),r.showOutOfFocusWarning&&!e.ctrlKey&&!e.metaKey&&e.preventDefault()),e.key==="Tab"&&await MF(e,n),e.key==="Escape"&&r.quickRestart==="esc"){if(Xt("commandLineWrapper")||n)return;if(ee()!=="test"){await Qe("/");return}e.shiftKey?oe():Dr(),W({event:e})}if(e.key==="Enter"&&r.quickRestart==="enter"){const d=document.activeElement;if((d==null?void 0:d.tagName)==="BUTTON"||(d==null?void 0:d.tagName)==="A"||(d==null?void 0:d.classList.contains("button"))||(d==null?void 0:d.classList.contains("textButton"))||(d==null?void 0:d.tagName)==="INPUT"&&(d==null?void 0:d.id)!=="wordsInput"||Xt("commandLineWrapper")||n)return;if(ee()!=="test"){await Qe("/");return}if(de){W({event:e});return}r.mode==="zen"||(!Lr&&!r.funbox.includes("58008")||(Lr||r.funbox.includes("58008"))&&e.shiftKey)&&(e.shiftKey?oe():Dr(),W({event:e}))}if(l){if(!((c=e.originalEvent)!=null&&c.isTrusted)||Vt){e.preventDefault();return}if(Wb(),e.key==="Backspace"){if(Ho(),/INPUT|SELECT|TEXTAREA/i.test(e.target.tagName)||e.preventDefault(),r.confidenceMode==="max"){e.preventDefault();return}r.codeUnindentOnBackspace&&k.current.length>0&&/^\t*$/.test(k.current)&&r.language.startsWith("code")&&Sk(k.current.slice(-1),k.current.length-1)&&(k.getHistory(Z-1)!==I.get(Z-1)||r.freedomMode)&&(k.current="",await Io())}if(e.key==="Backspace"&&k.current.length===0&&(kk(),k.current&&$o(" "+k.current+" ")),e.key==="Enter")if(e.shiftKey)if(r.mode==="zen")ii();else if(Zd(r.mode,r.words,r.time,Ia(),ta()??!1))await Ut(`
`,k.current.length),$o(" "+k.current),Ui();else{const d=Date.now()-Vu;Vu===-1||d>200?(Vu=Date.now(),d>=5e3&&m("Please double tap shift+enter to confirm bail out",0,{important:!0,duration:5})):(wp(!0),ii())}else await Ut(`
`,k.current.length),$o(" "+k.current),Ui();if(e.key==="Dead"&&!Hs()){Ho();const d=(u=document.querySelectorAll("#words .word"))==null?void 0:u[Z-ut],p=k.current.length,f=d==null?void 0:d.querySelectorAll("letter")[p];f&&f.classList.toggle("dead")}if(r.oppositeShiftMode!=="off")if(r.oppositeShiftMode==="keymap"&&r.keymapLayout!=="overrideSync"){let d=await zs(r.keymapLayout).catch(()=>{});if(d===void 0){m("Failed to load keymap layout",-1);return}wo().includes("layout_mirror")&&(d=sm(d));const f=Hv(e.key,d);ud=f===void 0?!0:Cf(f)}else ud=Cf(e.code);for(const d of Ct("preventDefaultEvent"))await d.functions.preventDefaultEvent(e)&&(e.preventDefault(),await Ut(e.key,k.current.length),Ui(),$o(" "+k.current));if(r.layout!=="default"&&!(e.ctrlKey||e.altKey&&Uk())){const d=await LF(e);d!==null&&(e.preventDefault(),await Ut(d,k.current.length),Ui(),$o(" "+k.current))}wk=e.key==="Backspace"||e.key==="delete"}});i("#wordsInput").on("keydown",e=>{var o;if((o=e.originalEvent)!=null&&o.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}GM(e),e.code==="NumpadEnter"&&r.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&r.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const a=e.code===""||e.key==="Unidentified"?"NoCode":e.code;mL(t,a)},0)});i("#wordsInput").on("keyup",e=>{var o;if((o=e.originalEvent)!=null&&o.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}e.code==="NumpadEnter"&&r.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&r.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const a=e.code===""||e.key==="Unidentified"?"NoCode":e.code;Hb(t,a)},0)});i("#wordsInput").on("keyup",e=>{var t;if(!((t=e.originalEvent)!=null&&t.isTrusted)||Vt){e.preventDefault();return}jM(e),vk.includes(e.key)});i("#wordsInput").on("beforeinput",e=>{var t;(t=e.originalEvent)!=null&&t.isTrusted&&e.target.value===""&&(e.target.value=" ")});i("#wordsInput").on("input",async e=>{var u;if(!((u=e.originalEvent)!=null&&u.isTrusted)||Vt){e.target.value=" ";return}if(md()){e.preventDefault();return}Wb(),(r.layout==="default"||r.layout==="korean")&&e.target.value.normalize().match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)&&k.setKoreanStatus(!0);const o=k.getKoreanStatus(),a=r.language.startsWith("chinese"),s=e.target.value.normalize(),n=o?dt.disassemble(s).join("").slice(1):s.slice(1),l=o?dt.disassemble(k.current).join(""):k.current;if(o&&!wk&&(Nu||s.slice(1).length<k.current.length&&dt.disassemble(k.current.slice(-1)).length>1)){Nu=!Nu;return}if(r.layout!=="default"&&n.length>=l.length){$o(" "+l),Ui();return}if(s.length===0&&l.length===0)kk();else if(n.length<l.length){if(a)if(l.length-n.length<=2&&l.startsWith(l))k.current=n;else{let d=0;for(;n[d]===l[d];)d++;let p=0;r.stopOnError!=="word"&&/.+ .+/.test(n)&&(p=n.indexOf(" ")+1);for(let f=d;f<n.length;f++)await Ut(n[f],f-p,s)}else if(o){const d=e.target.value.normalize().slice(1);k.current=d,Ck.innerText=d.slice(-1)}else k.current=n;Io(),Ea(),Hs()||((e==null?void 0:e.originalEvent).inputType==="deleteWordBackward"?Os("setLetterIndex",0):Os("setLetterIndex",l.length-1))}if(n!==l){let d=0;for(;n[d]===l[d];)d++;let p=0;r.stopOnError!=="word"&&/.+ .+/.test(n)&&(p=n.indexOf(" ")+1);for(let f=d;f<n.length;f++)await Ut(n[f],f-p,s)}$o(" "+k.current),Ui();const c=Hs();setTimeout(()=>{const d=Hs();c!==d&&Io(),e.target.selectionStart!==e.target.value.length&&(!Ka.test(e.target.value)||(e.target.selectionStart??0)<e.target.value.search(Ka))&&(e.target.selectionStart=e.target.selectionEnd=e.target.value.length)},0)});var $y;($y=document.querySelector("#wordsInput"))==null||$y.addEventListener("focus",e=>{const t=e.target,o=t.value;t.setSelectionRange(o.length,o.length)});i("#wordsInput").on("copy paste",e=>{e.preventDefault()});i("#wordsInput").on("select selectstart",e=>{e.preventDefault()});i("#wordsInput").on("selectionchange",e=>{e.preventDefault();const t=e.target,o=t.value;t.setSelectionRange(o.length,o.length)});i("#wordsInput").on("keydown",e=>{e.key.startsWith("Arrow")&&e.preventDefault()});i("#wordsInput").on("compositionstart",()=>{r.layout==="default"&&(Dp(!0),zL(k.current.length))});i("#wordsInput").on("compositionend",()=>{r.layout==="default"&&Dp(!1)});const Yh=new Gt({key:"merchBannerClosed3",schema:P.boolean(),fallback:!1});function AF(){Yh.get()||q1('New merch store now open, including a limited edition metal keycap! <a target="_blank" rel="noopener" href="https://mktp.co/merch">monkeytype.store</a>',1,"./images/merch3.png",!1,()=>{Yh.set(!0)},!0)}i(async()=>{await Bb,await W1,i("body").css("transition","background .25s, transform .05s"),AF();for(const e of Ct("applyGlobalCSS"))e.functions.applyGlobalCSS();i("#app").css("opacity","0").removeClass("hidden").stop(!0,!0).animate({opacity:1},fe(250)),it()&&o_().then(()=>{var e;(e=An())!=null&&e.users.signUp||(zx(),i(".register").addClass("hidden"),i(".login").addClass("hidden"),i(".disabledNotification").removeClass("hidden"))}),A2(),new ZS("https://keymash.io/"),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(e=>{console.error("ServiceWorker registration failed: ",e)})})});i("#nocss .requestedStylesheets").html("Requested stylesheets:<br>"+[...document.querySelectorAll("link[rel=stylesheet")].map(e=>e.href).filter(e=>/\/css\/style/gi.test(e)).join("<br>"));i("#nocss .requestedJs").html("Requested Javascript files:<br>"+[...document.querySelectorAll("script")].map(e=>e.src).filter(e=>/(\/js\/mon|\/js\/vendor)/gi.test(e)).join("<br>")+"<br><br>Client version:<br>"+wn.clientVersion);window.navigator.userAgent.toLowerCase().includes("mac")?i("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-top: 1rem;
        margin-bottom: 1rem;
      "
    >
      Cmd
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `):i("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-bottom: 1rem;
      "
    >
      Ctrl
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `);let as;async function xk(e=r.language){if(!as)return;const o=(await kn(e)).bcp47??"en-US";as.lang=o}async function Tk(){as=new SpeechSynthesisUtterance,await xk()}function EF(){as=void 0}async function _F(e){window.speechSynthesis.cancel(),as===void 0&&await Tk(),as!==void 0&&(as.text=e,window.speechSynthesis.speak(as))}ge((e,t)=>{e==="funbox"&&(t==="none"?EF():t==="tts"&&Tk()),e==="language"&&r.funbox.includes("tts")&&xk()});o$(e=>{_F(e)});const Hn=new Jd(i(".page.pageProfileSearch .search input"),{notFound:{icon:"fa-user-slash",level:-1},error:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:1}});function IF(){i(".page.pageProfileSearch .search button").addClass("disabled"),i(".page.pageProfileSearch .search input").attr("disabled","disabled")}function qF(){i(".page.pageProfileSearch .search button").removeClass("disabled"),i(".page.pageProfileSearch .search input").removeAttr("disabled")}function BF(){return i(".page.pageProfileSearch .search input").attr("disabled")!==void 0}function Xh(){i(".page.pageProfileSearch .search input").trigger("focus")}async function FF(){Hn.hide();const e=i(".page.pageProfileSearch .search input").val();if(e==="")return;Hn.show("checking"),IF(),await Te(500);const t=await E.users.getProfile({params:{uidOrName:e}});if(qF(),t.status===404){Xh(),Hn.show("notFound","User not found");return}else if(t.status!==200){Xh(),Hn.show("error",`Error: ${t.body.message}`);return}Hn.hide(),await Qe(`/profile/${e}`,{data:t.body.data})}i(".page.pageProfileSearch form").on("submit",e=>{e.preventDefault(),!BF()&&FF()});oo("pageProfileSearch");const Lk=new Gt({key:"lastSeenVersion",schema:P.string(),fallback:""});let up=null,pd=null;function RF(e){Lk.set(e)}function DF(){return Lk.get()}async function WF(){const{data:e,error:t}=await eo(lL());if(t){const a=re(t,"Failed to fetch version number from GitHub");console.error(a);return}const o=DF();up=e,pd=o===""?!1:o!==e,(pd||o==="")&&(RF(e),PF())}function PF(){"caches"in window&&caches.keys().then(function(e){for(const t of e)caches.delete(t)})}async function zF(){return(up===null||pd===null)&&await WF(),{version:up,isNew:pd}}function HF(e){i("footer .currentVersion .text").text(e)}function OF(e){e?i("#newVersionIndicator").removeClass("hidden"):i("#newVersionIndicator").addClass("hidden")}async function NF(){const{version:e,isNew:t}=await zF();HF(e),OF(t)}oo("devOptionsModal");let bo=[],$k=0,Qo=[],Aa=[];const rs={notifications:[],psas:[]};function Ku(){fp(!1),vx(0),Ak.hide({afterAnimation:async()=>{var l;i("#alertsPopup .notificationHistory .list").empty(),i("#alertsPopup .psas .list").empty();const e=[];let t=0;if(Qo.length===0&&Aa.length===0)return;const o=await E.users.updateInbox({body:{mailIdsToMarkRead:Qo.length>0?Qo:void 0,mailIdsToDelete:Aa.length>0?Aa:void 0}}),a=o.status,s=o.body.message;if(a!==200){m(`Failed to update inbox: ${s}`,-1);return}const n=bo.filter(c=>c.rewards.length>0&&Qo.includes(c.id)).map(c=>c.rewards).reduce(function(c,u){return c.concat(u)},[]);for(const c of n)if(c.type==="xp")t+=c.item;else if(c.type==="badge"){const u=ZE(c.item.id);u&&(e.push(u.name),wx(c.item))}if(e.length>0&&m(`New badge${e.length>1?"s":""} unlocked: ${e.join(", ")}`,1,{duration:5,customTitle:"Reward",customIcon:"gift"}),t>0){const c=((l=x())==null?void 0:l.xp)??0;kb(c,t),y0(c+t),bb(t)}}})}async function UF(){Ak.show({beforeAnimation:async()=>{F()?(i("#alertsPopup .accountAlerts").removeClass("hidden"),i("#alertsPopup .separator.accountSeparator").removeClass("hidden"),i("#alertsPopup .accountAlerts .list").html(`
          <div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`)):(i("#alertsPopup .accountAlerts").addClass("hidden"),i("#alertsPopup .separator.accountSeparator").addClass("hidden")),bo=[],Aa=[],Qo=[],jF(),GF()},afterAnimation:async()=>{F()&&VF()}})}async function VF(){if(!it()){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    You are offline
    </div>
    `);return}const e=await E.users.getInbox();if(e.status===503){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Account inboxes are temporarily unavailable
    </div>
    `);return}else if(e.status!==200){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Error getting inbox: ${e.body.message} Please try again later
    </div>
    `);return}const t=e.body.data;if(bo=t.inbox,ag(),bo.length===0){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `);return}$k=t.maxMail,Mk(),i("#alertsPopup .accountAlerts .list").empty();for(const o of bo){!o.read&&o.rewards.length===0&&Qo.push(o.id);let a="";o.rewards.length>0&&!o.read&&(a=`<div class="rewards">
        <i class="fas fa-fw fa-gift"></i>
        <span>${o.rewards.length}</span>
      </div>`),i("#alertsPopup .accountAlerts .list").append(`
    
      <div class="item" data-id="${o.id}">
        <div class="indicator ${o.read?"":"main"}"></div>
        <div class="timestamp">${Oy(new Date(o.timestamp))} ago</div>
        <div class="title">${o.subject}</div>
        <div class="body">
          ${o.body}

${a}
        </div>
        <div class="buttons">
          ${o.rewards.length>0&&!o.read?'<button class="markReadAlert textButton" aria-label="Claim" data-balloon-pos="left"><i class="fas fa-gift"></i></button>':""}
          ${o.rewards.length>0&&o.read||o.rewards.length===0?'<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>':""}
        </div>
      </div>
    
    `)}}function KF(e,t){rs.psas.push({message:e,level:t})}function GF(){if(rs.psas.length===0)i("#alertsPopup .psas .list").html('<div class="nothing">Nothing to show</div>');else{i("#alertsPopup .psas .list").empty();for(const e of rs.psas){const{message:t,level:o}=e;let a="";o===-1?a="error":o===1?a="main":o===0&&(a="sub"),i("#alertsPopup .psas .list").prepend(`
        <div class="item">
        <div class="indicator ${a}"></div>
        <div class="body">
          ${Ht(t)}
        </div>
      </div>
      `)}}}function jF(){if(rs.notifications.length===0)i("#alertsPopup .notificationHistory .list").html('<div class="nothing">Nothing to show</div>');else{i("#alertsPopup .notificationHistory .list").empty();for(const e of rs.notifications){const{message:t,level:o,customTitle:a}=e;let s="Notice",n="sub";o===-1?(n="error",s="Error"):o===1&&(n="main",s="Success"),a!==void 0&&(s=a),i("#alertsPopup .notificationHistory .list").prepend(`
      <div class="item">
      <div class="indicator ${n}"></div>
      <div class="title">${s}</div>
      <div class="body">
        ${Ht(t)}
      </div>
    </div>
    `)}}}function fp(e){e?i("header nav .showAlerts .notificationBubble").removeClass("hidden"):i("header nav .showAlerts .notificationBubble").addClass("hidden")}function Mk(){const e=bo.length-Aa.length;i("#alertsPopup .accountAlerts .title .right").text(`${e}/${$k}`)}function Zh(e){Aa.push(e),i(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`).remove(),i("#alertsPopup .accountAlerts .list .item").length===0&&i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `),ag(),Mk()}function Jh(e){Qo.push(e);const t=i(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`);ag(),t.find(".indicator").removeClass("main"),t.find(".buttons").empty(),t.find(".buttons").append('<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>'),t.find(".rewards").animate({opacity:0,height:0,marginTop:0},250,"easeOutCubic",()=>{t.find(".rewards").remove()})}function ag(){const e=i("#alertsPopup .accountAlerts .claimAll"),t=i("#alertsPopup .accountAlerts .deleteAll");if(e.addClass("hidden"),t.addClass("hidden"),bo.length>0){let o=0;for(const a of bo)!a.read&&!Qo.includes(a.id)&&(o+=a.rewards.length);o>0?e.removeClass("hidden"):t.removeClass("hidden")}Aa.length===bo.length&&t.addClass("hidden")}i("header nav .showAlerts").on("click",()=>{UF()});A1((e,t,o)=>{rs.notifications.push({message:e,level:t,customTitle:o}),rs.notifications.length>25&&rs.notifications.shift()});sa(e=>{if(e.type==="snapshotUpdated"&&e.data.isInitial){const t=x();fp(((t==null?void 0:t.inboxUnreadSize)??0)>0)}e.type==="authStateChanged"&&!e.data.isUserSignedIn&&(fp(!1),bo=[],Qo=[],Aa=[],i("#alertsPopup .accountAlerts .list").empty())});const Ak=new le({dialogId:"alertsPopup",customAnimations:{show:{modal:{from:{marginRight:"-10rem"},to:{marginRight:"0"},easing:"easeOutCirc"}},hide:{modal:{from:{marginRight:"0"},to:{marginRight:"-10rem"},easing:"easeInCirc"}}},customEscapeHandler:()=>{Ku()},customWrapperClickHandler:()=>{Ku()},setup:async()=>{i("#alertsPopup .accountAlerts").on("click",".claimAll",()=>{for(const e of bo)!e.read&&!Qo.includes(e.id)&&Jh(e.id)}),i("#alertsPopup .accountAlerts").on("click",".deleteAll",()=>{for(const e of bo)Aa.includes(e.id)||Zh(e.id)}),i("#alertsPopup .mobileClose").on("click",()=>{Ku()}),i("#alertsPopup .accountAlerts .list").on("click",".item .buttons .deleteAlert",e=>{const t=i(e.currentTarget).closest(".item").attr("data-id");Zh(t)}),i("#alertsPopup .accountAlerts .list").on("click",".item .buttons .markReadAlert",e=>{const t=i(e.currentTarget).closest(".item").attr("data-id");Jh(t)})}}),sg=new Gt({key:"confirmedPSAs",schema:P.array(Wy),fallback:[]});function QF(){sg.set([])}function Ek(){return sg.get()}function YF(e){const t=Ek();t.push(e),sg.set(t)}async function XF(){const e=await E.psas.get();if(e.status===500){{const{data:t,error:o}=await eo(fetch("https://monkeytype.instatus.com/summary.json"));let a;o?console.log("Failed to fetch Instatus summary",o):a=(await t.json()).activeMaintenances,a!==void 0&&a.length>0&&a[0]!==void 0&&a[0].status==="INPROGRESS"?Ws(`Server is currently offline for scheduled maintenance. <a target= '_blank' href='${a[0].url}'>Check the status page</a> for more info.`,-1,"bullhorn",!0,void 0,!0):Ws("Looks like the server is experiencing unexpected down time.<br>Check the <a target= '_blank' href='https://monkeytype.instatus.com/'>status page</a> for more information.",-1,"exclamation-triangle",!1,void 0,!0)}return null}else{if(e.status===503)return Ws("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Check the status page</a> for more info.",-1,"bullhorn",!0,void 0,!0),null;if(e.status!==200)return null}return e.body.data}async function ZF(){const e=await XF();if(e===null)return;if(e.length===0){QF();return}const t=Ek();e.forEach(o=>{if(be(o.date)){const a=new Date(o.date),s=o.date-Date.now(),n=ft(s/1e3,!1,!1,"text",!1,!0);o.message=o.message.replace("{dateDifference}",n),o.message=o.message.replace("{dateNoTime}",ae(a,"dd MMM yyyy")),o.message=o.message.replace("{date}",ae(a,"dd MMM yyyy HH:mm"))}KF(o.message,o.level??-1),!(t.includes(o._id)&&!(o.sticky??!1))&&Ws(o.message,o.level,"bullhorn",o.sticky,()=>{YF(o._id)},!0)})}sa(e=>{e.type==="authStateChanged"&&ZF()});async function JF(e){if(!e)return;const t=new URLSearchParams(e.slice(1));if(t.has("access_token")){history.replaceState(null,"","/");const o=t.get("access_token"),a=t.get("token_type"),s=t.get("state");te();const n=await E.users.linkDiscord({body:{tokenType:a,accessToken:o,state:s}});if(V(),n.status!==200){m("Failed to link Discord: "+n.body.message,-1);return}if(n.body.data===null){m("Failed to link Discord: data returned was null",-1);return}m(n.body.message,1);const l=x();if(!l)return;const{discordId:c,discordAvatar:u}=n.body.data;c!==void 0&&(l.discordId=c),u!==void 0&&(l.discordAvatar=u),st(l),ef(l)}}const eR=P.object({c:fS,i:P.string().optional(),s:uS.optional(),f:dS.optional()});function tR(e){const t=pp("customTheme",e);if(t===null)return;const{data:o,error:a}=gd(()=>vn(atob(t),eR));if(a){console.log("Custom theme URL decoding failed",a),m("Failed to load theme from URL: "+a.message,0);return}let s,n,l,c;if(Array.isArray(o.c)&&o.c.length===10?(s=o.c,n=o.i,l=o.s,c=o.f):Array.isArray(o)&&o.length===10&&(s=o),s===void 0||s.length!==10){m("Failed to load theme from URL: no colors found",0);return}const u=r.customTheme,d=r.customThemeColors;try{nn(s),m("Custom theme applied",1),n!==void 0&&l!==void 0&&c!==void 0&&(KT(n),Ib(l),Wi(c)),r.customTheme||Sa(!0)}catch(p){m("Something went wrong. Reverting to previous state.",0),console.error(p),Sa(u),nn(d)}}const oR=P.tuple([Py.nullable(),pS.nullable(),Zb.partial({pipeDelimiter:!0,limit:!0,mode:!0}).extend({isTimeRandom:P.boolean().optional(),isWordRandom:P.boolean().optional(),word:P.number().int().optional(),time:P.number().int().optional(),delimiter:P.string().optional()}).nullable(),P.boolean().nullable(),P.boolean().nullable(),P.string().nullable(),mS.nullable(),Ry.or(P.string().nullable())]);function aR(e){const t=pp("testSettings",e);if(t===null)return;const{data:o,error:a}=gd(()=>vn(Ky.decompressFromURI(t)??"",oR));if(a){console.error("Failed to parse test settings:",a),m("Failed to load test settings from URL: "+a.message,0);return}const s={};o[0]!==null&&(gt(o[0],!0),s.mode=o[0]);const n=o[0]??r.mode;if(o[1]!==null&&(n==="time"?wa(parseInt(o[1],10),!0):n==="words"?Qs(parseInt(o[1],10),!0):n==="quote"&&(Ld([-2],!1),Cp(parseInt(o[1],10)),oe()),s.mode2=o[1]),o[2]!==null){const c=o[2];_a(c.text),cn(c.mode??"repeat"),c.limit!==void 0?(_o(c.limit.mode),Ko(c.limit.value)):(c.isWordRandom?_o("word"):c.isTimeRandom&&_o("time"),c.word!==void 0?Ko(c.word):c.time!==void 0&&Ko(c.time)),c.pipeDelimiter?Xs(c.pipeDelimiter):c.delimiter==="|"&&Xs(!0),s["custom text settings"]=""}if(o[3]!==null&&(ls(o[3],!0),s.punctuation=o[3]?"on":"off"),o[4]!==null&&(ka(o[4],!0),s.numbers=o[4]?"on":"off"),o[5]!==null&&(rn(o[5],!0),s.language=o[5]),o[6]!==null&&(ca(o[6],!0),s.difficulty=o[6]),o[7]!==null){let c=[];typeof o[7]=="string"?c=o[7].split("#"):c=o[7],Xa(c,!0),s.funbox=c.join(", ")}W({nosave:!0});let l="";Object.keys(s).forEach(c=>{const u=s[c];u!==void 0&&(l+=`${c}${Ht(u?": "+u:"")}<br>`)}),l!==""&&m("Settings applied from URL:<br><br>"+l,1,{duration:10,allowHTML:!0})}function sR(e){const t=(pp("challenge",e)??"").toLowerCase();t!==""&&(m("Loading challenge",0),vw(t).then(o=>{o&&(m("Challenge loaded",1),W({nosave:!0}))}).catch(o=>{m("Failed to load challenge",-1),console.error(o)}))}sa(e=>{if(e.type==="authStateChanged"){const t=window.location.search,o=window.location.hash;tR(t),aR(t),sR(t),JF(o)}});async function iR(e){const t=Lo;if(t===null)return;cE(e);const o=await E.results.add({body:{result:t}});if(o.status!==200){m("Failed to save last result: "+o.body.message,-1);return}const a=structuredClone(t);a._id=o.body.data.insertedId,o.body.data.isPb&&(a.isPb=!0),hb(a),yb(1,a.testDuration+a.incompleteTestSeconds-a.afkDuration),jw(),m(`Last test result saved ${o.body.data.isPb?"(new pb!)":""}`,1)}function nR(){el.getModal().querySelector(".result").innerHTML=`
  <div class="group wpm">
        <div class="sub">wpm</div>
        <div class="val">-</div>
      </div>
      <div class="group acc">
        <div class="sub">accuracy</div>
        <div class="val">-</div>
      </div>
      <div class="group raw">
        <div class="sub">raw</div>
        <div class="val">-</div>
      </div>
      <div class="group con">
        <div class="sub">consistency</div>
        <div class="val">-</div>
      </div>
      <div class="group chardata">
        <div class="sub">characters</div>
        <div class="val">-</div>
      </div>
      <div class="group testType">
        <div class="sub">test type</div>
        <div class="val">-</div>
      </div>`}function rR(){const e=Lo;Ii("wpm",e.wpm),Ii("acc",e.acc+"%"),Ii("raw",e.rawWpm),Ii("con",e.consistency+"%"),Ii("chardata",e.charStats.join("/"));let t=e.mode+" "+e.mode2;t+="<br>"+e.language,e.numbers&&(t+="<br>numbers"),e.punctuation&&(t+="<br>punctuation"),e.blindMode&&(t+="<br>blind"),e.lazyMode&&(t+="<br>lazy"),e.funbox.length>0&&(t+="<br>"+e.funbox.map(o=>o.replace(/_/g," ")).join(",")),e.difficulty!=="normal"&&(t+="<br>"+e.difficulty),e.tags.length>0&&(t+="<br>"+e.tags.length+" tags"),Ii("testType",t,!0)}function Ii(e,t,o=!1){o?i(el.getModal()).find(`.group.${e} .val`).html(`${t}`):i(el.getModal()).find(`.group.${e} .val`).text(t)}function lR(){if(!Lo){m("Failed to show last signed out result modal: no last result",-1);return}el.show({beforeAnimation:async()=>{nR(),rR()}})}function ey(){el.hide()}sa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&Lo!==null&&lR()});const el=new le({dialogId:"lastSignedOutResult",setup:async e=>{var t,o;(t=e.querySelector("button.save"))==null||t.addEventListener("click",async()=>{const a=Po();a!==null&&iR(a.uid),ey()}),(o=e.querySelector("button.discard"))==null||o.addEventListener("click",()=>{jw(),m("Last test result discarded",0),ey()})},customWrapperClickHandler:()=>{}});Object.defineProperty(Math,"random",{value:Math.random,writable:!1,configurable:!1,enumerable:!0});Object.freeze(Math);Object.defineProperty(window,"Math",{value:Math,writable:!1,configurable:!1,enumerable:!0});function cR(e){for(const[t,o]of Object.entries(e))window[t]=o}YT();NF();zo(!0,!0);z1(cC);const dR=jm();dR===null?ik():sk();cR({snapshot:x,config:r,toggleFilterDebug:c_,glarsesMode:ZA,stats:Rv,replay:hA,enableTimerDebug:tA,getTimerStats:uA,toggleUnsmoothedRaw:r2,egVideoListener:Fq,toggleDebugLogs:CF,toggleSentryDebug:Lx});
//# sourceMappingURL=monkeytype.BiV-Z5bP.js.map
